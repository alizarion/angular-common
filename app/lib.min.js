/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * ProductionManager, v1.0.0
 * A powerful production manager.*/
!function(){var e=angular.module("itesoft",[]);e.directive("itDetail",function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:'<div  id="divDetail" class="col-md-6" ng-if="currentItemWrapper.currentItem"><div>{{selectedItemsCount}}</div><div class="jumbotron" ng-transclude></div></div>'}}),e.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row">           <div class="col-md-12"><form novalidate ng-transclude></form></div></div>'}}),e.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!0,transclude:!0,template:'<div class="row"><div class="col-md-12"><div class="btn-toolbar clearfix pull-right" ng-transclude></div></div></div>'}}),e.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:{itMasterData:"=",itLang:"=",itMasterDetailControl:"=",itLockOnChange:"="},template:'<div class="col-md-6" ui-i18n="{{itLang}}"><div class="jumbotron"><div class="row" ng-transclude></div><div class="row"><div class="col-md-12"> <div ng-grid="gridOptions"  class="gridStyle"></div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout",function(e,t,n,r){function a(t){var r=n.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged?(r.reject("undo or save before change"),r.promise):(e.$parent.currentItemWrapper={originalItem:t,currentItem:angular.copy(t),hasChanged:!1,isWatched:!1},r.resolve(""),r.promise)}function i(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)}function l(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!0,e.$parent.currentItemWrapper.isWatched=!0)}function s(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&(alert("You have unsaved edits. Do you wish to leave?"),t.preventDefault())}e.$parent.currentItemWrapper=null,e.gridOptions={data:"itMasterData",selectedItems:[],rowHeight:40,i18n:e.itLang,enableColumnResize:!0,multiSelect:!0,enableRowSelection:!0,filterOptions:{filterText:"",useExternalFilter:!1},showGroupPanel:!0,showSelectionCheckbox:!0,beforeSelectionChange:function(){return null!=e.$parent.currentItemWrapper?!e.$parent.currentItemWrapper.hasChanged:!0},showFooter:!0,checkboxCellTemplate:'<div class="ngSelectionCell"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.selected" ng-disabled="hasChanged()"/></div>',checkboxHeaderTemplate:'<input class="ngSelectionHeader" type="checkbox" ng-show="multiSelect" ng-model="allSelected" ng-change="toggleSelectAll(allSelected)"  ng-disabled="hasChanged()"/>',rowTemplate:'<div ng-mouseenter="row.mouseover = true" ng-mouseleave="row.mouseover = false"><div ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns"  ng-class="{ selected: row.selected, hovered: row.mouseover}"  ng-click="onRowClick(row,col)" class="ngCell {{col.cellClass}} {{col.colIndex()}}" ng-attr-id="{{\'row\'+row.rowIndex}}"><div class="ngVerticalBar" ng-style="{height: rowHeight}" ng-class="{ ngVerticalBarVisible: !$last }"></div><div ng-attr-id="{{\'cell-r\'+row.rowIndex+\'c\'+col.index}}" ng-cell></div></div></div>',footerTemplate:'<div id="priorityFooter" ng-show="showFooter" class="ngFooterPanel" ng-class="{\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}" ng-style="footerStyle()"> <div class="ngTotalSelectContainer"> <div class="ngFooterTotalItems" ng-class="{\'ngNoMultiSelect\': !multiSelect}"> <span class="ngLabel badge ">{{i18n.ngTotalItemsLabel}}  {{maxRows()}}</span> <span ng-show="filterText.length > 0 && maxRows()!= totalFilteredItemsLength()" class="ngLabel badge badge-warning">{{i18n.ngShowingItemsLabel}}  {{totalFilteredItemsLength()}}</span> <span ng-show="multiSelect" class="ngLabel badge badge-warning">{{i18n.ngSelectedItemsLabel}} {{selectedItems.length}}</span> </div></div> <div class="ngPagerContainer" style="float: right; margin-top: 10px;" ng-show="enablePaging" ng-class="{\'ngNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="ngRowCountPicker">               <span style="float: left; margin-top: 3px;" class="ngLabel">{{i18n.ngPageSizeLabel}}</span><select style="float: left;height: 27px; width: 100px" ng-model="pagingOptions.pageSize">                   <option ng-repeat="size in pagingOptions.pageSizes">{{size}}</option>               </select>           </div>           <div style="float:left; margin-right: 10px; line-height:25px;" class="ngPagerControl"                style="float: left; min-width: 135px;">               <button class="ngPagerButton" ng-click="pageToFirst()" ng-disabled="cantPageBackward()" title="{{i18n.ngPagerFirstTitle}}"> <div class="ngPagerFirstTriangle"> <div class="ngPagerFirstBar"></div> </div></button>  <button class="ngPagerButton" ng-click="pageBackward()" ng-disabled="cantPageBackward()"  title="{{i18n.ngPagerPrevTitle}}">  <div class="ngPagerFirstTriangle ngPagerPrevTriangle"></div>  </button>  <input class="ngPagerCurrent" min="1" max="{{maxPages()}}" type="number"  style="width:50px; height: 24px; margin-top: 1px; padding: 0 4px;"  ng-model="pagingOptions.currentPage"/> <button class="ngPagerButton" ng-click="pageForward()" ng-disabled="cantPageForward()"   title="{{i18n.ngPagerNextTitle}}">  <div class="ngPagerLastTriangle ngPagerNextTriangle"></div> </button> <button class="ngPagerButton" ng-click="pageToLast()" ng-disabled="cantPageToLast()" title="{{i18n.ngPagerLastTitle}}"> <div class="ngPagerLastTriangle">  <div class="ngPagerLastBar"></div>  </div> </button> </div> </div> </div>'},e.$watch("gridOptions.selectedItems",function(){e.gridOptions.selectedItems.length>1?e.$parent.currentItemWrapper=null:1===e.gridOptions.selectedItems.length&&a(e.gridOptions.selectedItems[0])},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.hasChanged=function(){return null!=e.$parent.currentItemWrapper?e.$parent.currentItemWrapper.hasChanged:!1},e.$watch("$parent.currentItemWrapper.currentItem",function(t,n){null!=e.$parent.currentItemWrapper&&e.itLockOnChange&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem))},!0),e.onRowClick=function(t,n){void 0!=n.colDef.index&&a(t.entity).then(function(t){e.gridOptions.selectAll(!1)},function(e){alert(e)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.itMasterDetailControl.getSelectedItems=function(){return e.gridOptions.selectedItems},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getFilteredItems=function(){var t=[];return angular.forEach(e.gridOptions.ngGrid.filteredRows,function(e){t.push(e.entity)}),t},e.itMasterDetailControl.setCurrentItem=function(t){var i=n.defer();return e.gridOptions.selectAll(!1),a(t).then(function(){r(function(){var n=e.itMasterData.indexOf(t);console.log(n),n>=0?(e.gridOptions.selectRow(e.itMasterData.indexOf(t),!0),i.resolve()):i.reject()})},function(){i.reject()}),i.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(a(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),i())},e.$on("unlockCurrentItem",function(){i()}),e.$on("lockCurrentItem",function(){l()}),e.$on("$locationChangeStart",s),e.itAppScope=e.$parent}]}}),e.directive("itMasterDetail",function(){return{restrict:"EA",transclude:!0,scope:!1,template:'<div class="row" ng-transclude></div>'}}),e.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:' <div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control floating-label" type="text" ng-model="$parent.gridOptions.filterOptions.filterText" class="form-control floating-label" it-text="{{itSearchPlaceholder}}"/></div></form></div></div>',link:function(e,t,n){e.itSearchPlaceholder=n.itSearchPlaceholder}}}),e.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,n){return n["class"]?n["class"]&&-1==n["class"].split(" ").indexOf("prettyprint")&&n.$set("class",n["class"]+" prettyprint"):n.$set("class","prettyprint"),function(e,n,r){function a(e){return String(e).replace(/[&<>"'\/]/g,function(e){return i[e]})}var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};console.log(t()),n[0].innerHTML=prettyPrintOne(a(n[0].innerHTML))}}}}]),e.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,n){var r=angular.element(t[0]);r.wrap('<div class="checkbox"></div>'),r.wrap("<label></label>"),r.after('<span class="checkbox-material"><span class="check" style="width: '+n.width+";height:"+n.height+';"></span></span>&nbsp;'+(n.itText||""))}}}),e.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,n,r){if(r){var a=angular.element(t[0]);if(a.hasClass("floating-label")){a.wrap('<div class="form-control-wrapper"></div>');var i=a.attr("placeholder");i?a.after('<div class="floating-label">'+i+"</div"):(a.after('<div class="floating-label">'+e.itText+"</div"),e.$watch("itText",function(e){var t=a[0].offsetParent.children;angular.forEach(t,function(t){var n=angular.element(t);n.hasClass("floating-label")&&n.text(e)})})),a.after('<span class="material-input"></span>'),a.attr("placeholder","").removeClass("floating-label")}a.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){var t=a[0].offsetParent.children;angular.forEach(t,function(t){var n=angular.element(t);n.hasClass("text-danger")&&(n.text(e),""!=e&&void 0!=e?(n.removeClass("ng-hide"),n.addClass("ng-show"),n.css("display","block")):(n.removeClass("ng-show"),n.addClass("ng-hide"),n.css("display","none")))})}),(null===a.val()||"undefined"==a.val()||""===a.val())&&a.addClass("empty"),e.$watch(function(){return r.$modelValue},function(e,t){null===e||void 0==e||""===e?a.addClass("empty"):a.removeClass("empty")}),a.on("key change",function(){null===a.val()||"undefined"==a.val()||""===a.val()?a.addClass("empty"):a.removeClass("empty")})}},scope:{itError:"=",itText:"@"}}}),e.directive("itToggle",function(){return{restrict:"A",transclude:!0,link:function(e,t,n){var r=angular.element(t[0]);r.wrap('<div class="togglebutton"></div>'),r.wrap("<label>"+(e.itText||"")+"&nbsp;&nbsp;</label>"),r.after('<span class="toggle"></span>')},scope:{itModel:"=",itText:"@"}}}),e.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,n){var r=angular.element(t[0].querySelector("ul")),a=angular.element(t[0].querySelector("a"));r.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu"),a.on("click",function(){r.hasClass("it-side-menu-collapse")?(r.removeClass("it-side-menu-collapse"),r.addClass("it-side-menu-expanded"),t.addClass("toggled")):(t.removeClass("toggled"),r.removeClass("it-side-menu-expanded"),r.addClass("it-side-menu-collapse"))})}}}),e.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div class="it-sidebar-inner"><div class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),e.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-menu-content menu-animated" ng-class="{\'it-side-menu-overlay\':showmenu}"><div class="it-container" ng-transclude></div></div>'}}),e.controller("$sideMenuCtrl",["$scope",function(e){var t=this;t.scope=e,t.scope.showmenu=!1,t.toggleMenu=function(){t.scope.showmenu=t.scope.showmenu?!1:!0},t.hideSideMenu=function(){t.scope.showmenu=!1}}]),e.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,n,r,a){var i=angular.element(n[0].querySelector(".it-material-design-hamburger__layer")),l=angular.element(n[0].querySelector(".it-material-design-hamburger__icon"));t.toggleMenu=a.toggleMenu;var s=function(){i.hasClass("it-material-design-hamburger__icon--to-arrow")?(i.removeClass("it-material-design-hamburger__icon--to-arrow"),i.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")):(i.removeClass("it-material-design-hamburger__icon--from-arrow"),i.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed"))};l.on("click",function(){s()}),r.itButtonMenu&&(t.itButtonMenu=t.$eval(r.itButtonMenu)),t.$watch(r.itButtonMenu,function(e,n){t.itButtonMenu=e,e&&(s(),a.hideSideMenu())})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itButtonMenu"><button it-menu-toggle ng-click="toggleMenu()" class="it-material-design-hamburger__icon  "><span class="menu-animated it-material-design-hamburger__layer  "> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),e.directive("itMenuToggle",["$animate","$rootScope",function(e,t){return{restrict:"E",require:"^itSideMenus",compile:["scope","element","attrs",function(t,n,r){var a=angular.element(n[0].querySelector(".it-material-design-hamburger__layer"));n.on("click",function(){a.hasClass("it-material-design-hamburger__icon--to-arrow")?(e.removeClass(a,"it-material-design-hamburger__icon--to-arrow"),e.addClass(a,"it-material-design-hamburger__icon--from-arrow")):(e.removeClass(a,"it-material-design-hamburger__icon--from-arrow"),e.addClass(a,"it-material-design-hamburger__icon--to-arrow"))})}]}}]),e.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),e.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(n,r,a){function i(){var a,i=angular.element(t[0].getElementById(n.footerElementId));a=1===i.length?i[0].offsetHeight+l(i)+s(i):0;var o=r[0].offsetTop,c=s(r),d=n.additionalPadding||0,u=e.innerHeight-o-c-a-d;r.css("height",u+"px")}function l(e){var t=o(e,"margin-top"),n=o(e,"border-top-width");return t+n}function s(e){var t=o(e,"margin-bottom"),n=o(e,"border-bottom-width");return t+n}function o(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",i),i()}}}]),e.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),e.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),e.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}})}();