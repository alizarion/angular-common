/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * ProductionManager, v1.0.0
 * A powerful production manager.*/
!function(){var e=angular.module("itesoft",["ngSanitize","ui.grid","ui.bootstrap.tabs","ui.bootstrap.modal"]);e.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,n,r){t.$watch(function(e){return e.$eval(r.itCompile)},function(r){n.html(r),e(n.contents())(t)})}}])}]),e.factory("itHttpLoaderInterceptor",["$q","$rootScope",function(e,t){var n=0;return{request:function(r){return n++,t.$broadcast("it_loader_show"),r||e.when(r)},response:function(r){return 0===--n&&t.$broadcast("it_loader_hide"),r||e.when(r)},responseError:function(r){return--n||t.$broadcast("it_loader_hide"),e.reject(r)}}}]).config(["$httpProvider",function(e){e.interceptors.push("itHttpLoaderInterceptor")}]).directive("itLoader",function(){return{restrict:"EA",template:'<span class="fa-stack"> <i class="fa fa-refresh fa-stack-1x" ></i></span>',link:function(e,t){var n=angular.element(t[0].querySelector("i"));return e.$on("it_loader_show",function(){n.addClass("fa-spin")}),e.$on("it_loader_hide",function(){n.removeClass("fa-spin")})}}}),e.directive("itDetail",function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:'<div   class="col-md-6 it-fill" ng-if="currentItemWrapper.currentItem"><div class="jumbotron it-fill" ng-transclude></div></div>'}}),e.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill">           <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),e.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!0,transclude:!0,template:'<div class="row"><div class="col-md-12"><div class="btn-toolbar clearfix pull-right" ng-transclude></div></div></div>'}}),e.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:{itMasterData:"=",itLang:"=",itMasterDetailControl:"=",itLockOnChange:"="},template:'<div class="col-md-6" ng-open="refreshData()" ui-i18n="{{itLang}}"><div class="jumbotron "><div class="row" ng-transclude></div><div class="row" ><div class="col-md-12 it-master-detail-container"><div ui-grid="gridOptions" ui-grid-selection  it-master-detail-auto-resize  ui-grid-move-columns class="it-master-detail-grid"></div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache",function(e,t,n,r,i,a){function o(e){this.originalItem=e,this.currentItem=angular.copy(e),this.hasChanged=!1,this.isWatched=!1,this.unlockOnEquals=!0}function l(t){var r=n.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged?(r.reject("undo or save before change"),r.promise):(e.$parent.currentItemWrapper=new o(t),r.resolve(""),r.promise)}function s(t){e.gridApi.core.scrollTo(t)}function c(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)}function u(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&(i.alert({text:e.itMasterDetailControl.navAlert.text,title:e.itMasterDetailControl.navAlert.title}),t.preventDefault())}a.put("ui-grid/uiGridHeaderCell",'<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button " ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'),a.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ng-click="selectButtonClick(row, $event)"><input type="checkbox" tabindex="-1" ng-click="selectButtonClick(row, $event)" ng-checked="row.isSelected">  </div>'),a.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-model="grid.selection.selectAll"></div>'),o.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},o.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.gridOptions={rowHeight:40,multiSelect:!0,enableSelectAll:!0,showGridFooter:!0,enableMinHeightCheck:!0,onRegisterApi:function(t){e.gridApi=t},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.$watch("$parent.currentItemWrapper.currentItem",function(t,n){null!=e.$parent.currentItemWrapper&&e.itLockOnChange&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.hasChanged=e.$parent.currentItemWrapper.unlockOnEquals?!angular.equals(t,e.$parent.currentItemWrapper.originalItem):!0)},!0),e.onRowClick=function(t,n){void 0!=n.entity&&"ui-grid/selectionHeaderCell"!=t.providedHeaderCellTemplate&&"undefined"!=typeof t.providedHeaderCellTemplate&&l(n.entity).then(function(t){e.gridApi.selection.clearSelectedRows(),e.gridApi.selection.selectRow(n.entity)},function(t){i.alert({text:e.itMasterDetailControl.navAlert.text,title:e.itMasterDetailControl.navAlert.title})})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.$watch("$scope.filterText",function(){e.refreshData()}),e.refreshData=function(){e.gridOptions.data=t("filter")(e.itMasterData,e.filterText,void 0)},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(l(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),c())},e.$on("unlockCurrentItem",function(){c()}),e.itMasterDetailControl.scrollToItem=function(e){s(e)},e.itMasterDetailControl.getSelectedItems=function(){return e.gridApi.selection.getSelectedRows()},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){return e.gridApi.core.getVisibleRows(e.gridApi.grid)},e.itMasterDetailControl.setCurrentItem=function(t){var i=n.defer();return e.gridApi.selection.clearSelectedRows(),l(t).then(function(){r(function(){var n=e.itMasterData.indexOf(t);n>=0?(e.gridApi.selection.selectRow(t),s(t),i.resolve()):i.reject()})},function(){i.reject()}),i.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(l(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.$on("unlockCurrentItem",function(){r(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){r(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.myDiv="ttt",e.$on("$locationChangeStart",u),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes"}},e.itMasterDetailControl)}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,n,r){var i=[];if(void 0===r||""===r)return t;r=r.toLowerCase();for(var a=e.$new(!0),o=0;o<t.length;o++)for(var l=0;l<n.columnDefs.length;l++){var s=t[o],c=n.columnDefs[l].field,u=s[c];if(n.columnDefs[l].cellFilter&&(a.value=u,u=a.$eval("value | "+n.columnDefs[l].cellFilter)),u.toString().toLowerCase().indexOf(r)>-1){i.push(s);break}}return a.$destroy(),i}}]).directive("itMasterDetailAutoResize",["$timeout","gridUtil",function(e,t){return{require:"uiGrid",scope:!1,link:function(e,n,r,i){function a(){s=t.elementHeight(n),l=t.elementWidth(n),angular.element(document.getElementsByClassName("it-master-detail-grid")).css("height","")}function o(){clearTimeout(c),c=setTimeout(function(){var r=t.elementWidth(n),c=angular.element(document.getElementsByClassName("it-master-detail-grid"))[0],u=c.getBoundingClientRect(),d=window.innerHeight,p=d-u.top,m=angular.element(document.getElementsByClassName("it-master-detail-grid")[0].getElementsByClassName("ngFooterPanel"))[0],g=m?m.getBoundingClientRect().height:0,f=p-g-40;f!==s||r!==l?(i.grid.gridHeight=f,i.grid.gridWidth=r,e.$apply(function(){i.grid.refresh().then(function(){a(),o()})})):o()},250)}var l,s,c;o(),e.$on("$destroy",function(){clearTimeout(c)})}}}]),e.directive("itMasterDetail",function(){return{restrict:"EA",transclude:!0,scope:!1,template:'<div class="it-fill"><div class="row it-fill" ng-transclude></div></div>'}}),e.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:' <div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  it-input class="form-control floating-label" type="text" ng-model="$parent.filterText" class="form-control floating-label"  it-text="{{placeholderText}}"/></div></form></div></div>',link:function(e,t,n){e.placeholderText=n.itSearchPlaceholder}}}),e.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,n){var r=angular.element(t[0]);r.wrap('<div class="checkbox"></div>'),r.wrap("<label></label>"),r.after('<span class="checkbox-material"><span class="check" style="width: '+n.width+";height:"+n.height+';"></span></span>&nbsp;'+(n.itText||""))}}}),e.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,n,r){if(r){var i=angular.element(t[0]);if(i.hasClass("floating-label")){i.wrap('<div class="form-control-wrapper"></div>');var a=i.attr("placeholder");a?i.after('<div class="floating-label">'+a+"</div"):(i.after('<div class="floating-label">'+e.itText+"</div"),e.$watch("itText",function(t){e.$applyAsync(function(){if(i[0].offsetParent){var e=i[0].offsetParent.children;angular.forEach(e,function(e){var n=angular.element(e);n.hasClass("floating-label")&&n.text(t)})}})})),i.after('<span class="material-input"></span>'),i.attr("placeholder","").removeClass("floating-label")}i.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(i[0].offsetParent){var t=i[0].offsetParent.children;angular.forEach(t,function(t){var n=angular.element(t);n.hasClass("text-danger")&&(n.text(e),""!=e&&void 0!=e?(n.removeClass("ng-hide"),n.addClass("ng-show"),n.css("display","block")):(n.removeClass("ng-show"),n.addClass("ng-hide"),n.css("display","none")))})}}),(null===i.val()||"undefined"==i.val()||""===i.val())&&i.addClass("empty"),e.$watch(function(){return r.$modelValue},function(e,t){null===e||void 0==e||""===e?i.addClass("empty"):i.removeClass("empty")}),i.on("key change",function(){null===i.val()||"undefined"==i.val()||""===i.val()?i.addClass("empty"):i.removeClass("empty")})}},scope:{itError:"=",itText:"@"}}}),e.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,n){var r=angular.element(t[0]);r.wrap('<div class="togglebutton"></div>'),r.wrap("<label>"+(e.itText||"")+"&nbsp;&nbsp;</label>"),r.after('<span class="toggle"></span>'),e.$watch("itText",function(e){var t=angular.element(r.context.parentNode);if(t){var n=angular.element(t.get(0).firstChild);n.get(0).textContent=e+"  "}})},scope:{itModel:"=",itText:"@"}}}]),e.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,n,r){function i(){var t=e.path();t&&angular.forEach(n.find("li"),function(e){var n=e.querySelector("a");n.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(a):angular.element(e).removeClass(a)})}var a=r.itActive||"active";i(),t.$on("$locationChangeSuccess",i)}}}]),e.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,n){function r(e){return String(e).replace(/[&<>"'\/]/g,function(e){return i[e]})}var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(r(t[0].innerHTML))}}}}]),e.directive("itCollapsedItem",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){var r=angular.element(t[0].querySelector("ul")),i=angular.element(t[0].querySelector("a"));r.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var a=angular.element(t[0].querySelector("h5")),o=angular.element('<i class="pull-right fa fa-angle-right" ></i>');e.$applyAsync(function(){a.append(o)}),i.on("click",function(){r.hasClass("it-side-menu-collapse")?(r.removeClass("it-side-menu-collapse"),r.addClass("it-side-menu-expanded"),o.removeClass("fa-angle-right"),o.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),o.addClass("fa-angle-right"),o.removeClass("fa-angle-down"),r.removeClass("it-side-menu-expanded"),r.addClass("it-side-menu-collapse"))})}}}]),e.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div class="it-sidebar-inner"><div class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),e.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-menu-content menu-animated" ng-class="{\'it-side-menu-overlay\':showmenu}"><div class="it-container it-fill" ng-transclude></div></div>'}}),e.controller("$sideMenuCtrl",["$scope","$timeout",function(e,t){var n=this;n.scope=e,n.scope.showmenu=!1,n.toggleMenu=function(){n.scope.showmenu=n.scope.showmenu?!1:!0},n.hideSideMenu=function(){n.scope.showmenu=!1}}]),e.directive("itSideMenuHeader",["$rootScope","$injector",function(e,t){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,n,r,i){var a=angular.element(n[0].querySelector(".it-material-design-hamburger__layer")),o=angular.element(n[0].querySelector(".it-material-design-hamburger__icon"));t.toggleMenu=i.toggleMenu;var l=function(){a.hasClass("it-material-design-hamburger__icon--to-arrow")?(a.removeClass("it-material-design-hamburger__icon--to-arrow"),a.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")):(a.removeClass("it-material-design-hamburger__icon--from-arrow"),a.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed"))};o.on("click",function(){l()}),r.itButtonMenu&&(t.itButtonMenu=t.$eval(r.itButtonMenu)),t.$watch(r.itButtonMenu,function(e,n){t.itButtonMenu=e,e&&(l(),i.hideSideMenu())})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itButtonMenu"><button it-menu-toggle ng-click="toggleMenu()" class="it-material-design-hamburger__icon  "><span class="menu-animated it-material-design-hamburger__layer  "> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),e.directive("itMenuToggle",["$animate","$rootScope","$controller",function(e,t,n){return{restrict:"E",require:"^itSideMenus",compile:["scope","element","attrs",function(t,n,r){var i=angular.element(n[0].querySelector(".it-material-design-hamburger__layer"));n.on("click",function(){i.hasClass("it-material-design-hamburger__icon--to-arrow")?(e.removeClass(i,"it-material-design-hamburger__icon--to-arrow"),e.addClass(i,"it-material-design-hamburger__icon--from-arrow")):(e.removeClass(i,"it-material-design-hamburger__icon--from-arrow"),e.addClass(i,"it-material-design-hamburger__icon--to-arrow"))})}]}}]),e.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),e.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(n,r,i){function a(){var i,a=angular.element(t[0].getElementById(n.footerElementId));i=1===a.length?a[0].offsetHeight+o(a)+l(a):0;var s=r[0].offsetTop,c=l(r),u=n.additionalPadding||0,d=e.innerHeight-s-c-i-u;r.css("height",d+"px")}function o(e){var t=s(e,"margin-top"),n=s(e,"border-top-width");return t+n}function l(e){var t=s(e,"margin-bottom"),n=s(e,"border-bottom-width");return t+n}function s(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",a),a()}}}]),e.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),e.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),e.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),e.factory("itPopup",["$modal","$rootScope","$q",function(e,t,n){function r(e){var r={};return r.scope=(e.scope||t).$new(),r.responseDeferred=n.defer(),r.scope.$buttonTapped=function(e,t){var n=(e.onTap||noop)(t);r.responseDeferred.resolve(n)},e=angular.extend({scope:r.scope,template:s,controller:["$scope","$modalInstance",function(e,t){function n(){t.close(e.data)}function i(){t.dismiss("cancel")}e.data={},e.itButtonAction=function(e,t){var a=(e.onTap||noop)(t),o=a;r.responseDeferred.resolve(o?n():i())}}],buttons:[]},e||{}),e.scope.options=e,r.options=e,r}function i(t){var n=r(t),i=e.open(n.options).result;return i}function a(e){return i(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function o(e){return i(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function l(e){var n=t.$new(!0);n.data={};var r="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(r="<span>"+e.template+"</span>",delete e.template),i(angular.extend({template:c,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var s='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction(button)" it-compile="button.text"></button></div>',c='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction(button)" it-compile="button.text"></button></div>',u={alert:a,confirm:o,prompt:l};return u}])}();