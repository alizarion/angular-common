/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * Angular-common, v1.0.0
 *Itesoft common Angularjs libs.*/
!function(){var e=angular.module("it-multi-pages-viewer",[]),t=angular.module("it-pdf-viewer",["it-multi-pages-viewer"]),i=angular.module("it-tiff-viewer",["it-multi-pages-viewer"]),n=angular.module("it-image-viewer",["it-multi-pages-viewer"]),o=angular.module("itesoft",["ngSanitize","ui.bootstrap.tabs","ui.bootstrap.modal","ui.bootstrap.tpls","ngAnimate","matchMedia","ui.grid","ui.grid.pagination","ngRoute","pascalprecht.translate","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.grouping","ui.bootstrap.dropdown","LocalStorageModule","ngToast","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","ui.codemirror","it-pdf-viewer","it-image-viewer","it-tiff-viewer","ngWebSocket"]);o.directive("itCircularBtn",[function(){return{restrict:"ACE",scope:!1,transclude:!0,template:'<span class="it-circular-button-container "><button class="btn  pull-right" > <div class="it-animated-circular-button"><ng-transclude></ng-transclude></div></button> </span>'}}]),o.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,i,n){t.$watch(function(e){return e.$eval(n.itCompile)},function(n){i.html(n),e(i.contents())(t)})}}])}]),o.directive("itModalFullScreen",["$timeout","$window","$document",function(e,t,i){function n(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),r=parseInt(o["z-index"]);(isNaN(r)?0:r)>i&&(i=r)}return i}var o='<div class="it-modal-full-screen" ng-class="$isModalOpen? $onOpenCss : \'\'"><div class="it-modal-full-screen-header pull-right"><div  ng-if="$isModalOpen"  class="it-modal-full-screen-button "><button class="btn " ng-click="$closeModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-compress"></i></div></button></div><div  ng-if="!$isModalOpen"  class="it-modal-full-screen-button "> <button class="btn pull-right"  ng-click="$openModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-expand"></i></div></button> </div></div><div  class="it-modal-full-screen-content it-fill"  ng-transclude> </div></div>';return{restrict:"EA",transclude:!0,scope:!1,template:o,link:function(o,r,a,s){var l=isNaN(parseInt(a.itZIndex))?null:parseInt(a.itZIndex);o.$onOpenCss=a.itOpenClass?a.itOpenClass:"it-modal-background";var c=isNaN(parseInt(a.itEscapeKey))?27:parseInt(a.itEscapeKey),d=angular.element(r[0].querySelector(".it-modal-full-screen")),u=angular.element(d[0]);o.$openModal=function(){o.$isModalOpen=!0;var i=document.getElementsByTagName("html"),r=t.getComputedStyle(i[0]),a=parseInt(r.top),s=parseInt(r["margin-top"]),c=parseInt(r["padding-top"]),d=(isNaN(parseInt(a))?0:parseInt(a))+(isNaN(parseInt(s))?0:parseInt(s))+(isNaN(parseInt(c))?0:parseInt(c));u.addClass("it-opened"),u.css("top",d+"px"),null!==l?u.css("z-index",l):u.css("z-index",n()+100),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)},o.$closeModal=function(){o.$isModalOpen=!1,o.$applyAsync(function(){u.removeAttr("style"),u.removeClass("it-opened"),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)})},i.on("keyup",function(e){e&&e.keyCode==c&&o.$closeModal()})}}}]),o.factory("itAmountCleanerService",["$filter",function(e){var t=["en_US","en_GB","fr_FR","de_DE","id_IT"];return{cleanAmount:function(e,i){var n=0,o=!1;return t.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(o=!0)}),0==o?(console.log("Unable to format amount for local "+i),""):(e=e.replace(/[^0-9,.]/g,""),(JSON.stringify(i)==JSON.stringify(t[2])||JSON.stringify(i)==JSON.stringify(t[4]))&&(e=e.replace(",",".")),JSON.stringify(i)==JSON.stringify(t[0])?e=e.replace(",",""):JSON.stringify(i)==JSON.stringify(t[3])&&(e=e.replace(".",""),e=e.replace(",",".")),n=parseFloat(e),console.log("result1 "+n),void 0==n&&(n=parseFloat(e)),console.log("result2 "+n),n)},formatAmount:function(i,n,o){var r="",a=!1;if(t.forEach(function(e){JSON.stringify(e)==JSON.stringify(n)&&(a=!0)}),0==a)return console.log("Unable to format amount for local "+n),"";if(void 0!=i){var s=i.toString();s=s.replace(/[^0-9,.]/g,""),(JSON.stringify(n)==JSON.stringify(t[2])||JSON.stringify(n)==JSON.stringify(t[4]))&&(s=s.replace(",","."))}return angular.isDefined(o)?(o=e("uppercase")(o),r=angular.equals(o,"TND")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:3,maximumFractionDigits:3}).format(parseFloat(s)):angular.equals(o,"JPY")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:0,maximumFractionDigits:0}).format(parseFloat(s)):new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s))):r=new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s)),r}}}]),o.directive("itLazyGrid",["OPERATOR","NOTIFICATION_TYPE","itQueryFactory","itQueryParamFactory","itAmountCleanerService","localStorageService","$rootScope","$log","$q","$templateCache","$timeout",function(e,t,i,n,o,r,a,s,l,c,d){return{restrict:"AE",scope:{options:"="},template:'<div ui-grid="lazyGrid.fields.gridOptions"  ui-grid-selection ui-grid-pagination ui-grid-auto-resize="true" class="it-fill it-sp-lazy-grid"><div class="it-watermark sp-watermark gridWatermark" ng-show="!lazyGrid.fields.gridOptions.data.length"> {{\'GLOBAL.NO_DATA\' |translate}} </div> </div> <!------------------------------------------------------------------------------------------------------------------------------- FILTER --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="dropDownFilter.html"> <div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"> <it-autocomplete name="autocomplete" items="colFilter.options.data" selected-option="colFilter.term" input-class="col.headerCellClass" option-container-class="colFilter.class"> </div> </script> <script type="text/ng-template" id="dateRangeFilter.html"> <div class="ui-grid-filter-container"> <span class="{{col.headerCellClass}}"> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[0].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[0].emptyOption | translate}}" ng-model="col.filters[0].term" data-min-date="{{col.filters[0].dateMin}}" data-max-date="{{col.filters[1].term}}" data-autoclose="1" name="date" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[1].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[1].emptyOption | translate}}" ng-model="col.filters[1].term" data-min-date="{{col.filters[0].term}}" data-max-date="{{col.filters[1].dateMax}}" data-autoclose="1" name="date2" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> </span></div> </script> <script type="text/ng-template" id="stringFilter.html"> <div class="ui-grid-filter-container {{col.headerCellClass}}" ng-repeat="colFilter in col.filters"> <input type="text" class="form-control" ng-model="colFilter.term" pattern="{{colFilter.pattern}}" placeholder="{{colFilter.emptyOption | translate}}" maxlength="{{colFilter.maxLength}}"> </div> </script> <!------------------------------------------------------------------------------------------------------------------------------- PAGINATOR --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="paginationTemplate.html"> <div role="contentinfo" class="ui-grid-pager-panel" ui-grid-pager ng-show="grid.options.enablePaginationControls"> <div role="navigation" class="ui-grid-pager-container"> <div role="menubar" class="ui-grid-pager-control"> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-first it-sp-grid-pager-first " ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="first-bar"> </div> </div> <input type="button" title="" ng-click="pageFirstPageClick()" > </input></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.PREVPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-previous it-sp-grid-pager-previous" ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="prev-triangle"> </div> </div><input type="button" title="" ng-click="pagePreviousPageClick()"/></label><input type="number" class="ui-grid-pager-control-input it-sp-grid-pager-control-input" ng-model="grid.options.paginationCurrentPage" min="1" max="{{ paginationApi.getTotalPages() }}" required/> <span class="ui-grid-pager-max-pages-number it-sp-grid-pager-max-pages-number" ng-show="paginationApi.getTotalPages() > 0"> <abbr> / </abbr> {{ paginationApi.getTotalPages() }} </span> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.NEXTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-next it-sp-grid-pager-next" ng-disabled="cantPageForward()"><div class="last-triangle"> <div class="next-triangle"> </div> </div><input type="button" title="" ng-click="pageNextPageClick()"/></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.LASTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-last it-sp-grid-pager-last" ng-disabled="cantPageToLast()"><div class="last-triangle"> <div class="last-bar"> </div> </div><input type="button" title="" ng-click="pageLastPageClick()"/></label> </div> <div class="ui-grid-pager-row-count-picker it-sp-grid-pager-row-count-picker" ng-if="grid.options.paginationPageSizes.length > 1"> <select ui-grid-one-bind-aria-labelledby-grid="\'items-per-page-label\'" ng-model="grid.options.paginationPageSize" ng-options="o as o for o in grid.options.paginationPageSizes"></select><span ui-grid-one-bind-id-grid="\'items-per-page-label\'" class="ui-grid-pager-row-count-label"> &nbsp; </span> </div> <span ng-if="grid.options.paginationPageSizes.length <= 1" class="ui-grid-pager-row-count-label it-sp-grid-pager-row-count-label"> {{grid.options.paginationPageSize}}&nbsp;{{sizesLabel}} </span> </div> <div class="ui-grid-pager-count-container"><div class="ui-grid-pager-count"> <span class="it-sp-grid-pager-footer-text" ng-show="grid.options.totalItems > 0"> {{\'PAGINATION.INVOICE.FROM\' | translate}} {{showingLow}} <abbr> </abbr> '+"{{'PAGINATION.INVOICE.TO' | translate}} {{showingHigh}} {{'PAGINATION.INVOICE.ON' | translate}} {{grid.options.totalItems}} {{'PAGINATION.INVOICE.TOTAL' | translate}} </span> </div> </div> </div> </script>",controllerAs:"lazyGrid",controller:["$scope",function(t){function a(){s.debug("LazyGrid:Apply External filter"),angular.forEach(I.fields.externalFilter,function(e,t){if(!angular.isUndefined(t)&&!angular.isUndefined(e.value)&&!angular.isUndefined(e.condition)){var i=n.create(t,e.value,e.condition);I.fields.filter.push(i)}})}function l(){s.debug("LazyGrid:Apply filter");var t="",i="",r=e.EQUALS;if(angular.isDefined(I.fields.gridApi.grid))for(var a=0;a<I.fields.gridApi.grid.columns.length;a++){t=I.fields.gridApi.grid.columns[a].field;for(var l=0;l<I.fields.gridApi.grid.columns[a].filters.length;l++)if(i=I.fields.gridApi.grid.columns[a].filters[l].term,void 0!=i&&""!=i){s.debug("LazyGrid:Filter changed, fieds: "+t+", and value: "+i);var c=I.fields.gridApi.grid.columns[a].filters[l].rsqlKey;void 0!=c&&(t=c),void 0!=I.fields.gridApi.grid.columns[a].filters[l].condition&&(r=I.fields.gridApi.grid.columns[a].filters[l].condition),1==I.fields.gridApi.grid.columns[a].filters[l].amount&&(i=o.cleanAmount(i,S));var d=n.create(t,i,r);I.fields.filter.push(d)}}}function u(){s.debug("LazyGrid:Apply default filter"),angular.isDefined(I.fields.gridApi.grid)&&angular.forEach(I.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&angular.isDefined(e.colDef.filters[0].defaultTerm)&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)||(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function p(){s.debug("LazyGrid:Reset Filter and Apply default filter"),angular.isDefined(I.fields.gridApi.grid)&&angular.forEach(I.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)?angular.forEach(e.colDef.filters,function(e){e.term=""}):(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function f(){}function g(){}function h(){s.debug("LazyGrid:Filter Changed"),I.fields.filter=[],angular.isDefined(I.fields.promise.refresh)&&d.cancel(I.fields.promise.refresh),I.fields.promise.refresh=d(function(){I.fn.refresh()},1e3)}function m(e,t){if(s.debug("LazyGrid:Sort Changed"),I.fields.filter=[],0==t.length)I.fields.paginationOptions.sort.name=void 0,I.fields.paginationOptions.sort.direction=void 0;else{var i=t[0].name;angular.isDefined(t[0])&&angular.isDefined(t[0].colDef)&&angular.isDefined(t[0].colDef.sorterRsqlKey)&&(i=t[0].colDef.sorterRsqlKey),I.fields.paginationOptions.sort.name=i,I.fields.paginationOptions.sort.direction=t[0].sort.direction,s.debug("sort changed, sort key: "+t[0].name+", and direction: "+t[0].sort.direction)}I.fn.refresh()}function v(e,t){s.debug("LazyGrid:Pagination Changed"),I.fields.filter=[],(I.fields.paginationOptions.pageNumber!=e||I.fields.paginationOptions.pageSize!=t)&&(I.fields.paginationOptions.pageNumber=e,I.fields.paginationOptions.pageSize=t,I.fn.refresh())}function C(){s.debug("LazyGrid:Row Selection Changed")}function b(){s.debug("LazyGrid:Refresh"),a(),l();var e=(I.fields.paginationOptions.pageNumber-1)*I.fields.paginationOptions.pageSize,t=i.create(I.fields.filter,e,I.fields.paginationOptions.pageSize,I.fields.paginationOptions.sort);I.fn.callBack(t)}function w(){s.debug("LazyGrid:Initial load"),l(),I.fields.filter.length<=0&&u(),I.fields.filter=[],I.fn.refresh()}function y(e){return angular.isUndefined(e.key)?void s.error("External filter object must have key"):angular.isUndefined(e.condition)?void s.error("External filter object must have condition"):void(angular.isUndefined(e.value)?I.fields.externalFilter[e.key]={}:I.fields.externalFilter[e.key]=e)}function E(){}var S=r.get("Locale"),I=this;I.options=t.options,I.fields={template:{pagination:c.get("paginationTemplate.html")},filter:[],externalFilter:{},gridApi:{},gridOptions:{},paginationOptions:{},appScope:{},promise:{refresh:{}}},I.on={loaded:f,ready:g,filterChange:h,sortChange:m,paginationChanged:v,rowSelectionChanged:C},I.fn={callBack:I.options.callBack,initialize:E,refresh:b,initialLoad:w,addExternalFilter:y,refreshDefaultFilter:p},I.fields.paginationOptions={pageNumber:1,pageSize:10,sort:{name:void 0,direction:void 0}},I.fields.gridOptions={enableFiltering:!0,enableSorting:!0,enableColumnMenus:!1,useExternalPagination:!0,useExternalSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!0,useExternalFiltering:!0,data:[],columnDefs:[],paginationTemplate:I.fields.template.pagination,onRegisterApi:function(e){e.core.on.filterChanged(I.appScope,I.on.filterChange),e.core.on.sortChanged(I.appScope,I.on.sortChange),e.pagination.on.paginationChanged(I.appScope,I.on.paginationChanged),e.selection.on.rowSelectionChanged(I.appScope,I.on.rowSelectionChanged),I.fields.gridApi=e,s.debug("LazyGrid:UI-grid:onRegisterApi")}},angular.isDefined(I.options.onRegisterApi)&&(I.options.onRegisterApi(I),s.debug("LazyGrid:onRegisterApi"))}]}}]).constant("OPERATOR",{EQUALS:"==",LIKE:"==%",NOT_EQUALS:"!=",LESS_THAN:"=lt=",LESS_EQUALS:"=le=",GREATER_THAN:"=gt=",GREATER_EQUALS:"=ge="}).constant("NOTIFICATION_TYPE",{INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS",DISMISS:"DISMISS"}),o.factory("itPaginatorConfigService",["$q","$log","itNotifier","$filter","MetadataService",function(e,t,i,n,o){function r(){if(a.fields.loaded)t.debug("PaginatorConfigService: loaded"),s.resolve("ok");else{var r=o.getConfig.get({type:"paginatorOptions"}).$promise,l=o.getConfig.get({type:"paginatorDefaultOption"}).$promise;e.all([r,l]).then(function(e){a.fields.defaultOption=e[1].value;var o=e[0].value;angular.isDefined(o)&&null!=o&&angular.isDefined(o.split)?a.fields.options=o.split(","):i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},o),t.debug("PaginatorConfigService: loaded"),a.fields.loaded=!0,s.resolve("ok")},function(e){i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},e.data)})}return s.promise}var a=this,s=e.defer();return a.fields={options:[],defaultOption:"",loaded:!1},a.fn={initialize:r},a}]),o.factory("itQueryParamFactory",[function(){function e(e,t,i){this.key=e,this.value=t,this.operator=i}return{create:function(t,i,n){return new e(t,i,n)}}}]),o.factory("itQueryFactory",["OPERATOR",function(e){function t(t,i,n,o){this.parameters=t,this.start=i,this.size=n,this.sort=o,this.build=function(){var r="";return void 0!=t&&this.parameters.forEach(function(t){angular.isDefined(t.value)&&angular.isDefined(t.key)&&(t.value instanceof Date&&t.operator==e.LESS_EQUALS&&(t.value.setHours(23),t.value.setMinutes(59),t.value.setSeconds(59),t.value.setMilliseconds(999)),r.length>0&&(r+=" and "),t.value instanceof Date&&(t.value=t.value.toISOString()),t.operator==e.LIKE&&(t.value=t.value+"%"),r+=t.key+t.operator+t.value)}),r="query="+r,null!=n&&angular.isDefined(n)&&""!=n&&(r+="&size="+this.size),null!=i&&angular.isDefined(i)&&""!=i&&(r+="&start="+this.start),void 0!=o&&void 0!=this.sort.name&&(r+="&sort=","desc"==this.sort.direction&&(r+="-"),r+=this.sort.name),r}}return{create:function(e,i,n,o){return new t(e,i,n,o)}}}]),o.directive("itBusyIndicator",["$timeout","$http",function(e,t){function i(i,o,r){i.$watch(function(){return t.pendingRequests.length>0},function(t){n&&e.cancel(n),t===!0?n=e(function(){i.hasPendingRequests=!0},250):i.hasPendingRequests=!1})}var n;return{link:i,restrict:"AE",transclude:!0,scope:{isBusy:"="},template:'<div class="mask-loading-container" ng-show="hasPendingRequests"></div><div class="main-loading-container" ng-show="hasPendingRequests || isBusy"><i class="fa fa-circle-o-notch fa-spin fa-4x text-primary "></i></div><ng-transclude ng-show="!isBusy" class="it-fill"></ng-transclude>'}}]),o.directive("itLoader",["$http","$rootScope",function(e,t){return{restrict:"EA",scope:!0,template:'<span class="fa-stack"><i class="fa fa-refresh fa-stack-1x" ng-class="{\'fa-spin\':$isLoading}"></i></span>',link:function(t){t.$watch(function(){e.pendingRequests.length>0?t.$applyAsync(function(){t.$isLoading=!0}):t.$applyAsync(function(){t.$isLoading=!1})})}}}]),o.directive("itDetail",[function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:' <div ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))"   ng-if="currentItemWrapper.currentItem"  class="it-master-detail-slide-left col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" > <div class="it-fill" ng-transclude></div></div><div  ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))" class="col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" ng-if="!currentItemWrapper.currentItem"><div class="it-watermark" >{{$itNoDetail}}</div></div>'}}]),o.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill"> <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),o.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!1,transclude:!0,template:'<div class="fluid-container"><div class="row it-md-header"><div class="col-md-2 it-fill  col-xs-2"><a href="" ng-if="$parent.$parent.$parent.mobile" ng-click="$parent.$parent.$parent.$parent.goToMaster()" class="it-material-design-hamburger__icon pull-left it-fill "> <span  class="menu-animated it-material-design-hamburger__layer " ng-class="{\'it-material-design-hamburger__icon--to-arrow\':$parent.$parent.$parent.$parent.mobile}"> </span> </a></div><div class="col-md-10 col-xs-10 it-fill "><div class="btn-toolbar  it-fill pull-right " ng-transclude></div></div></div></div>'}}),o.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",priority:-1,transclude:!0,scope:{itMasterData:"=",itLang:"=",itCol:"=",itMasterDetailControl:"=",itLockOnChange:"=",itNoDataMsg:"@",itNoDetailMsg:"@"},template:'<div  ng-show="($parent.$parent.activeState == \'master\')" class=" it-master it-master-detail-slide-right col-md-{{itCol ? itCol : 6}} it-fill " ui-i18n="{{itLang}}"><div class="row" ng-transclude></div><div class="row it-master-grid it-fill" ><div class="col-md-12 it-fill"><div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns  ui-grid-move-columns  ui-grid-auto-resize class="it-master-detail-grid it-fill "><div class="it-watermark" ng-show="!gridOptions.data.length" >{{itNoDataMsg}}</div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache","$route","$window",function(e,t,i,n,o,r,a,s){function l(t){var i=this;angular.forEach(e.itMasterData,function(e,n){angular.equals(e,t)&&(i.index=n)}),i.originalItem=t,i.currentItem=angular.copy(t),i.hasChanged=!1,i.isWatched=!1,i.unlockOnEquals=!0}function c(t){e.itMasterDetailControl.disableMultiSelect||(e.gridApi.selection.getSelectedRows().length>1?e.$parent.currentItemWrapper=null:1===e.gridApi.selection.getSelectedRows().length?(d(e.gridApi.selection.getSelectedRows()[0]),u(e.gridApi.selection.getSelectedRows()[0])):0===e.gridApi.selection.getSelectedRows().length&&(e.$parent.currentItemWrapper=null))}function d(t){var n=i.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange?(n.reject("undo or save before change"),n.promise):(e.$parent.currentItemWrapper=new l(t),n.resolve(""),n.promise)}function u(t){e.gridApi.core.scrollTo(t)}function p(){e.$applyAsync(function(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)})}function f(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange&&(o.alert(e.itMasterDetailControl.navAlert),t.preventDefault())}r.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input type="checkbox" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange " tabindex="-1"  ng-checked="row.isSelected"></div>'),r.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="(grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange  )? \'return false\':headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged  && grid.appScope.itLockOnChange" ng-model="grid.selection.selectAll"></div>'),e.$parent.$masterCol=e.itCol,l.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},l.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.$parent.$itNoDetail=e.itNoDetailMsg,e.gridOptions={rowHeight:40,data:e.itMasterData,multiSelect:!e.itMasterDetailControl.disableMultiSelect,enableSelectAll:!e.itMasterDetailControl.disableMultiSelect,enableRowHeaderSelection:!e.itMasterDetailControl.disableMultiSelect,showGridFooter:!0,enableMinHeightCheck:!0,enableColumnResizing:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(e){c(e)}),t.selection.on.rowSelectionChangedBatch(e,function(e){c(e)})},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span ng-show="!grid.appScope.itMasterDetailControl.disableMultiSelect" class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},"undefined"!=typeof e.itMasterDetailControl.columnDefs&&angular.forEach(e.itMasterDetailControl.columnDefs,function(e){e.headerCellTemplate='<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.onRowClick=function(t,i){void 0!=i.entity&&"undefined"!=typeof t.providedHeaderCellTemplate&&d(i.entity).then(function(n){"ui-grid/selectionHeaderCell"!==t.providedHeaderCellTemplate&&(e.gridApi.selection.clearSelectedRows(),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail()),e.gridApi.selection.toggleRowSelection(i.entity),e.$emit("MASTER_ROW_CHANGED",i.entity)},function(t){o.alert(e.itMasterDetailControl.navAlert)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.refreshData=function(){var i=t("itUIGridGlobalFilter")(e.gridOptions.data,e.gridOptions,e.filterText);angular.forEach(e.gridApi.grid.rows,function(t){var n=!1;i.forEach(function(e){angular.equals(t.entity,e)&&(n=!0)}),n?e.gridApi.core.clearRowInvisible(t):e.gridApi.core.setRowInvisible(t)})},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),p())},e.$on("unlockCurrentItem",function(){p()}),e.itMasterDetailControl.scrollToItem=function(e){u(e)},e.itMasterDetailControl.getSelectedItems=function(){return"undefined"!=typeof e.gridApi&&"function"==typeof e.gridApi.selection.getSelectedRows?e.gridApi.selection.getSelectedRows():[]},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){var t=e.gridApi.core.getVisibleRows(e.gridApi.grid),i=[];return angular.forEach(t,function(e){i.push(e.entity)}),i},e.itMasterDetailControl.setCurrentItem=function(t){var o=i.defer();return e.gridApi.selection.clearSelectedRows(),d(t).then(function(){n(function(){var i=e.itMasterData.indexOf(t);i>=0?(e.gridApi.selection.selectRow(t),u(t),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail(),o.resolve()):o.reject()})},function(){o.reject()}),o.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.$on("unlockCurrentItem",function(){n(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){n(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.itAppScope.$navAlert=e.itMasterDetailControl.navAlert;var g=angular.element(s);g.bind("resize",function(){e.gridApi.core.handleWindowResize()}),e.itMasterDetailControl.initState=!0,e.$on("$locationChangeStart",f),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes",buttons:[{text:"OK",type:"btn-info",onTap:function(){return!1}}]}},e.itMasterDetailControl),e.$watch("itLang",function(){e.gridApi.grid.refresh()}),e.$watch("itMasterData",function(){e.gridOptions.data=[],e.itMasterData.forEach(function(t){e.gridOptions.data.push(t)}),"undefined"==typeof e.itMasterData||null===e.itMasterData?e.$parent.currentItemWrapper=null:0===e.itMasterData.length&&(e.$parent.currentItemWrapper=null),e.gridApi.grid.refresh(),null!==e.itMasterDetailControl&&"undefined"!=typeof e.itMasterDetailControl.getCurrentItemWrapper()&&null!=e.itMasterDetailControl.getCurrentItemWrapper()&&e.$applyAsync(function(){u(e.itMasterDetailControl.getCurrentItemWrapper().originalItem)}),e.refreshData()},!0),n(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),s.dispatchEvent(e)},250),e.$watch("$parent.currentItemWrapper.currentItem",function(t,i){null!=e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.unlockOnEquals?e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem):e.$parent.currentItemWrapper.hasChanged=!0)},!0),e.$watch("filterText",function(){e.refreshData()},!0),e.$watch("itNoDetailMsg",function(){e.$parent.$itNoDetail=e.itNoDetailMsg})}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,i,n){function o(e,t){var i,n=t.split("."),o=e;for(i=0;i<n.length;++i){if(void 0==o[n[i]])return void 0;o=o[n[i]]}return o}var r=[];if(void 0===n||""===n)return t;n=n.toLowerCase();for(var a=e.$new(!0),s=0;s<t.length;s++)for(var l=0;l<i.columnDefs.length;l++){var c=t[s],d=i.columnDefs[l].field,u=o(c,d);if(i.columnDefs[l].cellFilter&&(a.value=u,u=a.$eval("value | "+i.columnDefs[l].cellFilter)),"undefined"!=typeof u&&null!=u&&u.toString().toLowerCase().indexOf(n)>-1){r.push(c);break}}return a.$destroy(),r}}]),o.directive("itMasterDetail",["itPopup","$timeout","$window",function(e,t,i){return{restrict:"EA",transclude:!0,scope:!0,template:'<div it-bottom-glue="" class="it-master-detail-container jumbotron "> <div class="it-fill row " ng-transclude></div></div>',controller:["$scope","screenSize",function(n,o){n.activeState="master",n.desktop=o.on("md, lg",function(e){n.desktop=e}),n.mobile=o.on("xs, sm",function(e){n.mobile=e}),n.goToDetail=function(){n.activeState="detail"},n.$watch("mobile",function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper?n.activeState="detail":n.activeState="master"}),n.$watch("$$childHead.currentItemWrapper",function(){
!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!==n.$$childHead.currentItemWrapper?!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper.currentItem&&null!==n.$$childHead.currentItemWrapper.currentItem||(n.activeState="master"):n.activeState="master"}),n.goToMaster=function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper&&n.$$childHead.currentItemWrapper.hasChanged&&n.$$childHead.$$childHead.itLockOnChange?e.alert(n.$$childHead.$navAlert):(n.activeState="master",t(function(){i.dispatchEvent(new Event("resize"))},300))}}]}}]),o.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:'<div class="fuild-container">   <div class="row it-fill">   <div class="it-md-header col-xs-12 col-md-12"><div class="btn-toolbar it-fill" ng-transclude></div></div><div class="col-xs-12 col-md-12 pull-right"><div><form><div class="form-group has-feedback it-master-header-search-group  col-xs-12 col-md-{{$parent.itCol < 4 ? 12 :6 }} pull-right" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  class="form-control " type="text" ng-model="$parent.filterText" class="form-control floating-label"  placeholder="{{placeholderText}}"/></div></form></div></div></div></div>',link:function(e,t,i){e.$watch(function(){return i.itSearchPlaceholder},function(t){e.placeholderText=t})}}}),o.directive("itAutocomplete",function(){return{restrict:"AE",scope:{items:"=",itemsGetter:"&?",selectedOption:"=",inputClass:"=",optionClass:"=",optionContainerClass:"=",converter:"=",searchMode:"=",placeholder:"=",options:"=",onChange:"&",eventSelect:"=",eventRefresh:"=",name:"=",disabled:"=",readonly:"="},controllerAs:"itAutocompleteCtrl",controller:["$scope","$rootScope","$translate","$document","$timeout","$log",function(e,t,i,n,o,r){function a(){I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: focusIndex value changed  -> "+e.focusIndex),e.focusIndex<0?e.focusIndex=-1:e.focusIndex>=I.fields.items.length&&(e.focusIndex=I.fields.items.length-1),angular.isDefined(I.fields.items)&&I.fields.items[e.focusIndex]!=I.selectedItem&&d(I.fields.items[e.focusIndex])}function s(e){e=y(e);var t=!1;I.fields.selectedItem={},angular.isDefined(e)&&(I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: select with  id "+e),angular.forEach(I.fields.items,function(i){y(i)==e&&(u(i),t=!0)}),t||c())}function l(){angular.isDefined(e.items)?I.fields.items=angular.copy(e.items):I.fields.items=angular.copy(e.itemsGetter({param:I.fields.event.refresh.value})),I.fields.initialItems=angular.copy(I.fields.items),I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: copy option items "+I.fields.initialItems)}function c(){I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: init select ");var e=0;angular.forEach(I.fields.items,function(t){angular.isDefined(I.fields.selectedItem)&&I.fields.selectedItem==t&&d(t),e++})}function d(i){angular.isDefined(i)?(u(i),I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: select "+JSON.stringify(i)),I.fields.converter?e.selectedOption=E(i):e.selectedOption=y(i)):(I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: select empty"),e.selectedOption=void 0),I.fields.event.select&&(I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: emit select event "+e.selectedOption),t.$emit(I.fields.event.select,e.selectedOption))}function u(t){if(angular.isDefined(t)){I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: applySelection "+JSON.stringify(t));var i=S(t);e.focusIndex!=i&&(e.focusIndex=i,a()),I.fields.inputSearch=w(t),I.fields.selectedItem=E(t);var o=n[0].querySelector("#options_"+I.cleanDomRef.encode(y(I.fields.selectedItem)+""));p(o,t)}else I.fields.selectedItem=void 0,e.focusIndex=-1,a()}function p(e,t){var i=n[0].querySelector("#"+I.fields.optionContainerId);I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: scrollTo #"+I.fields.optionContainerId+" to: "+e),angular.isDefined(i)&&null!=i&&(i.scrollTop=20*(S(t)+1)-i.getBoundingClientRect().height)}function f(t){r.debug(I.fields.name+" itAutocomplete: hide "+I.fields.selectedItem),angular.isUndefined(t)?(I.fields.showItems=!1,angular.isDefined(I.fields.selectedItem)&&(I.fields.inputSearch=w(I.fields.selectedItem))):document.activeElement.classList.contains("it-autocomplete-container")?e.$applyAsync(function(){t.srcElement.focus()}):(I.fields.showItems=!1,angular.isDefined(I.fields.selectedItem)&&(I.fields.inputSearch=w(I.fields.selectedItem)))}function g(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function h(e){if(angular.isDefined(e)&&-1!=g()){var t=e.srcElement.parentElement.children[1],i=angular.element(e.srcElement.parentElement)[0];if(angular.isDefined(t)&&angular.isDefined(i)&&"fixed"==t.currentStyle.position){var n=i.getBoundingClientRect().top+i.getBoundingClientRect().height;t.style.setProperty("top",n+"px")}}I.fields.showItems=!0}function m(e){if(r.debug(I.fields.name+" itAutocomplete: input search change value "+e+"->"+I.fields.inputSearch),I.fields.items=[],""==I.fields.inputSearch)d(void 0),l(),c();else{var t=0;angular.forEach(I.fields.initialItems,function(e){"startsWith"==I.fields.searchMode?b(w(e)).startsWith(b(I.fields.inputSearch))&&(I.fields.items.push(e),t++):"custom"==I.fields.searchMode?angular.isUndefined(I.fn.searchPredicate)?r.error(I.fields.name+" When using searchMode = custom, you need to add a searchPredicate function by adding  self.fn.searchPredicate = function (inputValue,item) "):I.fn.searchPredicate(I.fields.inputSearch,e)&&(I.fields.items.push(e),t++):-1!=b(w(e)).search(b(I.fields.inputSearch))&&(I.fields.items.push(e),t++)}),1==I.fields.items.length&&d(I.fields.items[0])}h()}function v(t){var i=t.keyCode;e.keys.forEach(function(e){e.code===i&&e.action()})}function C(){var e=(new Date).getTime(),t="option_container_xxxxxxxxxxxx4yxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}function b(e){var t="";return t+=angular.isDefined(e)&&e.toLowerCase?e.toLowerCase():e}function w(e){var t="";return t=angular.isDefined(I.fields.converter)&&I.fields.converter.getLabelFromObject?I.fields.converter.getLabelFromObject(e):e.value}function y(e){var t="";if(angular.isDefined(I.fields.converter)&&I.fields.converter.getIdFromObject)t=I.fields.converter.getIdFromObject(e);else{if(!e||!angular.isDefined(e)||"object"!=typeof e)return e;t=e.id}return t}function E(e){var t={};return t=angular.isDefined(I.fields.converter)&&I.fields.converter.getObject?I.fields.converter.getObject(e):e}function S(e){return I.fields.items.indexOf(e)}var I=this;I.options=e.options,I.fields={items:[],inputSearch:"",showItems:!1,optionClass:e.optionClass,optionContainerClass:e.optionContainerClass,inputClass:e.inputClass,defaultSelectClass:"",selectedSelectClass:"",selectedItem:{},searchMode:e.searchMode,placeholder:e.placeholder,debug:!1,converter:e.converter,disabled:!1,readonly:!1,event:{refresh:{name:e.eventRefresh,value:void 0},select:e.eventSelect}},angular.isUndefined(I.fields.optionClass)&&(I.fields.optionClass=""),angular.isUndefined(I.fields.optionContainerClass)&&(I.fields.optionContainerClass=""),angular.isUndefined(I.fields.inputClass)&&(I.fields.inputClass="it-autocomplete-input-class it-autocomplete-input"),angular.isUndefined(I.fields.placeholder)&&(I.fields.placeholder=""),angular.isDefined(e.disabled)&&(I.fields.disabled=!0),angular.isDefined(e.readonly)&&(I.fields.readonly=!0),I.fields.optionContainerClass=I.fields.optionContainerClass+" it-autocomplete-container",I.fields.defaultSelectClass=I.fields.optionClass+" it-autocomplete-select",I.fields.selectedSelectClass=I.fields.defaultSelectClass+" it-autocomplete-selected",I.fields.optionContainerId=C(),I.cleanDomRef={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",encode:function(e){if(e){var t,i,n,o,r,a,s,l="",c=0;for(e=I.cleanDomRef._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),o=t>>2,r=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(s);return l}},decode:function(e){var t,i,n,o,r,a,s,l="",c=0;if(e.replace)for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");c<e.length;)o=this._keyStr.indexOf(e.charAt(c++)),r=this._keyStr.indexOf(e.charAt(c++)),a=this._keyStr.indexOf(e.charAt(c++)),s=this._keyStr.indexOf(e.charAt(c++)),t=o<<2|r>>4,i=(15&r)<<4|a>>2,n=(3&a)<<6|s,l+=String.fromCharCode(t),64!=a&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(n));return l=cleanDomRef._utf8_decode(l)},_utf8_encode:function(e){var t="";if(e.replace){e=e.replace(/rn/g,"n");for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),128>n?(t+=String.fromCharCode(n),i++):n>191&&224>n?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},angular.isUndefined(I.fields.name)?I.fields.name=I.fields.optionContainerId:I.fields.name=I.fields.name,I.fn={select:d,change:m,init:c,fullInit:l,hideItems:f,showItems:h,getIdFromObject:y,getLabelFromObject:w,keyBoardInteration:v},I.on={},angular.isDefined(e.items)&&angular.isDefined(e.itemsGetter)&&r.error(I.fields.name+" Autocomplete must use items or items-getter, you are not allowed to use both"),angular.isUndefined(e.items)&&angular.isUndefined(e.itemsGetter)&&r.error(I.fields.name+" Autocomplete must use items or items-getter, you need to add one parameter"),angular.isDefined(I.options)&&angular.isDefined(I.options.onRegisterApi)&&I.options.onRegisterApi(I),l(),c(),e.focusIndex=-1,a(),s(e.selectedOption),I.fields.event.refresh.name?t.$on(I.fields.event.refresh.name,function(e,t){I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: refresh event emit, calling refresh items "),I.fields.event.refresh.value=t,l(),f(),c()}):(I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: refresh event is not defined, add watch to items"),e.$watch("items",function(t,i){t!=I.fields.item&&(I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: items value changed "+t+" "+i),l(),c(),s(e.selectedOption),f())})),e.$watch("selectedOption",function(t,i){e.onChange&&e.onChange(),I.fields.debug&&r.debug(I.fields.name+" itAutocomplete: selectedOption value changed "+i+" -> "+t),(angular.isUndefined(I.fields.selectedItem)||t!=y(I.fields.selectedItem))&&s(t)}),e.keys=[];const A=13,T=38,P=40,k=8,D=27;e.keys.push({code:A,action:function(){I.fields.showItems?f():(h(),""==I.fields.inputSearch&&(e.focusIndex=-1,a()))}}),e.keys.push({code:k,action:function(){I.fields.inputSearch="",e.focusIndex=-1,a(),m()}}),e.keys.push({code:T,action:function(){h(),e.focusIndex--,a()}}),e.keys.push({code:P,action:function(){h(),e.focusIndex++,a()}}),e.keys.push({code:D,action:function(){I.fields.showItems&&f()}})}],template:'<div class="col-xs-12 it-autocomplete-div"><div class="it-autocomplete-div-visible" >    <input ng-disabled="itAutocompleteCtrl.fields.disabled"  ng-readonly="itAutocompleteCtrl.fields.readonly" placeholder="{{itAutocompleteCtrl.fields.placeholder}}" ng-keydown="itAutocompleteCtrl.fn.keyBoardInteration($event)" ng-focus="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" type="text" class="form-control it-autocomplete-input" ng-class="inputClass" ng-change="itAutocompleteCtrl.fn.change($event)" ng-model="itAutocompleteCtrl.fields.inputSearch">    <div class="it-autocomplete-btn"  ng-disabled="itAutocompleteCtrl.fields.disabled" ng-click="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" > &#9679;&#9679;&#9679;</div></div>   <div  ng-class="itAutocompleteCtrl.fields.optionContainerClass" id="{{itAutocompleteCtrl.fields.optionContainerId}}" ng-show="itAutocompleteCtrl.fields.showItems" >       <div class="it-autocomplete-content"  ng-repeat="item in itAutocompleteCtrl.fields.items">           <div class=" {{item == itAutocompleteCtrl.fields.selectedItem?itAutocompleteCtrl.fields.selectedSelectClass: itAutocompleteCtrl.fields.defaultSelectClass}}"               id="{{\'options_\'+itAutocompleteCtrl.cleanDomRef.encode(itAutocompleteCtrl.fn.getIdFromObject(item))}}"                 ng-mousedown="itAutocompleteCtrl.fn.select(item)">               {{itAutocompleteCtrl.fn.getLabelFromObject(item)}}           </div>       </div>   </div></div>'}}),o.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="checkbox"></div>'),n.wrap("<label></label>"),n.after('<span class="checkbox-material"><span class="check" style="margin-right:16px;width: '+i.width+";height:"+i.height+';"></span></span>&nbsp;'+(i.itLabel||""))}}}),o.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,i,n){if(n){var o=angular.element(t[0]);if(o.hasClass("floating-label")){o.wrap('<div class="form-control-wrapper"></div>');var r=o.attr("placeholder");r?o.after('<div class="floating-label">'+r+"</div"):(o.after('<div class="floating-label">'+e.itLabel+"</div"),e.$watch("itLabel",function(t){e.$applyAsync(function(){if(o[0].offsetParent){var e=o[0].offsetParent.children;angular.forEach(e,function(e){var i=angular.element(e);i.hasClass("floating-label")&&i.text(t)})}})})),o.after('<span class="material-input"></span>'),o.attr("placeholder","").removeClass("floating-label")}o.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(o[0].offsetParent){var t=o[0].offsetParent.children;angular.forEach(t,function(t){var i=angular.element(t);i.hasClass("text-danger")&&(i.text(e),""!=e&&void 0!=e?(i.removeClass("ng-hide"),i.addClass("ng-show"),i.css("display","block")):(i.removeClass("ng-show"),i.addClass("ng-hide"),i.css("display","none")))})}}),(null===o.val()||"undefined"==o.val()||""===o.val())&&o.addClass("empty"),e.$watch(function(){return n.$modelValue},function(e,t){null===e||void 0==e||""===e?o.addClass("empty"):o.removeClass("empty")}),o.on("change",function(){null===o.val()||"undefined"==o.val()||""===o.val()?o.addClass("empty"):o.removeClass("empty")})}},scope:{itError:"=",itLabel:"@"}}}),o.directive("itSearch",function(){return{restrict:"A",replace:!0,scope:{itSearchControl:"="},link:function(e,t,i){var n=angular.element(t[0]);n.after('<span class="glyphicon glyphicon-search form-control-feedback"/>')},controller:["$scope",function(e){e.itSearchControl.multicolumnsFilter=function(t){var i=new RegExp(e.itSearchControl.filterText,"i"),n=[],o=!1;return e.itSearchControl.columnDefs&&t.forEach(function(t){var r=!1;t.entity?(e.itSearchControl.columnDefs.forEach(function(n){if(!r&&t.entity[n.field]){var o=t.entity[n.field].toString();n.cellFilter&&(e.value=o,o=e.$eval("value | "+n.cellFilter)),"undefined"!=typeof o&&null!=o&&o.match(i)&&(r=!0)}}),r||(t.visible=!1)):(o=!0,e.itSearchControl.columnDefs.forEach(function(e){!r&&t[e.field]&&t[e.field].toString().match(i)&&(r=!0)}),r&&n.push(t))}),o&&(t=n),t}}]}}),o.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="togglebutton"></div>'),void 0==e.itLabel?(n.wrap("<label></label>"),n.after('<span class="toggle"></span>')):(n.wrap("<label></label>"),n.after('<span class="toggle"></span><span>'+(e.itLabel||"")+"</span>"),e.$watch("itLabel",function(e){if(e&&n.context){var t=angular.element(n.context.parentNode);if(t&&i.itLabel){var o=angular.element(t.get(0).firstChild);o.get(0).textContent=e+"  "}}}))},scope:{itLabel:"@"}}}]),o.directive("itInclude",["$timeout","$compile",function(e,t){var i=function(i,n,o){var r;i.$watch(o.itInclude,function(o){e(function(){r&&r.$destroy(),r=i.$new(),n.html(o||""),t(n.contents())(r)},50)})};return{restrict:"AE",link:i}}]),o.directive("itMediaViewer",["itScriptService",function(e){var t=function(e,t){if(void 0!=e){var i=e.split(t);return i[i.length-1]}return e},i=function(i,n,o){var r=function(t,n){var o=(i.options?i.options.libPath:null)||"js/dist/assets/lib";switch(t){case"pdf":i.pdfSrc=n,e.LoadScripts([o+"/pdf.js"]).then(function(){PDFJS.workerSrc=o+"/pdf.worker.js",i.template='<it-pdf-viewer src="pdfSrc" options="options"></it-pdf-viewer>'});break;case"png":case"jpeg":case"jpg":i.imageSrc=n,i.template='<it-image-viewer src="imageSrc" options="options"></it-image-viewer>';break;case"tif":case"tiff":i.tiffSrc=n,e.LoadScripts([o+"/tiff.min.js"]).then(function(){i.template='<it-tiff-viewer src="tiffSrc" options="options"></it-tiff-viewer>'});break;default:i.template="No template found for extension : "+t}},a=function(e){e&&("string"==typeof e?(i.ext=t(e,".").toLowerCase(),r(i.ext,e)):o.type?r(o.type,e):void 0!=e.name?(i.ext=t(e.name,".").toLowerCase(),r(i.ext,e)):i.template="must specify type when using stream")};i.$watch("src",a),i.$watch("file",a)};return{scope:{src:"=",file:"=",type:"@",options:"="},restrict:"E",template:'<div it-include="template"></div>',link:i}}]),o.factory("itScriptService",["$log","$window","$q",function(e,t,i){var n={},o={},r=i.defer(),a=i.defer(),s=function(e){if(e){if(void 0!=n[e])return n[e];var t=i.defer(),o=document.createElement("script");return n[e]=t.promise,o.src=e,o.type="text/javascript",o.onload=function(){t.resolve(o)},document.head.appendChild(o),t.promise}return r.resolve(),r.promise},l=function(e){if("string"==typeof e)return s(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(s(e))}),i.all(t)}return a.resolve(),a.promise},c=function(e){if(e){if(void 0!=o[e])return o[e];var t=i.defer(),n=document.createElement("link");return o[e]=t.promise,n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=function(){t.resolve(n)},document.head.appendChild(n),t.promise}return r.resolve(),r.promise},d=function(e){if("string"==typeof e)return c(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(c(e))}),i.all(t)}return a.resolve(),a.promise},u=function(e,t){return i.all([l(e),d(t)])};return{LoadScripts:u}}]),o.directive("konami",["$document","$uibModal",function(e,t){return{restrict:"A",template:'<style type="text/css"> @-webkit-keyframes easterEggSpinner { from { -webkit-transform: rotateY(0deg); } to { -webkit-transform: rotateY(-360deg); } } @keyframes easterEggSpinner { from { -moz-transform: rotateY(0deg); -ms-transform: rotateY(0deg); transform: rotateY(0deg); } to { -moz-transform: rotateY(-360deg); -ms-transform: rotateY(-360deg); transform: rotateY(-360deg); } } .easterEgg { -webkit-animation-name: easterEggSpinner; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite; -webkit-animation-duration: 6s; animation-name: easterEggSpinner; animation-timing-function: linear; animation-iteration-count: infinite; animation-duration: 6s; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d; } .easterEgg img { position: absolute; border: 1px solid #ccc; background: rgba(255,255,255,0.8); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); } </style>',link:function(i){var n=[38,38,40,40,37,39,37,39,66,65],o=0,r=function(a){if(a.keyCode===n[o++]){if(o===n.length){e.off("keydown",r);var s=t.open({template:'<div style="max-width: 100%;" class="easterEgg"> <img style="-webkit-transform: rotateY(0deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-72deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-144deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-216deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-288deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> </div>',size:"lg"});i.cancel=function(){s.dismiss("cancel")}}}else o=0};e.on("keydown",r),i.$on("$destroy",function(){e.off("keydown",r)})}}}]),o.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,i){function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return o[e]})}var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(n(t[0].innerHTML))}}}}]),o.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,i){var n=angular.element(t[0].querySelector("ul")),o=angular.element(t[0].querySelector("a"));n.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var r=angular.element(t[0].querySelector("h5")),a=angular.element('<i class="pull-right fa fa-angle-right" ></i>');r.append(a),o.on("click",function(){n.hasClass("it-side-menu-collapse")?(n.removeClass("it-side-menu-collapse"),n.addClass("it-side-menu-expanded"),a.removeClass("fa-angle-right"),a.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),a.addClass("fa-angle-right"),a.removeClass("fa-angle-down"),n.removeClass("it-side-menu-expanded"),n.addClass("it-side-menu-collapse"))})}}}),o.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,i,n){function o(){var t=e.path();t&&angular.forEach(i.find("li"),function(e){var i=e.querySelector("a");i.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(r):angular.element(e).removeClass(r)})}var r=n.itActive||"active";o(),t.$on("$locationChangeSuccess",o)}}}]),o.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e,t,i){e.$itSideMenuWidth=i.itWidth?i.itWidth:260,e.$watch(function(){e.$itSideMenuWidth=i.itWidth?i.itWidth:260});var n=angular.element(document.querySelector("it-side-menu-header"));n[0]||(e.$noMenuHeader=!0)},template:'<div style="{{$noMenuHeader ? \'top:0px;padding-bottom:0px;left:0px;\':\'\'}}width:{{$itSideMenuWidth}}px;" class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div style="width:{{($itSideMenuWidth * 1 ) + (50 * 1)}}px;"  class="it-sidebar-inner"><div style="width:{{$itSideMenuWidth}}px;" class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),o.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e){var t=angular.element(document.querySelector("it-side-menu-header"));t[0]||(e.showmenu=!0)},template:'<div class="it-menu-content"  style="padding-left : {{showmenu ? $itSideMenuWidth : 0}}px"><div class="it-container it-fill" ng-transclude></div></div>'}}),o.controller("$sideMenuCtrl",["$scope","$document","$timeout","$window",function(e,t,i,n){var o=this;o.scope=e,o.scope.showmenu=!1,o.toggleMenu=function(){o.scope.showmenu=o.scope.showmenu?!1:!0,i(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),n.dispatchEvent(e)},300)},o.hideSideMenu=function(){o.scope.showmenu=!1}}]),o.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,i,n,o){var r=angular.element(i[0].querySelector(".it-material-design-hamburger__layer")),a=(angular.element(i[0].querySelector(".it-material-design-hamburger__icon")),angular.element(document.querySelector("it-side-menu-content")));a&&a.css("padding-top","60px"),t.toggleMenu=o.toggleMenu,"true"===n.itAnimate&&t.$watch("showmenu",function(t,i){t!=i&&(t?(r.removeClass("it-material-design-hamburger__icon--from-arrow"),r.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed")):(r.removeClass("it-material-design-hamburger__icon--to-arrow"),r.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")))},!0),n.itHideButtonMenu&&(t.itHideButtonMenu=t.$eval(n.itHideButtonMenu)),t.$watch(n.itHideButtonMenu,function(e,i){t.itHideButtonMenu=e,e&&o.hideSideMenu()})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itHideButtonMenu"><button  ng-click="toggleMenu()" class="it-material-design-hamburger__icon"><span class="it-menu-animated it-material-design-hamburger__layer"> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),o.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),o.directive("itBottomGlue",["$window","$timeout",function(e,t){return function(i,n){function o(){for(var t=n[0],i=angular.element(n)[0],o=0,r=0,a=0,s=0;null!==t&&"undefined"!=typeof t;){var l=e.getComputedStyle(t),c=parseInt(l["margin-bottom"],10),d=parseInt(l["padding-bottom"],10),u=parseInt(l["padding-top"],10),p=parseInt(l["margin-top"],10);s+=isNaN(p)?0:p,o+=isNaN(c)?0:c,r+=isNaN(d)?0:d,a+=isNaN(u)?0:u,t=t.parentElement}var f=e.getComputedStyle(n[0]),g=parseInt(f["padding-bottom"],10),h=i.getBoundingClientRect();n.css("height",e.innerHeight-h.top-o-(r-g)+"px"),n.css("overflow-y","auto")}t(function(){o(),e.addEventListener("resize",function(){o()})},250)}}]),o.directive("itSidePanel",["$window",function(e){function t(e,t,i){e.itSidePanelElement=t,e.setIconClass(e,i),e.setZIndexes(t,i),e.setColMd(i),e.setHeightMode(i),e.setTopPosition(i)}return{link:t,restrict:"E",transclude:!0,controller:"$sidePanelCtrl",scope:!0,template:'<div class="it-side-panel-container" ng-class="{\'it-side-panel-container-show\': showPanel}"><div class="it-side-panel-button it-vertical-text" ng-class="{\'it-side-panel-button-show\':showPanel,\'it-side-panel-button-right\':!showPanel}" ng-click="toggleSidePanel()"><span class="fa {{itIconClass}}"></span></div><div class="it-side-panel" ng-transclude></div></div>'}}]),o.directive("itSidePanelContent",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-content" ng-transclude></div>'}}),o.controller("$sidePanelCtrl",["$scope","$window","$document","$timeout","$log",function(e,t,i,n,o){var r="it-col",a="it-height-mode",s="it-top-position",l=40,c="z-index",d="window",u="full",p="auto",f=[d,u,p],g=d,h=4,m=12,v=1,C="fa-search",b="none",w=b,y=".it-side-panel-button",E=".it-side-panel-button-right",S=".it-side-panel-container",I=".it-side-panel",A=".it-side-panel-header",T=".it-side-panel-content",P=".it-side-panel-footer",k=this;k.scope=e,k.scope.showPanel=!1,k.scope.itHeightMode=g,k.scope.itSidePanelcolMd=h,k.scope.itSidePanelTopPosition=b,k.scope.sidePanelButtonWidth=l,k.scope.sidePanelContainerWidth=null,k.scope.sidePanelContainerRight=null,k.scope.sidePanelButtonRight=null;var D=angular.element(t);k.scope.getWindowDimensions=function(){return{height:t.innerHeight,width:t.innerWidth}},k.scope.$watch(k.scope.getWindowDimensions,function(e,t){k.scope.windowHeight=e.height,k.scope.windowWidth=e.width;var i=k.scope.getElementFromClass(k.scope.itSidePanelElement,S);if(k.scope.itHeightMode===d){var n=i[0].getBoundingClientRect().top;if(Math.abs(n)<k.scope.windowHeight){var o=k.scope.itSidePanelTopPosition;k.scope.isNoneTopPosition()&&(o=0);var r=k.scope.windowHeight-n-o,a=.1*r,s=k.scope.getElementFromClass(k.scope.itSidePanelElement,A);s.css("height",a+"px");var l=.1*r,c=k.scope.getElementFromClass(k.scope.itSidePanelElement,P);c.css("height",l+"px");var u=k.scope.getElementFromClass(k.scope.itSidePanelElement,T);u.css("height",.8*r+"px")}}if(k.scope.showPanel){var p=k.scope.windowWidth/12*k.scope.itSidePanelcolMd;k.scope.sidePanelContainerWidth=p,i.css("width",p+"px")}else k.scope.modifySidePanelCssProperties()},!0),k.scope.modifySidePanelCssProperties=function(){var e=k.scope.getElementFromClass(k.scope.itSidePanelElement,S),t=k.scope.getElementFromClass(k.scope.itSidePanelElement,E),i=k.scope.windowWidth/12*k.scope.itSidePanelcolMd;k.scope.sidePanelContainerWidth=i,k.scope.sidePanelContainerRight=-k.scope.sidePanelContainerWidth,k.scope.sidePanelButtonRight=k.scope.sidePanelContainerWidth,e.css("width",k.scope.sidePanelContainerWidth+"px"),e.css("right",k.scope.sidePanelContainerRight+"px"),t.css("right",k.scope.sidePanelButtonRight+"px")},D.bind("resize",function(){k.scope.$apply()}),k.scope.toggleSidePanel=function(){k.scope.showPanel=k.scope.showPanel?!1:!0;var e=k.scope.getElementFromClass(k.scope.itSidePanelElement,S),t=k.scope.getElementFromClass(k.scope.itSidePanelElement,y);if(k.scope.showPanel)t.css("right",""),n(function(){k.scope.sidePanelContainerRight=0,e.css("right",k.scope.sidePanelContainerRight+"px")},50);else{var i=e.css("width");k.scope.sidePanelContainerRight=-parseInt(i.slice(0,i.length-2)),k.scope.sidePanelButtonRight=k.scope.sidePanelContainerWidth,e.css("right",k.scope.sidePanelContainerRight+"px"),t.css("right",k.scope.sidePanelButtonRight+"px")}},k.scope.setItSidePanelElement=function(e){k.scope.itSidePanelElement=e},k.scope.setHeightMode=function(e){if(k.scope.itHeightMode=e.itHeightMode,""===k.scope.itHeightMode||"undefined"==typeof k.scope.itHeightMode)k.scope.itHeightMode=g;else if(-1!=f.indexOf(k.scope.itHeightMode)){var t=f.indexOf(k.scope.itHeightMode);k.scope.itHeightMode=f[t]}else k.scope.itHeightMode=g,o.error('"'+a+'" with value "'+k.scope.itHeightMode+'"is unknown. The default value is taken : "'+g+'"');var i=k.scope.getElementFromClass(k.scope.itSidePanelElement,A);i.css("height","10%");var n=k.scope.getElementFromClass(k.scope.itSidePanelElement,P);n.css("height","10%");var r=k.scope.getElementFromClass(k.scope.itSidePanelElement,T);switch(r.css("height","80%"),k.scope.itHeightMode){case u:var s=k.scope.getElementFromClass(k.scope.itSidePanelElement,S),l=s.css("height");if(l>k.scope.windowHeight){s.css("height","100%");var c=k.scope.getElementFromClass(k.scope.itSidePanelElement,I);c.css("height","100%")}break;case p:break;case d:var c=k.scope.getElementFromClass(k.scope.itSidePanelElement,I);c.css("height","100%");var r=k.scope.getElementFromClass(k.scope.itSidePanelElement,T);r.css("overflow","auto");break;default:o.error('Height mode : "'+k.scope.itHeightMode+'" is unknown.');
}},k.scope.setIconClass=function(e,t){var i=C;""===t.itIconClass||"undefined"==typeof t.itIconClass?k.scope.itIconClass=i:k.scope.itIconClass=t.itIconClass},k.scope.setColMd=function(e){isNaN(parseInt(e.itCol))?(k.scope.itSidePanelcolMd=h,o.warn('Attribute "'+r+'" of itSidePanel directive is not a number. The default value is taken : "'+k.scope.itSidePanelcolMd+'"')):e.itCol>m?(k.scope.itSidePanelcolMd=m,o.warn('Attribute "'+r+'" of itSidePanel directive exceeds the maximum value ('+m+"). The maximum value is taken.")):e.itCol<v?(k.scope.itSidePanelcolMd=v,o.warn('Attribute "'+r+'" of itSidePanel directive exceeds the minimum value ('+v+"). The minimum value is taken.")):k.scope.itSidePanelcolMd=e.itCol},k.scope.setZIndexes=function(e,t){var i=null;isNaN(parseInt(t.itZIndex))||(i=parseInt(t.itZIndex));var n=k.scope.getElementFromClass(e,S),o=k.scope.getElementFromClass(e,y);if(null!==i)n.css(c,i),o.css(c,i+1);else{var r=k.scope.findHighestZIndex(),a=r+100;n.css(c,a),o.css(c,a+1)}},k.scope.getElementFromClass=function(e,t){var i=angular.element(e[0].querySelector(t)),n=angular.element(i[0]);return n},k.scope.findHighestZIndex=function(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),r=parseInt(o["z-index"]);(isNaN(r)?0:r)>i&&(i=r)}return i},k.scope.setTopPosition=function(e){var t=e.itTopPosition;if(isNaN(parseInt(t)))k.scope.isNoneTopPosition()&&"undefined"!=typeof t||(k.scope.itSidePanelTopPosition=w,o.warn('Attribute "'+s+'" of itSidePanel directive is not a number. The mode taken is "'+w+'"'));else{k.scope.itSidePanelTopPosition=e.itTopPosition;var i=k.scope.getElementFromClass(k.scope.itSidePanelElement,S);i.css("top",k.scope.itSidePanelTopPosition+"px")}},k.scope.isNoneTopPosition=function(){return"none"===k.scope.itSidePanelTopPosition}}]),o.directive("itSidePanelFooter",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-footer" ng-transclude></div>'}}),o.directive("itSidePanelHeader",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-header text-center" ng-transclude></div>'}}),o.factory("BlockService",["$resource","CONFIG",function(e,t){return{custom:e(t.REST_TEMPLATE_API_URL+"/blocks/custom/"+t.CURRENT_PACKAGE+"/:name"),all:e(t.REST_TEMPLATE_API_URL+"/blocks/all/"+t.CURRENT_PACKAGE+"/:name"),original:e(t.REST_TEMPLATE_API_URL+"/blocks/original/:name"),customByOriginal:e(t.REST_TEMPLATE_API_URL+"/original/"+t.CURRENT_PACKAGE+"/:name/custom"),restore:e(t.REST_TEMPLATE_API_URL+"/blocks/restore/"+t.CURRENT_PACKAGE+"/:name"),build:e(t.REST_TEMPLATE_API_URL+"/packages/build"),preview:e(t.REST_TEMPLATE_API_URL+"/packages/preview"),"new":function(e,t,i,n,o,r){return{name:e,position:i,ref:t,content:n,role:o,version:r}}}}]),o.directive("itBlock",[function(){return{restrict:"E",scope:!0,transclude:!0,template:'<ng-transclude  class="{{itBlockController.hilightClass}}" ng-mouseover="itBlockController.over()" ng-mouseleave="itBlockController.leave()" ng-if="!removed || $root.editSite"> </ng-transclude>',controllerAs:"itBlockController",link:function(e,t,i,n,o){o(e,function(t){var i="";angular.forEach(t,function(e){e.outerHTML&&(i+=e.outerHTML)}),e.content=i}),e.ref=i.ref,e.role=i.role,e.position=i.position,e.name=i.name,e.removed=!1,e.element=t,e.version=i.version,angular.isDefined(i.removed)&&"true"==i.removed&&(e.removed=i.removed),this.fields={},n.onRegisterApi()},controller:["$scope","$rootScope","$location","$log","$interval","$timeout","$document","itPopup","BlockService","PilotSiteSideService",function(e,t,i,n,o,r,a,s,l,c){var d=this;d.focusable=!1,t.$on("hilightBlock",function(t,i){angular.isDefined(i)&&i.name==d.block.name?d.hilightClass="block-hilight":e.removed?d.hilightClass="block-removed":d.hilightClass=""}),d.onRegisterApi=function(){d.block=l["new"](e.name,e.ref,e.position,e.content,e.role,e.version),d.block.removed=e.removed},d.leave=function(){t.$emit("unSelectBlock",d.block)},d.over=function(){t.$emit("selectBlock",d.block)},t.$watch("editSite",function(){t.editSite&&(r(function(){e.removed&&(d.hilightClass="block-removed")},500),r(function(){angular.isDefined(e.element.find("ng-transclude")[0])&&(e.element.find("ng-transclude")[0].children[0].disabled=!1)},500))})}]}}]),o.directive("itBlockControlPanel",[function(){return{restrict:"EA",scope:!0,template:'<div class="block-control-panel col-xs-12" ng-if="itBlockControlPanelController.CONFIG.ENABLE_TEMPLATE_EDITOR"><div ng-if="itBlockControlPanelController.editorIsOpen" class="col-xs-12"/> <div class="block-control-panel-action-container col-xs-12"><it-circular-btn ng-if="!$root.editSite" ng-click="$root.editSite=true" ><i class="fa fa-pencil"></i></it-circular-btn><it-circular-btn ng-if="$root.editSite" ng-click="$root.editSite=false" ><i class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.refresh()"><i class="fa fa-refresh"></i></it-circular-btn><it-circular-btn ng-if="$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=false"><i class="fa fa-stop"></i></it-circular-btn><it-circular-btn ng-if="!$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=true"><i class="fa fa-play"></i></it-circular-btn><it-circular-btn><a ng-href="{{itBlockControlPanelController.url}}" target="_blank" ><i class="fa fa-floppy-o"></i></a></it-circular-btn><span ng-if="!itBlockControlPanelController.focusable" class="col-xs-8 block-control-panel-help">(Press Ctrl and move your mouse over a block)</span><span ng-if="itBlockControlPanelController.focusable" class="col-xs-8 block-control-panel-help">(Release Ctrl over an element to select it)</span></div><div class=" btn btn-danger offline-editor"  ng-if="!itBlockControlPanelController.editorIsOpen" aria-label="Left Align"><span class="fa fa-exclamation" aria-hidden="true"></span><a  target="_blank" ng-href="{{CONFIG.TEMPLATE_EDITOR_URL}}" >{{\'GLOBAL.TEMPLATE.BLOCK.OPEN_EDITOR\' | translate}}</a></div><div class="block-lists"  ng-if="$root.editSite"><div ng-repeat="block in itBlockControlPanelController.blocks | orderBy:\'-name\'" ng-mouseover="itBlockControlPanelController.hilightBlock(block)" class="{{itBlockControlPanelController.getClass(block)}}"><div class="block-lists-name">{{block.name}}</div><div class="block-lists-action"><it-circular-btn ng-click="itBlockControlPanelController.addBlock(block)"><i class="fa fa-plus "></i></it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.editBlock(block)"><i  class="fa fa-pencil"></i></it-circular-btn><it-circular-btn ng-if="block.removed" ng-click="itBlockControlPanelController.restoreBlock(block)"><i  class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-if="!block.removed" ng-click="itBlockControlPanelController.deleteBlock(block)"><i  class="fa fa-eye-slash block-btn"></i></it-circular-btn></div></div></div></div>',controllerAs:"itBlockControlPanelController",controller:["$scope","$rootScope","$location","$log","$document","$filter","BlockService","PilotSiteSideService","PilotService","CONFIG","itPopup","itNotifier",function(e,t,i,n,o,r,a,s,l,c,d,u){function p(){s.fn.options({currentPackage:c.CURRENT_PACKAGE})}var f=this;c.ENABLE_TEMPLATE_EDITOR&&(f.editorIsOpen=!1,f.CONFIG=c,f.blocks=[],f.url=c.REST_TEMPLATE_API_URL+"/export/"+c.CURRENT_PACKAGE,this.refresh=function(){a.build.get(function(){location.reload()},function(e){u.notifyError({content:r("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},f.interval=0,p(),s.on.pong=function(t){n.debug("pong"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorConnect=function(t){n.debug("editorConnect"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorDisconnect=function(t){n.debug("editorDisconnect"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.close=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.error=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.transportFailure=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.reload=this.refresh,f.editJS=function(){n.debug("edit JS"),s.fn.editPage({fileName:"js.blocks.js",fileType:"js",filePackage:c.CURRENT_PACKAGE})},f.editCSS=function(){n.debug("edit CSS"),s.fn.editPage({fileName:"css.blocks.css",fileType:"css",filePackage:c.CURRENT_PACKAGE})},f.addFile=function(){n.debug("add File"),s.fn.createPage()},t.editSite=!0,t.autoRefreshTemplate=!0,o.bind("keydown",function(e){17!=e.keyCode||f.focusable||(o.find("*").addClass("crosshair"),n.log("keydown"),f.focusable=!0,f.blocks=[],f.hilightedBlock=void 0,f.hilightBlock(void 0))}),o.bind("keyup",function(e){17==e.keyCode&&f.focusable&&(n.log("keyup"),o.find("*").removeClass("crosshair"),f.focusable=!1)}),t.$on("selectBlock",function(e,t){f.focusable&&-1==f.blocks.indexOf(t)&&f.blocks.push(t)}),t.$on("unSelectBlock",function(e,t){f.focusable&&-1!=f.blocks.indexOf(t)&&f.blocks.splice(f.blocks.indexOf(t),1)})),f.editBlock=function(e){if(n.debug("edit block"),angular.isDefined(e.ref)&&""!=e.ref)s.fn.editBlock(e,i.path());else{var t=a["new"](c.CURRENT_PACKAGE+"_replace"+e.name+"_"+r("date")(new Date,"yyyyMMddHHmmss"),e.name,"replace",e.content,c.CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.addBlock=function(e){if(angular.isDefined(e.name)&&""!=e.name){n.debug("add block");var t=a["new"](c.CURRENT_PACKAGE+"_new_"+e.name+"_"+r("date")(new Date,"yyyyMMddHHmmss"),e.name,"before","",c.CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.restoreBlock=function(e){n.debug("restore block"),a.restore.get({name:e.name},function(){a.build.get(function(){a.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:r("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(t){u.notifyError({content:r("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},t.data.body),n.error("Unable to restore block "+JSON.stringify(e))})})},f.deleteBlock=function(e){n.debug("delete block");var i=d.confirm({title:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.TITLE' | translate}}",text:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.CONFIRM' | translate}}",buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});i.then(function(){a.all["delete"]({name:e.name},function(){a.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:r("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(e){u.notifyError({content:r("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(){u.notifyError({content:"{{'GLOBAL.TEMPLACE.WS.BLOCK_DELETED_KO' | translate}}"})})},f.hilightBlock=function(e){f.hilightedBlock=e,t.$emit("hilightBlock",e)},f.getClass=function(e){return f.hilightedBlock&&f.hilightedBlock.name==e.name?"block-lists-element-hilight":""}}]}}]),o.factory("PilotService",["$resource","$log","CONFIG",function(e,t,i){function n(e){t.log("ping "+e),r.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:r.ACTION_PING,params:[]}))}function o(e){t.log("pong "+e),r.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:r.ACTION_PONG,params:[]}))}var r=this;return r.ACTION_EDIT_BLOCK="editBlock",r.ACTION_REMOVE_BLOCK="removeBlock",r.ACTION_CREATE_BLOCK="createBlock",r.ACTION_EDIT_PAGE="editPage",r.ACTION_REMOVE_PAGE="removePage",r.ACTION_CREATE_PAGE="createPage",r.ACTION_PING="ping",r.ACTION_PONG="pong",r.ACTION_DISCONNECT="disconnect",r.ACTION_TIMEOUT="timeout",r.ACTION_CONNECT="connect",r.ACTION_RELOAD="reload",r.ACTION_OPTIONS="options",r.DEST_EDITOR="editor",r.DEST_SITE="site",r.DEST_ALL="all",r.fields={socket:{},request:{url:i.REST_EDITOR_API_URL,contentType:"application/json",logLevel:"debug",transport:"websocket",trackMessageLength:!0,reconnectInterval:5e3,enableXDR:!0,timeout:6e4},model:{},dest:""},r.fn={ping:n,pong:o},r.on={message:{},open:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},r.fields.request.onOpen=function(e){r.fields.model.transport=e.transport,r.fields.model.connected=!0,r.fields.socket.push(atmosphere.util.stringifyJSON({dest:r.fields.dest,action:r.ACTION_CONNECT,params:[]})),angular.isDefined(r.on.open)&&r.on.open()},r.fields.request.onClientTimeout=function(e){r.fields.model.connected=!1,r.fields.socket.push(atmosphere.util.stringifyJSON({dest:r.fields.dest,action:r.ACTION_TIMEOUT,params:[]})),setTimeout(function(){r.fields.socket=atmosphere.subscribe(r.fields.request)},r.fields.request.reconnectInterval)},r.fields.request.onReopen=function(e){r.fields.model.connected=!0,r.fields.socket.push(atmosphere.util.stringifyJSON({dest:r.fields.dest,action:r.ACTION_CONNECT,params:[]})),angular.isDefined(r.on.reopen)&&r.on.reopen()},r.fields.request.onTransportFailure=function(e,t){atmosphere.util.info(e),t.fallbackTransport="long-polling",angular.isDefined(r.on.transportFailure)&&r.on.transportFailure()},r.fields.request.onMessage=function(e){r.on.message(e)},r.fields.request.onClose=function(e){r.fields.model.connected=!1,r.fields.socket.push(atmosphere.util.stringifyJSON({dest:r.fields.dest,action:r.ACTION_DISCONNECT,params:[]})),angular.isDefined(r.on.close)&&r.on.close()},r.fields.request.onError=function(e){r.fields.model.logged=!1,angular.isDefined(r.on.error)&&r.on.error()},r.fields.request.onReconnect=function(e,t){r.fields.model.connected=!1},i.ENABLE_TEMPLATE_EDITOR&&(r.fields.socket=atmosphere.subscribe(r.fields.request)),r}]),o.factory("PilotSiteSideService",["$resource","$log","CONFIG","PilotService",function(e,t,i,n){function o(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_BLOCK,params:[{block:e,path:t}]}))}function r(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_BLOCK,params:[{block:e,path:t}]}))}function a(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_BLOCK,params:[{block:e,path:t}]}))}function s(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_PAGE,params:[{page:e}]}))}function l(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_PAGE,params:[{page:e}]}))}function c(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_PAGE,params:[{page:e}]}))}function d(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_OPTIONS,params:[{options:e}]}))}var u=this;return u.fields={},u.fn={editBlock:o,removeBlock:r,createBlock:a,editPage:s,removePage:l,createPage:c,options:d,ping:n.fn.ping},u.on={reload:void 0,pong:void 0,editorConnect:void 0,editorDisconnect:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},i.ENABLE_TEMPLATE_EDITOR&&(n.fields.dest=n.DEST_EDITOR,n.on.open=function(e){t.log("WebSocket connection is opened"),u.fn.ping(n.DEST_EDITOR)},n.on.reopen=function(e){t.log("WebSocket connection is reopened"),u.fn.ping(n.DEST_EDITOR)},n.on.close=function(){angular.isDefined(u.on.close)&&u.on.close()},n.on.error=function(){angular.isDefined(u.on.error)&&u.on.error()},n.on.transportFailure=function(){angular.isDefined(u.on.transportFailure)&&u.on.transportFailure()},n.on.message=function(e){var i=e.responseBody;try{var o=atmosphere.util.parseJSON(i);if(o.dest==n.DEST_ALL)switch(o.action){case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect()}if(o.dest==n.DEST_SITE)switch(o.action){case n.ACTION_RELOAD:t.log(n.ACTION_RELOAD),angular.isDefined(u.on.reload)&&u.on.reload();break;case n.ACTION_PING:t.log(n.ACTION_PING),n.pong(n.DEST_EDITOR);break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect();break;case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect()}}catch(r){throw t.error("Error parsing JSON: ",i),r}}),u}]),o.filter("itUnicode",["$sce",function(e){return function(t){function i(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();n.length<4;)n="0"+n;n="&#x"+n+";",t+=n}return t}return e.trustAsHtml(i(t))}}]),o.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(i,n,o){function r(){var o,r=angular.element(t[0].getElementById(i.footerElementId));o=1===r.length?r[0].offsetHeight+a(r)+s(r):0;var l=n[0].offsetTop,c=s(n),d=i.additionalPadding||0,u=e.innerHeight-l-c-o-d;n.css("height",u+"px")}function a(e){var t=l(e,"margin-top"),i=l(e,"border-top-width");return t+i}function s(e){var t=l(e,"margin-bottom"),i=l(e,"border-bottom-width");return t+i}function l(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",r),r()}}}]),o.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),o.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),o.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),o.provider("itLanguageChangeHandler",function(){var e=this;this.options={storage:"local",displayConfirm:!0,onChangePopup:{title:"Confirm language change",text:"By modifying the language any recent changes may be lost. Continue?",buttonCancelLabel:"NO",buttonOkLabel:"YES"}},this.$get=["$rootScope","$translate","$location","$q","localStorageService","itPopup",function(t,i,n,o,r,a){return{translate:i,getConfig:function(){return e.options},changeLanguage:function(o,s,l){var c={currentLanguage:this.getCurrentLanguage()};if(e.options.displayConfirm){i.use(o);var d=a.confirm({title:e.options.onChangePopup.title,text:e.options.onChangePopup.text,cancelText:e.options.onChangePopup.buttonCancelLabel,okText:e.options.onChangePopup.buttonOkLabel});!function(a){var c=a;d.then(function(c){if(i.use(o),"query"===e.options.storage)try{n.search("Locale",o)}catch(d){reject("Error setting query parameter, lang, to locale value: "+o+" Error: "+d.message)}else try{r.set("Locale",o)}catch(d){reject("Error setting local storage parameter, lang, to locale value: "+o+" Error: "+d.message)}s&&(s.currentLanguage=o,s.user&&(s.user.language=i.use())),a={currentLanguage:o},l&&l(a),t.$applyAsync(function(){location.reload()})},function(){i.use(c.currentLanguage)})}(c)}},getCurrentLanguage:function(){return"query"===e.options.storage?n.search().Locale?n.search().Locale.replace(/-/g,"_"):this.getDefaultLocale(this.translate.use()):r.get("Locale")||this.getDefaultLocale(this.translate.use())},getDefaultLocale:function(e){switch(e||(e=i.preferredLanguage()),e){case"en":return"en_GB";case"de":return"de_DE";default:case"fr":return"fr_FR"}},getLanguageCode:function(e){switch(e){case"en_GB":case"en-GB":case"en_US":case"en-US":return"en";case"de_DE":case"de-DE":return"de";default:case"fr_FR":case"fr-FR":case"fr_CA":case"fr-CA":return"fr"}}}}]}),o.service("ItMessaging",["$log","$http","$q","$websocket","$rootScope",function(e,t,i,n,o){function r(r){function a(){var n=i.defer();return t({url:"http://"+c.URL+"/rest/topics",method:"GET",headers:{token:c.token}}).then(function(e){n.resolve(e.data)},function(t){e.error(t),n.reject(n)}),n.promise}function s(e,t){for(var i,n=0;n<c.onMessageCallbacks.length;n++){i=c.onMessageCallbacks[n];var r=angular.fromJson(e.data);angular.isArray(r)?angular.forEach(r,function(e){o.$applyAsync(function(){i.fn.apply(this,[e,t])})}):o.$applyAsync(function(){i.fn.apply(this,[r,t])})}}function l(e){for(var t,i=0;i<c.onCloseCallbacks.length;i++)t=c.onCloseCallbacks[i],o.$applyAsync(function(){t.fn.apply(this,e)})}var c=this;c.URL=r,c.onMessageCallbacks=[],c.onCloseCallbacks=[],c.token=null,this.getToken=function(n,o){console.warn("This function is only for demo purpose, do NOT use it in production mode, the security of your apiKey will not be granted");var r=i.defer();return t({url:"http://"+this.URL+"/rest/token",method:"GET",params:{username:o},headers:{"api-key":n}}).then(function(e){r.resolve(e.data.token)},function(t){e.error("error on api endpoint"),r.reject("error on api endpoint")}),r.promise},this.connect=function(e){return e?(c.token=e,c.dataStream=n("ws://"+c.URL+"/websocket/"+e),c.dataStream.onMessage(function(e){a().then(function(t){s(e,t)})}),c.dataStream.onClose(function(e){l(e)}),!0):void 0},this.onMessage=function(e){return c.onMessageCallbacks.push({fn:e}),c},this.onClose=function(e){return c.onCloseCallbacks.push({fn:e}),c},this.subscribeToTopic=function(n,o){var r=i.defer();return null!=c.token?t({url:"http://"+c.URL+"/rest/topics/"+n+"/register",method:"POST",data:o,headers:{token:c.token}}).then(function(e){r.resolve(e.data),a()},function(t){e.error(t),r.reject(t)}):(e.error("You cannot register observers to topic without token"),r.reject("no token")),r.promise},this.unsubscribeToTopic=function(n,o){var r=i.defer();return null!=c.token?t({url:"http://"+c.URL+"/rest/topics/"+n+"/unregister",method:"POST",data:o,headers:{token:c.token}}).then(function(e){r.resolve(e.data),a()},function(t){e.error(t),r.reject(t)}):(e.error("You cannot register observers to topic without token"),r.reject("no token")),r.promise},this.sendMessage=function(n){var o=i.defer();return t({url:"http://"+c.URL+"/rest/messages",method:"POST",headers:{token:c.token},data:n}).then(function(e){o.resolve(e.data)},function(t){e.error(t),o.reject(t)}),o.promise}}return function(e){return new r(e)}}]),o.provider("itNotifier",[function(){var e=this;e.defaultOptions={dismissOnTimeout:!0,timeout:4e3,dismissButton:!0,animation:"fade",horizontalPosition:"right",verticalPosition:"bottom",compileContent:!0,dismissOnClick:!1,success:{dismissOnClick:!0},info:{dismissOnClick:!0},error:{dismissOnTimeout:!1},warning:{dismissOnTimeout:!1}},this.$get=["ngToast","$rootScope","$log",function(t,i,n){function o(e){return" CODE : "+e.CODE+", TYPE : "+e.TYPE+", MESSAGE : "+e.MESSAGE+", DETAIL : "+e.DETAIL+", DONE : "+e.DONE}var r={};return t.settings=angular.extend(t.settings,e.defaultOptions),r.notifySuccess=function(i,r){var a=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.success,i,i.success);t.success(a),void 0!=r&&n.log("Success popup called : "+o(r))},r.notifyError=function(i,r){var a=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.error,i,i.error);t.danger(a),void 0!=r&&n.error("Error popup called : "+o(r))},r.notifyInfo=function(i,r){var a=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.info,i,i.info);t.info(a),void 0!=r&&n.info("Info popup called : "+o(r))},r.notifyWarning=function(i,r){var a=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.warning,i,i.warning);t.warning(a),void 0!=r&&n.warn("Warning popup called : "+o(r))},r.notifyDismiss=function(e,i){t.dismiss()},r.notify=function(e){n.error("Unknown type for itNotifier: "+e)},i.$on("$locationChangeSuccess",function(){r.notifyDismiss()}),i.$on("itNotifierEvent",function(e,t){if(t)switch(t.type){case"SUCCESS":r.notifySuccess(t.options,t.errorDetails);break;case"ERROR":r.notifyError(t.options,t.errorDetails);break;case"INFO":r.notifyInfo(t.options,t.errorDetails);break;case"WARNING":r.notifyWarning(t.options,t.errorDetails);break;case"DISMISS":r.notifyDismiss(t.options,t.errorDetails);break;default:r.notify(t.type)}else n.error("Bad usage of itNotifier. Check manual for details")}),r}]}]),o.factory("itPopup",["$uibModal","$uibModalStack","$rootScope","$q","$compile",function(e,t,i,n,o){function r(e){function t(){return!1}var o={};return o.scope=(e.scope||i).$new(),o.responseDeferred=n.defer(),o.scope.$buttonTapped=function(e,t){var i=(t.onTap||noop)(e);o.responseDeferred.resolve(i)},e=angular.extend({scope:o.scope,template:u,controller:["$scope","$uibModalInstance",function(e,i){function n(){i.close(e.data)}function r(){i.dismiss("cancel")}e.itButtonAction=function(i,a){var s=(a.onTap||t)(i,e),l=s;i.isDefaultPrevented()||o.responseDeferred.resolve(l?n():r())}}],buttons:[]},e||{}),e.scope.options=e,o.options=e,o}function a(i){t.dismissAll();var n=r(i);return e.open(n.options).result}function s(e){return t.dismissAll(),a(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function l(e){return t.dismissAll(),a(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function c(e){return t.dismissAll(),a(e)}function d(e){t.dismissAll();var n=i.$new(!0);n.data={};var o="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(o="<span>"+e.template+"</span>",delete e.template),a(angular.extend({template:p,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var u='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',p='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',f={alert:s,confirm:l,prompt:d,custom:c};return f}]),n.factory("IMAGEPage",["$log","MultiPagesPage","PageViewport","MultiPagesConstants",function(e,t,i,n){function o(e,i,n){this.base=t,this.base(e,n),this.img=i}return o.prototype=new t,o.prototype.render=function(e){var t=this;if(this.rendered)return void(e&&e(this,n.PAGE_ALREADY_RENDERED));if(this.rendered=!0,this.canvasRendered)t.container.append(t.canvas);else{t.container.append(t.canvas);var i=t.canvas[0].getContext("2d");i.transform.apply(i,t.viewport.transform),i.drawImage(this.img,0,0),e&&e(t,n.PAGE_RENDERED)}},o}]).factory("IMAGEViewer",["$log","MultiPagesViewer","MultiPagesViewerAPI","IMAGEPage",function(e,t,i,n){function o(e){this.base=t,this.base(new i(this),e)}return o.prototype=new t,o.prototype.open=function(e,t,i){this.element.empty(),this.pages=[],this.pageMargin=i,this.initialScale=t;var n="string"!=typeof e;n?this.setFile(e):this.setUrl(e)},o.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;t.getAllPages(e,function(e){t.pages=e,t.setContainerSize(t.initialScale)})}},o.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result;t.getAllPages(i,function(e){t.pages=e,t.setContainerSize(t.initialScale)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsDataURL(e)}},o.prototype.getAllPages=function(e,t){var i=[],o=this;i.push({});var r=new Image;r.onprogress=angular.bind(this,o.downloadProgress),r.onload=function(){var e=new n(0,r,[0,0,r.width,r.height]);i[0]=e,o.element.append(e.container),t(i)},r.src=e},o}]).directive("imageViewer",["$log","IMAGEViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",api:"=",initialScale:"@"},controller:["$scope","$element",function(e,n){var o=new t(n);e.api=o.getAPI(),e.onSrcChanged=function(){o.open(this.src,this.initialScale,i)},e.onFileChanged=function(){o.open(this.file,this.initialScale,i)},o.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}]),n.directive("itImageViewer",["$sce",function(e){var t=function(t,i,n){t.trustSrc=function(t){return e.trustAsResourceUrl(t)},t.$watch("options.api",function(e){t.options&&t.options.onApiLoaded&&t.options.api&&t.options.onApiLoaded(t.options.api)})};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><image-viewer class="multipage-viewer" src="{{trustSrc(src)}}" api="options.api" initial-scale="{{options.initialScale}}" ></image-viewer>',link:t}}]),t.factory("CustomStyle",[function(){function e(){}var t=["ms","Moz","Webkit","O"],i={};return e.getProp=function(e,n){if(1===arguments.length&&"string"==typeof i[e])return i[e];n=n||document.documentElement;var o,r,a=n.style;if("string"==typeof a[e])return i[e]=e;r=e.charAt(0).toUpperCase()+e.slice(1);for(var s=0,l=t.length;l>s;s++)if(o=t[s]+r,"string"==typeof a[o])return i[e]=o;return i[e]="undefined"},e.setProp=function(e,t,i){var n=this.getProp(e);"undefined"!==n&&(t.style[n]=i)},e}]),t.directive("itPdfViewer",["$sce",function(e){var t=function(t,i,n){t.onPassword=function(e){return prompt("The selected PDF is password protected. PDF.js reason: "+e,"")},t.$watch("src",function(e){"string"==typeof e?t.url=e:t.file=e}),t.trustSrc=function(t){return e.trustAsResourceUrl(t)},t.$watch("options.api",function(e){t.options&&t.options.onApiLoaded&&t.options.api&&t.options.onApiLoaded(t.options.api)})};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><pdf-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.api" initial-scale="{{options.initialScale}}" render-text-layer="{{options.renderTextLayer}}" password-callback="onPassword(reason)"></pdf-viewer>',link:t}}]),t.factory("PDFViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.findNext=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID+1;e>=this.viewer.searchResults.length&&(e=0),this.viewer.highlightSearchResult(e)}},i.prototype.findPrev=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID-1;0>e&&(e=this.viewer.searchResults.length-1),this.viewer.highlightSearchResult(e)}},i}]).factory("PDFPage",["$log","MultiPagesPage","MultiPagesConstants","TextLayerBuilder",function(e,t,i,n){
function o(e,i){this.base=t,this.base(e.pageIndex),this.pdfPage=e,this.textContent=i,this.renderTask=null}return o.prototype=new t,o.prototype.clear=function(){null!==this.renderTask&&this.renderTask.cancel(),t.prototype.clear.call(this),this.renderTask=null},o.prototype.getViewport=function(e,t){return this.pdfPage.getViewport(e,t,0,0)},o.prototype.transform=function(){t.prototype.transform.call(this),this.textLayer=angular.element("<div class='text-layer'></div>"),this.textLayer.css("width",this.viewport.width+"px"),this.textLayer.css("height",this.viewport.height+"px")},o.prototype.render=function(t){var o=this;return this.rendered?void(null===this.renderTask?t&&t(this,i.PAGE_ALREADY_RENDERED):this.renderTask.then(function(){t&&t(o,i.PAGE_ALREADY_RENDERED)},function(t){e.debug("stopped "+t)})):(this.rendered=!0,void(this.canvasRendered?(o.container.append(o.canvas),o.container.append(o.textLayer)):(this.renderTask=this.pdfPage.render({canvasContext:this.canvas[0].getContext("2d"),viewport:this.viewport}),o.container.append(o.canvas),this.renderTask.then(function(){if(o.rendered=!0,o.renderTask=null,o.canvasRendered=!0,o.textContent){var e=new n({textLayerDiv:o.textLayer[0],pageIndex:o.id,viewport:o.viewport});e.setTextContent(o.textContent),e.renderLayer(),o.container.append(o.textLayer)}t&&t(o,i.PAGE_RENDERED)},function(e){o.rendered=!1,o.renderTask=null,"cancelled"===e?t&&t(o,i.PAGE_RENDER_CANCELLED):t&&t(o,i.PAGE_RENDER_FAILED)}))))},o}]).factory("PDFViewer",["$log","MultiPagesViewer","PDFViewerAPI","PDFPage",function(e,t,i,n){function o(e){this.base=t,this.base(new i(this),e),this.pdf=null,this.passwordCallback=null}return o.prototype=new t,o.prototype.open=function(e,t,i,n){this.element.empty(),this.pages=[],this.pageMargin=n,this.initialScale=t,this.hasTextLayer=i;var o="string"!=typeof e;if(void 0!=this.getDocumentTask){var r=this;this.getDocumentTask.destroy().then(function(){o?r.setFile(e):r.setUrl(e)})}else o?this.setFile(e):this.setUrl(e)},o.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;this.getDocumentTask=PDFJS.getDocument(e,null,angular.bind(this,this.passwordCallback),angular.bind(this,this.downloadProgress)),this.getDocumentTask.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i;for(var n=0;n<e.length;++n)t.element.append(e[n].container);t.setContainerSize(t.initialScale)})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})}},o.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result,n=new Uint8Array(i),o=PDFJS.getDocument(n,null,angular.bind(t,t.passwordCallback),angular.bind(t,t.downloadProgress));o.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i;for(var n=0;n<e.length;++n)t.element.append(e[n].container);t.setContainerSize(t.initialScale)})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},o.prototype.getAllPages=function(e){var t=[],i={},o=this.pdf.numPages,r=o;if(this.hasTextLayer)for(var a=0;o>a;++a){t.push({});var s=this.pdf.getPage(a+1);s.then(function(o){var a=o.ref.num+" "+o.ref.gen+" R";i[a]=o.pageIndex+1;var s=new n(o,null);t[o.pageIndex]=s,--r,0===r&&e(t,i),o.getTextContent().then(function(e){s.textContent=e})})}else for(var a=0;o>a;++a){t.push({});var s=this.pdf.getPage(a+1);s.then(function(o){t[o.pageIndex]=new n(o,null),--r,0===r&&e(t,i)})}},o.prototype.onDestroy=function(){this.getDocumentTask&&(this.getDocumentTask.destroy(),this.getDocumentTask=null)},o}]).directive("pdfViewer",["$log","PDFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",initialScale:"@",renderTextLayer:"@",passwordCallback:"&"},controller:["$scope","$element",function(n,o){n.getPassword=function(t,i){if(this.passwordCallback){var n=this;this.$apply(function(){var o=n.passwordCallback({reason:i});""!==o&&void 0!==o&&null!==o?t(o):e.log("A password is required to read this document.")})}else e.log("A password is required to read this document.")};var r=new t(o);r.passwordCallback=angular.bind(n,n.getPassword),n.api=r.getAPI(),n.shouldRenderTextLayer=function(){return""===this.renderTextLayer||void 0===this.renderTextLayer||null===this.renderTextLayer||"false"===this.renderTextLayer.toLowerCase()?!1:!0},n.onSrcChanged=function(){r.open(this.src,this.initialScale,this.shouldRenderTextLayer(),i)},n.onFileChanged=function(){r.open(this.file,this.initialScale,this.shouldRenderTextLayer(),i)},r.hookScope(n)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}]),t.factory("TextLayerBuilder",["CustomStyle",function(e){function t(e){return!o.test(e)}function i(e){this.textLayerDiv=e.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=e.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=e.viewport,this.textDivs=[],this.findController=e.findController||null}var n=1e5,o=/\S/;return i.prototype={_finishRendering:function(){this.renderingDone=!0;var e=document.createEvent("CustomEvent");e.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(e)},renderLayer:function(){var t=document.createDocumentFragment(),i=this.textDivs,o=i.length,r=document.createElement("canvas"),a=r.getContext("2d");if(o>n)return void this._finishRendering();for(var s,l,c=0;o>c;c++){var d=i[c];if(void 0===d.dataset.isWhitespace){var u=d.style.fontSize,p=d.style.fontFamily;(u!==s||p!==l)&&(a.font=u+" "+p,s=u,l=p);var f=a.measureText(d.textContent).width;if(f>0){t.appendChild(d);var g;if(void 0!==d.dataset.canvasWidth){var h=d.dataset.canvasWidth/f;g="scaleX("+h+")"}else g="";var m=d.dataset.angle;m&&(g="rotate("+m+"deg) "+g),g&&e.setProp("transform",d,g)}}}this.textLayerDiv.appendChild(t),this._finishRendering(),this.updateMatches()},render:function(e){if(this.divContentDone&&!this.renderingDone)if(this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),e){var t=this;this.renderTimer=setTimeout(function(){t.renderLayer(),t.renderTimer=null},e)}else this.renderLayer()},appendText:function(e,i){var n=i[e.fontName],o=document.createElement("div");if(this.textDivs.push(o),t(e.str))return void(o.dataset.isWhitespace=!0);var r=PDFJS.Util.transform(this.viewport.transform,e.transform),a=Math.atan2(r[1],r[0]);n.vertical&&(a+=Math.PI/2);var s=Math.sqrt(r[2]*r[2]+r[3]*r[3]),l=s;n.ascent?l=n.ascent*l:n.descent&&(l=(1+n.descent)*l);var c,d;0===a?(c=r[4],d=r[5]-l):(c=r[4]+l*Math.sin(a),d=r[5]-l*Math.cos(a)),o.style.left=c+"px",o.style.top=d+"px",o.style.fontSize=s+"px",o.style.fontFamily=n.fontFamily,o.textContent=e.str,PDFJS.pdfBug&&(o.dataset.fontName=e.fontName),0!==a&&(o.dataset.angle=a*(180/Math.PI)),o.textContent.length>1&&(n.vertical?o.dataset.canvasWidth=e.height*this.viewport.scale:o.dataset.canvasWidth=e.width*this.viewport.scale)},setTextContent:function(e){this.textContent=e;for(var t=e.items,i=0,n=t.length;n>i;i++)this.appendText(t[i],e.styles);this.divContentDone=!0},convertMatches:function(e){for(var t=0,i=0,n=this.textContent.items,o=n.length-1,r=null===this.findController?0:this.findController.state.query.length,a=[],s=0,l=e.length;l>s;s++){for(var c=e[s];t!==o&&c>=i+n[t].str.length;)i+=n[t].str.length,t++;t===n.length&&console.error("Could not find a matching mapping");var d={begin:{divIdx:t,offset:c-i}};for(c+=r;t!==o&&c>i+n[t].str.length;)i+=n[t].str.length,t++;d.end={divIdx:t,offset:c-i},a.push(d)}return a},renderMatches:function(e){function t(e,t){var n=e.divIdx;o[n].textContent="",i(n,0,e.offset,t)}function i(e,t,i,r){var a=o[e],s=n[e].str.substring(t,i),l=document.createTextNode(s);if(r){var c=document.createElement("span");return c.className=r,c.appendChild(l),void a.appendChild(c)}a.appendChild(l)}if(0!==e.length){var n=this.textContent.items,o=this.textDivs,r=null,a=this.pageIdx,s=null===this.findController?!1:a===this.findController.selected.pageIdx,l=null===this.findController?-1:this.findController.selected.matchIdx,c=null===this.findController?!1:this.findController.state.highlightAll,d={divIdx:-1,offset:void 0},u=l,p=u+1;if(c)u=0,p=e.length;else if(!s)return;for(var f=u;p>f;f++){var g=e[f],h=g.begin,m=g.end,v=s&&f===l,C=v?" selected":"";if(this.findController&&this.findController.updateMatchPosition(a,f,o,h.divIdx,m.divIdx),r&&h.divIdx===r.divIdx?i(r.divIdx,r.offset,h.offset):(null!==r&&i(r.divIdx,r.offset,d.offset),t(h)),h.divIdx===m.divIdx)i(h.divIdx,h.offset,m.offset,"highlight"+C);else{i(h.divIdx,h.offset,d.offset,"highlight begin"+C);for(var b=h.divIdx+1,w=m.divIdx;w>b;b++)o[b].className="highlight middle"+C;t(m,"highlight end"+C)}r=m}r&&i(r.divIdx,r.offset,d.offset)}},updateMatches:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,i=this.textContent.items,n=-1,o=0,r=e.length;r>o;o++){for(var a=e[o],s=Math.max(n,a.begin.divIdx),l=s,c=a.end.divIdx;c>=l;l++){var d=t[l];d.textContent=i[l].str,d.className=""}n=a.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}},i}]),e.directive("itProgressbarViewer",[function(){return{scope:{api:"="},restrict:"E",template:'<div class="loader" ><div class="progress-bar"><span class="bar" ng-style=\'{width: api.downloadProgress + "%"}\'></span></div></div>'}}]),e.directive("itToolbarViewer",["$log",function(e){var t=function(e,t,i){e.$watch("api.getZoomLevel()",function(t){e.scale=t}),e.$watch("api.getCurrentPage()",function(t){e.currentPage=t}),e.onZoomLevelChanged=function(){e.api.zoomTo(e.scale)},e.onPageChanged=function(){e.api.goToPage(e.currentPage)}};return{scope:{api:"="},restrict:"E",template:'<div class="toolbar"><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button ng-click="api.zoomOut()">-</button> <select ng-model="scale" ng-change="onZoomLevelChanged()" ng-options="zoom as zoom.label for zoom in api.getZoomLevels()"></select> <button ng-click="api.zoomIn()">+</button> </div><div class="select_page_wrapper" ng-show="api.getNumPages() > 1"><span>Page : </span><button ng-click="api.goToPrevPage()"><</button> <input type="text" ng-model="currentPage" ng-change="onPageChanged()"/> <button ng-click="api.goToNextPage()">></button> <span> of {{api.getNumPages()}}</span> </div><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button ng-click="api.rotatePageRight()"><i class="fa fa-repeat" aria-hidden="true"></i></button><button ng-click="api.rotatePageLeft()"><i class="fa fa-undo" aria-hidden="true"></i></button></div></div>',link:t}}]),e.constant("MultiPagesConstants",{PAGE_RENDER_FAILED:-1,PAGE_RENDER_CANCELLED:0,PAGE_RENDERED:1,PAGE_ALREADY_RENDERED:2,ZOOM_LEVELS_LUT:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2,2.2,2.4,2.6,2.8,3,3.3,3.6,3.9,4,4.5,5],ZOOM_FIT_WIDTH:"fit_width",ZOOM_FIT_PAGE:"fit_page",ZOOM_FIT_HEIGHT:"fit_height"}),e.factory("MultiPagesPage",["PageViewport",function(e){function t(e,t){this.id=e+1,this.container=angular.element("<div class='page'></div>"),this.container.attr("id","page_"+e),this.canvasRendered=!1,this.rendered=!1,this.rotation=0,this.scale=1,this.view=t}return t.prototype={clear:function(){this.rendered=!1,this.container.empty()},getViewport:function(t,i){return new e(this.view,t,i,0,0,!0)},transform:function(){this.clear(),this.viewport=this.getViewport(this.scale,this.rotation),this.canvasRendered=!1,this.canvas=angular.element("<canvas></canvas>"),this.canvas.attr("width",this.viewport.width),this.canvas.attr("height",this.viewport.height),this.container.css("width",this.viewport.width+"px"),this.container.css("height",this.viewport.height+"px")},resize:function(e){this.scale=e,this.transform()},rotate:function(e){this.rotation=e,this.transform()},isVisible:function(){var e=this.container[0],t=this.container.parent()[0],i=e.offsetTop-t.scrollTop,n=i+e.offsetHeight;return n>=0&&i<=t.offsetHeight},render:function(e){throw"NotImplementedError - render"}},t}]),e.factory("MultiPagesViewer",["$log","$timeout","MultiPagesViewerAPI","MultiPagesConstants","SizeWatcher",function(e,t,i,n,o){function r(e,t){var i=angular.element("<div></div>");i.css("height","10000px"),e.append(i);var n=i[0].offsetWidth;i.remove();var o=e[0].offsetHeight;return 0===o&&(o=2*t),n-=2*t,o-=2*t,{width:n,height:o}}function a(e,t){this.pages=[],this.scaleItem=null,this.fitWidthScale=1,this.fitHeightScale=1,this.fitPageScale=1,this.element=t,this.pageMargin=0,this.currentPage=0,this.lastScrollDir=0,this.scaleItems={},this.zoomLevels=[],this.api=e,this.onPageRendered=null,this.onDataDownloaded=null,this.onCurrentPageChanged=null}return a.prototype={getAPI:function(){return this.api},updateScaleItem:function(e){var t=this.scaleItems[e.id];return void 0==t?(this.scaleItems[e.id]=e,t=e):t.value=e.value,this.zoomLevels.push(t),t},setContainerSize:function(e){if(this.pages.length>0){this.containerSize=r(this.element,this.pageMargin),this.fitWidthScale=this.calcScale(n.ZOOM_FIT_WIDTH),this.fitHeightScale=this.calcScale(n.ZOOM_FIT_HEIGHT),this.fitPageScale=this.calcScale(n.ZOOM_FIT_PAGE),this.zoomLevels=[];for(var t=n.ZOOM_LEVELS_LUT.length-1,i=0;t>i;++i){var o=null,a=n.ZOOM_LEVELS_LUT[i],s=n.ZOOM_LEVELS_LUT[i+1];a<this.fitWidthScale&&s>this.fitWidthScale&&(o=this.updateScaleItem({id:n.ZOOM_FIT_WIDTH,value:this.fitWidthScale,label:"Fit width"})),a<this.fitHeightScale&&s>this.fitHeightScale&&(o=this.updateScaleItem({id:n.ZOOM_FIT_HEIGHT,value:this.fitHeightScale,label:"Fit height"})),a<this.fitPageScale&&s>this.fitPageScale&&(o=this.updateScaleItem({id:n.ZOOM_FIT_PAGE,value:this.fitPageScale,label:"Fit page"}));var l=(100*s).toFixed(0)+"%";o=this.updateScaleItem({id:l,value:s,label:l})}void 0==this.scaleItem&&void 0!=this.scaleItems[e]&&(this.scaleItem=this.scaleItems[e]),this.setScale(this.scaleItem||this.scaleItems[1])}},rotate:function(e){if(void 0!=e){var t=this.pages[e.pageIndex|this.currentPage-1];if(void 0!=t){var i=t.viewport.rotation+e.rotation;(360===i||-360===i)&&(i=0),t.viewport.rotation=i,t.rotate(i),this.setContainerSize(this.initialScale)}}},setScale:function(e){void 0!=e&&(this.scaleItem=e);for(var t=e||this.zoomLevels[0],i=this.pages.length,n=0;i>n;++n)this.pages[n].resize(t.value);0!=this.currentPage&&1!=this.currentPage?this.api.goToPage(this.currentPage):this.renderAllVisiblePages()},calcScale:function(t){if(t===n.ZOOM_FIT_WIDTH){for(var i=this.pages.length,o=this.pages[0],r=o.getViewport(1,o.rotation).width,a=1;i>a;++a)o=this.pages[a],r=Math.max(r,o.getViewport(1,o.rotation).width);return this.containerSize.width/r}if(t===n.ZOOM_FIT_HEIGHT){for(var i=this.pages.length,o=this.pages[0],s=o.getViewport(1,o.rotation).height,a=1;i>a;++a)o=this.pages[a],s=Math.max(s,o.getViewport(1,o.rotation).height);return this.containerSize.height/s}if(t===n.ZOOM_FIT_PAGE){var o=this.pages[0],l=o.getViewport(1,o.rotation);return this.containerSize.height<this.containerSize.width?this.containerSize.height/l.height:this.containerSize.width/l.width}var c=parseFloat(t);return isNaN(c)?(e.debug("PDF viewer: "+t+" isn't a valid scaleItem value."),1):c},removeDistantPages:function(e,t,i){for(var n=this.pages.length,o=Math.max(e-i,0),r=Math.min(t+i,n-1),a=0;o>a;++a)this.pages[a].clear();for(var a=r+1;n>a;++a)this.pages[a].clear()},renderAllVisiblePages:function(e){void 0!=e&&(this.lastScrollDir=e);for(var t=this,i=this.pages.length,o=-1,r=0,a=!1,s=0;i>s;++s){var l=this.pages[s];if(l.isVisible()){var c=l.container.parent()[0],d=l.container[0],u=d.offsetTop-c.scrollTop,p=d.offsetHeight/2;-1===o&&p+u>=0&&(o=s),a=!0,r=s,l.render(function(e,i){i===n.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===n.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}else if(a)break}if(0!==this.lastScrollDir){var f=(this.lastScrollDir>0?r:o)+this.lastScrollDir;f>=0&&i>f&&this.pages[f].render(function(e,i){i===n.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===n.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}this.removeDistantPages(o,r,1),this.currentPage=o+1,this.onCurrentPageChanged&&this.onCurrentPageChanged(o+1)},hookScope:function(i){var n=this,r=0,a=new o(n.element[0],200);i.$watchGroup(a.group,function(e){n.setContainerSize(n.initialScale)});var s=function(t,i,o,r,a){"render"===t&&1===o?"success"===i?e.debug("onProgress("+t+", "+i+", "+o+", "+r+")"):e.debug("Failed to render 1st page!\n\n"+a):"download"===t&&"loading"===i?n.api.downloadProgress=o/r*100:"failed"===i&&e.debug("Something went really bad!\n\n"+a)};i.onPageRendered=function(e,t,i,n){s("render",e,t,i,n)},i.onDataDownloaded=function(e,t,i,n){s("download",e,t,i,n)},n.onPageRendered=angular.bind(i,i.onPageRendered),n.onDataDownloaded=angular.bind(i,i.onDataDownloaded),i.$on("$destroy",function(){if(null!=n.onDestroy){try{}catch(t){e.log(t)}n.onDestroy()}a.cancel(),n.element.empty(),e.debug("viewer destroyed")}),n.element.bind("scroll",function(e){i.scrollTimeout&&t.cancel(i.scrollTimeout),i.scrollTimeout=t(function(){var e=n.element[0].scrollTop,t=e-r;r=e;var i=t>0?1:0>t?-1:0;n.renderAllVisiblePages(i)},350)})},downloadProgress:function(e){var t=0;if("undefined"==typeof e.total)for(;t<e.loaded;)t+=1048576;else t=e.total;this.onDataDownloaded&&this.onDataDownloaded("loading",e.loaded,t,"")}},a}]),e.factory("MultiPagesViewerAPI",["$log","MultiPagesConstants",function(e,t){function i(e){this.viewer=e,this.rotation=0}return i.prototype={getZoomLevels:function(){return this.viewer.zoomLevels},zoomTo:function(e){void 0!=e&&this.viewer.setScale(e)},getZoomLevel:function(){return this.viewer.scaleItem},zoomIn:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e<this.viewer.zoomLevels.length&&this.zoomTo(this.viewer.zoomLevels[e+1])},zoomOut:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e>0&&this.zoomTo(this.viewer.zoomLevels[e-1])},getCurrentPage:function(){return this.viewer.currentPage},goToPage:function(e){if(!(1>e||e>this.getNumPages())){var t=this.viewer.pages[e-1].container[0].offsetTop;Math.round(this.viewer.element[0].scrollTop)===t&&(t-=1),this.viewer.element[0].scrollTop=t}},goToNextPage:function(){this.goToPage(this.viewer.currentPage+1)},goToPrevPage:function(){this.goToPage(this.viewer.currentPage-1)},getNumPages:function(){return this.viewer.pages.length},rotatePagesRight:function(){var e=this.viewer.pages.length,t=this.rotation+90;(360===t||-360===t)&&(t=0),this.rotation=t;for(var i=0;e>i;++i)this.viewer.pages[i].rotate(t);this.viewer.setContainerSize(this.viewer.initialScale)},rotatePagesLeft:function(){var e=this.viewer.pages.length,t=this.rotation-90;(360===t||-360===t)&&(t=0),this.rotation=t;for(var i=0;e>i;++i)this.viewer.pages[i].rotate(t);this.viewer.setContainerSize(this.viewer.initialScale)},rotatePageRight:function(e){this.viewer.rotate({pageIndex:e,rotation:90})},rotatePageLeft:function(e){this.viewer.rotate({pageIndex:e,rotation:-90})}},i}]),e.factory("PageViewport",[function(){function e(e,t,i,n,o,r){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=n,this.offsetY=o;var a,s,l,c,d=(e[2]+e[0])/2,u=(e[3]+e[1])/2;switch(i%=360,i=0>i?i+360:i){case 180:a=-1,s=0,l=0,c=1;break;case 90:a=0,s=1,l=1,c=0;break;case 270:a=0,s=-1,l=-1,c=0;break;default:a=1,s=0,l=0,c=-1}r&&(l=-l,c=-c);var p,f,g,h;0===a?(p=Math.abs(u-e[1])*t+n,f=Math.abs(d-e[0])*t+o,g=Math.abs(e[3]-e[1])*t,h=Math.abs(e[2]-e[0])*t):(p=Math.abs(d-e[0])*t+n,f=Math.abs(u-e[1])*t+o,g=Math.abs(e[2]-e[0])*t,h=Math.abs(e[3]-e[1])*t),this.transform=[a*t,s*t,l*t,c*t,p-a*t*d-l*t*u,f-s*t*d-c*t*u],this.width=g,this.height=h,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var i="scale"in t?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return Util.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=Util.applyTransform([e[0],e[1]],this.transform),i=Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]},convertToPdfPoint:function(e,t){return Util.applyInverseTransform([e,t],this.transform)}},e}]),e.factory("SizeWatcher",["$interval",function(e){return function(t,i){var n=this;(n.update=function(){n.dimensions=[t.offsetWidth,t.offsetHeight]})(),n.monitor=e(n.update,i),n.group=[function(){return n.dimensions[0]},function(){return n.dimensions[1]}],n.cancel=function(){e.cancel(n.monitor)}}}]),i.directive("itTiffViewer",["$sce",function(e){var t=function(t,i,n){t.trustSrc=function(t){return e.trustAsResourceUrl(t)},t.$watch("options.api",function(e){t.options&&t.options.onApiLoaded&&t.options.api&&t.options.onApiLoaded(t.options.api)})};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><tiff-viewer class="multipage-viewer" src="{{trustSrc(src)}}" api="options.api" initial-scale="{{options.initialScale}}" ></tiff-viewer>',link:t}}]),i.factory("TIFFPage",["$log","MultiPagesPage","MultiPagesConstants",function(e,t,i){function n(e,i,n){this.base=t,this.base(e,n),this.getSrc=i}return n.prototype=new t,n.prototype.render=function(e){var t=this;if(this.rendered)return void(e&&e(this,i.PAGE_ALREADY_RENDERED));if(this.rendered=!0,this.canvasRendered)t.container.append(t.canvas);else{t.container.append(t.canvas);var n=t.canvas[0].getContext("2d");n.transform.apply(n,t.viewport.transform);var o=new Image;o.onload=function(){n.drawImage(o,0,0),t.canvasRendered=!0,e&&e(t,i.PAGE_RENDERED)},$timeout(function(){void 0==t.src&&(t.src=t.getSrc(t.id-1)),o.src=t.src},50)}},n}]).factory("TIFFViewer",["$log","MultiPagesViewerAPI","TIFFPage","MultiPagesViewer",function(e,t,i,n){function o(e){this.base=n,this.base(new t(this),e),this.tiff=null}return Tiff.initialize({TOTAL_MEMORY:167772160}),o.prototype=new n,o.prototype.open=function(e,t,i){this.element.empty(),this.pages=[],this.pageMargin=i,this.initialScale=t;var n="string"!=typeof e;n?this.setFile(e):this.setUrl(e)},o.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onprogress=angular.bind(this,t.downloadProgress),i.onload=function(e){t.loadTiff(i.response)},i.send()}},o.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){t.loadTiff(e.target.result)},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},o.prototype.loadTiff=function(e){var t=this;t.onDestroy(),t.tiff=new Tiff({buffer:e}),t.getAllPages(function(e){t.pages=e,t.setContainerSize(t.initialScale)})},o.prototype.getAllPages=function(e){function t(e){return a.tiff.setDirectory(e),a.tiff.toDataURL()}for(var n=[],o=this.tiff.countDirectory(),r=o,a=this,s=0;o>s;++s){n.push({}),this.tiff.setDirectory(s);var l=new i(s,t,[0,0,this.tiff.width(),this.tiff.height()]);n[s]=l,this.element.append(l.container),--r,0===r&&e(n)}},o.prototype.onDestroy=function(){null!=self.tiff&&(self.tiff.close(),self.tiff=null)},o}]).directive("tiffViewer",["$log","TIFFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",initialScale:"@"},controller:["$scope","$element",function(e,n){var o=new t(n);e.api=o.getAPI(),e.onSrcChanged=function(){o.open(this.src,this.initialScale,i)},e.onFileChanged=function(){o.open(this.file,this.initialScale,i)},o.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}])}();