/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * Angular-common, v1.0.0
 *Itesoft common Angularjs libs.*/
!function(){var e=angular.module("it-multi-pages-viewer",["pascalprecht.translate"]),t=angular.module("it-pdf-viewer",["it-multi-pages-viewer","ui.layout"]),i=angular.module("it-tiff-viewer",["it-multi-pages-viewer","ui.layout"]),n=angular.module("it-image-viewer",["it-multi-pages-viewer"]);angular.module("itesoft.viewer",["it-image-viewer","it-tiff-viewer","it-pdf-viewer","it-multi-pages-viewer"]);var o=angular.module("it-tab",[]),a=angular.module("itesoft",["ngSanitize","ui.bootstrap.tabs","itesoft.popup","ui.bootstrap.tpls","ngAnimate","matchMedia","ui.grid","ui.grid.pagination","ngRoute","pascalprecht.translate","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.grouping","ui.bootstrap.dropdown","LocalStorageModule","ngToast","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","ui.codemirror","it-tab","itesoft.messaging","itesoft.language","itesoft.viewer","angular-timeline"]);a.directive("itModalFullScreen",["$timeout","$window","$document",function(e,t,i){function n(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),a=parseInt(o["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i}var o='<div class="it-modal-full-screen" ng-class="$isModalOpen? $onOpenCss : \'\'"><div class="it-modal-full-screen-header pull-right"><div  ng-if="$isModalOpen"  class="it-modal-full-screen-button "><button class="btn " ng-click="$closeModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-compress"></i></div></button></div><div  ng-if="!$isModalOpen"  class="it-modal-full-screen-button "> <button class="btn pull-right"  ng-click="$openModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-expand"></i></div></button> </div></div><div  class="it-modal-full-screen-content it-fill"  ng-transclude> </div></div>';return{restrict:"EA",transclude:!0,scope:!1,template:o,link:function(o,a,r,s){var l=isNaN(parseInt(r.itZIndex))?null:parseInt(r.itZIndex);o.$onOpenCss=r.itOpenClass?r.itOpenClass:"it-modal-background";var c=isNaN(parseInt(r.itEscapeKey))?27:parseInt(r.itEscapeKey),d=angular.element(a[0].querySelector(".it-modal-full-screen")),u=angular.element(d[0]);o.$openModal=function(){o.$isModalOpen=!0;var i=document.getElementsByTagName("html"),a=t.getComputedStyle(i[0]),r=parseInt(a.top),s=parseInt(a["margin-top"]),c=parseInt(a["padding-top"]),d=(isNaN(parseInt(r))?0:parseInt(r))+(isNaN(parseInt(s))?0:parseInt(s))+(isNaN(parseInt(c))?0:parseInt(c));u.addClass("it-opened"),u.css("top",d+"px"),null!==l?u.css("z-index",l):u.css("z-index",n()+100),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)},o.$closeModal=function(){o.$isModalOpen=!1,o.$applyAsync(function(){u.removeAttr("style"),u.removeClass("it-opened"),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)})};var p=o.$eval(r.options);angular.isObject(p)&&angular.isDefined(p.onRegisterApi)&&p.onRegisterApi({open:o.$openModal,close:o.$closeModal}),i.on("keyup",function(e){e&&e.keyCode==c&&o.$closeModal()})}}}]),a.directive("itCircularBtn",[function(){return{restrict:"ACE",scope:!1,transclude:!0,template:'<span class="it-circular-button-container "><button class="btn  pull-right" > <div class="it-animated-circular-button"><ng-transclude></ng-transclude></div></button> </span>'}}]),a.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,i,n){t.$watch(function(e){return e.$eval(n.itCompile)},function(n){i.html(n),e(i.contents())(t)})}}])}]),a.directive("itBusyIndicator",["$timeout","$http",function(e,t){function i(i,o,a){i.$watch(function(){return t.pendingRequests.length>0},function(t){n&&e.cancel(n),t===!0?n=e(function(){i.hasPendingRequests=!0},250):i.hasPendingRequests=!1})}var n;return{link:i,restrict:"AE",transclude:!0,scope:{isBusy:"="},template:'<div class="mask-loading-container" ng-show="hasPendingRequests"></div><div class="main-loading-container" ng-show="hasPendingRequests || isBusy"><i class="fa fa-circle-o-notch fa-spin fa-4x text-primary "></i></div><ng-transclude ng-show="!isBusy" class="it-fill"></ng-transclude>'}}]),a.directive("itLoader",["$http","$rootScope",function(e,t){return{restrict:"EA",scope:!0,template:'<span class="fa-stack"><i class="fa fa-refresh fa-stack-1x" ng-class="{\'fa-spin\':$isLoading}"></i></span>',link:function(t){t.$watch(function(){e.pendingRequests.length>0?t.$applyAsync(function(){t.$isLoading=!0}):t.$applyAsync(function(){t.$isLoading=!1})})}}}]),a.factory("itAmountCleanerService",["$filter",function(e){var t=["en_US","en_GB","fr_FR","de_DE","id_IT"];return{cleanAmount:function(e,i){var n=0,o=!1;return t.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(o=!0)}),0==o?(console.log("Unable to format amount for local "+i),""):(e=e.replace(/[^0-9,.-]/g,""),(JSON.stringify(i)==JSON.stringify(t[2])||JSON.stringify(i)==JSON.stringify(t[4]))&&(e=e.replace(",",".")),JSON.stringify(i)==JSON.stringify(t[0])?e=e.replace(",",""):JSON.stringify(i)==JSON.stringify(t[3])&&(e=e.replace(".",""),e=e.replace(",",".")),n=parseFloat(e),console.log("result1 "+n),void 0==n&&(n=parseFloat(e)),console.log("result2 "+n),n)},formatAmount:function(i,n,o){var a="",r=!1;if(t.forEach(function(e){JSON.stringify(e)==JSON.stringify(n)&&(r=!0)}),0==r)return console.log("Unable to format amount for local "+n),"";if(void 0!=i){var s=i.toString();s=s.replace(/[^0-9,.-]/g,""),(JSON.stringify(n)==JSON.stringify(t[2])||JSON.stringify(n)==JSON.stringify(t[4]))&&(s=s.replace(",","."))}return angular.isDefined(o)?(o=e("uppercase")(o),a=angular.equals(o,"TND")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:3,maximumFractionDigits:3}).format(parseFloat(s)):angular.equals(o,"JPY")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:0,maximumFractionDigits:0}).format(parseFloat(s)):new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s))):a=new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s)),a}}}]),a.directive("itLazyGrid",["OPERATOR","NOTIFICATION_TYPE","itQueryFactory","itQueryParamFactory","itAmountCleanerService","localStorageService","$rootScope","$log","$q","$templateCache","$timeout",function(e,t,i,n,o,a,r,s,l,c,d){return{restrict:"AE",scope:{options:"="},template:'<div ui-grid="lazyGrid.fields.gridOptions"  ui-grid-selection ui-grid-pagination ui-grid-auto-resize="true" class="it-fill it-sp-lazy-grid"><div class="it-watermark sp-watermark gridWatermark" ng-show="!lazyGrid.fields.gridOptions.data.length"> {{\'GLOBAL.NO_DATA\' |translate}} </div> </div> <!------------------------------------------------------------------------------------------------------------------------------- FILTER --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="dropDownFilter.html"> <div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"> <it-autocomplete name="autocomplete" items="colFilter.options.data" selected-option="colFilter.term" input-class="col.headerCellClass" option-container-class="colFilter.class"> </div> </script> <script type="text/ng-template" id="dateRangeFilter.html"> <div class="ui-grid-filter-container"> <span class="{{col.headerCellClass}}"> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[0].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[0].emptyOption | translate}}" ng-model="col.filters[0].term" data-min-date="{{col.filters[0].dateMin}}" data-max-date="{{col.filters[1].term}}" data-autoclose="1" name="date" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[1].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[1].emptyOption | translate}}" ng-model="col.filters[1].term" data-min-date="{{col.filters[0].term}}" data-max-date="{{col.filters[1].dateMax}}" data-autoclose="1" name="date2" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> </span></div> </script> <script type="text/ng-template" id="stringFilter.html"> <div class="ui-grid-filter-container {{col.headerCellClass}}" ng-repeat="colFilter in col.filters"> <input type="text" class="form-control" ng-model="colFilter.term" pattern="{{colFilter.pattern}}" placeholder="{{colFilter.emptyOption | translate}}" maxlength="{{colFilter.maxLength}}"> </div> </script> <!------------------------------------------------------------------------------------------------------------------------------- PAGINATOR --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="paginationTemplate.html"> <div role="contentinfo" class="ui-grid-pager-panel" ui-grid-pager ng-show="grid.options.enablePaginationControls"> <div role="navigation" class="ui-grid-pager-container"> <div role="menubar" class="ui-grid-pager-control"> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-first it-sp-grid-pager-first " ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="first-bar"> </div> </div> <input type="button" title="" ng-click="pageFirstPageClick()" > </input></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.PREVPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-previous it-sp-grid-pager-previous" ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="prev-triangle"> </div> </div><input type="button" title="" ng-click="pagePreviousPageClick()"/></label><input type="number" class="ui-grid-pager-control-input it-sp-grid-pager-control-input" ng-model="grid.options.paginationCurrentPage" min="1" max="{{ paginationApi.getTotalPages() }}" required/> <span class="ui-grid-pager-max-pages-number it-sp-grid-pager-max-pages-number" ng-show="paginationApi.getTotalPages() > 0"> <abbr> / </abbr> {{ paginationApi.getTotalPages() }} </span> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.NEXTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-next it-sp-grid-pager-next" ng-disabled="cantPageForward()"><div class="last-triangle"> <div class="next-triangle"> </div> </div><input type="button" title="" ng-click="pageNextPageClick()"/></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.LASTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-last it-sp-grid-pager-last" ng-disabled="cantPageToLast()"><div class="last-triangle"> <div class="last-bar"> </div> </div><input type="button" title="" ng-click="pageLastPageClick()"/></label> </div> <div class="ui-grid-pager-row-count-picker it-sp-grid-pager-row-count-picker" ng-if="grid.options.paginationPageSizes.length > 1"> <select ui-grid-one-bind-aria-labelledby-grid="\'items-per-page-label\'" ng-model="grid.options.paginationPageSize" ng-options="o as o for o in grid.options.paginationPageSizes"></select><span ui-grid-one-bind-id-grid="\'items-per-page-label\'" class="ui-grid-pager-row-count-label"> &nbsp; </span> </div> <span ng-if="grid.options.paginationPageSizes.length <= 1" class="ui-grid-pager-row-count-label it-sp-grid-pager-row-count-label"> {{grid.options.paginationPageSize}}&nbsp;{{sizesLabel}} </span> </div> <div class="ui-grid-pager-count-container"><div class="ui-grid-pager-count"> <span class="it-sp-grid-pager-footer-text" ng-show="grid.options.totalItems > 0"> {{\'PAGINATION.INVOICE.FROM\' | translate}} {{showingLow}} <abbr> </abbr> '+"{{'PAGINATION.INVOICE.TO' | translate}} {{showingHigh}} {{'PAGINATION.INVOICE.ON' | translate}} {{grid.options.totalItems}} {{'PAGINATION.INVOICE.TOTAL' | translate}} </span> </div> </div> </div> </script>",controllerAs:"lazyGrid",controller:["$scope",function(t){function r(){s.debug("LazyGrid:Apply External filter"),angular.forEach(S.fields.externalFilter,function(e,t){if(!angular.isUndefined(t)&&!angular.isUndefined(e.value)&&!angular.isUndefined(e.condition)){var i=n.create(t,e.value,e.condition);S.fields.filter.push(i)}})}function l(){s.debug("LazyGrid:Apply filter");var t="",i="",a=e.EQUALS;if(angular.isDefined(S.fields.gridApi.grid))for(var r=0;r<S.fields.gridApi.grid.columns.length;r++){t=S.fields.gridApi.grid.columns[r].field;for(var l=0;l<S.fields.gridApi.grid.columns[r].filters.length;l++)if(i=S.fields.gridApi.grid.columns[r].filters[l].term,void 0!=i&&""!=i){s.debug("LazyGrid:Filter changed, fieds: "+t+", and value: "+i);var c=S.fields.gridApi.grid.columns[r].filters[l].rsqlKey;void 0!=c&&(t=c),void 0!=S.fields.gridApi.grid.columns[r].filters[l].condition&&(a=S.fields.gridApi.grid.columns[r].filters[l].condition),1==S.fields.gridApi.grid.columns[r].filters[l].amount&&(i=o.cleanAmount(i,T));var d=n.create(t,i,a);S.fields.filter.push(d)}}}function u(){s.debug("LazyGrid:Apply default filter"),angular.isDefined(S.fields.gridApi.grid)&&angular.forEach(S.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&angular.isDefined(e.colDef.filters[0].defaultTerm)&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)||(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function p(){s.debug("LazyGrid:Reset Filter and Apply default filter"),angular.isDefined(S.fields.gridApi.grid)&&angular.forEach(S.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)?angular.forEach(e.colDef.filters,function(e){e.term=""}):(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function f(){}function g(){}function h(){s.debug("LazyGrid:Filter Changed"),S.fields.filter=[],angular.isDefined(S.fields.promise.refresh)&&d.cancel(S.fields.promise.refresh),S.fields.promise.refresh=d(function(){S.fn.refresh()},1e3)}function m(e,t){if(s.debug("LazyGrid:Sort Changed"),S.fields.filter=[],0==t.length)S.fields.paginationOptions.sort.name=void 0,S.fields.paginationOptions.sort.direction=void 0;else{var i=t[0].name;angular.isDefined(t[0])&&angular.isDefined(t[0].colDef)&&angular.isDefined(t[0].colDef.sorterRsqlKey)&&(i=t[0].colDef.sorterRsqlKey),S.fields.paginationOptions.sort.name=i,S.fields.paginationOptions.sort.direction=t[0].sort.direction,s.debug("sort changed, sort key: "+t[0].name+", and direction: "+t[0].sort.direction)}S.fn.refresh()}function v(e,t){s.debug("LazyGrid:Pagination Changed"),S.fields.filter=[],(S.fields.paginationOptions.pageNumber!=e||S.fields.paginationOptions.pageSize!=t)&&(S.fields.paginationOptions.pageNumber=e,S.fields.paginationOptions.pageSize=t,S.fn.refresh())}function b(){s.debug("LazyGrid:Row Selection Changed")}function w(){s.debug("LazyGrid:Refresh"),r(),l();var e=(S.fields.paginationOptions.pageNumber-1)*S.fields.paginationOptions.pageSize,t=i.create(S.fields.filter,e,S.fields.paginationOptions.pageSize,S.fields.paginationOptions.sort);S.fn.callBack(t)}function C(){s.debug("LazyGrid:Initial load"),l(),S.fields.filter.length<=0&&u(),S.fields.filter=[],S.fn.refresh()}function y(e){return angular.isUndefined(e.key)?void s.error("External filter object must have key"):angular.isUndefined(e.condition)?void s.error("External filter object must have condition"):void(angular.isUndefined(e.value)?S.fields.externalFilter[e.key]={}:S.fields.externalFilter[e.key]=e)}function E(){}var T=a.get("Locale"),S=this;S.options=t.options,S.fields={template:{pagination:c.get("paginationTemplate.html")},filter:[],externalFilter:{},gridApi:{},gridOptions:{},paginationOptions:{},appScope:{},promise:{refresh:{}}},S.on={loaded:f,ready:g,filterChange:h,sortChange:m,paginationChanged:v,rowSelectionChanged:b},S.fn={callBack:S.options.callBack,initialize:E,refresh:w,initialLoad:C,addExternalFilter:y,refreshDefaultFilter:p},S.fields.paginationOptions={pageNumber:1,pageSize:10,sort:{name:void 0,direction:void 0}},S.fields.gridOptions={enableFiltering:!0,enableSorting:!0,enableColumnMenus:!1,useExternalPagination:!0,useExternalSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!0,useExternalFiltering:!0,data:[],columnDefs:[],paginationTemplate:S.fields.template.pagination,onRegisterApi:function(e){e.core.on.filterChanged(S.appScope,S.on.filterChange),e.core.on.sortChanged(S.appScope,S.on.sortChange),e.pagination.on.paginationChanged(S.appScope,S.on.paginationChanged),e.selection.on.rowSelectionChanged(S.appScope,S.on.rowSelectionChanged),S.fields.gridApi=e,s.debug("LazyGrid:UI-grid:onRegisterApi")}},angular.isDefined(S.options.onRegisterApi)&&(S.options.onRegisterApi(S),s.debug("LazyGrid:onRegisterApi"))}]}}]).constant("OPERATOR",{EQUALS:"==",LIKE:"==%",NOT_EQUALS:"!=",LESS_THAN:"=lt=",LESS_EQUALS:"=le=",GREATER_THAN:"=gt=",GREATER_EQUALS:"=ge="}).constant("NOTIFICATION_TYPE",{INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS",DISMISS:"DISMISS"}),a.factory("itPaginatorConfigService",["$q","$log","itNotifier","$filter","MetadataService",function(e,t,i,n,o){function a(){if(r.fields.loaded)t.debug("PaginatorConfigService: loaded"),s.resolve("ok");else{var a=o.getConfig.get({type:"paginatorOptions"}).$promise,l=o.getConfig.get({type:"paginatorDefaultOption"}).$promise;e.all([a,l]).then(function(e){r.fields.defaultOption=e[1].value;var o=e[0].value;angular.isDefined(o)&&null!=o&&angular.isDefined(o.split)?r.fields.options=o.split(","):i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},o),t.debug("PaginatorConfigService: loaded"),r.fields.loaded=!0,s.resolve("ok")},function(e){i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},e.data)})}return s.promise}var r=this,s=e.defer();return r.fields={options:[],defaultOption:"",loaded:!1},r.fn={initialize:a},r}]),a.factory("itQueryParamFactory",[function(){function e(e,t,i){this.key=e,this.value=t,this.operator=i}return{create:function(t,i,n){return new e(t,i,n)}}}]),a.factory("itQueryFactory",["OPERATOR",function(e){function t(t,i,n,o){this.parameters=t,this.start=i,this.size=n,this.sort=o,this.build=function(){var a="";return void 0!=t&&this.parameters.forEach(function(t){angular.isDefined(t.value)&&angular.isDefined(t.key)&&(t.value instanceof Date&&t.operator==e.LESS_EQUALS&&(t.value.setHours(23),t.value.setMinutes(59),t.value.setSeconds(59),t.value.setMilliseconds(999)),a.length>0&&(a+=" and "),t.value instanceof Date&&(t.value=t.value.toISOString()),t.operator==e.LIKE&&(t.value=t.value+"%"),a+=t.key+t.operator+t.value)}),a="query="+a,null!=n&&angular.isDefined(n)&&""!=n&&(a+="&size="+this.size),null!=i&&angular.isDefined(i)&&""!=i&&(a+="&start="+this.start),void 0!=o&&void 0!=this.sort.name&&(a+="&sort=","desc"==this.sort.direction&&(a+="-"),a+=this.sort.name),a}}return{create:function(e,i,n,o){return new t(e,i,n,o)}}}]),a.directive("itDetail",[function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:' <div ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))"   ng-if="currentItemWrapper.currentItem"  class="it-master-detail-slide-left col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" > <div class="it-fill" ng-transclude></div></div><div  ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))" class="col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" ng-if="!currentItemWrapper.currentItem"><div class="it-watermark" >{{$itNoDetail}}</div></div>'}}]),a.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill"> <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),a.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!1,transclude:!0,template:'<div class="fluid-container"><div class="row it-md-header"><div class="col-md-2 it-fill  col-xs-2"><a href="" ng-if="$parent.$parent.$parent.mobile" ng-click="$parent.$parent.$parent.$parent.goToMaster()" class="it-material-design-hamburger__icon pull-left it-fill "> <span  class="menu-animated it-material-design-hamburger__layer " ng-class="{\'it-material-design-hamburger__icon--to-arrow\':$parent.$parent.$parent.$parent.mobile}"> </span> </a></div><div class="col-md-10 col-xs-10 it-fill "><div class="btn-toolbar  it-fill pull-right " ng-transclude></div></div></div></div>'}}),a.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",priority:-1,transclude:!0,scope:{itMasterData:"=",itLang:"=",itCol:"=",itMasterDetailControl:"=",itLockOnChange:"=",itNoDataMsg:"@",itNoDetailMsg:"@"},template:'<div  ng-show="($parent.$parent.activeState == \'master\')" class=" it-master it-master-detail-slide-right col-md-{{itCol ? itCol : 6}} it-fill " ui-i18n="{{itLang}}"><div class="row" ng-transclude></div><div class="row it-master-grid it-fill" ><div class="col-md-12 it-fill"><div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns  ui-grid-move-columns  ui-grid-auto-resize class="it-master-detail-grid it-fill "><div class="it-watermark" ng-show="!gridOptions.data.length" >{{itNoDataMsg}}</div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache","$route","$window",function(e,t,i,n,o,a,r,s){function l(t){var i=this;angular.forEach(e.itMasterData,function(e,n){angular.equals(e,t)&&(i.index=n)}),i.originalItem=t,i.currentItem=angular.copy(t),i.hasChanged=!1,i.isWatched=!1,i.unlockOnEquals=!0}function c(t){e.itMasterDetailControl.disableMultiSelect||(e.gridApi.selection.getSelectedRows().length>1?e.$parent.currentItemWrapper=null:1===e.gridApi.selection.getSelectedRows().length?(d(e.gridApi.selection.getSelectedRows()[0]),u(e.gridApi.selection.getSelectedRows()[0])):0===e.gridApi.selection.getSelectedRows().length&&(e.$parent.currentItemWrapper=null))}function d(t){var n=i.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange?(n.reject("undo or save before change"),n.promise):(e.$parent.currentItemWrapper=new l(t),n.resolve(""),n.promise)}function u(t){e.gridApi.core.scrollTo(t)}function p(){e.$applyAsync(function(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)})}function f(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange&&(o.alert(e.itMasterDetailControl.navAlert),t.preventDefault())}a.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input type="checkbox" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange " tabindex="-1"  ng-checked="row.isSelected"></div>'),a.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="(grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange  )? \'return false\':headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged  && grid.appScope.itLockOnChange" ng-model="grid.selection.selectAll"></div>'),e.$parent.$masterCol=e.itCol,l.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},l.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.$parent.$itNoDetail=e.itNoDetailMsg,e.gridOptions={rowHeight:40,data:e.itMasterData,multiSelect:!e.itMasterDetailControl.disableMultiSelect,enableSelectAll:!e.itMasterDetailControl.disableMultiSelect,enableRowHeaderSelection:!e.itMasterDetailControl.disableMultiSelect,showGridFooter:!0,enableMinHeightCheck:!0,enableColumnResizing:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.itMasterDetailControl.disableMultiSelect&&c(t)}),t.selection.on.rowSelectionChangedBatch(e,function(t){e.itMasterDetailControl.disableMultiSelect&&c(t)})},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span ng-show="!grid.appScope.itMasterDetailControl.disableMultiSelect" class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},"undefined"!=typeof e.itMasterDetailControl.columnDefs&&angular.forEach(e.itMasterDetailControl.columnDefs,function(e){e.headerCellTemplate='<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.onRowClick=function(t,i){void 0!=i.entity&&"undefined"!=typeof t.providedHeaderCellTemplate&&d(i.entity).then(function(n){"ui-grid/selectionHeaderCell"!==t.providedHeaderCellTemplate&&(e.gridApi.selection.clearSelectedRows(),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail()),e.gridApi.selection.toggleRowSelection(i.entity),e.$emit("MASTER_ROW_CHANGED",i.entity)},function(t){o.alert(e.itMasterDetailControl.navAlert),e.$parent.currentItemWrapper&&e.itMasterDetailControl.disableMultiSelect&&e.gridApi.selection.toggleRowSelection(e.$parent.currentItemWrapper.originalItem)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.refreshData=function(){var i=t("itUIGridGlobalFilter")(e.gridOptions.data,e.gridOptions,e.filterText);angular.forEach(e.gridApi.grid.rows,function(t){var n=!1;i.forEach(function(e){angular.equals(t.entity,e)&&(n=!0)}),n?e.gridApi.core.clearRowInvisible(t):e.gridApi.core.setRowInvisible(t)})},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),p())},e.$on("unlockCurrentItem",function(){p()}),e.itMasterDetailControl.scrollToItem=function(e){u(e)},e.itMasterDetailControl.getSelectedItems=function(){return"undefined"!=typeof e.gridApi&&"function"==typeof e.gridApi.selection.getSelectedRows?e.gridApi.selection.getSelectedRows():[]},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){var t=e.gridApi.core.getVisibleRows(e.gridApi.grid),i=[];return angular.forEach(t,function(e){i.push(e.entity)}),i},e.itMasterDetailControl.setCurrentItem=function(t){var o=i.defer();return e.gridApi.selection.clearSelectedRows(),d(t).then(function(){n(function(){var i=e.itMasterData.indexOf(t);i>=0?(e.gridApi.selection.selectRow(t),u(t),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail(),o.resolve()):o.reject()})},function(){o.reject()}),o.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.itMasterDetailControl.setFilterText=function(t){e.filterText=t},e.$on("unlockCurrentItem",function(){n(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){n(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.itAppScope.$navAlert=e.itMasterDetailControl.navAlert;var g=angular.element(s);g.bind("resize",function(){e.gridApi.core.handleWindowResize()}),e.itMasterDetailControl.initState=!0,e.$on("$locationChangeStart",f),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes",buttons:[{text:"OK",type:"btn-info",onTap:function(){return!1}}]}},e.itMasterDetailControl),e.$watch("itLang",function(){e.gridApi.grid.refresh()}),e.$watch("itMasterData",function(){e.gridOptions.data=[],e.itMasterData.forEach(function(t){e.gridOptions.data.push(t)}),"undefined"==typeof e.itMasterData||null===e.itMasterData?e.$parent.currentItemWrapper=null:0===e.itMasterData.length&&(e.$parent.currentItemWrapper=null),e.gridApi.grid.refresh(),null!==e.itMasterDetailControl&&"undefined"!=typeof e.itMasterDetailControl.getCurrentItemWrapper()&&null!=e.itMasterDetailControl.getCurrentItemWrapper()&&e.$applyAsync(function(){u(e.itMasterDetailControl.getCurrentItemWrapper().originalItem)}),e.refreshData()},!0),n(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),s.dispatchEvent(e)},250),e.$watch("$parent.currentItemWrapper.currentItem",function(t,i){null!=e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.unlockOnEquals?e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem):e.$parent.currentItemWrapper.hasChanged=!0)},!0),e.$watch("filterText",function(){e.refreshData()},!0),e.$watch("itNoDetailMsg",function(){e.$parent.$itNoDetail=e.itNoDetailMsg})}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,i,n){function o(e,t){var i,n=t.split("."),o=e;for(i=0;i<n.length;++i){if(void 0==o[n[i]])return void 0;o=o[n[i]]}return o}var a=[];if(void 0===n||""===n)return t;n=n.toLowerCase();for(var r=e.$new(!0),s=0;s<t.length;s++)for(var l=0;l<i.columnDefs.length;l++){var c=t[s],d=i.columnDefs[l].field,u=o(c,d);if(i.columnDefs[l].cellFilter&&(r.value=u,u=r.$eval("value | "+i.columnDefs[l].cellFilter)),"undefined"!=typeof u&&null!=u&&u.toString().toLowerCase().indexOf(n)>-1){a.push(c);break}}return r.$destroy(),a}}]),a.directive("itMasterDetail",["itPopup","$timeout","$window",function(e,t,i){
return{restrict:"EA",transclude:!0,scope:!0,template:'<div class="it-master-detail-container jumbotron "> <div class="it-fill row " ng-transclude></div></div>',controller:["$scope","screenSize",function(n,o){n.activeState="master",n.desktop=o.on("md, lg",function(e){n.desktop=e}),n.mobile=o.on("xs, sm",function(e){n.mobile=e}),n.goToDetail=function(){n.activeState="detail"},n.$watch("mobile",function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper?n.activeState="detail":n.activeState="master"}),n.$watch("$$childHead.currentItemWrapper",function(){!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!==n.$$childHead.currentItemWrapper?!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper.currentItem&&null!==n.$$childHead.currentItemWrapper.currentItem||(n.activeState="master"):n.activeState="master"}),n.goToMaster=function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper&&n.$$childHead.currentItemWrapper.hasChanged&&n.$$childHead.$$childHead.itLockOnChange?e.alert(n.$$childHead.$navAlert):(n.activeState="master",t(function(){i.dispatchEvent(new Event("resize"))},300))}}]}}]),a.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:'<div class="fuild-container">   <div class="row it-fill">   <div class="it-md-header col-xs-12 col-md-12"><div class="btn-toolbar it-fill" ng-transclude></div></div><div class="col-xs-12 col-md-12 pull-right"><div><form><div class="form-group has-feedback it-master-header-search-group  col-xs-12 col-md-{{$parent.itCol < 4 ? 12 :6 }} pull-right" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  class="form-control " type="text" ng-model="$parent.filterText" class="form-control floating-label"  placeholder="{{placeholderText}}"/></div></form></div></div></div></div>',link:function(e,t,i){e.$watch(function(){return i.itSearchPlaceholder},function(t){e.placeholderText=t})}}}),a.directive("itAutocomplete",function(){return{restrict:"AE",scope:{items:"=",itemsGetter:"&?",selectedOption:"=",inputClass:"=",optionClass:"=",optionContainerClass:"=",converter:"=",searchMode:"=",placeholder:"=",options:"=",onChange:"&",onFocus:"&?",onBlur:"&?",eventSelect:"=",eventRefresh:"=",name:"=",disabled:"=",readonly:"="},controllerAs:"itAutocompleteCtrl",controller:["$scope","$rootScope","$translate","$document","$timeout","$log","itStringUtilsService",function(e,t,i,n,o,a,r){function s(){P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: focusIndex value changed  -> "+e.focusIndex),e.focusIndex<0?e.focusIndex=-1:e.focusIndex>=P.fields.items.length&&(e.focusIndex=P.fields.items.length-1),angular.isDefined(P.fields.items)&&P.fields.items[e.focusIndex]!=P.selectedItem&&u(P.fields.items[e.focusIndex])}function l(e){e=T(e);var t=!1;P.fields.selectedItem={},angular.isDefined(e)&&(P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: select with  id "+e),angular.forEach(P.fields.items,function(i){T(i)==e&&(p(i),t=!0)}),t||d())}function c(){angular.isDefined(e.items)?P.fields.items=angular.copy(e.items):P.fields.items=angular.copy(e.itemsGetter({param:P.fields.event.refresh.value})),P.fields.initialItems=angular.copy(P.fields.items),P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: copy option items "+P.fields.initialItems)}function d(){P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: init select ");var e=0;angular.forEach(P.fields.items,function(t){angular.isDefined(P.fields.selectedItem)&&P.fields.selectedItem==t&&u(t),e++})}function u(i){angular.isDefined(i)?(p(i),P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: select "+JSON.stringify(i)),P.fields.converter?e.selectedOption=S(i):e.selectedOption=T(i)):(P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: select empty"),e.selectedOption=void 0),P.fields.event.select&&(P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: emit select event "+e.selectedOption),t.$emit(P.fields.event.select,e.selectedOption))}function p(t){if(angular.isDefined(t)){P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: applySelection "+JSON.stringify(t));var i=I(t);e.focusIndex!=i&&(e.focusIndex=i,s()),P.fields.inputSearch=E(t),P.fields.selectedItem=S(t);var o=n[0].querySelector("#options_"+r.cleanDomRef.encode(T(P.fields.selectedItem)+""));f(o,t)}else P.fields.selectedItem=void 0,e.focusIndex=-1,s()}function f(e,t){var i=n[0].querySelector("#"+P.fields.optionContainerId);P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: scrollTo #"+P.fields.optionContainerId+" to: "+e),angular.isDefined(i)&&null!=i&&(i.scrollTop=20*(I(t)+1)-i.getBoundingClientRect().height)}function g(t){a.debug(P.fields.name+" itAutocomplete: hide "+P.fields.selectedItem),angular.isUndefined(t)?(P.fields.showItems=!1,angular.isDefined(P.fields.selectedItem)&&(P.fields.inputSearch=E(P.fields.selectedItem))):document.activeElement.classList.contains("it-autocomplete-container")?e.$applyAsync(function(){t.srcElement.focus()}):(P.fields.showItems=!1,angular.isDefined(P.fields.selectedItem)&&(P.fields.inputSearch=E(P.fields.selectedItem)))}function h(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function m(e){if(angular.isDefined(e)&&-1!=h()){var t=e.srcElement.parentElement.children[1],i=angular.element(e.srcElement.parentElement)[0];if(angular.isDefined(t)&&angular.isDefined(i)&&"fixed"==t.currentStyle.position){var n=i.getBoundingClientRect().top+i.getBoundingClientRect().height;t.style.setProperty("top",n+"px")}}P.fields.showItems=!0}function v(e){if(a.debug(P.fields.name+" itAutocomplete: input search change value "+e+"->"+P.fields.inputSearch),P.fields.items=[],""==P.fields.inputSearch)u(void 0),c(),d();else{var t=0;angular.forEach(P.fields.initialItems,function(e){"startsWith"==P.fields.searchMode?r.clear(E(e)).startsWith(r.clear(P.fields.inputSearch))&&(P.fields.items.push(e),t++):"custom"==P.fields.searchMode?angular.isUndefined(P.fn.searchPredicate)?a.error(P.fields.name+" When using searchMode = custom, you need to add a searchPredicate function by adding  self.fn.searchPredicate = function (inputValue,item) "):P.fn.searchPredicate(P.fields.inputSearch,e)&&(P.fields.items.push(e),t++):-1!=r.clear(E(e)).search(r.clear(P.fields.inputSearch))&&(P.fields.items.push(e),t++)}),1==P.fields.items.length&&u(P.fields.items[0])}m()}function b(t){g(t),e.onBlur&&e.onBlur()}function w(t){m(t),e.onFocus&&e.onFocus()}function C(t){var i=t.keyCode;e.keys.forEach(function(e){e.code===i&&e.action()})}function y(){var e=(new Date).getTime(),t="option_container_xxxxxxxxxxxx4yxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}function E(e){var t="";return t=angular.isDefined(P.fields.converter)&&P.fields.converter.getLabelFromObject?P.fields.converter.getLabelFromObject(e):e.value}function T(e){var t="";if(angular.isDefined(P.fields.converter)&&P.fields.converter.getIdFromObject)t=P.fields.converter.getIdFromObject(e);else{if(!e||!angular.isDefined(e)||"object"!=typeof e)return e;t=e.id}return t}function S(e){var t={};return t=angular.isDefined(P.fields.converter)&&P.fields.converter.getObject?P.fields.converter.getObject(e):e}function I(e){return P.fields.items.indexOf(e)}var P=this;P.options=e.options,P.fields={items:[],inputSearch:"",showItems:!1,optionClass:e.optionClass,optionContainerClass:e.optionContainerClass,inputClass:e.inputClass,defaultSelectClass:"",selectedSelectClass:"",selectedItem:{},searchMode:e.searchMode,placeholder:e.placeholder,debug:!1,converter:e.converter,disabled:!1,readonly:!1,event:{refresh:{name:e.eventRefresh,value:void 0},select:e.eventSelect}},angular.isUndefined(P.fields.optionClass)&&(P.fields.optionClass=""),angular.isUndefined(P.fields.optionContainerClass)&&(P.fields.optionContainerClass=""),angular.isUndefined(P.fields.inputClass)&&(P.fields.inputClass="it-autocomplete-input-class it-autocomplete-input"),angular.isUndefined(P.fields.placeholder)&&(P.fields.placeholder=""),angular.isDefined(e.disabled)&&(P.fields.disabled=!0),angular.isDefined(e.readonly)&&(P.fields.readonly=!0),P.fields.optionContainerClass=P.fields.optionContainerClass+" it-autocomplete-container",P.fields.defaultSelectClass=P.fields.optionClass+" it-autocomplete-select",P.fields.selectedSelectClass=P.fields.defaultSelectClass+" it-autocomplete-selected",P.fields.optionContainerId=y(),angular.isUndefined(P.fields.name)?P.fields.name=P.fields.optionContainerId:P.fields.name=P.fields.name,P.fn={select:u,change:v,blur:b,focus:w,init:d,fullInit:c,hideItems:g,showItems:m,getIdFromObject:T,getLabelFromObject:E,keyBoardInteration:C},P.on={},angular.isDefined(e.items)&&angular.isDefined(e.itemsGetter)&&a.error(P.fields.name+" Autocomplete must use items or items-getter, you are not allowed to use both"),angular.isUndefined(e.items)&&angular.isUndefined(e.itemsGetter)&&a.error(P.fields.name+" Autocomplete must use items or items-getter, you need to add one parameter"),angular.isDefined(P.options)&&angular.isDefined(P.options.onRegisterApi)&&P.options.onRegisterApi(P),c(),d(),e.focusIndex=-1,s(),l(e.selectedOption),P.fields.event.refresh.name?t.$on(P.fields.event.refresh.name,function(e,t){P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: refresh event emit, calling refresh items "),P.fields.event.refresh.value=t,c(),g(),d()}):(P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: refresh event is not defined, add watch to items"),e.$watch("items",function(t,i){t!=P.fields.item&&(P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: items value changed "+t+" "+i),c(),d(),l(e.selectedOption),g())})),e.$watch("selectedOption",function(t,i){e.onChange&&e.onChange(),P.fields.debug&&a.debug(P.fields.name+" itAutocomplete: selectedOption value changed "+i+" -> "+t),(angular.isUndefined(P.fields.selectedItem)||t!=T(P.fields.selectedItem))&&l(t)}),e.keys=[];var A=13,x=38,k=40,O=8,D=27;e.keys.push({code:A,action:function(){P.fields.showItems?g():(m(),""==P.fields.inputSearch&&(e.focusIndex=-1,s()))}}),e.keys.push({code:O,action:function(){P.fields.inputSearch="",e.focusIndex=-1,s(),v()}}),e.keys.push({code:x,action:function(){m(),e.focusIndex--,s()}}),e.keys.push({code:k,action:function(){m(),e.focusIndex++,s()}}),e.keys.push({code:D,action:function(){P.fields.showItems&&g()}})}],template:'<div class="col-xs-12 it-autocomplete-div"><div class="it-autocomplete-div-visible" >    <input ng-disabled="itAutocompleteCtrl.fields.disabled" ng-focus="itAutocompleteCtrl.fn.focus($event)" ng-readonly="itAutocompleteCtrl.fields.readonly" placeholder="{{itAutocompleteCtrl.fields.placeholder}}" ng-keydown="itAutocompleteCtrl.fn.keyBoardInteration($event)"ng-blur="itAutocompleteCtrl.fn.blur($event);" type="text" class="form-control it-autocomplete-input" ng-class="inputClass" ng-change="itAutocompleteCtrl.fn.change($event)" ng-model="itAutocompleteCtrl.fields.inputSearch">    <div class="it-autocomplete-btn"  ng-disabled="itAutocompleteCtrl.fields.disabled" ng-click="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" > &#9679;&#9679;&#9679;</div></div>   <div  ng-class="itAutocompleteCtrl.fields.optionContainerClass" id="{{itAutocompleteCtrl.fields.optionContainerId}}" ng-show="itAutocompleteCtrl.fields.showItems" >       <div class="it-autocomplete-content"  ng-repeat="item in itAutocompleteCtrl.fields.items">           <div class=" {{item == itAutocompleteCtrl.fields.selectedItem?itAutocompleteCtrl.fields.selectedSelectClass: itAutocompleteCtrl.fields.defaultSelectClass}}"               id="{{\'options_\'+itAutocompleteCtrl.itStringUtilsService.cleanDomRef.encode(itAutocompleteCtrl.fn.getIdFromObject(item))}}"                 ng-mousedown="itAutocompleteCtrl.fn.select(item)">               {{itAutocompleteCtrl.fn.getLabelFromObject(item)}}           </div>       </div>   </div></div>'}}),a.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="checkbox"></div>'),n.wrap("<label></label>"),n.after('<span class="checkbox-material"><span class="check" style="margin-right:16px;width: '+i.width+";height:"+i.height+';"></span></span>&nbsp;'+(i.itLabel||""))}}}),a.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,i,n){if(n){var o=angular.element(t[0]);if(o.hasClass("floating-label")){o.wrap('<div class="form-control-wrapper"></div>');var a=o.attr("placeholder");a?o.after('<div class="floating-label">'+a+"</div"):(o.after('<div class="floating-label">'+e.itLabel+"</div"),e.$watch("itLabel",function(t){e.$applyAsync(function(){if(o[0].offsetParent){var e=o[0].offsetParent.children;angular.forEach(e,function(e){var i=angular.element(e);i.hasClass("floating-label")&&i.text(t)})}})})),o.after('<span class="material-input"></span>'),o.attr("placeholder","").removeClass("floating-label")}o.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(o[0].offsetParent){var t=o[0].offsetParent.children;angular.forEach(t,function(t){var i=angular.element(t);i.hasClass("text-danger")&&(i.text(e),""!=e&&void 0!=e?(i.removeClass("ng-hide"),i.addClass("ng-show"),i.css("display","block")):(i.removeClass("ng-show"),i.addClass("ng-hide"),i.css("display","none")))})}}),(null===o.val()||"undefined"==o.val()||""===o.val())&&o.addClass("empty"),e.$watch(function(){return n.$modelValue},function(e,t){null===e||void 0==e||""===e?o.addClass("empty"):o.removeClass("empty")}),o.on("change",function(){null===o.val()||"undefined"==o.val()||""===o.val()?o.addClass("empty"):o.removeClass("empty")})}},scope:{itError:"=",itLabel:"@"}}}),a.directive("itSearch",function(){return{restrict:"A",replace:!0,scope:{itSearchControl:"="},link:function(e,t,i){var n=angular.element(t[0]);n.after('<span class="glyphicon glyphicon-search form-control-feedback"/>')},controller:["$scope",function(e){e.itSearchControl.multicolumnsFilter=function(t){var i=new RegExp(e.itSearchControl.filterText,"i"),n=[],o=!1;return e.itSearchControl.columnDefs&&t.forEach(function(t){var a=!1;t.entity?(e.itSearchControl.columnDefs.forEach(function(n){if(!a&&t.entity[n.field]){var o=t.entity[n.field].toString();n.cellFilter&&(e.value=o,o=e.$eval("value | "+n.cellFilter)),"undefined"!=typeof o&&null!=o&&o.match(i)&&(a=!0)}}),a||(t.visible=!1)):(o=!0,e.itSearchControl.columnDefs.forEach(function(e){!a&&t[e.field]&&t[e.field].toString().match(i)&&(a=!0)}),a&&n.push(t))}),o&&(t=n),t}}]}}),a.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="togglebutton"></div>'),void 0==e.itLabel?(n.wrap("<label></label>"),n.after('<span class="toggle"></span>')):(n.wrap("<label></label>"),n.after('<span class="toggle"></span><span>'+(e.itLabel||"")+"</span>"),e.$watch("itLabel",function(e){if(e&&n.context){var t=angular.element(n.context.parentNode);if(t&&i.itLabel){var o=angular.element(t.get(0).firstChild);o.get(0).textContent=e+"  "}}}))},scope:{itLabel:"@"}}}]),angular.module("itesoft.viewer").directive("itInclude",["$timeout","$compile",function(e,t){var i=function(i,n,o){var a;n.css("height","100%"),i.$watch(o.itInclude,function(o){e(function(){a&&a.$destroy(),a=i.$new(),n.html(o||""),t(n.contents())(a)},50)})};return{restrict:"AE",link:i}}]),angular.module("itesoft.viewer").directive("itMediaViewer",["itScriptService",function(e){var t=function(e,t){if(void 0!=e){var i=e.split(t);return i[i.length-1]}return e},i=function(i,n,o){var a=function(t,n){var o=(i.options?i.options.libPath:null)||"assets/Scripts/vendor";switch(t){case"pdf":i.pdfSrc=n,e.LoadScripts([o+"/pdf.js"]).then(function(){PDFJS.workerSrc=o+"/pdf.worker.js",i.template='<it-pdf-viewer src="pdfSrc" options="options"></it-pdf-viewer>'});break;case"png":case"jpeg":case"jpg":i.imageSrc=n,i.template='<it-image-viewer src="imageSrc" options="options"></it-image-viewer>';break;case"tif":case"tiff":i.tiffSrc=n,e.LoadScripts([o+"/tiff.min.js"]).then(function(){i.template='<it-tiff-viewer src="tiffSrc" options="options"></it-tiff-viewer>'});break;default:i.options&&i.options.onTemplateNotFound&&i.options.onTemplateNotFound(t),$log.debug("No template found for extension : "+t),i.template=null}},r=function(e,n){e?"string"==typeof e?(i.ext=t(e,".").toLowerCase(),a(i.ext,e)):o.type?a(o.type.toLowerCase(),e):void 0!=e.name?(i.ext=t(t(e.name,"."),"/").toLowerCase(),a(i.ext,e)):($log.debug("must specify type when using stream"),i.template=null):e!=n&&(i.template=null)};i.$watch("src",r),i.$watch("file",r)};return{scope:{src:"=",file:"=",type:"@",options:"="},restrict:"E",template:'<div it-include="template"></div>',link:i}}]),angular.module("itesoft.viewer").factory("itScriptService",["$log","$window","$q",function(e,t,i){var n={},o={},a=i.defer(),r=i.defer(),s=function(e){if(e){if(void 0!=n[e])return n[e];var t=i.defer(),o=document.createElement("script");return n[e]=t.promise,o.src=e,o.type="text/javascript",o.onload=function(){t.resolve(o)},document.head.appendChild(o),t.promise}return a.resolve(),a.promise},l=function(e){if("string"==typeof e)return s(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(s(e))}),i.all(t)}return r.resolve(),r.promise},c=function(e){if(e){if(void 0!=o[e])return o[e];var t=i.defer(),n=document.createElement("link");return o[e]=t.promise,n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=function(){t.resolve(n)},document.head.appendChild(n),t.promise}return a.resolve(),a.promise},d=function(e){if("string"==typeof e)return c(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(c(e))}),i.all(t)}return r.resolve(),r.promise},u=function(e,t){return i.all([l(e),d(t)])};return{LoadScripts:u}}]),a.directive("konami",["$document","$uibModal",function(e,t){return{restrict:"A",template:'<style type="text/css"> @-webkit-keyframes easterEggSpinner { from { -webkit-transform: rotateY(0deg); } to { -webkit-transform: rotateY(-360deg); } } @keyframes easterEggSpinner { from { -moz-transform: rotateY(0deg); -ms-transform: rotateY(0deg); transform: rotateY(0deg); } to { -moz-transform: rotateY(-360deg); -ms-transform: rotateY(-360deg); transform: rotateY(-360deg); } } .easterEgg { -webkit-animation-name: easterEggSpinner; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite; -webkit-animation-duration: 6s; animation-name: easterEggSpinner; animation-timing-function: linear; animation-iteration-count: infinite; animation-duration: 6s; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d; } .easterEgg img { position: absolute; border: 1px solid #ccc; background: rgba(255,255,255,0.8); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); } </style>',link:function(i){var n=[38,38,40,40,37,39,37,39,66,65],o=0,a=function(r){if(r.keyCode===n[o++]){if(o===n.length){e.off("keydown",a);var s=t.open({template:'<div style="max-width: 100%;" class="easterEgg"> <img style="-webkit-transform: rotateY(0deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-72deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-144deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-216deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-288deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> </div>',size:"lg"});i.cancel=function(){s.dismiss("cancel")}}}else o=0};e.on("keydown",a),i.$on("$destroy",function(){e.off("keydown",a)})}}}]),a.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,i){function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return o[e]})}var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(n(t[0].innerHTML))}}}}]),a.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,i){var n=angular.element(t[0].querySelector("ul")),o=angular.element(t[0].querySelector("a"));n.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var a=angular.element(t[0].querySelector("h5")),r=angular.element('<i class="pull-right fa fa-angle-right" ></i>');a.append(r),o.on("click",function(){n.hasClass("it-side-menu-collapse")?(n.removeClass("it-side-menu-collapse"),n.addClass("it-side-menu-expanded"),r.removeClass("fa-angle-right"),r.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),r.addClass("fa-angle-right"),r.removeClass("fa-angle-down"),n.removeClass("it-side-menu-expanded"),n.addClass("it-side-menu-collapse"))})}}}),a.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,i,n){function o(){var t=e.path();t&&angular.forEach(i.find("li"),function(e){var i=e.querySelector("a");i.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(a):angular.element(e).removeClass(a)})}var a=n.itActive||"active";o(),t.$on("$locationChangeSuccess",o)}}}]),a.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e,t,i){function n(){e.$itSideMenuWidth=i.itWidth?i.itWidth:260,e.sideMenuCalc1={width:1*e.itSideMenuWidth+50+"px"},e.sideMenuCalc2={width:e.$itSideMenuWidth+"px"}}n(),e.$watch(function(){n()});var o=angular.element(document.querySelector("it-side-menu-header"));o[0]||(e.$noMenuHeader=!0)},template:'<div style="{{$noMenuHeader ? \'top:0px;padding-bottom:0px;left:0px;\':\'\'}}width:{{$itSideMenuWidth}}px;" class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div ng-style="sideMenuCalc1"  class="it-sidebar-inner"><div ng-style="sideMenuCalc2" class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),a.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e){function t(){e.menuOpenStyle={"padding-left":(e.$itSideMenuWidth?e.$itSideMenuWidth:0)+"px"},e.menuCloseStyle={"padding-left":"0px"}}var i=angular.element(document.querySelector("it-side-menu-header"));i[0]||(e.showmenu=!0),t(),e.$watch("$itSideMenuWidth",function(){t()})},template:'<div class="it-menu-content"  ng-style="showmenu && menuOpenStyle || menuCloseStyle"><div class="it-container it-fill" ng-transclude></div></div>'}}),a.controller("$sideMenuCtrl",["$scope","$document","$timeout","$window",function(e,t,i,n){var o=this;o.scope=e,o.scope.showmenu=!1,o.toggleMenu=function(){o.scope.showmenu=o.scope.showmenu?!1:!0,i(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),n.dispatchEvent(e)},300)},o.hideSideMenu=function(){o.scope.showmenu=!1}}]),a.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,i,n,o){var a=angular.element(i[0].querySelector(".it-material-design-hamburger__layer")),r=(angular.element(i[0].querySelector(".it-material-design-hamburger__icon")),angular.element(document.querySelector("it-side-menu-content")));r&&r.css("padding-top","60px"),t.toggleMenu=o.toggleMenu,"true"===n.itAnimate&&t.$watch("showmenu",function(t,i){t!=i&&(t?(a.removeClass("it-material-design-hamburger__icon--from-arrow"),a.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed")):(a.removeClass("it-material-design-hamburger__icon--to-arrow"),a.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")))},!0),n.itHideButtonMenu&&(t.itHideButtonMenu=t.$eval(n.itHideButtonMenu)),t.$watch(n.itHideButtonMenu,function(e,i){t.itHideButtonMenu=e,e&&o.hideSideMenu()})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itHideButtonMenu"><button  ng-click="toggleMenu()" class="it-material-design-hamburger__icon"><span class="it-menu-animated it-material-design-hamburger__layer"> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),a.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),a.directive("itBottomGlue",["$window","$timeout",function(e,t){return function(i,n){function o(){for(var t=n[0],i=angular.element(n)[0],o=0,a=0,r=0,s=0;null!==t&&"undefined"!=typeof t;){var l=e.getComputedStyle(t),c=parseInt(l["margin-bottom"],10),d=parseInt(l["padding-bottom"],10),u=parseInt(l["padding-top"],10),p=parseInt(l["margin-top"],10);s+=isNaN(p)?0:p,o+=isNaN(c)?0:c,a+=isNaN(d)?0:d,r+=isNaN(u)?0:u,t=t.parentElement}var f=e.getComputedStyle(n[0]),g=parseInt(f["padding-bottom"],10),h=i.getBoundingClientRect();n.css("height",e.innerHeight-h.top-o-(a-g)+"px"),n.css("overflow-y","auto")}t(function(){o(),e.addEventListener("resize",function(){o()})},250)}}]),a.directive("itSidePanel",["$window",function(e){function t(e,t,i){e.itSidePanelElement=t,e.setIconClass(e,i),e.setZIndexes(t,i),e.setColMd(i),e.setHeightMode(i),e.setTopPosition(i)}return{link:t,restrict:"E",transclude:!0,controller:"$sidePanelCtrl",scope:!0,template:'<div class="it-side-panel-container" ng-class="{\'it-side-panel-container-show\': showPanel}"><div class="it-side-panel-button it-vertical-text" ng-class="{\'it-side-panel-button-show\':showPanel,\'it-side-panel-button-right\':!showPanel}" ng-click="toggleSidePanel()"><span class="fa {{itIconClass}}"></span></div><div class="it-side-panel" ng-transclude></div></div>'}}]),a.directive("itSidePanelContent",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-content" ng-transclude></div>'}}),a.controller("$sidePanelCtrl",["$scope","$window","$document","$timeout","$log",function(e,t,i,n,o){var a="it-col",r="it-height-mode",s="it-top-position",l=40,c="z-index",d="window",u="full",p="auto",f=[d,u,p],g=d,h=4,m=12,v=1,b="fa-search",w="none",C=w,y=".it-side-panel-button",E=".it-side-panel-container",T=".it-side-panel",S=".it-side-panel-header",I=".it-side-panel-content",P=".it-side-panel-footer",A=this;A.scope=e,A.scope.showPanel=!1,A.scope.itHeightMode=g,A.scope.itSidePanelcolMd=h,A.scope.itSidePanelTopPosition=w,A.scope.sidePanelButtonWidth=l,A.scope.sidePanelContainerWidth=null,A.scope.sidePanelContainerRight=null,A.scope.sidePanelButtonRight=null;var x=angular.element(t);A.scope.getWindowDimensions=function(){return{height:t.innerHeight,width:t.innerWidth}},A.scope.$watch(A.scope.getWindowDimensions,function(e,t){A.scope.windowHeight=e.height,A.scope.windowWidth=e.width;var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,E);if(A.scope.itHeightMode===d){var n=i[0].getBoundingClientRect().top;if(Math.abs(n)<A.scope.windowHeight){var o=A.scope.itSidePanelTopPosition;A.scope.isNoneTopPosition()&&(o=0);var a=A.scope.windowHeight-n-o,r=.1*a,s=A.scope.getElementFromClass(A.scope.itSidePanelElement,S);s.css("height",r+"px");var l=.1*a,c=A.scope.getElementFromClass(A.scope.itSidePanelElement,P);c.css("height",l+"px");var u=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);u.css("height",.8*a+"px")}}if(A.scope.showPanel){var p=A.scope.windowWidth/12*A.scope.itSidePanelcolMd;A.scope.sidePanelContainerWidth=p,i.css("width",p+"px")}else A.scope.modifySidePanelCssProperties()},!0),A.scope.modifySidePanelCssProperties=function(){var e=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),t=A.scope.getElementFromClass(A.scope.itSidePanelElement,y),i=A.scope.windowWidth/12*A.scope.itSidePanelcolMd;A.scope.sidePanelContainerWidth=i,A.scope.sidePanelContainerRight=-A.scope.sidePanelContainerWidth,A.scope.sidePanelButtonRight=A.scope.sidePanelContainerWidth,e.css("width",A.scope.sidePanelContainerWidth+"px"),e.css("right",A.scope.sidePanelContainerRight+"px"),t.css("right",A.scope.sidePanelButtonRight+"px")},x.bind("resize",function(){A.scope.$apply()}),A.scope.toggleSidePanel=function(){A.scope.showPanel=A.scope.showPanel?!1:!0;var e=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),t=A.scope.getElementFromClass(A.scope.itSidePanelElement,y);if(A.scope.showPanel)t.css("right",""),n(function(){A.scope.sidePanelContainerRight=0,e.css("right",A.scope.sidePanelContainerRight+"px")},50);else{var i=e.css("width");A.scope.sidePanelContainerRight=-parseInt(i.slice(0,i.length-2)),A.scope.sidePanelButtonRight=A.scope.sidePanelContainerWidth,e.css("right",A.scope.sidePanelContainerRight+"px"),t.css("right",A.scope.sidePanelButtonRight+"px")}},A.scope.setItSidePanelElement=function(e){A.scope.itSidePanelElement=e},A.scope.setHeightMode=function(e){if(A.scope.itHeightMode=e.itHeightMode,""===A.scope.itHeightMode||"undefined"==typeof A.scope.itHeightMode)A.scope.itHeightMode=g;else if(-1!=f.indexOf(A.scope.itHeightMode)){var t=f.indexOf(A.scope.itHeightMode);A.scope.itHeightMode=f[t]}else A.scope.itHeightMode=g,o.error('"'+r+'" with value "'+A.scope.itHeightMode+'"is unknown. The default value is taken : "'+g+'"');var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,S);i.css("height","10%");var n=A.scope.getElementFromClass(A.scope.itSidePanelElement,P);n.css("height","10%");var a=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);switch(a.css("height","80%"),A.scope.itHeightMode){case u:var s=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),l=s.css("height");if(l>A.scope.windowHeight){s.css("height","100%");var c=A.scope.getElementFromClass(A.scope.itSidePanelElement,T);c.css("height","100%")}break;case p:break;case d:var c=A.scope.getElementFromClass(A.scope.itSidePanelElement,T);c.css("height","100%");var a=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);a.css("overflow","auto");break;default:o.error('Height mode : "'+A.scope.itHeightMode+'" is unknown.')}},A.scope.setIconClass=function(e,t){var i=b;""===t.itIconClass||"undefined"==typeof t.itIconClass?A.scope.itIconClass=i:A.scope.itIconClass=t.itIconClass},A.scope.setColMd=function(e){isNaN(parseInt(e.itCol))?(A.scope.itSidePanelcolMd=h,o.warn('Attribute "'+a+'" of itSidePanel directive is not a number. The default value is taken : "'+A.scope.itSidePanelcolMd+'"')):e.itCol>m?(A.scope.itSidePanelcolMd=m,
o.warn('Attribute "'+a+'" of itSidePanel directive exceeds the maximum value ('+m+"). The maximum value is taken.")):e.itCol<v?(A.scope.itSidePanelcolMd=v,o.warn('Attribute "'+a+'" of itSidePanel directive exceeds the minimum value ('+v+"). The minimum value is taken.")):A.scope.itSidePanelcolMd=e.itCol},A.scope.setZIndexes=function(e,t){var i=null;isNaN(parseInt(t.itZIndex))||(i=parseInt(t.itZIndex));var n=A.scope.getElementFromClass(e,E),o=A.scope.getElementFromClass(e,y);if(null!==i)n.css(c,i),o.css(c,i+1);else{var a=A.scope.findHighestZIndex(),r=a+100;n.css(c,r),o.css(c,r+1)}},A.scope.getElementFromClass=function(e,t){var i=angular.element(e[0].querySelector(t)),n=angular.element(i[0]);return n},A.scope.findHighestZIndex=function(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),a=parseInt(o["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i},A.scope.setTopPosition=function(e){var t=e.itTopPosition;if(isNaN(parseInt(t)))A.scope.isNoneTopPosition()&&"undefined"!=typeof t||(A.scope.itSidePanelTopPosition=C,o.warn('Attribute "'+s+'" of itSidePanel directive is not a number. The mode taken is "'+C+'"'));else{A.scope.itSidePanelTopPosition=e.itTopPosition;var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,E);i.css("top",A.scope.itSidePanelTopPosition+"px")}},A.scope.isNoneTopPosition=function(){return"none"===A.scope.itSidePanelTopPosition}}]),a.directive("itSidePanelFooter",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-footer" ng-transclude></div>'}}),a.directive("itSidePanelHeader",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-header text-center" ng-transclude></div>'}}),a.factory("CurrentErrors",[function(){function e(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function t(e){return angular.isDefined(e)&&angular.isArray(e)?0==e.length:!1}return{technicalErrors:[],fatals:{},errors:{},warnings:{},fatalsByTabs:{},errorsByTabs:{},warningsByTabs:{},init:function(){this.fatals={},this.errors={},this.warnings={},this.fatalsByTabs={},this.errorsByTabs={},this.warningsByTabs={}},hasFatalOrHigher:function(){return this.hasFatal()||this.hasTechnical()},hasTechnical:function(){return!t(this.technicalErrors)},hasFatal:function(t){return angular.isDefined(t)?angular.isDefined(this.fatalsByTabs[t])?!e(this.fatalsByTabs[t]):!1:!e(this.fatals)},hasError:function(t){return angular.isDefined(t)?angular.isDefined(this.errorsByTabs[t])?!e(this.errorsByTabs[t]):!1:!e(this.errors)},hasWarning:function(t){return angular.isDefined(t)?angular.isDefined(this.warningsByTabs[t])?!e(this.warningsByTabs[t]):!1:!e(this.warnings)}}}]),o.component("itTab",{bindings:{groupId:"=",id:"=",label:"<",title:"<"},template:'<button class="btn header-tab header-tab-btn full-width label-text-overflow " ng-click="$ctrl.fn.changeTab()" title="{{$ctrl.title |translate}}" ng-disabled="$ctrl.fn.isTabActive()"><i class="fa fa-exclamation-triangle color-danger" aria-hidden="true" ng-if="$ctrl.fn.hasError()"></i> <i class="fa fa-exclamation-triangle color-warning" aria-hidden="true" ng-if="$ctrl.fn.hasWarning()"></i> <span class="label-text-overflow"> {{$ctrl.label |translate }} </span> </button>',controller:["$rootScope","CurrentErrors","TabService",function(e,t,i){function n(){return i.isTabActive(s.id,s.groupId)}function o(){i.changeTab(s.id,s.groupId)}function a(){return t.hasError(s.id)}function r(){return t.hasWarning(s.id)}var s=this;s.fn={isTabActive:n,hasError:a,hasWarning:r,changeTab:o},i.onTabChanged(function(e,t){i.isTabActive(e,t)})}]}),o.component("itTabContent",{restrict:"E",bindings:{groupId:"=",id:"=",contentUrl:"=",viewController:"="},template:'<div ng-show="$ctrl.fn.isTabActive()"                class="row-height-10 under-tabs-container bloc-border-left">           <div id="{{$ctrl.id}}" group-id="{{$ctrl.groupId}}" class="it-scpas-bloc-content-scrollable it-fill content-tab"               ng-include="$ctrl.contentUrl"></div>           </div>',controller:["$rootScope","TabService",function(e,t){function i(){return t.isTabActive(n.id,n.groupId)}var n=this;n.fn={isTabActive:i},t.onTabChanged(function(e,i){t.isTabActive(e,i)})}]}),o.factory("TabService",[function(){function e(e,i){t(i)?o.currentActiveTabIds[a]=e:o.currentActiveTabIds[i]=e,o.tabChangedCallBacks.forEach(function(t){angular.isDefined(t)&&t(e,i)})}function t(e){return!angular.isDefined(e)||null==e||""===e}function i(e,i){var n=!1;return n=t(i)?o.currentActiveTabIds[a]===e:o.currentActiveTabIds[i]===e}function n(e){o.tabChangedCallBacks.push(e)}var o=this,a="_IT_DEFAULT_TAB_GROUP";return o.tabChangedCallBacks=[],o.changeTab=e,o.onTabChanged=n,o.isTabActive=i,o.currentActiveTabIds=[],o}]),a.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(i,n,o){function a(){var o,a=angular.element(t[0].getElementById(i.footerElementId));o=1===a.length?a[0].offsetHeight+r(a)+s(a):0;var l=n[0].offsetTop,c=s(n),d=i.additionalPadding||0,u=e.innerHeight-l-c-o-d;n.css("height",u+"px")}function r(e){var t=l(e,"margin-top"),i=l(e,"border-top-width");return t+i}function s(e){var t=l(e,"margin-bottom"),i=l(e,"border-bottom-width");return t+i}function l(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",a),a()}}}]),a.component("itPanelForm",{bindings:{options:"=",dateFormat:"@",updateLabel:"@",update:"&",cancel:"&",cancelLabel:"@"},template:'<div class="it-ac-panel-form"><form name="$ctrl.form" novalidate><div ng-repeat="option in $ctrl.options"><div class="row panelFormRow"><div ng-switch on="option.type"><div ng-switch-when="title"><div ng-include=" \'titleTemplate.html\' "></div></div><div ng-switch-when="labelalone"><div ng-include=" \'labelAloneTemplate.html\' "></div></div><div ng-switch-when="label"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'labelTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6 "></div></div><div ng-switch-when="input"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'inputTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="select"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'selectTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="date"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'dateTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="toggle"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'toggleTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="textarea"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'textAreaTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="autocomplete"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'autoCompleteTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="number"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'numberTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div><div ng-switch-when="html"><div class="col-xs-3 col-md-3 col-lg-5"> <label>{{option.title}} </label></div><div ng-include=" \'htmlTemplate.html\' " class="col-xs-3 col-md-4 col-lg-6"></div></div></div></div></div><div class="col-xs-3 col-md-3 col-lg-5"></div><div class="col-xs-3 col-md-4 col-lg-4"><button ng-show="{{$ctrl.showButtonUpdate}}"  type="submit" ng-click="$ctrl.update({message:options})" class="btn btn-primary">{{$ctrl.updateLabel}}</button><button ng-show="{{$ctrl.showButtonCancel}}"  type="submit" ng-click="$ctrl.cancel()" class="btn btn-primary">{{$ctrl.cancelLabel}}</button></div></form></div><!------------------- Template title -------------------><script type="text/ng-template" id="titleTemplate.html"><div class="col-xs-9 col-md-9 col-lg- it-panel-form-group"><p>{{option.value}}</p><hr style="background-color:black;margin-top: 0px;"></div></script><!------------------- Template label -------------------><script type="text/ng-template" id="labelTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-label"><p>{{option.value[option.code]}}</p></div></script><!------------------- Template label alone -------------------><script type="text/ng-template" id="labelAloneTemplate.html"><div class="col-xs-8 col-md-8 col-lg-8 it-panel-form-label"><p>{{option.value[option.code]}}</p></div></script><!------------------- Template input -------------------><script type="text/ng-template" id="inputTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-input"><p><input it-input class="form-control floating-label" type="text" ng-model="option.value[option.code]" name="input" it-label=""></p></div></script><!------------------- Template select -------------------><script type="text/ng-template" id="selectTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-select"><p><select name="repeatSelect" id="repeatSelect" ng-model="option.value[option.code]" ng-options="value.value for value in option.items"/></select></p></div> </script><!------------------- Template toggle -------------------><script type="text/ng-template" id="toggleTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-toggle"><p><input it-toggle type="checkbox" ng-model="option.value[option.code]" ng-true-value="true" ng-false-value="false"><br></p></script><!------------------- Template textArea -------------------><script type="text/ng-template" id="textAreaTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-textarea"><p><textarea ng-model="option.value[option.code]" name="textArea"></textarea></p></div></script><!------------------- Template date Input format yyyy-mm-dd -------------------><script type="text/ng-template" id="dateTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-date"><p><input type="text" class="form-control" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" ng-model="option.value[option.code]" data-autoclose="1" name="date" data-date-format="{{$ctrl.dateFormat}}" bs-datepicker></p></div></script><!------------------- Template autoComplete Input -------------------><script type="text/ng-template" id="autoCompleteTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-auto"><p><it-autocomplete name="autoComplete" id="autoComplete" items="option.items" selected-option="option.value[option.code]"></it-autocomplete></p></div></script><!------------------- Template number Input -------------------><script type="text/ng-template" id="numberTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-number"><p><input it-input class="form-control floating-label" type="number" name="input" ng-model="option.value[option.code]" it-label=""></p></div></script><!------------------- Template html Input -------------------><script type="text/ng-template" id="htmlTemplate.html"><div class="col-xs-5 col-md-4 col-lg-4 it-panel-form-html"><p><div  ng-bind-html="option.value[option.code]"/></p></div></script>',controller:["$scope",function(e){var t=this;void 0==t.updateLabel?t.showButtonUpdate=!1:t.showButtonUpdate=!0,void 0==t.cancelLabel?t.showButtonCancel=!1:t.showButtonCancel=!0,void 0==t.dateFormat&&(t.dateFormat="dd/MM/yyyy"),void 0==t.updateLabel&&(t.updateLabel="Update"),void 0==t.cancelLabel&&(t.cancelLabel="Cancel")}]}),a.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),a.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),a.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),a.factory("BlockService",["$resource","itConfig",function(e,t){return{custom:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/blocks/custom/"+t.get().CURRENT_PACKAGE+"/:name"),all:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/blocks/all/"+t.get().CURRENT_PACKAGE+"/:name"),original:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/blocks/original/:name"),customByOriginal:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/original/"+t.get().CURRENT_PACKAGE+"/:name/custom"),restore:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/blocks/restore/"+t.get().CURRENT_PACKAGE+"/:name"),build:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/packages/build"),preview:e(t.get().REST_TEMPLATE_API_URL+"/t4html/rest/packages/preview"),"new":function(e,t,i,n,o,a,r,s){return{name:e,position:i,ref:t,content:n,role:o,version:a,removed:"true"==r?!0:!1,element:s}}}}]),a.directive("itBlock",["$timeout","BlockService",function(e,t){return{restrict:"EAC",link:function(e,i,n,o){e.$root.$emit("registerBlock",t["new"](n.name,n.ref,n.position,i.html(),n.role,n.version,n.removed,i))}}}]),a.directive("itBlockControlPanel",[function(){return{restrict:"EA",scope:!0,template:'<div class="block-control-panel col-xs-12" ng-if="itBlockControlPanelController.itConfig.get().ENABLE_TEMPLATE_EDITOR">    <div class="col-xs-12"/>    <div class="block-lists">        <div class=" btn btn-danger offline-editor" ng-if="!itBlockControlPanelController.editorIsOpen"             aria-label="Left Align">            <span class="fa fa-exclamation" aria-hidden="true"></span>            <a target="_blank" ng-href="{{itConfig.get().TEMPLATE_EDITOR_URL}}">{{\'GLOBAL.TEMPLATE.BLOCK.OPEN_EDITOR\'|                translate}}</a>        </div><div class="row" style="margin-bottom: 10px;">        <div ng-if="!itBlockControlPanelController.focusable" class="col-xs-12 block-control-panel-help">(Press Ctrl                and move your mouse over a block)            </div>        <div ng-if="itBlockControlPanelController.focusable" class="col-xs-12 block-control-panel-help">(Release                Ctrl over an element to select it)            </div>    </div><div><it-circular-btn ng-if="!$root.editSite" ng-click="itBlockControlPanelController.editSite()">   <i class="fa fa-pencil"></i>            </it-circular-btn><it-circular-btn ng-if="$root.editSite" ng-click="itBlockControlPanelController.viewSite()">   <i class="fa fa-eye"></i>            </it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.refresh()">   <i class="fa fa-refresh"></i>            </it-circular-btn><it-circular-btn ng-if="$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=false">   <i class="fa fa-stop"></i></it-circular-btn><it-circular-btn ng-if="!$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=true">   <i class="fa fa-play"></i></it-circular-btn><it-circular-btn><a ng-href="{{itBlockControlPanelController.url}}" target="_blank"><i class="fa fa-floppy-o"></i></a></it-circular-btn></div><div  ng-repeat="block in itBlockControlPanelController.blocks | orderBy:\'-name\'" ng-mouseover="itBlockControlPanelController.hilightBlock(block)" ng-mouseleave="itBlockControlPanelController.unHilightBlock(block)" class="{{itBlockControlPanelController.getClass(block)}}"><div class="block-lists-name">{{block.name}}</div><div class="block-lists-action"><it-circular-btn ng-click="itBlockControlPanelController.addBlock(block)">   <i class="fa fa-plus "></i> </it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.editBlock(block)">   <i class="fa fa-pencil"></i> </it-circular-btn><it-circular-btn ng-if="block.removed" ng-click="itBlockControlPanelController.restoreBlock(block)">   <i class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-if="!block.removed" ng-click="itBlockControlPanelController.deleteBlock(block)">   <i class="fa fa-eye-slash block-btn"></i></it-circular-btn></div></div></div></div>',controllerAs:"itBlockControlPanelController",controller:["$scope","$rootScope","$location","$log","$document","$filter","BlockService","PilotSiteSideService","PilotService","itConfig","itPopup","itNotifier",function(e,t,i,n,o,a,r,s,l,c,d,u){function p(){s.fn.options({currentPackage:c.get().CURRENT_PACKAGE})}var f=this;c.get().ENABLE_TEMPLATE_EDITOR&&(f.editorIsOpen=!1,f.itConfig=c,f.blocks=[],f.availableBlocks=[],f.url=c.get().REST_TEMPLATE_API_URL+"/t4html/rest/export/"+c.get().CURRENT_PACKAGE,this.refresh=function(){r.build.get(function(){location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},f.interval=0,l.on.open=function(e){p()},s.on.pong=function(t){n.debug("pong"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorConnect=function(t){n.debug("editorConnect"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorDisconnect=function(t){n.debug("editorDisconnect"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.close=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.error=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.transportFailure=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.reload=this.refresh,t.editSite=!0,t.autoRefreshTemplate=!0,o.bind("keydown",function(e){t.editSite&&(17!=e.keyCode||f.focusable||(o.find("*").addClass("crosshair"),f.focusable=!0,f.init()))}),o.bind("keyup",function(e){t.editSite&&17==e.keyCode&&f.focusable&&(o.find("*").removeClass("crosshair"),f.focusable=!1)}),t.$on("registerBlock",function(t,i){f.availableBlocks[i.name]=i,i.element.bind("mouseenter",function(t){e.$applyAsync(function(){f.selectBlock(i.name)})}),i.element.bind("mouseleave",function(t){e.$applyAsync(function(){f.unSelectBlock(i.name)})}),f.blocks=[],f.clearStyle(),f.hilightedBlock=void 0}),f.init=function(){f.blocks=[],f.clearStyle(),f.hilightedBlock=void 0},f.selectBlock=function(e){var t=f.availableBlocks[e];f.focusable&&!f.exists(t)&&f.blocks.push(t)},f.unSelectBlock=function(e){var t=f.availableBlocks[e];f.focusable&&f.exists(t)&&f.blocks.splice(f.blocks.indexOf(t),1)}),f.editSite=function(){t.editSite=!0,f.clearStyle()},f.viewSite=function(){t.editSite=!1,f.clearStyle(),f.init()},f.editBlock=function(e){if(n.debug("edit block"),angular.isDefined(e.ref)&&""!=e.ref)s.fn.editBlock(e,i.path());else{var t=r["new"](c.get().CURRENT_PACKAGE+"_replace"+e.name+"_"+a("date")(new Date,"yyyyMMddHHmmss"),e.name,"replace",e.content,c.get().CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.addBlock=function(e){if(angular.isDefined(e.name)&&""!=e.name){n.debug("add block");var t=r["new"](c.get().CURRENT_PACKAGE+"_new_"+e.name+"_"+a("date")(new Date,"yyyyMMddHHmmss"),e.name,"before","",c.get().CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.restoreBlock=function(e){n.debug("restore block"),r.restore.get({name:e.name},function(){r.build.get(function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(t){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},t.data.body),n.error("Unable to restore block "+JSON.stringify(e))})})},f.deleteBlock=function(e){n.debug("delete block");var i=d.confirm({title:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.TITLE' | translate}}",text:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.CONFIRM' | translate}}",buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});i.then(function(){r.all["delete"]({name:e.name},function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(){u.notifyError({content:"{{'GLOBAL.TEMPLACE.WS.BLOCK_DELETED_KO' | translate}}"})})},f.hilightBlock=function(e){angular.isDefined(e)&&(f.hilightedBlock=e,f.clearStyle(),f.updateStyle(e.name))},f.unHilightBlock=function(e){angular.isDefined(e)&&(f.hilightedBlock=void 0,f.clearStyle())},f.updateStyle=function(e){for(var t in f.availableBlocks)t==e&&f.availableBlocks[t].element.addClass("block-hilight")},f.clearStyle=function(){for(var e in f.availableBlocks){var i=f.availableBlocks[e].element;angular.isDefined(i)&&(i.removeClass("block-removed"),i.removeClass("block-hilight"),i.css("display",""),t.editSite&&i.children().attr("disabled",!1),f.availableBlocks[e].removed&&(t.editSite?i.addClass("block-removed"):i.css("display","none")))}},f.getClass=function(e){return f.hilightedBlock&&f.hilightedBlock.name==e.name?"block-lists-element-hilight":""},f.exists=function(e){var t=!1;return f.blocks.forEach(function(i){i.name==e.name&&(t=!0)}),t}}]}}]),a.factory("PilotService",["$resource","$log","itConfig",function(e,t,i){function n(e){t.log("ping "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PING,params:[]}))}function o(e){t.log("pong "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PONG,params:[]}))}var a=this;return a.ACTION_EDIT_BLOCK="editBlock",a.ACTION_REMOVE_BLOCK="removeBlock",a.ACTION_CREATE_BLOCK="createBlock",a.ACTION_EDIT_PAGE="editPage",a.ACTION_REMOVE_PAGE="removePage",a.ACTION_CREATE_PAGE="createPage",a.ACTION_PING="ping",a.ACTION_PONG="pong",a.ACTION_DISCONNECT="disconnect",a.ACTION_TIMEOUT="timeout",a.ACTION_CONNECT="connect",a.ACTION_RELOAD="reload",a.ACTION_OPTIONS="options",a.DEST_EDITOR="editor",a.DEST_SITE="site",a.DEST_ALL="all",a.fields={socket:{},request:{url:i.get().REST_TEMPLATE_API_URL+"/t4html/editor",contentType:"application/json",logLevel:"debug",transport:"websocket",trackMessageLength:!0,reconnectInterval:5e3,enableXDR:!0,timeout:6e4},model:{},dest:""},a.fn={ping:n,pong:o},a.on={message:{},open:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},a.fields.request.onOpen=function(e){a.fields.model.transport=e.transport,a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.open)&&a.on.open()},a.fields.request.onClientTimeout=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_TIMEOUT,params:[]})),setTimeout(function(){a.fields.socket=atmosphere.subscribe(a.fields.request)},a.fields.request.reconnectInterval)},a.fields.request.onReopen=function(e){a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.reopen)&&a.on.reopen()},a.fields.request.onTransportFailure=function(e,t){atmosphere.util.info(e),t.fallbackTransport="long-polling",angular.isDefined(a.on.transportFailure)&&a.on.transportFailure()},a.fields.request.onMessage=function(e){a.on.message(e)},a.fields.request.onClose=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_DISCONNECT,params:[]})),angular.isDefined(a.on.close)&&a.on.close()},a.fields.request.onError=function(e){a.fields.model.logged=!1,angular.isDefined(a.on.error)&&a.on.error()},a.fields.request.onReconnect=function(e,t){a.fields.model.connected=!1},i.get().ENABLE_TEMPLATE_EDITOR&&(a.fields.socket=atmosphere.subscribe(a.fields.request)),a}]),a.factory("PilotSiteSideService",["$resource","$log","itConfig","PilotService",function(e,t,i,n){function o(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_BLOCK,params:[{block:e,path:t}]}))}function a(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_BLOCK,params:[{block:e,path:t}]}))}function r(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_BLOCK,params:[{block:e,path:t}]}))}function s(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_PAGE,params:[{page:e}]}))}function l(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_PAGE,params:[{page:e}]}))}function c(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_PAGE,params:[{page:e}]}))}function d(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_OPTIONS,params:[{options:e}]}))}var u=this;return u.fields={},u.fn={editBlock:o,removeBlock:a,createBlock:r,editPage:s,removePage:l,createPage:c,options:d,ping:n.fn.ping},u.on={reload:void 0,pong:void 0,editorConnect:void 0,editorDisconnect:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},i.get().ENABLE_TEMPLATE_EDITOR&&(n.fields.dest=n.DEST_EDITOR,n.on.open=function(e){t.log("WebSocket connection is opened"),u.fn.ping(n.DEST_EDITOR)},n.on.reopen=function(e){t.log("WebSocket connection is reopened"),u.fn.ping(n.DEST_EDITOR)},n.on.close=function(){angular.isDefined(u.on.close)&&u.on.close()},n.on.error=function(){angular.isDefined(u.on.error)&&u.on.error()},n.on.transportFailure=function(){angular.isDefined(u.on.transportFailure)&&u.on.transportFailure()},n.on.message=function(e){var i=e.responseBody;try{var o=atmosphere.util.parseJSON(i);if(o.dest==n.DEST_ALL)switch(o.action){case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect()}if(o.dest==n.DEST_SITE)switch(o.action){case n.ACTION_RELOAD:t.log(n.ACTION_RELOAD),angular.isDefined(u.on.reload)&&u.on.reload();break;case n.ACTION_PING:t.log(n.ACTION_PING),n.pong(n.DEST_EDITOR);break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect();break;case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect()}}catch(a){throw t.error("Error parsing JSON: ",i),a}}),u}]),a.filter("itUnicode",["$sce",function(e){return function(t){function i(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();n.length<4;)n="0"+n;n="&#x"+n+";",t+=n}return t}return e.trustAsHtml(i(t))}}]),angular.module("itesoft.language",["itesoft.popup","LocalStorageModule"]).provider("itLanguageChangeHandler",function(){var e=this;this.options={storage:"local",displayConfirm:!0,onChangePopup:{title:"Confirm language change",text:"By modifying the language any recent changes may be lost. Continue?",buttonCancelLabel:"NO",buttonOkLabel:"YES"}},this.$get=["$rootScope","$translate","$location","$q","localStorageService","itPopup",function(t,i,n,o,a,r){return{translate:i,getConfig:function(){return e.options},changeLanguage:function(o,s,l){var c={currentLanguage:this.getCurrentLanguage()};if(e.options.displayConfirm){var d=r.confirm({title:e.options.onChangePopup.title,text:e.options.onChangePopup.text,cancelText:e.options.onChangePopup.buttonCancelLabel,okText:e.options.onChangePopup.buttonOkLabel});!function(r){var c=r;d.then(function(c){if("query"===e.options.storage)try{n.search("Locale",o)}catch(d){reject("Error setting query parameter, lang, to locale value: "+o+" Error: "+d.message)}else try{a.set("Locale",o)}catch(d){reject("Error setting local storage parameter, lang, to locale value: "+o+" Error: "+d.message)}s&&(s.currentLanguage=o,s.user&&(s.user.language=i.use())),r={currentLanguage:o},l&&l(r),t.$applyAsync(function(){location.reload()})},function(){i.use(c.currentLanguage)})}(c)}},getCurrentLanguage:function(){return"query"===e.options.storage?n.search().Locale?n.search().Locale.replace(/-/g,"_"):this.getDefaultLocale(this.translate.use()):a.get("Locale")||this.getDefaultLocale(this.translate.use())},getDefaultLocale:function(e){switch(e||(e=i.preferredLanguage()),e){case"en":return"en_GB";case"de":return"de_DE";default:case"fr":return"fr_FR"}},getLanguageCode:function(e){switch(e){case"en_GB":case"en-GB":case"en_US":case"en-US":return"en";case"de_DE":case"de-DE":return"de";default:case"fr_FR":case"fr-FR":case"fr_CA":case"fr-CA":return"fr"}}}}]}),a.provider("itConfig",[function(){function e(){var e=location.search;""==e&&(e=location.hash);var t=e.split(/[&||?]/).filter(function(e){return e.indexOf("=")>-1}).map(function(e){return e.split(/=/)}).map(function(e){return e[1]=e[1].replace(/\+/g," "),e}).map(function(e){return"true"==e[1]?(e[1]=!0,e):"false"==e[1]?(e[1]=!1,e):e}).reduce(function(e,t){return e[t[0]]=t[1],e},{});return t}function t(t){var a={};if(void 0==s){t=e();var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){if(s=JSON.parse(l.responseText),r=!0,i&&void 0!=o&&null!=o){a=s[o];for(var e in a)"undefined"!=typeof t&&"undefined"!=typeof t[e]&&(a[e]=t[e])}r=!0}},l.open("GET",n,!1),l.send()}return a}var i=!1,n="app/config/config.json",o=null,a=void 0,r=!1,s=void 0;this.allowOverride=function(e){i=e},this.configFile=function(e){n=e},this.defaultNamespace=function(e){o=e},this.get=function(){return r?s[o]:t(a)},this.$get=["$location",function(e){return{get:function(e){return r||t(a),null!=e&&void 0!=e?s[e]:null!=o?s[o]:s}}}]}]),angular.module("itesoft.popup",["ui.bootstrap.modal"]).factory("itPopup",["$uibModal","$uibModalStack","$rootScope","$q","$compile",function(e,t,i,n,o){function a(e){function t(){return!1}var o={};return o.scope=(e.scope||i).$new(),o.responseDeferred=n.defer(),o.scope.$buttonTapped=function(e,t){var i=(t.onTap||noop)(e);o.responseDeferred.resolve(i)},e=angular.extend({scope:o.scope,template:u,controller:["$scope","$uibModalInstance",function(e,i){function n(){i.close(e.data)}function a(){i.dismiss("cancel")}e.itButtonAction=function(i,r){var s=(r.onTap||t)(i,e),l=s;i.isDefaultPrevented()||o.responseDeferred.resolve(l?n():a())}}],buttons:[]},e||{}),e.scope.options=e,o.options=e,o}function r(e){$modalStack.dismissAll();var t=a(e);return $modal.open(t.options).result}function s(e){return $modalStack.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function l(e){return $modalStack.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function c(e){return $modalStack.dismissAll(),r(e)}function d(e){$modalStack.dismissAll();var t=i.$new(!0);t.data={};var n="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(n="<span>"+e.template+"</span>",delete e.template),r(angular.extend({template:p,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var u='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',p='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',f={
alert:s,confirm:l,prompt:d,custom:c};return f}]),angular.module("itesoft.messaging",["ngWebSocket"]).provider("ItMessaging",[function(){var e=this;e.SERVICE_URL="tstbuydpoc01:3333/itesoft-messaging",this.$get=["$log","$http","$q","$websocket","$rootScope",function(t,i,n,o,a){function r(r){function s(){var e=n.defer();return i({url:"http://"+d.URL+"/rest/topics",method:"GET",headers:{token:d.token}}).then(function(t){e.resolve(t.data)},function(i){t.error(i),e.reject(e)}),e.promise}function l(e,t){for(var i,n=0;n<d.onMessageCallbacks.length;n++){i=d.onMessageCallbacks[n];var o=angular.fromJson(e.data);angular.isArray(o)?angular.forEach(o,function(e){a.$applyAsync(function(){i.fn.apply(this,[e,t])})}):a.$applyAsync(function(){i.fn.apply(this,[o,t])})}}function c(e){for(var t,i=0;i<d.onCloseCallbacks.length;i++)t=d.onCloseCallbacks[i],a.$applyAsync(function(){t.fn.apply(this,e)})}var d=this;d.URL=e.SERVICE_URL,d.onMessageCallbacks=[],d.onCloseCallbacks=[],d.token=r,this.getToken=function(e,o,a){console.warn("This function is only for demo purpose, do NOT use it in production mode, the security of your apiKey will not be granted");var r=n.defer();return i({url:"http://"+this.URL+"/rest/tokens",method:"POST",data:o,headers:{"api-key":e}}).then(function(e){r.resolve(e.data.jwt)},function(e){t.error("error on api endpoint"),r.reject("error on api endpoint")}),r.promise},this.getServiceUrl=function(){return d.URL},this.connect=function(e){return e?(d.token=e,d.dataStream=o("ws://"+d.URL+"/websocket?token="+e),d.dataStream.onMessage(function(e){s().then(function(t){l(e,t)})}),d.dataStream.onClose(function(e){c(e)}),!0):void 0},this.onMessage=function(e){return d.onMessageCallbacks.push({fn:e}),d},this.onClose=function(e){return d.onCloseCallbacks.push({fn:e}),d},this.subscribeToTopic=function(e,o,a){a||(a=0);var r=n.defer();return null!=d.token?i({url:"http://"+d.URL+"/rest/topics/"+e+"/subscribe?retrieve="+a,method:"POST",data:o,headers:{token:d.token}}).then(function(e){r.resolve(e.data),s()},function(e){t.error(e),r.reject(e)}):(t.error("You cannot register observers to topic without token"),r.reject("no token")),r.promise},this.unsubscribeToTopic=function(e,o){var a=n.defer();return null!=d.token?i({url:"http://"+d.URL+"/rest/topics/"+e+"/unsubscribe",method:"POST",data:o,headers:{token:d.token}}).then(function(e){a.resolve(e.data),s()},function(e){t.error(e),a.reject(e)}):(t.error("You cannot register observers to topic without token"),a.reject("no token")),a.promise},this.sendMessage=function(e){var o=n.defer();return i({url:"http://"+d.URL+"/rest/messages",method:"POST",headers:{token:d.token},data:e}).then(function(e){o.resolve(e.data)},function(e){t.error(e),o.reject(e)}),o.promise}}return function(e){return new r(e)}}]}]),a.provider("itNotifier",[function(){var e=this;e.defaultOptions={dismissOnTimeout:!0,timeout:4e3,dismissButton:!0,animation:"fade",horizontalPosition:"right",verticalPosition:"bottom",compileContent:!0,dismissOnClick:!1,success:{dismissOnClick:!0},info:{dismissOnClick:!0},error:{dismissOnTimeout:!1},warning:{dismissOnTimeout:!1}},this.$get=["ngToast","$rootScope","$log",function(t,i,n){function o(e){return" CODE : "+e.CODE+", TYPE : "+e.TYPE+", MESSAGE : "+e.MESSAGE+", DETAIL : "+e.DETAIL+", DONE : "+e.DONE}var a={};return t.settings=angular.extend(t.settings,e.defaultOptions),a.notifySuccess=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.success,i,i.success);t.success(r),void 0!=a&&n.log("Success popup called : "+o(a))},a.notifyError=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.error,i,i.error);t.danger(r),void 0!=a&&n.error("Error popup called : "+o(a))},a.notifyInfo=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.info,i,i.info);t.info(r),void 0!=a&&n.info("Info popup called : "+o(a))},a.notifyWarning=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.warning,i,i.warning);t.warning(r),void 0!=a&&n.warn("Warning popup called : "+o(a))},a.notifyDismiss=function(e,i){t.dismiss()},a.notify=function(e){n.error("Unknown type for itNotifier: "+e)},i.$on("$locationChangeSuccess",function(){a.notifyDismiss()}),i.$on("itNotifierEvent",function(e,t){if(t)switch(t.type){case"SUCCESS":a.notifySuccess(t.options,t.errorDetails);break;case"ERROR":a.notifyError(t.options,t.errorDetails);break;case"INFO":a.notifyInfo(t.options,t.errorDetails);break;case"WARNING":a.notifyWarning(t.options,t.errorDetails);break;case"DISMISS":a.notifyDismiss(t.options,t.errorDetails);break;default:a.notify(t.type)}else n.error("Bad usage of itNotifier. Check manual for details")}),a}]}]),a.factory("itStringUtilsService",[function(){function e(e){var n="";return n=t(e),n=i(n)}function t(e){var t="";return t+=angular.isDefined(e)&&e.toLowerCase?e.toLowerCase():e}function i(e){var t=[{"char":"A",base:/[\300-\306]/g},{"char":"a",base:/[\340-\346]/g},{"char":"E",base:/[\310-\313]/g},{"char":"e",base:/[\350-\353]/g},{"char":"I",base:/[\314-\317]/g},{"char":"i",base:/[\354-\357]/g},{"char":"O",base:/[\322-\330]/g},{"char":"o",base:/[\362-\370]/g},{"char":"U",base:/[\331-\334]/g},{"char":"u",base:/[\371-\374]/g},{"char":"N",base:/[\321]/g},{"char":"n",base:/[\361]/g},{"char":"C",base:/[\307]/g},{"char":"c",base:/[\347]/g}],i=e;return t.forEach(function(e){i=i.replace(e.base,e["char"])}),i}return{getLower:t,removeAccent:i,clear:e,cleanDomRef:{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",encode:function(e){if(e){var t,i,n,o,a,r,s,l="",c=0;for(e=this._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),o=t>>2,a=(3&t)<<4|i>>4,r=(15&i)<<2|n>>6,s=63&n,isNaN(i)?r=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return l}},decode:function(e){var t,i,n,o,a,r,s,l="",c=0;if(e.replace)for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");c<e.length;)o=this._keyStr.indexOf(e.charAt(c++)),a=this._keyStr.indexOf(e.charAt(c++)),r=this._keyStr.indexOf(e.charAt(c++)),s=this._keyStr.indexOf(e.charAt(c++)),t=o<<2|a>>4,i=(15&a)<<4|r>>2,n=(3&r)<<6|s,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(n));return l=this._utf8_decode(l)},_utf8_encode:function(e){var t="";if(e.replace){e=e.replace(/rn/g,"n");for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),128>n?(t+=String.fromCharCode(n),i++):n>191&&224>n?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}}}}]),n.factory("IMAGEPage",["$log","MultiPagesPage","PageViewport","MultiPagesConstants",function(e,t,i,n){function o(e,i,n,o){this.base=t,this.base(e,i,o),this.img=n}return o.prototype=new t,o.prototype.renderPage=function(e,t){var i=this;if(e.canvasRendered)e.wrapper.append(e.canvas);else{e.wrapper.append(e.canvas);var o=e.canvas[0].getContext("2d");o.transform.apply(o,e.viewport.transform),o.drawImage(i.img,0,0),t&&t(e,n.PAGE_RENDERED)}},o}]).factory("IMAGEViewer",["$log","MultiPagesViewer","MultiPagesViewerAPI","IMAGEPage",function(e,t,i,n){function o(e){this.base=t,this.base(new i(this),e)}return o.prototype=new t,o.prototype.open=function(e,t){this.element.empty(),this.pages=[],angular.extend(this,t);var i="string"!=typeof e;i?this.setFile(e):this.setUrl(e)},o.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;t.getAllPages(e,function(e){t.pages=e,t.addPages()})}},o.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result;t.getAllPages(i,function(e){t.pages=e,t.addPages()})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsDataURL(e)}},o.prototype.getAllPages=function(e,t){var i=[],o=this;i.push({});var a=new Image;a.onprogress=angular.bind(this,o.downloadProgress),a.onload=function(){var e=new n(o,0,a,[0,0,a.width,a.height]);i[0]=e,t(i)},a.src=e},o}]).directive("imageViewer",["$log","IMAGEViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"="},controller:["$scope","$element",function(e,n){var o=function(t){return null===e.options||void 0===e.options?null:e.options[t]},a=function(){return{initialScale:o("initialScale"),initialMode:o("initialMode"),zoomSelectionShortcutKey:o("zoomSelectionShortcutKey"),pageMargin:i}},r=new t(n);e.api=r.getAPI(),e.Open=function(e){r.open(e,a())},r.hookScope(e)}],link:function(e,t,i){i.$observe("src",e.Open),e.$watch("file",e.Open)}}}]),n.directive("itImageViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.$$api" ng-if="options.showToolbar"></it-toolbar-viewer><image-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}"  api="options.$$api" options="options" ></image-viewer></div>',link:i}}]),e.directive("itProgressbarViewer",[function(){return{scope:{api:"="},restrict:"E",template:'<div class="loader" ><div class="progress-bar"><span class="bar" ng-style=\'{width: api.downloadProgress + "%"}\'></span></div></div>'}}]),e.directive("itToolbarViewer",["$log",function(e){var t=function(e,t,i){e.$watch("api.getMode()",function(t){e.mode=t}),e.$watch("api.getZoomLevel()",function(t){e.scale=t}),e.$watch("api.getSelectedPage()",function(t){e.currentPage=t}),e.onZoomLevelChanged=function(){e.api.zoomTo(e.scale)},e.onModeChanged=function(){e.api.setMode(e.mode)},e.onPageChanged=function(){e.api.goToPage(e.currentPage)}};return{scope:{api:"="},restrict:"E",template:'<div class="toolbar"><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><select ng-model="mode" ng-change="onModeChanged()" ng-options="mode as mode.label for mode in api.getModes()"></select> <button type="button" ng-click="api.zoomOut()">-</button> <select ng-model="scale" ng-change="onZoomLevelChanged()" ng-options="zoom as zoom.label for zoom in api.getZoomLevels()"></select> <button type="button" ng-click="api.zoomIn()">+</button> </div><div class="select_page_wrapper" ng-show="api.getNumPages() > 1"><span>Page : </span><button type="button" ng-click="api.goToPrevPage()"><</button> <input type="text" ng-model="currentPage" ng-change="onPageChanged()"/> <button type="button" ng-click="api.goToNextPage()">></button> <span> of {{api.getNumPages()}}</span> </div><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button type="button" ng-click="api.rotatePageRight()"><i class="fa fa-repeat" aria-hidden="true"></i></button><button type="button" ng-click="api.rotatePageLeft()"><i class="fa fa-undo" aria-hidden="true"></i></button></div></div>',link:t}}]),e.factory("MultiPagesAddEventWatcher",["$sce",function(e){return function(t){t&&(t.$watch("src",function(e){"string"==typeof e?t.url=e:t.file=e}),t.$watch("options.$$api",function(e){e&&(t.options.getApi=function(){return e},t.options&&t.options.onApiLoaded&&t.options.onApiLoaded(e))}),t.trustSrc=function(t){return e.trustAsResourceUrl(t)})}}]),e.constant("MultiPagesConstants",{PAGE_RENDER_FAILED:-1,PAGE_RENDER_CANCELLED:0,PAGE_RENDERED:1,PAGE_ALREADY_RENDERED:2,ZOOM_LEVELS_LUT:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2,2.2,2.4,2.6,2.8,3,3.3,3.6,3.9,4,4.5,5],ZOOM_FIT_WIDTH:"fit_width",ZOOM_FIT_PAGE:"fit_page",ZOOM_FIT_HEIGHT:"fit_height",ORIENTATION_VERTICAL:"vertical",ORIENTATION_HORIZONTAL:"horizontal",MODE_HAND:"mode_hand",MODE_ZOOM_SELECTION:"mode_zoomSelection",MODE_TEXT:"mode_text"}),e.factory("MultiPagesPage",["$log","MultiPagesConstants","PageViewport","ZoomSelection",function(e,t,i,n){function o(e,t,i){this.viewer=e,this.pageIndex=t,this.id=t+1,this.container=angular.element("<div></div>"),this.container.attr("id","page_"+t),this.wrapper=angular.element('<div class="page {{api.isPageSelected('+this.id+')}}"  ></div>'),this.container.append(this.wrapper),this.canvasRendered=!1,this.rendered=!1,this.rotation=0,this.scale=1,this.view=i}return o.prototype={clear:function(){this.rendered=!1,this.wrapper.empty(),this.layer=null,this.cleanUp&&this.cleanUp()},getViewport:function(e,t){return new i(this.view,e,t,0,0,!0)},transform:function(){this.clear(),this.viewport=this.getViewport(this.scale,this.rotation),this.canvasRendered=!1,this.canvas=angular.element("<canvas></canvas>"),this.canvas.attr("width",this.viewport.width),this.canvas.attr("height",this.viewport.height),this.wrapper.css("width",this.viewport.width+"px"),this.wrapper.css("height",this.viewport.height+"px")},resize:function(e){this.setOrientation(),this.scale=e,this.transform()},setOrientation:function(e){switch(this.viewer.orientation){case t.ORIENTATION_HORIZONTAL:this.container.addClass("horizontal"),this.container.removeClass("vertical");break;default:this.container.addClass("vertical"),this.container.removeClass("horizontal")}},rotate:function(e){this.rotation=e,this.transform()},isVisible:function(){var e=this.container[0],i=this.container.parent()[0];switch(this.viewer.orientation){case t.ORIENTATION_HORIZONTAL:var n=e.offsetLeft-i.scrollLeft,o=n+e.offsetWidth;return o>=0&&n<=i.offsetWidth;default:var a=e.offsetTop-i.scrollTop,r=a+e.offsetHeight;return r>=0&&a<=i.offsetHeight}},addLayer:function(e){null==this.layer&&(this.layer=angular.element("<div class='selectable-layer'></div>"),this.wrapper.append(this.layer)),this.layer.append(e)},initSelectZoom:function(){function e(e){var t=e||window.event,i=o.wrapper[0].getBoundingClientRect();t.pageX?(a.x=t.pageX-i.left,a.y=t.pageY-i.top):t.clientX&&(a.x=t.clientX-i.left,a.y=t.clientY-i.top)}function i(e){if(null!=e){var t=o.viewer.zoomSelectionShortcutKey;return null!=t&&null!=e[t]?e[t]:e.ctrlKey}return!1}var o=this,a={x:0,y:0,startX:0,startY:0},r=null,s=null,l=function(n){o.viewer.mode.id===t.MODE_ZOOM_SELECTION||i(n)?null==r&&(e(n),o.layer&&o.layer.removeClass("selectable-layer"),a.startX=a.x,a.startY=a.y,r={},r.offsetX=a.x,r.offsetY=a.y,s=angular.element('<div class="zoom-selection-rectangle"></div>'),s.css("left",a.x+"px"),s.css("top",a.y+"px"),o.wrapper.append(s),o.viewer.element.on("mouseup",c),o.viewer.element.on("mousemove",d),o.viewer.element.addClass("viewer-zoom-cursor")):(o.viewer.selectedPage=o.id,o.viewer.onPageClicked&&o.viewer.onPageClicked(o.id),o.viewer.api.onPageClicked&&o.viewer.api.onPageClicked(o.id))},c=function(e){o.viewer.element.removeClass("viewer-zoom-cursor"),o.viewer.element.off("mouseup",c),o.viewer.element.off("mousemove",d),null!=r&&(o.layer&&o.layer.addClass("selectable-layer"),(r.width>10||r.height>10)&&o.viewer.zoomTo(new n(r,o)),s.remove(),s=null,r=null)},d=function(t){e(t),null!==r&&(r.width=Math.abs(a.x-a.startX),r.height=Math.abs(a.y-a.startY),r.offsetLeft=a.x-a.startX<0?a.x:a.startX,r.offsetTop=a.y-a.startY<0?a.y:a.startY,s.css("width",r.width+"px"),s.css("height",r.height+"px"),s.css("left",r.offsetLeft+"px"),s.css("top",r.offsetTop+"px"))};o.container.on("mousedown",l),o.cleanUp=function(){o.container.off("mousedown",l),delete o.cleanUp}},render:function(i){if(this.onRendering&&this.onRendering(),this.rendered)return void(i&&i(this,t.PAGE_ALREADY_RENDERED));e.debug("render page "+this.id+" started");var n=new Date;this.rendered=!0,this.initSelectZoom(),this.renderPage(this,function(o,a){a===t.PAGE_RENDERED?(o.canvasRendered=!0,e.debug("render page "+o.id+" ended, duration : "+((new Date-n)%6e4/1e3).toFixed(0)+" sec")):a===t.PAGE_ALREADY_RENDERED&&e.debug("page "+o.id+" already rendered"),i&&i(o,a)})},renderPage:function(e,t){throw"NotImplementedError - renderPage(page, callback)"}},o}]),e.factory("MultiPagesViewer",["$log","$timeout","$compile","$document","MultiPagesViewerAPI","MultiPagesConstants","SizeWatcher","TranslateViewer",function(e,t,i,n,o,a,r,s){function l(e,t){var i=angular.element("<div></div>");i.css("height","10000px"),e.append(i);var n=i[0].offsetWidth;i.remove();var o=e[0].offsetHeight;return 0===o&&(o=2*t),n-=2*t,o-=2*t+10,{width:n,height:o}}function c(e,t){this.pages=[],this.currentPages=[],this.fitWidthScale=1,this.fitHeightScale=1,this.fitPageScale=1,this.element=t,this.pageMargin=0,this.orientation=a.ORIENTATION_VERTICAL,this.currentPage=0,this.lastScrollDir=0,this.rotation=0,this.scaleItem=null,this.scaleItems={},this.zoomLevels=[],this.modes=[{id:a.MODE_HAND,label:s.translate("GLOBAL.VIEWER.MODE_HAND","Main"),activate:function(){var e=t[0],i={acceptPropagatedEvent:!0,preventDefault:!0},o=function(e){if(1!=e.ctrlKey){if(t.css("cursor","-webkit-grabbing"),t.css("cursor","grabbing"),1!=e.which||!i.acceptPropagatedEvent&&e.target!=this)return!1;if(i.lastCoord={left:e.clientX,top:e.clientY},n.on("mouseup",r),n.on("mousemove",a),i.preventDefault)return e.preventDefault(),!1}},a=function(t){var n={left:t.clientX-i.lastCoord.left,top:t.clientY-i.lastCoord.top};return e.scrollLeft=e.scrollLeft-n.left,e.scrollTop=e.scrollTop-n.top,i.lastCoord={left:t.clientX,top:t.clientY},i.preventDefault?(t.preventDefault(),!1):void 0},r=function(e){return n.off("mouseup",r),n.off("mousemove",a),t.css("cursor","-webkit-grab"),t.css("cursor","grab"),i.preventDefault?(e.preventDefault(),!1):void 0};t.on("mousedown",o),t.css("cursor","-webkit-grab"),t.css("cursor","grab"),this.cleanUp=function(){t.off("mousedown",o),t.css("cursor","default")}}},{id:a.MODE_ZOOM_SELECTION,label:s.translate("GLOBAL.VIEWER.MODE_ZOOM_SELECTION","Zoom slection"),activate:function(){}}],this.api=e,this.onPageRendered=null,this.onTextLayerRendered=null,this.onDataDownloaded=null,this.onCurrentPageChanged=null,this.setMode(this.modes[0])}return c.prototype={setMode:function(e){null!=this.element&&null!=e&&this.mode!=e&&(this.mode&&null!=this.mode.cleanUp&&this.mode.cleanUp(),this.mode=e,this.mode.activate())},getAPI:function(){return this.api},zoomTo:function(e){var t=this.pages[e.pageIndex];if(void 0!=t)for(var i={width:t.viewport.width*e.percentWidth/100,height:t.viewport.height*e.percentHeight/100},n={width:this.containerSize.width*this.scaleItem.value,height:this.containerSize.height*this.scaleItem.value},o=i.width>i.height?"width":"height",a=this.zoomLevels.length,r=0;a>r;++r){var s=this.zoomLevels[r],l=this.zoomLevels[r+1],c=i[o];if(null==l||s.value*c<=n[o]&&l.value*c>=n[o]){this.scaleItem.value!=s.value&&this.setScale(s);var d=t.viewport.height*e.percentTop/100+t.container[0].offsetTop,u=t.viewport.width*e.percentLeft/100+t.container[0].offsetLeft;this.element[0].scrollTop=d,this.element[0].scrollLeft=u,0===e.pageIndex&&this.renderAllVisiblePages(),this.api.onZoomToSelection&&this.api.onZoomToSelection(e);break}}},addPages:function(){for(var e=this,t=e.pages.length,i=0;t>i;++i)this.element.append(e.pages[i].container);e.onPageRendered("loaded",1,t,""),null!=e.initialMode&&angular.forEach(e.modes,function(t){e.initialMode===t.id&&e.setMode(t)}),e.setContainerSize(e.initialScale)},updateScaleItem:function(e){var t=this.scaleItems[e.id];return void 0==t?(this.scaleItems[e.id]=e,t=e):t.value=e.value,this.zoomLevels.push(t),t},setContainerSize:function(t){if(this.pages.length>0){var i=l(this.element,this.pageMargin);if(i.width>0&&i.height>0){this.onContainerSizeChanged&&this.onContainerSizeChanged(i),this.containerSize=i;var n=this.scaleItem?this.scaleItem.value:null;this.fitWidthScale=this.calcScale(a.ZOOM_FIT_WIDTH),this.fitHeightScale=this.calcScale(a.ZOOM_FIT_HEIGHT),this.fitPageScale=this.calcScale(a.ZOOM_FIT_PAGE),this.zoomLevels=[];for(var o=a.ZOOM_LEVELS_LUT.length-1,r=0;o>r;++r){var c=null,d=a.ZOOM_LEVELS_LUT[r],u=a.ZOOM_LEVELS_LUT[r+1];d<this.fitWidthScale&&u>this.fitWidthScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_WIDTH,value:this.fitWidthScale,label:s.translate("GLOBAL.VIEWER.FIT_WIDTH_LABEL","Fit width")})),d<this.fitHeightScale&&u>this.fitHeightScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_HEIGHT,value:this.fitHeightScale,label:s.translate("GLOBAL.VIEWER.FIT_HEIGHT_LABEL","Fit height")})),d<this.fitPageScale&&u>this.fitPageScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_PAGE,value:this.fitPageScale,label:s.translate("GLOBAL.VIEWER.FIT_PAGE_LABEL","Fit page")}));var p=(100*u).toFixed(0)+"%";c=this.updateScaleItem({id:p,value:u,label:p})}if(void 0==this.scaleItem&&t&&(void 0!=this.scaleItems[t]?this.scaleItem=this.scaleItems[t]:e.debug("InitialScale not found : "+t)),this.api.onZoomLevelsChanged&&this.api.onZoomLevelsChanged(this.zoomLevels),null!=this.scaleItem&&this.scaleItem.value===n&&this.pages[0]&&null!=this.pages[0].viewport)return void this.renderAllVisiblePages();this.setScale(this.scaleItem),this.render()}}},hasMultiplePages:function(){return this.pages.length>1},setOrientation:function(e){this.orientation=e,this.hasMultiplePages()&&(this.setScale(this.scaleItem),this.render())},setScale:function(e){void 0!=e&&(this.scaleItem=e);for(var t=e||this.scaleItems["100%"],i=this.pages.length,n=0;i>n;++n){var o=this.pages[n];o.resize(t.value)}},calcScale:function(t){if(t===a.ZOOM_FIT_WIDTH){for(var i=this.pages.length,n=this.pages[0],o=n.getViewport(1,n.rotation).width,r=1;i>r;++r)n=this.pages[r],o=Math.max(o,n.getViewport(1,n.rotation).width);return this.containerSize.width/o}if(t===a.ZOOM_FIT_HEIGHT){for(var i=this.pages.length,n=this.pages[0],s=n.getViewport(1,n.rotation).height,r=1;i>r;++r)n=this.pages[r],s=Math.max(s,n.getViewport(1,n.rotation).height);return this.containerSize.height/s}if(t===a.ZOOM_FIT_PAGE){var n=this.pages[0],l=n.getViewport(1,n.rotation);return this.containerSize.height<this.containerSize.width?this.containerSize.height/l.height:this.containerSize.width/l.width}var c=parseFloat(t);return isNaN(c)?(e.debug("PDF viewer: "+t+" isn't a valid scaleItem value."),1):c},removeDistantPages:function(e,t,i){for(var n=this.pages.length,o=Math.max(e-i,0),a=Math.min(t+i,n-1),r=0;o>r;++r)this.pages[r].clear();for(var r=a+1;n>r;++r)this.pages[r].clear()},renderAllVisiblePages:function(e){void 0!=e&&(this.lastScrollDir=e);var t=this;this.currentPages=[];for(var i=this.pages.length,n=-1,o=0,r=!1,s=0;i>s;++s){var l=this.pages[s];if(l.isVisible()){var c=l.container.parent()[0],d=l.container[0];if(t.hasMultiplePages()){if(-1===n)if(this.orientation===a.ORIENTATION_HORIZONTAL){var u=d.offsetLeft-c.scrollLeft,p=d.offsetWidth/1.5;p+u>=0&&(n=s)}else{var f=d.offsetTop-c.scrollTop,p=d.offsetHeight/1.5;p+f>=0&&(n=s)}}else n=s;r=!0,o=s,this.currentPages.push(l),l.render(function(e,i){i===a.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===a.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}else if(r)break}if(-1===n&&(n=o),t.hasMultiplePages()){if(this.clearDistantSelectedPage(n+1,o+1),0!==this.lastScrollDir){var g=(this.lastScrollDir>0?o:n)+this.lastScrollDir;if(g>=0&&i>g){var l=this.pages[g];this.currentPages.push(l),l.render(function(e,i){i===a.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===a.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}}this.removeDistantPages(n,o,1)}this.currentPage=n+1,this.onCurrentPageChanged&&this.onCurrentPageChanged(n+1)},clearDistantSelectedPage:function(e,t){(this.selectedPage<=e||this.selectedPage>t)&&(this.selectedPage=null)},render:function(){0!=this.currentPage&&1!=this.currentPage?this.api.goToPage(this.api.getSelectedPage()):this.renderAllVisiblePages()},rotate:function(e){if(void 0!=e){var t=this.pages[e.pageIndex];if(void 0!=t){var i=t.rotation+e.rotation;(360===i||-360===i)&&(i=0),t.rotation=i,t.rotate(i),this.api.onPageRotation&&this.api.onPageRotation(e),this.setContainerSize(this.initialScale),this.thumbnail&&this.thumbnail.rotate(e)}}},rotatePages:function(e){var t=this.pages.length,i=this.rotation-e;(360===i||-360===i)&&(i=0),this.rotation=i;for(var n=0;t>n;++n)this.pages[n].rotate(i);this.setContainerSize(this.initialScale),this.thumbnail&&this.thumbnail.rotatePages(e)},downloadProgress:function(e){var t=0;if("undefined"==typeof e.total)for(;t<e.loaded;)t+=1048576;else t=e.total;this.onDataDownloaded&&this.onDataDownloaded("loading",e.loaded,t,"")},hookScope:function(n){var o=this,a=0,s=new r(o.element[0],200);n.$watchGroup(s.group,function(i){n.sizeWatcherTimeout&&t.cancel(n.sizeWatcherTimeout),n.sizeWatcherTimeout=t(function(){e.debug("SizeChanged"),o.setContainerSize(o.initialScale)},450)}),n.$watch("options.orientation",function(e){o.setOrientation(e)});var l=function(t,a,r,s,l){"render"===t&&1===r?"loaded"===a?i(o.element.contents())(n):"success"===a?e.debug("onProgress("+t+", "+a+", "+r+", "+s+")"):o.api.onError?o.api.onError(t,l):e.debug("Failed to render 1st page!\n\n"+l):"download"===t&&"loading"===a?o.api.downloadProgress=r/s*100:"failed"===a&&(o.api.onError?o.api.onError(t,l):e.debug("Something went really bad!\n\n"+l))};n.onPageRendered=function(e,t,i,n){l("render",e,t,i,n)},n.onTextLayerRendered=function(t,i){e.debug("TextLayer of page id "+t+" rendered")},n.onDataDownloaded=function(e,t,i,n){l("download",e,t,i,n)},o.onPageRendered=angular.bind(n,n.onPageRendered),o.onTextLayerRendered=angular.bind(n,n.onTextLayerRendered),o.onDataDownloaded=angular.bind(n,n.onDataDownloaded),n.$on("$destroy",function(){if(null!=o.onDestroy){try{}catch(t){e.log(t)}o.onDestroy()}o.thumbnail=null,s.cancel(),o.element.empty(),e.debug("viewer destroyed")}),o.element.bind("scroll",function(e){n.scrollTimeout&&t.cancel(n.scrollTimeout),n.scrollTimeout=t(function(){var e=o.element[0].scrollTop,t=e-a;a=e;var i=t>0?1:0>t?-1:0;o.renderAllVisiblePages(i)},350)})}},c}]),e.factory("MultiPagesViewerAPI",["$log","MultiPagesConstants",function(e,t){function i(e){this.viewer=e}return i.prototype={getViewer:function(){return this.viewer},getMode:function(){return this.viewer.mode},getModes:function(){return this.viewer.modes},setMode:function(e){this.viewer.setMode(e)},getZoomLevels:function(){return this.viewer.zoomLevels},zoomTo:function(e){void 0!=e&&(this.viewer.setScale(e),this.viewer.render())},getZoomLevel:function(){return this.viewer.scaleItem},zoomToSelection:function(e){this.viewer.zoomTo(e)},zoomIn:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e<this.viewer.zoomLevels.length&&this.zoomTo(this.viewer.zoomLevels[e+1])},zoomOut:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e>0&&this.zoomTo(this.viewer.zoomLevels[e-1])},getCurrentPage:function(){return this.viewer.currentPage},getSelectedPage:function(){return this.viewer.selectedPage||this.viewer.currentPage},isPageSelected:function(e){return this.getSelectedPage()===e?"selected":null},goToPage:function(e){if(!(1>e||e>this.getNumPages())){var i=this.viewer.pages[e-1].container[0],n=this.viewer.element[0];if(this.viewer.orientation===t.ORIENTATION_HORIZONTAL){var o=i.offsetLeft-10;Math.round(n.scrollLeft)===o&&(o-=1),n.scrollLeft=o,n.scrollTop=0}else{var a=i.offsetTop-10;Math.round(n.scrollTop)===a&&(a-=1),n.scrollTop=a,n.scrollLeft=0}}},goToNextPage:function(){this.goToPage(this.getSelectedPage()+1)},goToPrevPage:function(){this.goToPage(this.getSelectedPage()-1)},getNumPages:function(){return this.viewer.pages.length},rotatePagesRight:function(){this.viewer.rotatePages(90)},rotatePagesLeft:function(){this.viewer.rotatePages(-90)},rotatePageRight:function(e){this.rotatePage({pageIndex:e|this.getSelectedPage()-1,rotation:90})},rotatePageLeft:function(e){this.rotatePage({pageIndex:e|this.getSelectedPage()-1,rotation:-90})},rotatePage:function(e){this.viewer.rotate(e)}},i}]),e.factory("PageViewport",[function(){function e(e,t,i,n,o,a){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=n,this.offsetY=o;var r,s,l,c,d=(e[2]+e[0])/2,u=(e[3]+e[1])/2;switch(i%=360,i=0>i?i+360:i){case 180:r=-1,s=0,l=0,c=1;break;case 90:r=0,s=1,l=1,c=0;break;case 270:r=0,s=-1,l=-1,c=0;break;default:r=1,s=0,l=0,c=-1}a&&(l=-l,c=-c);var p,f,g,h;0===r?(p=Math.abs(u-e[1])*t+n,f=Math.abs(d-e[0])*t+o,g=Math.abs(e[3]-e[1])*t,h=Math.abs(e[2]-e[0])*t):(p=Math.abs(d-e[0])*t+n,f=Math.abs(u-e[1])*t+o,g=Math.abs(e[2]-e[0])*t,h=Math.abs(e[3]-e[1])*t),this.transform=[r*t,s*t,l*t,c*t,p-r*t*d-l*t*u,f-s*t*d-c*t*u],this.width=g,this.height=h,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var i="scale"in t?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return Util.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=Util.applyTransform([e[0],e[1]],this.transform),i=Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]},convertToPdfPoint:function(e,t){return Util.applyInverseTransform([e,t],this.transform)}},e}]),e.factory("SizeWatcher",["$interval",function(e){return function(t,i){var n=this;(n.update=function(){n.dimensions=[t.offsetWidth,t.offsetHeight]})(),n.monitor=e(n.update,i),n.group=[function(){return n.dimensions[0]},function(){return n.dimensions[1]}],n.cancel=function(){e.cancel(n.monitor)}}}]),e.factory("TranslateViewer",["$translate",function(e){return{translate:function(t,i){var n=e.instant(t);return n!=t?n:i}}}]),e.factory("ZoomSelection",["$log","MultiPagesConstants",function(e,t){function i(e,t){this.percentTop=100*e.offsetTop/t.viewport.height,this.percentLeft=100*e.offsetLeft/t.viewport.width,this.percentWidth=100*e.width/t.viewport.width,this.percentHeight=100*e.height/t.viewport.height,this.pageIndex=t.pageIndex}return i}]),t.factory("CustomStyle",[function(){function e(){}var t=["ms","Moz","Webkit","O"],i={};return e.getProp=function(e,n){if(1===arguments.length&&"string"==typeof i[e])return i[e];n=n||document.documentElement;var o,a,r=n.style;if("string"==typeof r[e])return i[e]=e;a=e.charAt(0).toUpperCase()+e.slice(1);for(var s=0,l=t.length;l>s;s++)if(o=t[s]+a,"string"==typeof r[o])return i[e]=o;return i[e]="undefined"},e.setProp=function(e,t,i){var n=this.getProp(e);"undefined"!==n&&(t.style[n]=i)},e}]),t.factory("EventBus",[function(){function e(){this._listeners=Object.create(null)}return e.prototype={on:function(e,t){var i=this._listeners[e];i||(i=[],this._listeners[e]=i),i.push(t)},off:function(e,t){var i,n=this._listeners[e];!n||(i=n.indexOf(t))<0||n.splice(i,1)},dispatch:function(e){var t=this._listeners[e];if(t&&0!==t.length){var i=Array.prototype.slice.call(arguments,1);t.slice(0).forEach(function(e){e.apply(null,i)})}}},e}]),t.directive("itPdfViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){e.thumbnailCollapsed=!1,e.onPassword=function(e){return prompt("The selected PDF is password protected. PDF.js reason: "+e,"")},e.toggleThumbnail=function(){e.thumbnailCollapsed=!e.thumbnailCollapsed},t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div ui-layout="{ flow : \'column\', dividerSize : 0 }" class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar != false"></it-progressbar-viewer><it-toolbar-viewer  api="options.$$api" ng-if="options.showToolbar != false"></it-toolbar-viewer><div ng-if="options.showThumbnail != false" collapsed="thumbnailCollapsed" ui-layout-container size="210px" class="thumbnail-menu"><it-thumbnail-menu-viewer orientation="\'vertical\'" options="options"><div class="ui-splitbar-container-column pull-right"  ng-click="toggleThumbnail()"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-left"></span></div></it-thumbnail-menu-viewer></div><div ui-layout-container><pdf-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.$$api" options="options" password-callback="onPassword(reason)"></pdf-viewer></div><div class="ui-splitbar-container-column pull-left"  ng-click="toggleThumbnail()" ng-if="thumbnailCollapsed"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-right"></span></div></div>',
link:i}}]),t.factory("PDFViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.findNext=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID+1;e>=this.viewer.searchResults.length&&(e=0),this.viewer.highlightSearchResult(e)}},i.prototype.findPrev=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID-1;0>e&&(e=this.viewer.searchResults.length-1),this.viewer.highlightSearchResult(e)}},i}]).factory("PDFPage",["$log","$window","$document","$timeout","MultiPagesPage","MultiPagesConstants","TextLayerBuilder",function(e,t,i,n,o,a,r){function s(e,t){this.base=o,this.base(e,t.pageIndex),this.pdfPage=t,this.renderTask=null}return s.prototype=new o,s.prototype.clear=function(){null!==this.renderTask&&this.renderTask.cancel(),o.prototype.clear.call(this),this.renderTask=null},s.prototype.getViewport=function(e,t){return this.pdfPage.getViewport(e,t+(this.pdfPage.pageInfo?this.pdfPage.pageInfo.rotate:0),0,0)},s.prototype.renderTextLayer=function(){var e=this;this.viewer.mode.id===a.MODE_TEXT&&(null!=e.textLayer?e.addLayer(e.textLayer):(e.textLayer=angular.element("<div class='textLayer r"+e.rotation+"'></div>"),e.textLayer.css("width",this.viewport.width+"px"),e.textLayer.css("height",this.viewport.height+"px"),null==e.textContentTask&&(e.textContentTask=e.pdfPage.getTextContent()),e.textContentTask.then(function(t){var i=new r({textLayerDiv:e.textLayer[0],pageIndex:e.id,viewport:e.viewport});i.setTextContent(t),i.render(null,function(){e.addLayer(e.textLayer),e.viewer.onTextLayerRendered(e.id,e.textLayer)})})))},s.prototype.removeTextLayer=function(){null!=this.textLayer&&this.textLayer.remove()},s.prototype.transform=function(){o.prototype.transform.call(this),this.textLayer=null},s.prototype.onRendering=function(){this.renderTextLayer&&this.renderTextLayer()},s.prototype.renderPage=function(e,t){e.canvasRendered?(e.wrapper.append(e.canvas),t&&t(this,a.PAGE_ALREADY_RENDERED)):(e.wrapper.append(e.canvas),e.renderTask=this.pdfPage.render({canvasContext:e.canvas[0].getContext("2d"),viewport:e.viewport}),e.renderTask.then(function(){e.renderTask=null,t&&t(e,a.PAGE_RENDERED)},function(i){e.rendered=!1,e.renderTask=null,"cancelled"===i?t&&t(e,a.PAGE_RENDER_CANCELLED):t&&t(e,a.PAGE_RENDER_FAILED)}))},s}]).factory("PDFViewer",["$log","$window","$document","$timeout","MultiPagesViewer","PDFViewerAPI","PDFPage","MultiPagesConstants","TranslateViewer",function(e,t,i,n,o,a,r,s,l){function c(e){function r(t){var i=t||window.event,n=e[0],o=n.getBoundingClientRect();i.pageX?(u.x=i.pageX+n.scrollLeft-o.left,u.y=i.pageY+n.scrollTop-o.top):i.clientX&&(u.x=i.clientX+n.scrollLeft-o.left,u.y=i.clientY+n.scrollTop-o.top)}function c(t){var i=0,n=0,o=e[0];do i+=t.offsetLeft-t.scrollLeft+t.clientLeft,n+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;while(t!=o&&null!=t);return{x:i,y:n}}this.base=o,this.base(new a(this),e),this.pdf=null,this.passwordCallback=null;var d=this,u={x:0,y:0},p=function(e){if(t.getSelection){d.wordEventTimeout&&n.cancel(d.wordEventTimeout),d.wordEventTimeout=null;var o=t.getSelection(),a=i[0].createRange();a.selectNodeContents(e.target),o.removeAllRanges(),o.addRange(a);var r=a.toString();d.api.selectedText=r,null!=d.api.onTextSelected&&d.api.onTextSelected(r)}},f=function(t){null==d.selectionTooltip&&(null!=d.wordTooltip&&d.wordTooltip.css("display","none"),d.selectionTooltip=angular.element('<div class="selection-tooltip"></div>'),d.selectionTooltip.css("left",u.x+"px"),d.selectionTooltip.css("top",u.y+"px"),e.append(d.selectionTooltip))},g=function(e){null!=d.selectionTooltip&&(d.selectionTooltip.remove(),d.selectionTooltip=null),d.wordEventTimeout&&n.cancel(d.wordEventTimeout),d.wordEventTimeout=n(function(){var e="";t.getSelection&&(e=t.getSelection().toString()),e.length>0&&(d.api.selectedText=e,null!=d.api.onTextSelected&&d.api.onTextSelected(e))},450)},h=function(i){if(r(i),null!=d.selectionTooltip){d.selectionTooltip.css("left",u.x+"px"),d.selectionTooltip.css("top",u.y+"px");var n="";if(t.getSelection&&(n=t.getSelection().toString()),n.length>0){if(n.length>30){var o=n.slice(0,15),a=n.slice(n.length-15,n.length);d.selectionTooltip[0].innerHTML=o+" [...] "+a}else d.selectionTooltip[0].innerHTML=n;d.selectionTooltip.css("display","block")}else d.selectionTooltip.css("display","none")}else if(i.target&&"word"==i.target.className){null==d.wordTooltip&&(d.wordTooltip=angular.element('<div class="word-tooltip"></div>')),e.append(d.wordTooltip);var s=c(i.target);d.wordTooltip[0].textContent=i.target.textContent,d.wordTooltip.css("display","table"),d.wordTooltip.css("left",s.x+"px"),d.wordTooltip.css("top",s.y-d.wordTooltip[0].offsetHeight-10+"px")}else null!=d.wordTooltip&&d.wordTooltip.css("display","none")};this.modes.push({id:s.MODE_TEXT,label:l.translate("GLOBAL.VIEWER.MODE_TEXT","Text"),activate:function(){angular.forEach(d.currentPages,function(e){e.renderTextLayer()}),e.on("dblclick",p),e.on("mousedown",f),e.on("mouseup",g),e.on("mousemove",h)},cleanUp:function(){for(var t=0;t<d.pages.length;++t)d.pages[t].removeTextLayer();e.off("dblclick",p),e.off("mousedown",f),e.off("mouseup",g),e.off("mousemove",h)}})}return c.prototype=new o,c.prototype.open=function(e,t){if(this.element.empty(),this.pages=[],void 0!==e&&null!==e&&""!==e){angular.extend(this,t);var i="string"!=typeof e;if(void 0!=this.getDocumentTask){var n=this;this.getDocumentTask.destroy().then(function(){i?n.setFile(e):n.setUrl(e)})}else i?this.setFile(e):this.setUrl(e)}},c.prototype.setUrl=function(e){var t=this;this.getDocumentTask=PDFJS.getDocument(e,null,angular.bind(this,this.passwordCallback),angular.bind(this,this.downloadProgress)),this.getDocumentTask.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i,t.addPages()})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},c.prototype.setFile=function(e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result,n=new Uint8Array(i),o=PDFJS.getDocument(n,null,angular.bind(t,t.passwordCallback),angular.bind(t,t.downloadProgress));o.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i,t.addPages()})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)},c.prototype.getAllPages=function(e){for(var t=[],i={},n=this.pdf.numPages,o=n,a=this,s=0;n>s;++s){t.push({});var l=this.pdf.getPage(s+1);l.then(function(n){var s=n.ref.num+" "+n.ref.gen+" R";i[s]=n.pageIndex+1;var l=new r(a,n,!0);t[n.pageIndex]=l,--o,0===o&&e(t,i)})}},c.prototype.onDestroy=function(){this.getDocumentTask&&(this.getDocumentTask.destroy(),this.getDocumentTask=null)},c}]).directive("pdfViewer",["$log","PDFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"=",passwordCallback:"&"},controller:["$scope","$element",function(n,o){var a=function(e){return null===n.options||void 0===n.options?null:n.options[e]},r=function(){return{initialScale:a("initialScale"),initialMode:a("initialMode"),orientation:a("orientation"),zoomSelectionShortcutKey:a("zoomSelectionShortcutKey"),pageMargin:i}};n.getPassword=function(t,i){if(this.passwordCallback){var n=this;this.$apply(function(){var o=n.passwordCallback({reason:i});""!==o&&void 0!==o&&null!==o?t(o):e.log("A password is required to read this document.")})}else e.log("A password is required to read this document.")};var s=new t(o);s.passwordCallback=angular.bind(n,n.getPassword),n.api=s.getAPI(),n.Open=function(e){s.open(e,r())},s.hookScope(n)}],link:function(e,t,i){i.$observe("src",e.Open),e.$watch("file",e.Open)}}}]),t.factory("TextLayerBuilder",["CustomStyle","EventBus",function(e,t){function i(e){e.on("documentload",function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("documentload",!0,!0,{}),window.dispatchEvent(e)}),e.on("pagerendered",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pagerendered",!0,!0,{pageNumber:e.pageNumber,cssTransform:e.cssTransform}),e.source.div.dispatchEvent(t)}),e.on("textlayerrendered",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:e.pageNumber}),e.source.textLayerDiv.dispatchEvent(t)}),e.on("pagechange",function(e){var t=document.createEvent("UIEvents");t.initUIEvent("pagechange",!0,!0,window,0),t.pageNumber=e.pageNumber,e.source.container.dispatchEvent(t)}),e.on("pagesinit",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pagesinit",!0,!0,null),e.source.container.dispatchEvent(t)}),e.on("pagesloaded",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pagesloaded",!0,!0,{pagesCount:e.pagesCount}),e.source.container.dispatchEvent(t)}),e.on("scalechange",function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scalechange",!0,!0,window,0),t.scale=e.scale,t.presetValue=e.presetValue,e.source.container.dispatchEvent(t)}),e.on("updateviewarea",function(e){var t=document.createEvent("UIEvents");t.initUIEvent("updateviewarea",!0,!0,window,0),t.location=e.location,e.source.container.dispatchEvent(t)}),e.on("find",function(e){if(e.source!==window){var t=document.createEvent("CustomEvent");t.initCustomEvent("find"+e.type,!0,!0,{query:e.query,phraseSearch:e.phraseSearch,caseSensitive:e.caseSensitive,highlightAll:e.highlightAll,findPrevious:e.findPrevious}),window.dispatchEvent(t)}}),e.on("attachmentsloaded",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("attachmentsloaded",!0,!0,{attachmentsCount:e.attachmentsCount}),e.source.container.dispatchEvent(t)}),e.on("sidebarviewchanged",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("sidebarviewchanged",!0,!0,{view:e.view}),e.source.outerContainer.dispatchEvent(t)}),e.on("pagemode",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pagemode",!0,!0,{mode:e.mode}),e.source.pdfViewer.container.dispatchEvent(t)}),e.on("namedaction",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("namedaction",!0,!0,{action:e.action}),e.source.pdfViewer.container.dispatchEvent(t)}),e.on("presentationmodechanged",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("presentationmodechanged",!0,!0,{active:e.active,switchInProgress:e.switchInProgress}),window.dispatchEvent(t)}),e.on("outlineloaded",function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("outlineloaded",!0,!0,{outlineCount:e.outlineCount}),e.source.container.dispatchEvent(t)})}function n(){return a?a:(a=new t,i(a),a)}function o(e){this.textLayerDiv=e.textLayerDiv,this.eventBus=e.eventBus||n(),this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=e.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=e.viewport,this.textDivs=[],this.findController=e.findController||null,this.textLayerRenderTask=null,this.enhanceTextSelection=e.enhanceTextSelection,this._bindMouse()}var a=null;return o.prototype={_finishRendering:function(){this.renderingDone=!0,this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber})},render:function(e,t){if(this.divContentDone&&!this.renderingDone){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textDivs=[];var i=document.createDocumentFragment();this.textLayerRenderTask=PDFJS.renderTextLayer({textContent:this.textContent,container:i,viewport:this.viewport,textDivs:this.textDivs,timeout:e,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then(function(){this.textLayerDiv.appendChild(i),this._finishRendering(),this.updateMatches();for(var e=0;e<this.textDivs.length;e++)this.textDivs[e].setAttribute("class","word");t&&t()}.bind(this),function(e){})}},setTextContent:function(e){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textContent=e,this.divContentDone=!0},convertMatches:function(e,t){var i=0,n=0,o=this.textContent.items,a=o.length-1,r=null===this.findController?0:this.findController.state.query.length,s=[];if(!e)return s;for(var l=0,c=e.length;c>l;l++){for(var d=e[l];i!==a&&d>=n+o[i].str.length;)n+=o[i].str.length,i++;i===o.length&&console.error("Could not find a matching mapping");var u={begin:{divIdx:i,offset:d-n}};for(d+=t?t[l]:r;i!==a&&d>n+o[i].str.length;)n+=o[i].str.length,i++;u.end={divIdx:i,offset:d-n},s.push(u)}return s},renderMatches:function(e){function t(e,t){var n=e.divIdx;o[n].textContent="",i(n,0,e.offset,t)}function i(e,t,i,a){var r=o[e],s=n[e].str.substring(t,i),l=document.createTextNode(s);if(a){var c=document.createElement("span");return c.className=a,c.appendChild(l),void r.appendChild(c)}r.appendChild(l)}if(0!==e.length){var n=this.textContent.items,o=this.textDivs,a=null,r=this.pageIdx,s=null===this.findController?!1:r===this.findController.selected.pageIdx,l=null===this.findController?-1:this.findController.selected.matchIdx,c=null===this.findController?!1:this.findController.state.highlightAll,d={divIdx:-1,offset:void 0},u=l,p=u+1;if(c)u=0,p=e.length;else if(!s)return;for(var f=u;p>f;f++){var g=e[f],h=g.begin,m=g.end,v=s&&f===l,b=v?" selected":"";if(this.findController&&this.findController.updateMatchPosition(r,f,o,h.divIdx),a&&h.divIdx===a.divIdx?i(a.divIdx,a.offset,h.offset):(null!==a&&i(a.divIdx,a.offset,d.offset),t(h)),h.divIdx===m.divIdx)i(h.divIdx,h.offset,m.offset,"highlight"+b);else{i(h.divIdx,h.offset,d.offset,"highlight begin"+b);for(var w=h.divIdx+1,C=m.divIdx;C>w;w++)o[w].className="highlight middle"+b;t(m,"highlight end"+b)}a=m}a&&i(a.divIdx,a.offset,d.offset)}},updateMatches:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,i=this.textContent.items,n=-1,o=0,a=e.length;a>o;o++){for(var r=e[o],s=Math.max(n,r.begin.divIdx),l=s,c=r.end.divIdx;c>=l;l++){var d=t[l];d.textContent=i[l].str,d.className=""}n=r.end.divIdx+1}if(null!==this.findController&&this.findController.active){var u,p;null!==this.findController&&(u=this.findController.pageMatches[this.pageIdx]||null,p=this.findController.pageMatchesLength?this.findController.pageMatchesLength[this.pageIdx]||null:null),this.matches=this.convertMatches(u,p),this.renderMatches(this.matches)}}},_bindMouse:function(){var e=this.textLayerDiv,t=this;e.addEventListener("mousedown",function(i){if(t.enhanceTextSelection&&t.textLayerRenderTask)return void t.textLayerRenderTask.expandTextDivs(!0);var n=e.querySelector(".endOfContent");if(n){var o=i.target!==e;if(o=o&&"none"!==window.getComputedStyle(n).getPropertyValue("-moz-user-select")){var a=e.getBoundingClientRect(),r=Math.max(0,(i.pageY-a.top)/a.height);n.style.top=(100*r).toFixed(2)+"%"}n.classList.add("active")}}),e.addEventListener("mouseup",function(i){if(t.enhanceTextSelection&&t.textLayerRenderTask)return void t.textLayerRenderTask.expandTextDivs(!1);var n=e.querySelector(".endOfContent");n&&(n.style.top="",n.classList.remove("active"))})}},o}]),e.directive("itThumbnailMenuViewer",["$log","TranslateViewer",function(e,t){var i=function(e,i,n){e.model={},e.model.sizes=[{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.SMALL","small"),value:"small"},{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.MEDIUM","medium"),value:"medium"},{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.BIG","big"),value:"big"}],e.model.currentSize=e.model.sizes[2]};return{scope:{options:"=",orientation:"="},transclude:!0,restrict:"E",template:'<div class="thumbnail-menu-select" ng-if="options.showSizeMenu != false"><select ng-model="model.currentSize" ng-options="size as size.label for size in model.sizes"></select></div><div class="thumbnail-menu-{{orientation}}-{{model.currentSize.value}}" ><it-thumbnail-viewer viewer-api="options.$$api" orientation="orientation" show-num-pages="options.showNumPages"></it-thumbnail-viewer><ng-transclude></ng-transclude></div>',link:i}}]),e.directive("itThumbnailViewer",["$log","ThumbnailViewer","$timeout",function(e,t,i){var n=10;return{restrict:"E",scope:{viewerApi:"=",orientation:"=",showNumPages:"="},controller:["$scope","$element",function(e,i){e.shouldShowNumPages=function(){var e=this.showNumPages;return typeof e==typeof!0?e:!0};var o=new t(i);i.addClass("thumbnail-viewer"),e.api=o.getAPI(),e.onViewerApiChanged=function(){o.open(e.viewerApi,e.orientation,e.shouldShowNumPages(),n)},o.hookScope(e)}],link:function(e,t,n){e.$watchGroup(["viewerApi.getNumPages()","showNumPages"],function(){e.onViewerApiChangedTimeout&&i.cancel(e.onViewerApiChangedTimeout),e.onViewerApiChangedTimeout=i(function(){e.onViewerApiChanged()},300)})}}}]),e.factory("ThumbnailViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.getSelectedPage=function(){return this.viewer.viewer.getAPI().getSelectedPage()},i}]).factory("ThumbnailPage",["$log","$timeout","MultiPagesPage","MultiPagesConstants",function(e,t,i,n){function o(e,t,n){this.base=i,this.base(e,t.pageIndex,t.view),n&&(this.pageNum=angular.element("<div class='num-page'>"+this.id+"</div>")),this.page=t}return o.prototype=new i,o.prototype.getViewport=function(e,t){return this.page.getViewport(e,t)},o.prototype.renderPage=function(e,t){this.page.renderPage(e,t),void 0!=this.pageNum&&e.wrapper.append(this.pageNum)},o}]).factory("ThumbnailViewer",["$log","ThumbnailViewerAPI","ThumbnailPage","MultiPagesViewer","MultiPagesConstants",function(e,t,i,n,o){function a(e){this.base=n,this.base(new t(this),e)}return a.prototype=new n,a.prototype.open=function(e,t,i,n){if(this.element.empty(),this.pages=[],null!=e){var a=this;this.viewer=e.getViewer(),this.viewer.thumbnail=this,this.pageMargin=n,this.showNumPages=i,this.orientation=t,this.orientation===o.ORIENTATION_HORIZONTAL?this.initialScale=o.ZOOM_FIT_HEIGHT:this.initialScale=o.ZOOM_FIT_WIDTH,this.getAllPages(function(e){a.pages=e,a.addPages(),a.setContainerSize(a.initialScale)})}},a.prototype.getAllPages=function(e){for(var t=[],n=this.viewer.pages.length,o=n,a=this,r=0;n>r;++r){t.push({});var s=new i(a,a.viewer.pages[r],a.showNumPages);t[r]=s,--o,0===o&&e(t)}},a.prototype.onContainerSizeChanged=function(e){this.showNumPages===!0&&this.orientation===o.ORIENTATION_HORIZONTAL&&(e.height-=20)},a.prototype.onPageClicked=function(e){this.viewer&&(this.viewer.api.goToPage(e),this.viewer.selectedPage=e)},a.prototype.clearDistantSelectedPage=function(e,t){},a.prototype.onDestroy=function(){null!=self.viewer&&(this.viewer.thumbnail=null,self.viewer=null)},a.prototype.zoomTo=function(e){this.viewer.zoomTo(e)},a}]),i.directive("itTiffViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){e.thumbnailCollapsed=!1,e.toggleThumbnail=function(){e.thumbnailCollapsed=!e.thumbnailCollapsed},t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div ui-layout="{ flow : \'column\', dividerSize : 0 }" class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar != false"></it-progressbar-viewer><it-toolbar-viewer  api="options.$$api" ng-if="options.showToolbar != false"></it-toolbar-viewer><div ng-if="options.showThumbnail != false" collapsed="thumbnailCollapsed" ui-layout-container size="210px" class="thumbnail-menu"><it-thumbnail-menu-viewer orientation="\'vertical\'" options="options"><div class="ui-splitbar-container-column pull-right"  ng-click="toggleThumbnail()"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-left"></span></div></it-thumbnail-menu-viewer></div><div ui-layout-container><tiff-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.$$api" options="options"></tiff-viewer></div><div class="ui-splitbar-container-column pull-left"  ng-click="toggleThumbnail()" ng-if="thumbnailCollapsed"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-right"></span></div></div>',link:i}}]),i.factory("TIFFPage",["$log","$timeout","MultiPagesPage","MultiPagesConstants",function(e,t,i,n){function o(e,t,n,o){this.base=i,this.base(e,t,o),this.getSrc=n}return o.prototype=new i,o.prototype.renderPage=function(e,i){var o=this;if(e.canvasRendered)e.wrapper.append(e.canvas);else{e.wrapper.append(e.canvas);var a=e.canvas[0].getContext("2d");a.transform.apply(a,e.viewport.transform);var r=new Image;r.onload=function(){a.drawImage(r,0,0),i&&i(e,n.PAGE_RENDERED)},t(function(){void 0==o.src&&(o.src=o.getSrc(e.pageIndex)),r.src=o.src},50)}},o}]).factory("TIFFViewer",["$log","MultiPagesViewerAPI","TIFFPage","MultiPagesViewer",function(e,t,i,n){function o(e){this.base=n,this.base(new t(this),e),this.tiff=null}try{Tiff.initialize({TOTAL_MEMORY:167772160})}catch(a){e.debug("Lib tiff throw exception on set TOTAL_MEMORY : "+a)}return o.prototype=new n,o.prototype.open=function(e,t){this.element.empty(),this.pages=[],angular.extend(this,t);var i="string"!=typeof e;i?this.setFile(e):this.setUrl(e)},o.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onprogress=angular.bind(this,t.downloadProgress),i.onload=function(e){t.loadTiff(i.response)},i.send()}},o.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){t.loadTiff(e.target.result)},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},o.prototype.loadTiff=function(e){var t=this;t.onDestroy(),t.tiff=new Tiff({buffer:e}),t.getAllPages(function(e){t.pages=e,t.addPages()})},o.prototype.getAllPages=function(e){function t(e){return r.tiff.setDirectory(e),r.tiff.toDataURL()}for(var n=[],o=this.tiff.countDirectory(),a=o,r=this,s=0;o>s;++s){n.push({}),r.tiff.setDirectory(s);var l=new i(r,s,t,[0,0,r.tiff.width(),r.tiff.height()]);n[s]=l,--a,0===a&&e(n)}},o.prototype.onDestroy=function(){null!=self.tiff&&(self.tiff.close(),self.tiff=null)},o}]).directive("tiffViewer",["$log","TIFFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"="},controller:["$scope","$element",function(e,n){var o=function(t){return null===e.options||void 0===e.options?null:e.options[t]},a=function(){return{initialScale:o("initialScale"),initialMode:o("initialMode"),orientation:o("orientation"),zoomSelectionShortcutKey:o("zoomSelectionShortcutKey"),pageMargin:i}},r=new t(n);e.api=r.getAPI(),e.Open=function(e){r.open(e,a())},r.hookScope(e)}],link:function(e,t,i){i.$observe("src",e.Open),e.$watch("file",e.Open)}}}])}();