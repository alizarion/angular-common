/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * Angular-common, v1.0.0
 *Itesoft common Angularjs libs.*/
!function(){var e=angular.module("it-multi-pages-viewer",["pascalprecht.translate"]),t=angular.module("it-pdf-viewer",["it-multi-pages-viewer","ui.layout"]),i=angular.module("it-tiff-viewer",["it-multi-pages-viewer","ui.layout"]),n=angular.module("it-image-viewer",["it-multi-pages-viewer"]);angular.module("itesoft.viewer",["it-image-viewer","it-tiff-viewer","it-pdf-viewer","it-multi-pages-viewer"]);var a=angular.module("it-tab",[]),o=angular.module("itesoft",["ngSanitize","ui.bootstrap.tabs","itesoft.popup","ui.bootstrap.tpls","ngAnimate","matchMedia","ui.grid","ui.grid.pagination","ngRoute","pascalprecht.translate","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.grouping","ui.bootstrap.dropdown","LocalStorageModule","ngToast","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","ui.codemirror","it-tab","itesoft.messaging","itesoft.language","itesoft.viewer"]);o.filter("itUnicode",["$sce",function(e){return function(t){function i(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();n.length<4;)n="0"+n;n="&#x"+n+";",t+=n}return t}return e.trustAsHtml(i(t))}}]),o.directive("itCircularBtn",[function(){return{restrict:"ACE",scope:!1,transclude:!0,template:'<span class="it-circular-button-container "><button class="btn  pull-right" > <div class="it-animated-circular-button"><ng-transclude></ng-transclude></div></button> </span>'}}]),o.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,i,n){t.$watch(function(e){return e.$eval(n.itCompile)},function(n){i.html(n),e(i.contents())(t)})}}])}]),o.directive("itModalFullScreen",["$timeout","$window","$document",function(e,t,i){function n(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var a=t.getComputedStyle(e[n]),o=parseInt(a["z-index"]);(isNaN(o)?0:o)>i&&(i=o)}return i}var a='<div class="it-modal-full-screen" ng-class="$isModalOpen? $onOpenCss : \'\'"><div class="it-modal-full-screen-header pull-right"><div  ng-if="$isModalOpen"  class="it-modal-full-screen-button "><button class="btn " ng-click="$closeModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-compress"></i></div></button></div><div  ng-if="!$isModalOpen"  class="it-modal-full-screen-button "> <button class="btn pull-right"  ng-click="$openModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-expand"></i></div></button> </div></div><div  class="it-modal-full-screen-content it-fill"  ng-transclude> </div></div>';return{restrict:"EA",transclude:!0,scope:!1,template:a,link:function(a,o,r,s){var l=isNaN(parseInt(r.itZIndex))?null:parseInt(r.itZIndex);a.$onOpenCss=r.itOpenClass?r.itOpenClass:"it-modal-background";var c=isNaN(parseInt(r.itEscapeKey))?27:parseInt(r.itEscapeKey),d=angular.element(o[0].querySelector(".it-modal-full-screen")),u=angular.element(d[0]);a.$openModal=function(){a.$isModalOpen=!0;var i=document.getElementsByTagName("html"),o=t.getComputedStyle(i[0]),r=parseInt(o.top),s=parseInt(o["margin-top"]),c=parseInt(o["padding-top"]),d=(isNaN(parseInt(r))?0:parseInt(r))+(isNaN(parseInt(s))?0:parseInt(s))+(isNaN(parseInt(c))?0:parseInt(c));u.addClass("it-opened"),u.css("top",d+"px"),null!==l?u.css("z-index",l):u.css("z-index",n()+100),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)},a.$closeModal=function(){a.$isModalOpen=!1,a.$applyAsync(function(){u.removeAttr("style"),u.removeClass("it-opened"),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)})},i.on("keyup",function(e){e&&e.keyCode==c&&a.$closeModal()})}}}]),o.factory("itAmountCleanerService",["$filter",function(e){var t=["en_US","en_GB","fr_FR","de_DE","id_IT"];return{cleanAmount:function(e,i){var n=0,a=!1;return t.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(a=!0)}),0==a?(console.log("Unable to format amount for local "+i),""):(e=e.replace(/[^0-9,.]/g,""),(JSON.stringify(i)==JSON.stringify(t[2])||JSON.stringify(i)==JSON.stringify(t[4]))&&(e=e.replace(",",".")),JSON.stringify(i)==JSON.stringify(t[0])?e=e.replace(",",""):JSON.stringify(i)==JSON.stringify(t[3])&&(e=e.replace(".",""),e=e.replace(",",".")),n=parseFloat(e),console.log("result1 "+n),void 0==n&&(n=parseFloat(e)),console.log("result2 "+n),n)},formatAmount:function(i,n,a){var o="",r=!1;if(t.forEach(function(e){JSON.stringify(e)==JSON.stringify(n)&&(r=!0)}),0==r)return console.log("Unable to format amount for local "+n),"";if(void 0!=i){var s=i.toString();s=s.replace(/[^0-9,.]/g,""),(JSON.stringify(n)==JSON.stringify(t[2])||JSON.stringify(n)==JSON.stringify(t[4]))&&(s=s.replace(",","."))}return angular.isDefined(a)?(a=e("uppercase")(a),o=angular.equals(a,"TND")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:3,maximumFractionDigits:3}).format(parseFloat(s)):angular.equals(a,"JPY")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:0,maximumFractionDigits:0}).format(parseFloat(s)):new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s))):o=new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s)),o}}}]),o.directive("itLazyGrid",["OPERATOR","NOTIFICATION_TYPE","itQueryFactory","itQueryParamFactory","itAmountCleanerService","localStorageService","$rootScope","$log","$q","$templateCache","$timeout",function(e,t,i,n,a,o,r,s,l,c,d){return{restrict:"AE",scope:{options:"="},template:'<div ui-grid="lazyGrid.fields.gridOptions"  ui-grid-selection ui-grid-pagination ui-grid-auto-resize="true" class="it-fill it-sp-lazy-grid"><div class="it-watermark sp-watermark gridWatermark" ng-show="!lazyGrid.fields.gridOptions.data.length"> {{\'GLOBAL.NO_DATA\' |translate}} </div> </div> <!------------------------------------------------------------------------------------------------------------------------------- FILTER --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="dropDownFilter.html"> <div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"> <it-autocomplete name="autocomplete" items="colFilter.options.data" selected-option="colFilter.term" input-class="col.headerCellClass" option-container-class="colFilter.class"> </div> </script> <script type="text/ng-template" id="dateRangeFilter.html"> <div class="ui-grid-filter-container"> <span class="{{col.headerCellClass}}"> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[0].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[0].emptyOption | translate}}" ng-model="col.filters[0].term" data-min-date="{{col.filters[0].dateMin}}" data-max-date="{{col.filters[1].term}}" data-autoclose="1" name="date" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[1].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[1].emptyOption | translate}}" ng-model="col.filters[1].term" data-min-date="{{col.filters[0].term}}" data-max-date="{{col.filters[1].dateMax}}" data-autoclose="1" name="date2" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> </span></div> </script> <script type="text/ng-template" id="stringFilter.html"> <div class="ui-grid-filter-container {{col.headerCellClass}}" ng-repeat="colFilter in col.filters"> <input type="text" class="form-control" ng-model="colFilter.term" pattern="{{colFilter.pattern}}" placeholder="{{colFilter.emptyOption | translate}}" maxlength="{{colFilter.maxLength}}"> </div> </script> <!------------------------------------------------------------------------------------------------------------------------------- PAGINATOR --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="paginationTemplate.html"> <div role="contentinfo" class="ui-grid-pager-panel" ui-grid-pager ng-show="grid.options.enablePaginationControls"> <div role="navigation" class="ui-grid-pager-container"> <div role="menubar" class="ui-grid-pager-control"> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-first it-sp-grid-pager-first " ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="first-bar"> </div> </div> <input type="button" title="" ng-click="pageFirstPageClick()" > </input></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.PREVPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-previous it-sp-grid-pager-previous" ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="prev-triangle"> </div> </div><input type="button" title="" ng-click="pagePreviousPageClick()"/></label><input type="number" class="ui-grid-pager-control-input it-sp-grid-pager-control-input" ng-model="grid.options.paginationCurrentPage" min="1" max="{{ paginationApi.getTotalPages() }}" required/> <span class="ui-grid-pager-max-pages-number it-sp-grid-pager-max-pages-number" ng-show="paginationApi.getTotalPages() > 0"> <abbr> / </abbr> {{ paginationApi.getTotalPages() }} </span> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.NEXTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-next it-sp-grid-pager-next" ng-disabled="cantPageForward()"><div class="last-triangle"> <div class="next-triangle"> </div> </div><input type="button" title="" ng-click="pageNextPageClick()"/></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.LASTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-last it-sp-grid-pager-last" ng-disabled="cantPageToLast()"><div class="last-triangle"> <div class="last-bar"> </div> </div><input type="button" title="" ng-click="pageLastPageClick()"/></label> </div> <div class="ui-grid-pager-row-count-picker it-sp-grid-pager-row-count-picker" ng-if="grid.options.paginationPageSizes.length > 1"> <select ui-grid-one-bind-aria-labelledby-grid="\'items-per-page-label\'" ng-model="grid.options.paginationPageSize" ng-options="o as o for o in grid.options.paginationPageSizes"></select><span ui-grid-one-bind-id-grid="\'items-per-page-label\'" class="ui-grid-pager-row-count-label"> &nbsp; </span> </div> <span ng-if="grid.options.paginationPageSizes.length <= 1" class="ui-grid-pager-row-count-label it-sp-grid-pager-row-count-label"> {{grid.options.paginationPageSize}}&nbsp;{{sizesLabel}} </span> </div> <div class="ui-grid-pager-count-container"><div class="ui-grid-pager-count"> <span class="it-sp-grid-pager-footer-text" ng-show="grid.options.totalItems > 0"> {{\'PAGINATION.INVOICE.FROM\' | translate}} {{showingLow}} <abbr> </abbr> '+"{{'PAGINATION.INVOICE.TO' | translate}} {{showingHigh}} {{'PAGINATION.INVOICE.ON' | translate}} {{grid.options.totalItems}} {{'PAGINATION.INVOICE.TOTAL' | translate}} </span> </div> </div> </div> </script>",controllerAs:"lazyGrid",controller:["$scope",function(t){function r(){s.debug("LazyGrid:Apply External filter"),angular.forEach(T.fields.externalFilter,function(e,t){if(!angular.isUndefined(t)&&!angular.isUndefined(e.value)&&!angular.isUndefined(e.condition)){var i=n.create(t,e.value,e.condition);T.fields.filter.push(i)}})}function l(){s.debug("LazyGrid:Apply filter");var t="",i="",o=e.EQUALS;if(angular.isDefined(T.fields.gridApi.grid))for(var r=0;r<T.fields.gridApi.grid.columns.length;r++){t=T.fields.gridApi.grid.columns[r].field;for(var l=0;l<T.fields.gridApi.grid.columns[r].filters.length;l++)if(i=T.fields.gridApi.grid.columns[r].filters[l].term,void 0!=i&&""!=i){s.debug("LazyGrid:Filter changed, fieds: "+t+", and value: "+i);var c=T.fields.gridApi.grid.columns[r].filters[l].rsqlKey;void 0!=c&&(t=c),void 0!=T.fields.gridApi.grid.columns[r].filters[l].condition&&(o=T.fields.gridApi.grid.columns[r].filters[l].condition),1==T.fields.gridApi.grid.columns[r].filters[l].amount&&(i=a.cleanAmount(i,S));var d=n.create(t,i,o);T.fields.filter.push(d)}}}function u(){s.debug("LazyGrid:Apply default filter"),angular.isDefined(T.fields.gridApi.grid)&&angular.forEach(T.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&angular.isDefined(e.colDef.filters[0].defaultTerm)&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)||(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function p(){s.debug("LazyGrid:Reset Filter and Apply default filter"),angular.isDefined(T.fields.gridApi.grid)&&angular.forEach(T.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)?angular.forEach(e.colDef.filters,function(e){e.term=""}):(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function f(){}function g(){}function h(){s.debug("LazyGrid:Filter Changed"),T.fields.filter=[],angular.isDefined(T.fields.promise.refresh)&&d.cancel(T.fields.promise.refresh),T.fields.promise.refresh=d(function(){T.fn.refresh()},1e3)}function m(e,t){if(s.debug("LazyGrid:Sort Changed"),T.fields.filter=[],0==t.length)T.fields.paginationOptions.sort.name=void 0,T.fields.paginationOptions.sort.direction=void 0;else{var i=t[0].name;angular.isDefined(t[0])&&angular.isDefined(t[0].colDef)&&angular.isDefined(t[0].colDef.sorterRsqlKey)&&(i=t[0].colDef.sorterRsqlKey),T.fields.paginationOptions.sort.name=i,T.fields.paginationOptions.sort.direction=t[0].sort.direction,s.debug("sort changed, sort key: "+t[0].name+", and direction: "+t[0].sort.direction)}T.fn.refresh()}function v(e,t){s.debug("LazyGrid:Pagination Changed"),T.fields.filter=[],(T.fields.paginationOptions.pageNumber!=e||T.fields.paginationOptions.pageSize!=t)&&(T.fields.paginationOptions.pageNumber=e,T.fields.paginationOptions.pageSize=t,T.fn.refresh())}function b(){s.debug("LazyGrid:Row Selection Changed")}function C(){s.debug("LazyGrid:Refresh"),r(),l();var e=(T.fields.paginationOptions.pageNumber-1)*T.fields.paginationOptions.pageSize,t=i.create(T.fields.filter,e,T.fields.paginationOptions.pageSize,T.fields.paginationOptions.sort);T.fn.callBack(t)}function w(){s.debug("LazyGrid:Initial load"),l(),T.fields.filter.length<=0&&u(),T.fields.filter=[],T.fn.refresh()}function y(e){return angular.isUndefined(e.key)?void s.error("External filter object must have key"):angular.isUndefined(e.condition)?void s.error("External filter object must have condition"):void(angular.isUndefined(e.value)?T.fields.externalFilter[e.key]={}:T.fields.externalFilter[e.key]=e)}function E(){}var S=o.get("Locale"),T=this;T.options=t.options,T.fields={template:{pagination:c.get("paginationTemplate.html")},filter:[],externalFilter:{},gridApi:{},gridOptions:{},paginationOptions:{},appScope:{},promise:{refresh:{}}},T.on={loaded:f,ready:g,filterChange:h,sortChange:m,paginationChanged:v,rowSelectionChanged:b},T.fn={callBack:T.options.callBack,initialize:E,refresh:C,initialLoad:w,addExternalFilter:y,refreshDefaultFilter:p},T.fields.paginationOptions={pageNumber:1,pageSize:10,sort:{name:void 0,direction:void 0}},T.fields.gridOptions={enableFiltering:!0,enableSorting:!0,enableColumnMenus:!1,useExternalPagination:!0,useExternalSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!0,useExternalFiltering:!0,data:[],columnDefs:[],paginationTemplate:T.fields.template.pagination,onRegisterApi:function(e){e.core.on.filterChanged(T.appScope,T.on.filterChange),e.core.on.sortChanged(T.appScope,T.on.sortChange),e.pagination.on.paginationChanged(T.appScope,T.on.paginationChanged),e.selection.on.rowSelectionChanged(T.appScope,T.on.rowSelectionChanged),T.fields.gridApi=e,s.debug("LazyGrid:UI-grid:onRegisterApi")}},angular.isDefined(T.options.onRegisterApi)&&(T.options.onRegisterApi(T),s.debug("LazyGrid:onRegisterApi"))}]}}]).constant("OPERATOR",{EQUALS:"==",LIKE:"==%",NOT_EQUALS:"!=",LESS_THAN:"=lt=",LESS_EQUALS:"=le=",GREATER_THAN:"=gt=",GREATER_EQUALS:"=ge="}).constant("NOTIFICATION_TYPE",{INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS",DISMISS:"DISMISS"}),o.factory("itPaginatorConfigService",["$q","$log","itNotifier","$filter","MetadataService",function(e,t,i,n,a){function o(){if(r.fields.loaded)t.debug("PaginatorConfigService: loaded"),s.resolve("ok");else{var o=a.getConfig.get({type:"paginatorOptions"}).$promise,l=a.getConfig.get({type:"paginatorDefaultOption"}).$promise;e.all([o,l]).then(function(e){r.fields.defaultOption=e[1].value;var a=e[0].value;angular.isDefined(a)&&null!=a&&angular.isDefined(a.split)?r.fields.options=a.split(","):i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},a),t.debug("PaginatorConfigService: loaded"),r.fields.loaded=!0,s.resolve("ok")},function(e){i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},e.data)})}return s.promise}var r=this,s=e.defer();return r.fields={options:[],defaultOption:"",loaded:!1},r.fn={initialize:o},r}]),o.factory("itQueryParamFactory",[function(){function e(e,t,i){this.key=e,this.value=t,this.operator=i}return{create:function(t,i,n){return new e(t,i,n)}}}]),o.factory("itQueryFactory",["OPERATOR",function(e){function t(t,i,n,a){this.parameters=t,this.start=i,this.size=n,this.sort=a,this.build=function(){var o="";return void 0!=t&&this.parameters.forEach(function(t){angular.isDefined(t.value)&&angular.isDefined(t.key)&&(t.value instanceof Date&&t.operator==e.LESS_EQUALS&&(t.value.setHours(23),t.value.setMinutes(59),t.value.setSeconds(59),t.value.setMilliseconds(999)),o.length>0&&(o+=" and "),t.value instanceof Date&&(t.value=t.value.toISOString()),t.operator==e.LIKE&&(t.value=t.value+"%"),o+=t.key+t.operator+t.value)}),o="query="+o,null!=n&&angular.isDefined(n)&&""!=n&&(o+="&size="+this.size),null!=i&&angular.isDefined(i)&&""!=i&&(o+="&start="+this.start),void 0!=a&&void 0!=this.sort.name&&(o+="&sort=","desc"==this.sort.direction&&(o+="-"),o+=this.sort.name),o}}return{create:function(e,i,n,a){return new t(e,i,n,a)}}}]),o.directive("itBusyIndicator",["$timeout","$http",function(e,t){function i(i,a,o){i.$watch(function(){return t.pendingRequests.length>0},function(t){n&&e.cancel(n),t===!0?n=e(function(){i.hasPendingRequests=!0},250):i.hasPendingRequests=!1})}var n;return{link:i,restrict:"AE",transclude:!0,scope:{isBusy:"="},template:'<div class="mask-loading-container" ng-show="hasPendingRequests"></div><div class="main-loading-container" ng-show="hasPendingRequests || isBusy"><i class="fa fa-circle-o-notch fa-spin fa-4x text-primary "></i></div><ng-transclude ng-show="!isBusy" class="it-fill"></ng-transclude>'}}]),o.directive("itLoader",["$http","$rootScope",function(e,t){return{restrict:"EA",scope:!0,template:'<span class="fa-stack"><i class="fa fa-refresh fa-stack-1x" ng-class="{\'fa-spin\':$isLoading}"></i></span>',link:function(t){t.$watch(function(){e.pendingRequests.length>0?t.$applyAsync(function(){t.$isLoading=!0}):t.$applyAsync(function(){t.$isLoading=!1})})}}}]),o.directive("itDetail",[function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:' <div ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))"   ng-if="currentItemWrapper.currentItem"  class="it-master-detail-slide-left col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" > <div class="it-fill" ng-transclude></div></div><div  ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))" class="col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" ng-if="!currentItemWrapper.currentItem"><div class="it-watermark" >{{$itNoDetail}}</div></div>'}}]),o.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill"> <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),o.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!1,transclude:!0,template:'<div class="fluid-container"><div class="row it-md-header"><div class="col-md-2 it-fill  col-xs-2"><a href="" ng-if="$parent.$parent.$parent.mobile" ng-click="$parent.$parent.$parent.$parent.goToMaster()" class="it-material-design-hamburger__icon pull-left it-fill "> <span  class="menu-animated it-material-design-hamburger__layer " ng-class="{\'it-material-design-hamburger__icon--to-arrow\':$parent.$parent.$parent.$parent.mobile}"> </span> </a></div><div class="col-md-10 col-xs-10 it-fill "><div class="btn-toolbar  it-fill pull-right " ng-transclude></div></div></div></div>'}}),o.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",priority:-1,transclude:!0,scope:{itMasterData:"=",itLang:"=",itCol:"=",itMasterDetailControl:"=",itLockOnChange:"=",itNoDataMsg:"@",itNoDetailMsg:"@"},template:'<div  ng-show="($parent.$parent.activeState == \'master\')" class=" it-master it-master-detail-slide-right col-md-{{itCol ? itCol : 6}} it-fill " ui-i18n="{{itLang}}"><div class="row" ng-transclude></div><div class="row it-master-grid it-fill" ><div class="col-md-12 it-fill"><div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns  ui-grid-move-columns  ui-grid-auto-resize class="it-master-detail-grid it-fill "><div class="it-watermark" ng-show="!gridOptions.data.length" >{{itNoDataMsg}}</div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache","$route","$window",function(e,t,i,n,a,o,r,s){function l(t){var i=this;angular.forEach(e.itMasterData,function(e,n){angular.equals(e,t)&&(i.index=n)}),i.originalItem=t,i.currentItem=angular.copy(t),i.hasChanged=!1,i.isWatched=!1,i.unlockOnEquals=!0}function c(t){e.itMasterDetailControl.disableMultiSelect||(e.gridApi.selection.getSelectedRows().length>1?e.$parent.currentItemWrapper=null:1===e.gridApi.selection.getSelectedRows().length?(d(e.gridApi.selection.getSelectedRows()[0]),u(e.gridApi.selection.getSelectedRows()[0])):0===e.gridApi.selection.getSelectedRows().length&&(e.$parent.currentItemWrapper=null))}function d(t){var n=i.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange?(n.reject("undo or save before change"),n.promise):(e.$parent.currentItemWrapper=new l(t),n.resolve(""),n.promise)}function u(t){e.gridApi.core.scrollTo(t)}function p(){e.$applyAsync(function(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)})}function f(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange&&(a.alert(e.itMasterDetailControl.navAlert),t.preventDefault())}o.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input type="checkbox" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange " tabindex="-1"  ng-checked="row.isSelected"></div>'),o.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="(grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange  )? \'return false\':headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged  && grid.appScope.itLockOnChange" ng-model="grid.selection.selectAll"></div>'),e.$parent.$masterCol=e.itCol,l.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},l.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.$parent.$itNoDetail=e.itNoDetailMsg,e.gridOptions={rowHeight:40,data:e.itMasterData,multiSelect:!e.itMasterDetailControl.disableMultiSelect,enableSelectAll:!e.itMasterDetailControl.disableMultiSelect,enableRowHeaderSelection:!e.itMasterDetailControl.disableMultiSelect,showGridFooter:!0,enableMinHeightCheck:!0,enableColumnResizing:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(e){c(e)}),t.selection.on.rowSelectionChangedBatch(e,function(e){c(e)})},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span ng-show="!grid.appScope.itMasterDetailControl.disableMultiSelect" class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},"undefined"!=typeof e.itMasterDetailControl.columnDefs&&angular.forEach(e.itMasterDetailControl.columnDefs,function(e){e.headerCellTemplate='<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.onRowClick=function(t,i){void 0!=i.entity&&"undefined"!=typeof t.providedHeaderCellTemplate&&d(i.entity).then(function(n){"ui-grid/selectionHeaderCell"!==t.providedHeaderCellTemplate&&(e.gridApi.selection.clearSelectedRows(),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail()),e.gridApi.selection.toggleRowSelection(i.entity),e.$emit("MASTER_ROW_CHANGED",i.entity)},function(t){a.alert(e.itMasterDetailControl.navAlert)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.refreshData=function(){var i=t("itUIGridGlobalFilter")(e.gridOptions.data,e.gridOptions,e.filterText);angular.forEach(e.gridApi.grid.rows,function(t){var n=!1;i.forEach(function(e){angular.equals(t.entity,e)&&(n=!0)}),n?e.gridApi.core.clearRowInvisible(t):e.gridApi.core.setRowInvisible(t)})},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),p())},e.$on("unlockCurrentItem",function(){p()}),e.itMasterDetailControl.scrollToItem=function(e){u(e)},e.itMasterDetailControl.getSelectedItems=function(){return"undefined"!=typeof e.gridApi&&"function"==typeof e.gridApi.selection.getSelectedRows?e.gridApi.selection.getSelectedRows():[]},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){var t=e.gridApi.core.getVisibleRows(e.gridApi.grid),i=[];return angular.forEach(t,function(e){i.push(e.entity)}),i},e.itMasterDetailControl.setCurrentItem=function(t){var a=i.defer();return e.gridApi.selection.clearSelectedRows(),d(t).then(function(){n(function(){var i=e.itMasterData.indexOf(t);i>=0?(e.gridApi.selection.selectRow(t),u(t),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail(),a.resolve()):a.reject()})},function(){a.reject()}),a.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.$on("unlockCurrentItem",function(){n(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){n(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.itAppScope.$navAlert=e.itMasterDetailControl.navAlert;var g=angular.element(s);g.bind("resize",function(){e.gridApi.core.handleWindowResize()}),e.itMasterDetailControl.initState=!0,e.$on("$locationChangeStart",f),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes",buttons:[{text:"OK",type:"btn-info",onTap:function(){return!1}}]}},e.itMasterDetailControl),e.$watch("itLang",function(){e.gridApi.grid.refresh()}),e.$watch("itMasterData",function(){e.gridOptions.data=[],e.itMasterData.forEach(function(t){e.gridOptions.data.push(t)}),"undefined"==typeof e.itMasterData||null===e.itMasterData?e.$parent.currentItemWrapper=null:0===e.itMasterData.length&&(e.$parent.currentItemWrapper=null),e.gridApi.grid.refresh(),null!==e.itMasterDetailControl&&"undefined"!=typeof e.itMasterDetailControl.getCurrentItemWrapper()&&null!=e.itMasterDetailControl.getCurrentItemWrapper()&&e.$applyAsync(function(){u(e.itMasterDetailControl.getCurrentItemWrapper().originalItem)}),e.refreshData()},!0),n(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),s.dispatchEvent(e)},250),e.$watch("$parent.currentItemWrapper.currentItem",function(t,i){null!=e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.unlockOnEquals?e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem):e.$parent.currentItemWrapper.hasChanged=!0)},!0),e.$watch("filterText",function(){e.refreshData()},!0),e.$watch("itNoDetailMsg",function(){e.$parent.$itNoDetail=e.itNoDetailMsg})}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,i,n){function a(e,t){var i,n=t.split("."),a=e;for(i=0;i<n.length;++i){if(void 0==a[n[i]])return void 0;a=a[n[i]]}return a}var o=[];if(void 0===n||""===n)return t;n=n.toLowerCase();for(var r=e.$new(!0),s=0;s<t.length;s++)for(var l=0;l<i.columnDefs.length;l++){var c=t[s],d=i.columnDefs[l].field,u=a(c,d);if(i.columnDefs[l].cellFilter&&(r.value=u,u=r.$eval("value | "+i.columnDefs[l].cellFilter)),"undefined"!=typeof u&&null!=u&&u.toString().toLowerCase().indexOf(n)>-1){o.push(c);break}}return r.$destroy(),o}}]),o.directive("itMasterDetail",["itPopup","$timeout","$window",function(e,t,i){return{restrict:"EA",transclude:!0,scope:!0,template:'<div it-bottom-glue="" class="it-master-detail-container jumbotron "> <div class="it-fill row " ng-transclude></div></div>',controller:["$scope","screenSize",function(n,a){
n.activeState="master",n.desktop=a.on("md, lg",function(e){n.desktop=e}),n.mobile=a.on("xs, sm",function(e){n.mobile=e}),n.goToDetail=function(){n.activeState="detail"},n.$watch("mobile",function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper?n.activeState="detail":n.activeState="master"}),n.$watch("$$childHead.currentItemWrapper",function(){!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!==n.$$childHead.currentItemWrapper?!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper.currentItem&&null!==n.$$childHead.currentItemWrapper.currentItem||(n.activeState="master"):n.activeState="master"}),n.goToMaster=function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper&&n.$$childHead.currentItemWrapper.hasChanged&&n.$$childHead.$$childHead.itLockOnChange?e.alert(n.$$childHead.$navAlert):(n.activeState="master",t(function(){i.dispatchEvent(new Event("resize"))},300))}}]}}]),o.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:'<div class="fuild-container">   <div class="row it-fill">   <div class="it-md-header col-xs-12 col-md-12"><div class="btn-toolbar it-fill" ng-transclude></div></div><div class="col-xs-12 col-md-12 pull-right"><div><form><div class="form-group has-feedback it-master-header-search-group  col-xs-12 col-md-{{$parent.itCol < 4 ? 12 :6 }} pull-right" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  class="form-control " type="text" ng-model="$parent.filterText" class="form-control floating-label"  placeholder="{{placeholderText}}"/></div></form></div></div></div></div>',link:function(e,t,i){e.$watch(function(){return i.itSearchPlaceholder},function(t){e.placeholderText=t})}}}),o.directive("itAutocomplete",function(){return{restrict:"AE",scope:{items:"=",itemsGetter:"&?",selectedOption:"=",inputClass:"=",optionClass:"=",optionContainerClass:"=",converter:"=",searchMode:"=",placeholder:"=",options:"=",onChange:"&",onFocus:"&?",onBlur:"&?",eventSelect:"=",eventRefresh:"=",name:"=",disabled:"=",readonly:"="},controllerAs:"itAutocompleteCtrl",controller:["$scope","$rootScope","$translate","$document","$timeout","$log","itStringUtilsService",function(e,t,i,n,a,o,r){function s(){P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: focusIndex value changed  -> "+e.focusIndex),e.focusIndex<0?e.focusIndex=-1:e.focusIndex>=P.fields.items.length&&(e.focusIndex=P.fields.items.length-1),angular.isDefined(P.fields.items)&&P.fields.items[e.focusIndex]!=P.selectedItem&&u(P.fields.items[e.focusIndex])}function l(e){e=S(e);var t=!1;P.fields.selectedItem={},angular.isDefined(e)&&(P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: select with  id "+e),angular.forEach(P.fields.items,function(i){S(i)==e&&(p(i),t=!0)}),t||d())}function c(){angular.isDefined(e.items)?P.fields.items=angular.copy(e.items):P.fields.items=angular.copy(e.itemsGetter({param:P.fields.event.refresh.value})),P.fields.initialItems=angular.copy(P.fields.items),P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: copy option items "+P.fields.initialItems)}function d(){P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: init select ");var e=0;angular.forEach(P.fields.items,function(t){angular.isDefined(P.fields.selectedItem)&&P.fields.selectedItem==t&&u(t),e++})}function u(i){angular.isDefined(i)?(p(i),P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: select "+JSON.stringify(i)),P.fields.converter?e.selectedOption=T(i):e.selectedOption=S(i)):(P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: select empty"),e.selectedOption=void 0),P.fields.event.select&&(P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: emit select event "+e.selectedOption),t.$emit(P.fields.event.select,e.selectedOption))}function p(t){if(angular.isDefined(t)){P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: applySelection "+JSON.stringify(t));var i=I(t);e.focusIndex!=i&&(e.focusIndex=i,s()),P.fields.inputSearch=E(t),P.fields.selectedItem=T(t);var a=n[0].querySelector("#options_"+r.cleanDomRef.encode(S(P.fields.selectedItem)+""));f(a,t)}else P.fields.selectedItem=void 0,e.focusIndex=-1,s()}function f(e,t){var i=n[0].querySelector("#"+P.fields.optionContainerId);P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: scrollTo #"+P.fields.optionContainerId+" to: "+e),angular.isDefined(i)&&null!=i&&(i.scrollTop=20*(I(t)+1)-i.getBoundingClientRect().height)}function g(t){o.debug(P.fields.name+" itAutocomplete: hide "+P.fields.selectedItem),angular.isUndefined(t)?(P.fields.showItems=!1,angular.isDefined(P.fields.selectedItem)&&(P.fields.inputSearch=E(P.fields.selectedItem))):document.activeElement.classList.contains("it-autocomplete-container")?e.$applyAsync(function(){t.srcElement.focus()}):(P.fields.showItems=!1,angular.isDefined(P.fields.selectedItem)&&(P.fields.inputSearch=E(P.fields.selectedItem)))}function h(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function m(e){if(angular.isDefined(e)&&-1!=h()){var t=e.srcElement.parentElement.children[1],i=angular.element(e.srcElement.parentElement)[0];if(angular.isDefined(t)&&angular.isDefined(i)&&"fixed"==t.currentStyle.position){var n=i.getBoundingClientRect().top+i.getBoundingClientRect().height;t.style.setProperty("top",n+"px")}}P.fields.showItems=!0}function v(e){if(o.debug(P.fields.name+" itAutocomplete: input search change value "+e+"->"+P.fields.inputSearch),P.fields.items=[],""==P.fields.inputSearch)u(void 0),c(),d();else{var t=0;angular.forEach(P.fields.initialItems,function(e){"startsWith"==P.fields.searchMode?r.clear(E(e)).startsWith(r.clear(P.fields.inputSearch))&&(P.fields.items.push(e),t++):"custom"==P.fields.searchMode?angular.isUndefined(P.fn.searchPredicate)?o.error(P.fields.name+" When using searchMode = custom, you need to add a searchPredicate function by adding  self.fn.searchPredicate = function (inputValue,item) "):P.fn.searchPredicate(P.fields.inputSearch,e)&&(P.fields.items.push(e),t++):-1!=r.clear(E(e)).search(r.clear(P.fields.inputSearch))&&(P.fields.items.push(e),t++)}),1==P.fields.items.length&&u(P.fields.items[0])}m()}function b(t){g(t),e.onBlur&&e.onBlur()}function C(t){m(t),e.onFocus&&e.onFocus()}function w(t){var i=t.keyCode;e.keys.forEach(function(e){e.code===i&&e.action()})}function y(){var e=(new Date).getTime(),t="option_container_xxxxxxxxxxxx4yxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}function E(e){var t="";return t=angular.isDefined(P.fields.converter)&&P.fields.converter.getLabelFromObject?P.fields.converter.getLabelFromObject(e):e.value}function S(e){var t="";if(angular.isDefined(P.fields.converter)&&P.fields.converter.getIdFromObject)t=P.fields.converter.getIdFromObject(e);else{if(!e||!angular.isDefined(e)||"object"!=typeof e)return e;t=e.id}return t}function T(e){var t={};return t=angular.isDefined(P.fields.converter)&&P.fields.converter.getObject?P.fields.converter.getObject(e):e}function I(e){return P.fields.items.indexOf(e)}var P=this;P.options=e.options,P.fields={items:[],inputSearch:"",showItems:!1,optionClass:e.optionClass,optionContainerClass:e.optionContainerClass,inputClass:e.inputClass,defaultSelectClass:"",selectedSelectClass:"",selectedItem:{},searchMode:e.searchMode,placeholder:e.placeholder,debug:!1,converter:e.converter,disabled:!1,readonly:!1,event:{refresh:{name:e.eventRefresh,value:void 0},select:e.eventSelect}},angular.isUndefined(P.fields.optionClass)&&(P.fields.optionClass=""),angular.isUndefined(P.fields.optionContainerClass)&&(P.fields.optionContainerClass=""),angular.isUndefined(P.fields.inputClass)&&(P.fields.inputClass="it-autocomplete-input-class it-autocomplete-input"),angular.isUndefined(P.fields.placeholder)&&(P.fields.placeholder=""),angular.isDefined(e.disabled)&&(P.fields.disabled=!0),angular.isDefined(e.readonly)&&(P.fields.readonly=!0),P.fields.optionContainerClass=P.fields.optionContainerClass+" it-autocomplete-container",P.fields.defaultSelectClass=P.fields.optionClass+" it-autocomplete-select",P.fields.selectedSelectClass=P.fields.defaultSelectClass+" it-autocomplete-selected",P.fields.optionContainerId=y(),angular.isUndefined(P.fields.name)?P.fields.name=P.fields.optionContainerId:P.fields.name=P.fields.name,P.fn={select:u,change:v,blur:b,focus:C,init:d,fullInit:c,hideItems:g,showItems:m,getIdFromObject:S,getLabelFromObject:E,keyBoardInteration:w},P.on={},angular.isDefined(e.items)&&angular.isDefined(e.itemsGetter)&&o.error(P.fields.name+" Autocomplete must use items or items-getter, you are not allowed to use both"),angular.isUndefined(e.items)&&angular.isUndefined(e.itemsGetter)&&o.error(P.fields.name+" Autocomplete must use items or items-getter, you need to add one parameter"),angular.isDefined(P.options)&&angular.isDefined(P.options.onRegisterApi)&&P.options.onRegisterApi(P),c(),d(),e.focusIndex=-1,s(),l(e.selectedOption),P.fields.event.refresh.name?t.$on(P.fields.event.refresh.name,function(e,t){P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: refresh event emit, calling refresh items "),P.fields.event.refresh.value=t,c(),g(),d()}):(P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: refresh event is not defined, add watch to items"),e.$watch("items",function(t,i){t!=P.fields.item&&(P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: items value changed "+t+" "+i),c(),d(),l(e.selectedOption),g())})),e.$watch("selectedOption",function(t,i){e.onChange&&e.onChange(),P.fields.debug&&o.debug(P.fields.name+" itAutocomplete: selectedOption value changed "+i+" -> "+t),(angular.isUndefined(P.fields.selectedItem)||t!=S(P.fields.selectedItem))&&l(t)}),e.keys=[];var A=13,k=38,O=40,$=8,D=27;e.keys.push({code:A,action:function(){P.fields.showItems?g():(m(),""==P.fields.inputSearch&&(e.focusIndex=-1,s()))}}),e.keys.push({code:$,action:function(){P.fields.inputSearch="",e.focusIndex=-1,s(),v()}}),e.keys.push({code:k,action:function(){m(),e.focusIndex--,s()}}),e.keys.push({code:O,action:function(){m(),e.focusIndex++,s()}}),e.keys.push({code:D,action:function(){P.fields.showItems&&g()}})}],template:'<div class="col-xs-12 it-autocomplete-div"><div class="it-autocomplete-div-visible" >    <input ng-disabled="itAutocompleteCtrl.fields.disabled" ng-focus="itAutocompleteCtrl.fn.focus($event)" ng-readonly="itAutocompleteCtrl.fields.readonly" placeholder="{{itAutocompleteCtrl.fields.placeholder}}" ng-keydown="itAutocompleteCtrl.fn.keyBoardInteration($event)"ng-blur="itAutocompleteCtrl.fn.blur($event);" type="text" class="form-control it-autocomplete-input" ng-class="inputClass" ng-change="itAutocompleteCtrl.fn.change($event)" ng-model="itAutocompleteCtrl.fields.inputSearch">    <div class="it-autocomplete-btn"  ng-disabled="itAutocompleteCtrl.fields.disabled" ng-click="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" > &#9679;&#9679;&#9679;</div></div>   <div  ng-class="itAutocompleteCtrl.fields.optionContainerClass" id="{{itAutocompleteCtrl.fields.optionContainerId}}" ng-show="itAutocompleteCtrl.fields.showItems" >       <div class="it-autocomplete-content"  ng-repeat="item in itAutocompleteCtrl.fields.items">           <div class=" {{item == itAutocompleteCtrl.fields.selectedItem?itAutocompleteCtrl.fields.selectedSelectClass: itAutocompleteCtrl.fields.defaultSelectClass}}"               id="{{\'options_\'+itAutocompleteCtrl.itStringUtilsService.cleanDomRef.encode(itAutocompleteCtrl.fn.getIdFromObject(item))}}"                 ng-mousedown="itAutocompleteCtrl.fn.select(item)">               {{itAutocompleteCtrl.fn.getLabelFromObject(item)}}           </div>       </div>   </div></div>'}}),o.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="checkbox"></div>'),n.wrap("<label></label>"),n.after('<span class="checkbox-material"><span class="check" style="margin-right:16px;width: '+i.width+";height:"+i.height+';"></span></span>&nbsp;'+(i.itLabel||""))}}}),o.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,i,n){if(n){var a=angular.element(t[0]);if(a.hasClass("floating-label")){a.wrap('<div class="form-control-wrapper"></div>');var o=a.attr("placeholder");o?a.after('<div class="floating-label">'+o+"</div"):(a.after('<div class="floating-label">'+e.itLabel+"</div"),e.$watch("itLabel",function(t){e.$applyAsync(function(){if(a[0].offsetParent){var e=a[0].offsetParent.children;angular.forEach(e,function(e){var i=angular.element(e);i.hasClass("floating-label")&&i.text(t)})}})})),a.after('<span class="material-input"></span>'),a.attr("placeholder","").removeClass("floating-label")}a.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(a[0].offsetParent){var t=a[0].offsetParent.children;angular.forEach(t,function(t){var i=angular.element(t);i.hasClass("text-danger")&&(i.text(e),""!=e&&void 0!=e?(i.removeClass("ng-hide"),i.addClass("ng-show"),i.css("display","block")):(i.removeClass("ng-show"),i.addClass("ng-hide"),i.css("display","none")))})}}),(null===a.val()||"undefined"==a.val()||""===a.val())&&a.addClass("empty"),e.$watch(function(){return n.$modelValue},function(e,t){null===e||void 0==e||""===e?a.addClass("empty"):a.removeClass("empty")}),a.on("change",function(){null===a.val()||"undefined"==a.val()||""===a.val()?a.addClass("empty"):a.removeClass("empty")})}},scope:{itError:"=",itLabel:"@"}}}),o.directive("itSearch",function(){return{restrict:"A",replace:!0,scope:{itSearchControl:"="},link:function(e,t,i){var n=angular.element(t[0]);n.after('<span class="glyphicon glyphicon-search form-control-feedback"/>')},controller:["$scope",function(e){e.itSearchControl.multicolumnsFilter=function(t){var i=new RegExp(e.itSearchControl.filterText,"i"),n=[],a=!1;return e.itSearchControl.columnDefs&&t.forEach(function(t){var o=!1;t.entity?(e.itSearchControl.columnDefs.forEach(function(n){if(!o&&t.entity[n.field]){var a=t.entity[n.field].toString();n.cellFilter&&(e.value=a,a=e.$eval("value | "+n.cellFilter)),"undefined"!=typeof a&&null!=a&&a.match(i)&&(o=!0)}}),o||(t.visible=!1)):(a=!0,e.itSearchControl.columnDefs.forEach(function(e){!o&&t[e.field]&&t[e.field].toString().match(i)&&(o=!0)}),o&&n.push(t))}),a&&(t=n),t}}]}}),o.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="togglebutton"></div>'),void 0==e.itLabel?(n.wrap("<label></label>"),n.after('<span class="toggle"></span>')):(n.wrap("<label></label>"),n.after('<span class="toggle"></span><span>'+(e.itLabel||"")+"</span>"),e.$watch("itLabel",function(e){if(e&&n.context){var t=angular.element(n.context.parentNode);if(t&&i.itLabel){var a=angular.element(t.get(0).firstChild);a.get(0).textContent=e+"  "}}}))},scope:{itLabel:"@"}}}]),angular.module("itesoft.viewer").directive("itInclude",["$timeout","$compile",function(e,t){var i=function(i,n,a){var o;i.$watch(a.itInclude,function(a){e(function(){o&&o.$destroy(),o=i.$new(),n.html(a||""),t(n.contents())(o)},50)})};return{restrict:"AE",link:i}}]),angular.module("itesoft.viewer").directive("itMediaViewer",["itScriptService",function(e){var t=function(e,t){if(void 0!=e){var i=e.split(t);return i[i.length-1]}return e},i=function(i,n,a){var o=function(t,n){var a=(i.options?i.options.libPath:null)||"assets/Scripts/vendor";switch(t){case"pdf":i.pdfSrc=n,e.LoadScripts([a+"/pdf.js"]).then(function(){PDFJS.workerSrc=a+"/pdf.worker.js",i.template='<it-pdf-viewer src="pdfSrc" options="options"></it-pdf-viewer>'});break;case"png":case"jpeg":case"jpg":i.imageSrc=n,i.template='<it-image-viewer src="imageSrc" options="options"></it-image-viewer>';break;case"tif":case"tiff":i.tiffSrc=n,e.LoadScripts([a+"/tiff.min.js"]).then(function(){i.template='<it-tiff-viewer src="tiffSrc" options="options"></it-tiff-viewer>'});break;default:i.options&&i.options.onTemplateNotFound&&i.options.onTemplateNotFound(t),$log.debug("No template found for extension : "+t),i.template=null}},r=function(e,n){e?"string"==typeof e?(i.ext=t(e,".").toLowerCase(),o(i.ext,e)):a.type?o(a.type.toLowerCase(),e):void 0!=e.name?(i.ext=t(t(e.name,"."),"/").toLowerCase(),o(i.ext,e)):($log.debug("must specify type when using stream"),i.template=null):e!=n&&(i.template=null)};i.$watch("src",r),i.$watch("file",r)};return{scope:{src:"=",file:"=",type:"@",options:"="},restrict:"E",template:'<div it-include="template"></div>',link:i}}]),angular.module("itesoft.viewer").factory("itScriptService",["$log","$window","$q",function(e,t,i){var n={},a={},o=i.defer(),r=i.defer(),s=function(e){if(e){if(void 0!=n[e])return n[e];var t=i.defer(),a=document.createElement("script");return n[e]=t.promise,a.src=e,a.type="text/javascript",a.onload=function(){t.resolve(a)},document.head.appendChild(a),t.promise}return o.resolve(),o.promise},l=function(e){if("string"==typeof e)return s(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(s(e))}),i.all(t)}return r.resolve(),r.promise},c=function(e){if(e){if(void 0!=a[e])return a[e];var t=i.defer(),n=document.createElement("link");return a[e]=t.promise,n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=function(){t.resolve(n)},document.head.appendChild(n),t.promise}return o.resolve(),o.promise},d=function(e){if("string"==typeof e)return c(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(c(e))}),i.all(t)}return r.resolve(),r.promise},u=function(e,t){return i.all([l(e),d(t)])};return{LoadScripts:u}}]),o.directive("konami",["$document","$uibModal",function(e,t){return{restrict:"A",template:'<style type="text/css"> @-webkit-keyframes easterEggSpinner { from { -webkit-transform: rotateY(0deg); } to { -webkit-transform: rotateY(-360deg); } } @keyframes easterEggSpinner { from { -moz-transform: rotateY(0deg); -ms-transform: rotateY(0deg); transform: rotateY(0deg); } to { -moz-transform: rotateY(-360deg); -ms-transform: rotateY(-360deg); transform: rotateY(-360deg); } } .easterEgg { -webkit-animation-name: easterEggSpinner; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite; -webkit-animation-duration: 6s; animation-name: easterEggSpinner; animation-timing-function: linear; animation-iteration-count: infinite; animation-duration: 6s; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d; } .easterEgg img { position: absolute; border: 1px solid #ccc; background: rgba(255,255,255,0.8); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); } </style>',link:function(i){var n=[38,38,40,40,37,39,37,39,66,65],a=0,o=function(r){if(r.keyCode===n[a++]){if(a===n.length){e.off("keydown",o);var s=t.open({template:'<div style="max-width: 100%;" class="easterEgg"> <img style="-webkit-transform: rotateY(0deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-72deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-144deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-216deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-288deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> </div>',size:"lg"});i.cancel=function(){s.dismiss("cancel")}}}else a=0};e.on("keydown",o),i.$on("$destroy",function(){e.off("keydown",o)})}}}]),o.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,i){function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return a[e]})}var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(n(t[0].innerHTML))}}}}]),o.directive("itBottomGlue",["$window","$timeout",function(e,t){return function(i,n){function a(){for(var t=n[0],i=angular.element(n)[0],a=0,o=0,r=0,s=0;null!==t&&"undefined"!=typeof t;){var l=e.getComputedStyle(t),c=parseInt(l["margin-bottom"],10),d=parseInt(l["padding-bottom"],10),u=parseInt(l["padding-top"],10),p=parseInt(l["margin-top"],10);s+=isNaN(p)?0:p,a+=isNaN(c)?0:c,o+=isNaN(d)?0:d,r+=isNaN(u)?0:u,t=t.parentElement}var f=e.getComputedStyle(n[0]),g=parseInt(f["padding-bottom"],10),h=i.getBoundingClientRect();n.css("height",e.innerHeight-h.top-a-(o-g)+"px"),n.css("overflow-y","auto")}t(function(){a(),e.addEventListener("resize",function(){a()})},250)}}]),o.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,i){var n=angular.element(t[0].querySelector("ul")),a=angular.element(t[0].querySelector("a"));n.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var o=angular.element(t[0].querySelector("h5")),r=angular.element('<i class="pull-right fa fa-angle-right" ></i>');o.append(r),a.on("click",function(){n.hasClass("it-side-menu-collapse")?(n.removeClass("it-side-menu-collapse"),n.addClass("it-side-menu-expanded"),r.removeClass("fa-angle-right"),r.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),r.addClass("fa-angle-right"),r.removeClass("fa-angle-down"),n.removeClass("it-side-menu-expanded"),n.addClass("it-side-menu-collapse"))})}}}),o.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,i,n){function a(){var t=e.path();t&&angular.forEach(i.find("li"),function(e){var i=e.querySelector("a");i.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(o):angular.element(e).removeClass(o)})}var o=n.itActive||"active";a(),t.$on("$locationChangeSuccess",a)}}}]),o.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e,t,i){function n(){e.$itSideMenuWidth=i.itWidth?i.itWidth:260,e.sideMenuCalc1={width:1*e.itSideMenuWidth+50+"px"},e.sideMenuCalc2={width:e.$itSideMenuWidth+"px"}}n(),e.$watch(function(){n()});var a=angular.element(document.querySelector("it-side-menu-header"));a[0]||(e.$noMenuHeader=!0)},template:'<div style="{{$noMenuHeader ? \'top:0px;padding-bottom:0px;left:0px;\':\'\'}}width:{{$itSideMenuWidth}}px;" class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div ng-style="sideMenuCalc1"  class="it-sidebar-inner"><div ng-style="sideMenuCalc2" class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),o.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e){function t(){e.menuOpenStyle={"padding-left":(e.$itSideMenuWidth?e.$itSideMenuWidth:0)+"px"},e.menuCloseStyle={"padding-left":"0px"}}var i=angular.element(document.querySelector("it-side-menu-header"));i[0]||(e.showmenu=!0),t(),e.$watch("$itSideMenuWidth",function(){t()})},template:'<div class="it-menu-content"  ng-style="showmenu && menuOpenStyle || menuCloseStyle"><div class="it-container it-fill" ng-transclude></div></div>'}}),o.controller("$sideMenuCtrl",["$scope","$document","$timeout","$window",function(e,t,i,n){var a=this;a.scope=e,a.scope.showmenu=!1,a.toggleMenu=function(){a.scope.showmenu=a.scope.showmenu?!1:!0,i(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),n.dispatchEvent(e)},300)},a.hideSideMenu=function(){a.scope.showmenu=!1}}]),o.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,i,n,a){var o=angular.element(i[0].querySelector(".it-material-design-hamburger__layer")),r=(angular.element(i[0].querySelector(".it-material-design-hamburger__icon")),angular.element(document.querySelector("it-side-menu-content")));r&&r.css("padding-top","60px"),t.toggleMenu=a.toggleMenu,"true"===n.itAnimate&&t.$watch("showmenu",function(t,i){t!=i&&(t?(o.removeClass("it-material-design-hamburger__icon--from-arrow"),o.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed")):(o.removeClass("it-material-design-hamburger__icon--to-arrow"),o.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")))},!0),n.itHideButtonMenu&&(t.itHideButtonMenu=t.$eval(n.itHideButtonMenu)),t.$watch(n.itHideButtonMenu,function(e,i){t.itHideButtonMenu=e,e&&a.hideSideMenu()})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itHideButtonMenu"><button  ng-click="toggleMenu()" class="it-material-design-hamburger__icon"><span class="it-menu-animated it-material-design-hamburger__layer"> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),o.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),o.directive("itSidePanel",["$window",function(e){function t(e,t,i){e.itSidePanelElement=t,e.setIconClass(e,i),e.setZIndexes(t,i),e.setColMd(i),e.setHeightMode(i),e.setTopPosition(i)}return{link:t,restrict:"E",transclude:!0,controller:"$sidePanelCtrl",scope:!0,template:'<div class="it-side-panel-container" ng-class="{\'it-side-panel-container-show\': showPanel}"><div class="it-side-panel-button it-vertical-text" ng-class="{\'it-side-panel-button-show\':showPanel,\'it-side-panel-button-right\':!showPanel}" ng-click="toggleSidePanel()"><span class="fa {{itIconClass}}"></span></div><div class="it-side-panel" ng-transclude></div></div>'}}]),o.directive("itSidePanelContent",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-content" ng-transclude></div>'}}),o.controller("$sidePanelCtrl",["$scope","$window","$document","$timeout","$log",function(e,t,i,n,a){var o="it-col",r="it-height-mode",s="it-top-position",l=40,c="z-index",d="window",u="full",p="auto",f=[d,u,p],g=d,h=4,m=12,v=1,b="fa-search",C="none",w=C,y=".it-side-panel-button",E=".it-side-panel-container",S=".it-side-panel",T=".it-side-panel-header",I=".it-side-panel-content",P=".it-side-panel-footer",A=this;A.scope=e,A.scope.showPanel=!1,A.scope.itHeightMode=g,A.scope.itSidePanelcolMd=h,A.scope.itSidePanelTopPosition=C,A.scope.sidePanelButtonWidth=l,A.scope.sidePanelContainerWidth=null,A.scope.sidePanelContainerRight=null,A.scope.sidePanelButtonRight=null;var k=angular.element(t);A.scope.getWindowDimensions=function(){return{height:t.innerHeight,width:t.innerWidth}},A.scope.$watch(A.scope.getWindowDimensions,function(e,t){A.scope.windowHeight=e.height,A.scope.windowWidth=e.width;var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,E);if(A.scope.itHeightMode===d){var n=i[0].getBoundingClientRect().top;if(Math.abs(n)<A.scope.windowHeight){var a=A.scope.itSidePanelTopPosition;A.scope.isNoneTopPosition()&&(a=0);var o=A.scope.windowHeight-n-a,r=.1*o,s=A.scope.getElementFromClass(A.scope.itSidePanelElement,T);s.css("height",r+"px");var l=.1*o,c=A.scope.getElementFromClass(A.scope.itSidePanelElement,P);c.css("height",l+"px");var u=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);u.css("height",.8*o+"px")}}if(A.scope.showPanel){var p=A.scope.windowWidth/12*A.scope.itSidePanelcolMd;A.scope.sidePanelContainerWidth=p,i.css("width",p+"px")}else A.scope.modifySidePanelCssProperties()},!0),A.scope.modifySidePanelCssProperties=function(){var e=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),t=A.scope.getElementFromClass(A.scope.itSidePanelElement,y),i=A.scope.windowWidth/12*A.scope.itSidePanelcolMd;A.scope.sidePanelContainerWidth=i,A.scope.sidePanelContainerRight=-A.scope.sidePanelContainerWidth,A.scope.sidePanelButtonRight=A.scope.sidePanelContainerWidth,e.css("width",A.scope.sidePanelContainerWidth+"px"),e.css("right",A.scope.sidePanelContainerRight+"px"),t.css("right",A.scope.sidePanelButtonRight+"px")},k.bind("resize",function(){A.scope.$apply()}),A.scope.toggleSidePanel=function(){A.scope.showPanel=A.scope.showPanel?!1:!0;var e=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),t=A.scope.getElementFromClass(A.scope.itSidePanelElement,y);if(A.scope.showPanel)t.css("right",""),n(function(){A.scope.sidePanelContainerRight=0,e.css("right",A.scope.sidePanelContainerRight+"px")},50);else{var i=e.css("width");A.scope.sidePanelContainerRight=-parseInt(i.slice(0,i.length-2)),A.scope.sidePanelButtonRight=A.scope.sidePanelContainerWidth,e.css("right",A.scope.sidePanelContainerRight+"px"),t.css("right",A.scope.sidePanelButtonRight+"px")}},A.scope.setItSidePanelElement=function(e){A.scope.itSidePanelElement=e},A.scope.setHeightMode=function(e){if(A.scope.itHeightMode=e.itHeightMode,""===A.scope.itHeightMode||"undefined"==typeof A.scope.itHeightMode)A.scope.itHeightMode=g;else if(-1!=f.indexOf(A.scope.itHeightMode)){var t=f.indexOf(A.scope.itHeightMode);A.scope.itHeightMode=f[t]}else A.scope.itHeightMode=g,a.error('"'+r+'" with value "'+A.scope.itHeightMode+'"is unknown. The default value is taken : "'+g+'"');var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,T);i.css("height","10%");var n=A.scope.getElementFromClass(A.scope.itSidePanelElement,P);n.css("height","10%");var o=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);switch(o.css("height","80%"),A.scope.itHeightMode){case u:var s=A.scope.getElementFromClass(A.scope.itSidePanelElement,E),l=s.css("height");if(l>A.scope.windowHeight){s.css("height","100%");var c=A.scope.getElementFromClass(A.scope.itSidePanelElement,S);c.css("height","100%")}break;case p:break;case d:var c=A.scope.getElementFromClass(A.scope.itSidePanelElement,S);c.css("height","100%");var o=A.scope.getElementFromClass(A.scope.itSidePanelElement,I);o.css("overflow","auto");break;default:a.error('Height mode : "'+A.scope.itHeightMode+'" is unknown.')}},A.scope.setIconClass=function(e,t){var i=b;""===t.itIconClass||"undefined"==typeof t.itIconClass?A.scope.itIconClass=i:A.scope.itIconClass=t.itIconClass},A.scope.setColMd=function(e){isNaN(parseInt(e.itCol))?(A.scope.itSidePanelcolMd=h,a.warn('Attribute "'+o+'" of itSidePanel directive is not a number. The default value is taken : "'+A.scope.itSidePanelcolMd+'"')):e.itCol>m?(A.scope.itSidePanelcolMd=m,a.warn('Attribute "'+o+'" of itSidePanel directive exceeds the maximum value ('+m+"). The maximum value is taken.")):e.itCol<v?(A.scope.itSidePanelcolMd=v,a.warn('Attribute "'+o+'" of itSidePanel directive exceeds the minimum value ('+v+"). The minimum value is taken.")):A.scope.itSidePanelcolMd=e.itCol;
},A.scope.setZIndexes=function(e,t){var i=null;isNaN(parseInt(t.itZIndex))||(i=parseInt(t.itZIndex));var n=A.scope.getElementFromClass(e,E),a=A.scope.getElementFromClass(e,y);if(null!==i)n.css(c,i),a.css(c,i+1);else{var o=A.scope.findHighestZIndex(),r=o+100;n.css(c,r),a.css(c,r+1)}},A.scope.getElementFromClass=function(e,t){var i=angular.element(e[0].querySelector(t)),n=angular.element(i[0]);return n},A.scope.findHighestZIndex=function(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var a=t.getComputedStyle(e[n]),o=parseInt(a["z-index"]);(isNaN(o)?0:o)>i&&(i=o)}return i},A.scope.setTopPosition=function(e){var t=e.itTopPosition;if(isNaN(parseInt(t)))A.scope.isNoneTopPosition()&&"undefined"!=typeof t||(A.scope.itSidePanelTopPosition=w,a.warn('Attribute "'+s+'" of itSidePanel directive is not a number. The mode taken is "'+w+'"'));else{A.scope.itSidePanelTopPosition=e.itTopPosition;var i=A.scope.getElementFromClass(A.scope.itSidePanelElement,E);i.css("top",A.scope.itSidePanelTopPosition+"px")}},A.scope.isNoneTopPosition=function(){return"none"===A.scope.itSidePanelTopPosition}}]),o.directive("itSidePanelFooter",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-footer" ng-transclude></div>'}}),o.directive("itSidePanelHeader",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-header text-center" ng-transclude></div>'}}),o.factory("CurrentErrors",[function(){function e(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function t(e){return angular.isDefined(e)&&angular.isArray(e)?0==e.length:!1}return{technicalErrors:[],fatals:{},errors:{},warnings:{},fatalsByTabs:{},errorsByTabs:{},warningsByTabs:{},init:function(){this.fatals={},this.errors={},this.warnings={},this.fatalsByTabs={},this.errorsByTabs={},this.warningsByTabs={}},hasFatalOrHigher:function(){return this.hasFatal()||this.hasTechnical()},hasTechnical:function(){return!t(this.technicalErrors)},hasFatal:function(t){return angular.isDefined(t)?angular.isDefined(this.fatalsByTabs[t])?!e(this.fatalsByTabs[t]):!1:!e(this.fatals)},hasError:function(t){return angular.isDefined(t)?angular.isDefined(this.errorsByTabs[t])?!e(this.errorsByTabs[t]):!1:!e(this.errors)},hasWarning:function(t){return angular.isDefined(t)?angular.isDefined(this.warningsByTabs[t])?!e(this.warningsByTabs[t]):!1:!e(this.warnings)}}}]),a.component("itTab",{bindings:{id:"=",label:"="},template:'<button class="btn header-tab full-width " ng-click="$ctrl.changeTab()" title="{{\'ACCOUNTING_CODING.PAYMENT.TITLE\' |translate }}" ng-disabled="$ctrl.isActiveTab"> <i class="fa fa-exclamation-triangle color-danger" aria-hidden="true" ng-if="$ctrl.hasError()"></i> <i class="fa fa-exclamation-triangle color-warning" aria-hidden="true" ng-if="$ctrl.hasWarning()"></i> <span> {{$ctrl.label |translate }} </span> </button>',controller:["$rootScope","CurrentErrors","TabService",function(e,t,i){function n(){i.changeTab(r.id)}function a(){return t.hasError(r.id)}function o(){return t.hasWarning(r.id)}var r=this;r.isActiveTab=!1,r.hasError=a,r.hasWarning=o,r.changeTab=n,r.isActiveTab=i.currentActiveTabId==r.id,i.onTabChanged(function(e){r.isActiveTab=e==r.id})}]}),a.component("itTabContent",{restrict:"E",bindings:{id:"=",contentUrl:"=",viewController:"="},template:'<div ng-show="$ctrl.isActiveTab"                class="row-height-10 under-tabs-container bloc-border-left">           <div id="{{$ctrl.id}}" class="it-scpas-bloc-content-scrollable it-fill content-tab"               ng-include="$ctrl.contentUrl"></div>           </div>',controller:["$rootScope","TabService",function(e,t){var i=this;i.isActiveTab=!1,i.isActiveTab=t.currentActiveTabId==i.id,t.onTabChanged(function(e){i.isActiveTab=e==i.id})}]}),a.factory("TabService",[function(){function e(e){i.currentActiveTabId=e,i.tabChangedCallBacks.forEach(function(t){angular.isDefined(t)&&t(e)})}function t(e){i.tabChangedCallBacks.push(e)}var i=this;return i.tabChangedCallBacks=[],i.changeTab=e,i.onTabChanged=t,i.currentActiveTabId="",i}]),o.factory("BlockService",["$resource","itConfig",function(e,t){return{custom:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/blocks/custom/"+t.get().CURRENT_PACKAGE+"/:name"),all:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/blocks/all/"+t.get().CURRENT_PACKAGE+"/:name"),original:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/blocks/original/:name"),customByOriginal:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/original/"+t.get().CURRENT_PACKAGE+"/:name/custom"),restore:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/blocks/restore/"+t.get().CURRENT_PACKAGE+"/:name"),build:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/packages/build"),preview:e(t.get().REST_TEMPLATE_API_URL+"/api/rest/packages/preview"),"new":function(e,t,i,n,a,o,r,s){return{name:e,position:i,ref:t,content:n,role:a,version:o,removed:"true"==r?!0:!1,element:s}}}}]),o.directive("itBlock",["$timeout","BlockService",function(e,t){return{restrict:"EAC",link:function(e,i,n,a){e.$root.$emit("registerBlock",t["new"](n.name,n.ref,n.position,i.html(),n.role,n.version,n.removed,i))}}}]),o.directive("itBlockControlPanel",[function(){return{restrict:"EA",scope:!0,template:'<div class="block-control-panel col-xs-12" ng-if="itBlockControlPanelController.itConfig.get().ENABLE_TEMPLATE_EDITOR">    <div class="col-xs-12"/>    <div class="block-lists">        <div class=" btn btn-danger offline-editor" ng-if="!itBlockControlPanelController.editorIsOpen"             aria-label="Left Align">            <span class="fa fa-exclamation" aria-hidden="true"></span>            <a target="_blank" ng-href="{{itConfig.get().TEMPLATE_EDITOR_URL}}">{{\'GLOBAL.TEMPLATE.BLOCK.OPEN_EDITOR\'|                translate}}</a>        </div><div class="row" style="margin-bottom: 10px;">        <div ng-if="!itBlockControlPanelController.focusable" class="col-xs-12 block-control-panel-help">(Press Ctrl                and move your mouse over a block)            </div>        <div ng-if="itBlockControlPanelController.focusable" class="col-xs-12 block-control-panel-help">(Release                Ctrl over an element to select it)            </div>    </div><div><it-circular-btn ng-if="!$root.editSite" ng-click="itBlockControlPanelController.editSite()">   <i class="fa fa-pencil"></i>            </it-circular-btn><it-circular-btn ng-if="$root.editSite" ng-click="itBlockControlPanelController.viewSite()">   <i class="fa fa-eye"></i>            </it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.refresh()">   <i class="fa fa-refresh"></i>            </it-circular-btn><it-circular-btn ng-if="$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=false">   <i class="fa fa-stop"></i></it-circular-btn><it-circular-btn ng-if="!$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=true">   <i class="fa fa-play"></i></it-circular-btn><it-circular-btn><a ng-href="{{itBlockControlPanelController.url}}" target="_blank"><i class="fa fa-floppy-o"></i></a></it-circular-btn></div><div  ng-repeat="block in itBlockControlPanelController.blocks | orderBy:\'-name\'" ng-mouseover="itBlockControlPanelController.hilightBlock(block)" ng-mouseleave="itBlockControlPanelController.unHilightBlock(block)" class="{{itBlockControlPanelController.getClass(block)}}"><div class="block-lists-name">{{block.name}}</div><div class="block-lists-action"><it-circular-btn ng-click="itBlockControlPanelController.addBlock(block)">   <i class="fa fa-plus "></i> </it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.editBlock(block)">   <i class="fa fa-pencil"></i> </it-circular-btn><it-circular-btn ng-if="block.removed" ng-click="itBlockControlPanelController.restoreBlock(block)">   <i class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-if="!block.removed" ng-click="itBlockControlPanelController.deleteBlock(block)">   <i class="fa fa-eye-slash block-btn"></i></it-circular-btn></div></div></div></div>',controllerAs:"itBlockControlPanelController",controller:["$scope","$rootScope","$location","$log","$document","$filter","BlockService","PilotSiteSideService","PilotService","itConfig","itPopup","itNotifier",function(e,t,i,n,a,o,r,s,l,c,d,u){function p(){s.fn.options({currentPackage:c.get().CURRENT_PACKAGE})}var f=this;c.get().ENABLE_TEMPLATE_EDITOR&&(f.editorIsOpen=!1,f.itConfig=c,f.blocks=[],f.availableBlocks=[],f.url=c.get().REST_TEMPLATE_API_URL+"/api/rest/export/"+c.get().CURRENT_PACKAGE,this.refresh=function(){r.build.get(function(){location.reload()},function(e){u.notifyError({content:o("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},f.interval=0,p(),s.on.pong=function(t){n.debug("pong"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorConnect=function(t){n.debug("editorConnect"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorDisconnect=function(t){n.debug("editorDisconnect"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.close=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.error=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.transportFailure=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.reload=this.refresh,t.editSite=!0,t.autoRefreshTemplate=!0,a.bind("keydown",function(e){t.editSite&&(17!=e.keyCode||f.focusable||(a.find("*").addClass("crosshair"),f.focusable=!0,f.init()))}),a.bind("keyup",function(e){t.editSite&&17==e.keyCode&&f.focusable&&(a.find("*").removeClass("crosshair"),f.focusable=!1)}),t.$on("registerBlock",function(t,i){f.availableBlocks[i.name]=i,i.element.bind("mouseenter",function(t){e.$applyAsync(function(){f.selectBlock(i.name)})}),i.element.bind("mouseleave",function(t){e.$applyAsync(function(){f.unSelectBlock(i.name)})}),f.blocks=[],f.clearStyle(),f.hilightedBlock=void 0}),f.init=function(){f.blocks=[],f.clearStyle(),f.hilightedBlock=void 0},f.selectBlock=function(e){var t=f.availableBlocks[e];f.focusable&&!f.exists(t)&&f.blocks.push(t)},f.unSelectBlock=function(e){var t=f.availableBlocks[e];f.focusable&&f.exists(t)&&f.blocks.splice(f.blocks.indexOf(t),1)}),f.editSite=function(){t.editSite=!0,f.clearStyle()},f.viewSite=function(){t.editSite=!1,f.clearStyle(),f.init()},f.editBlock=function(e){if(n.debug("edit block"),angular.isDefined(e.ref)&&""!=e.ref)s.fn.editBlock(e,i.path());else{var t=r["new"](c.get().CURRENT_PACKAGE+"_replace"+e.name+"_"+o("date")(new Date,"yyyyMMddHHmmss"),e.name,"replace",e.content,c.get().CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.addBlock=function(e){if(angular.isDefined(e.name)&&""!=e.name){n.debug("add block");var t=r["new"](c.get().CURRENT_PACKAGE+"_new_"+e.name+"_"+o("date")(new Date,"yyyyMMddHHmmss"),e.name,"before","",c.get().CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.restoreBlock=function(e){n.debug("restore block"),r.restore.get({name:e.name},function(){r.build.get(function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:o("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(t){u.notifyError({content:o("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},t.data.body),n.error("Unable to restore block "+JSON.stringify(e))})})},f.deleteBlock=function(e){n.debug("delete block");var i=d.confirm({title:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.TITLE' | translate}}",text:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.CONFIRM' | translate}}",buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});i.then(function(){r.all["delete"]({name:e.name},function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:o("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(e){u.notifyError({content:o("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(){u.notifyError({content:"{{'GLOBAL.TEMPLACE.WS.BLOCK_DELETED_KO' | translate}}"})})},f.hilightBlock=function(e){angular.isDefined(e)&&(f.hilightedBlock=e,f.clearStyle(),f.updateStyle(e.name))},f.unHilightBlock=function(e){angular.isDefined(e)&&(f.hilightedBlock=void 0,f.clearStyle())},f.updateStyle=function(e){for(var t in f.availableBlocks)t==e&&f.availableBlocks[t].element.addClass("block-hilight")},f.clearStyle=function(){for(var e in f.availableBlocks){var i=f.availableBlocks[e].element;angular.isDefined(i)&&(i.removeClass("block-removed"),i.removeClass("block-hilight"),i.css("display",""),t.editSite&&i.children().attr("disabled",!1),f.availableBlocks[e].removed&&(t.editSite?i.addClass("block-removed"):i.css("display","none")))}},f.getClass=function(e){return f.hilightedBlock&&f.hilightedBlock.name==e.name?"block-lists-element-hilight":""},f.exists=function(e){var t=!1;return f.blocks.forEach(function(i){i.name==e.name&&(t=!0)}),t}}]}}]),o.factory("PilotService",["$resource","$log","itConfig",function(e,t,i){function n(e){t.log("ping "+e),o.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:o.ACTION_PING,params:[]}))}function a(e){t.log("pong "+e),o.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:o.ACTION_PONG,params:[]}))}var o=this;return o.ACTION_EDIT_BLOCK="editBlock",o.ACTION_REMOVE_BLOCK="removeBlock",o.ACTION_CREATE_BLOCK="createBlock",o.ACTION_EDIT_PAGE="editPage",o.ACTION_REMOVE_PAGE="removePage",o.ACTION_CREATE_PAGE="createPage",o.ACTION_PING="ping",o.ACTION_PONG="pong",o.ACTION_DISCONNECT="disconnect",o.ACTION_TIMEOUT="timeout",o.ACTION_CONNECT="connect",o.ACTION_RELOAD="reload",o.ACTION_OPTIONS="options",o.DEST_EDITOR="editor",o.DEST_SITE="site",o.DEST_ALL="all",o.fields={socket:{},request:{url:i.get().REST_TEMPLATE_API_URL+"/api/editor",contentType:"application/json",logLevel:"debug",transport:"websocket",trackMessageLength:!0,reconnectInterval:5e3,enableXDR:!0,timeout:6e4},model:{},dest:""},o.fn={ping:n,pong:a},o.on={message:{},open:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},o.fields.request.onOpen=function(e){o.fields.model.transport=e.transport,o.fields.model.connected=!0,o.fields.socket.push(atmosphere.util.stringifyJSON({dest:o.fields.dest,action:o.ACTION_CONNECT,params:[]})),angular.isDefined(o.on.open)&&o.on.open()},o.fields.request.onClientTimeout=function(e){o.fields.model.connected=!1,o.fields.socket.push(atmosphere.util.stringifyJSON({dest:o.fields.dest,action:o.ACTION_TIMEOUT,params:[]})),setTimeout(function(){o.fields.socket=atmosphere.subscribe(o.fields.request)},o.fields.request.reconnectInterval)},o.fields.request.onReopen=function(e){o.fields.model.connected=!0,o.fields.socket.push(atmosphere.util.stringifyJSON({dest:o.fields.dest,action:o.ACTION_CONNECT,params:[]})),angular.isDefined(o.on.reopen)&&o.on.reopen()},o.fields.request.onTransportFailure=function(e,t){atmosphere.util.info(e),t.fallbackTransport="long-polling",angular.isDefined(o.on.transportFailure)&&o.on.transportFailure()},o.fields.request.onMessage=function(e){o.on.message(e)},o.fields.request.onClose=function(e){o.fields.model.connected=!1,o.fields.socket.push(atmosphere.util.stringifyJSON({dest:o.fields.dest,action:o.ACTION_DISCONNECT,params:[]})),angular.isDefined(o.on.close)&&o.on.close()},o.fields.request.onError=function(e){o.fields.model.logged=!1,angular.isDefined(o.on.error)&&o.on.error()},o.fields.request.onReconnect=function(e,t){o.fields.model.connected=!1},i.get().ENABLE_TEMPLATE_EDITOR&&(o.fields.socket=atmosphere.subscribe(o.fields.request)),o}]),o.factory("PilotSiteSideService",["$resource","$log","itConfig","PilotService",function(e,t,i,n){function a(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_BLOCK,params:[{block:e,path:t}]}))}function o(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_BLOCK,params:[{block:e,path:t}]}))}function r(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_BLOCK,params:[{block:e,path:t}]}))}function s(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_PAGE,params:[{page:e}]}))}function l(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_PAGE,params:[{page:e}]}))}function c(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_PAGE,params:[{page:e}]}))}function d(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_OPTIONS,params:[{options:e}]}))}var u=this;return u.fields={},u.fn={editBlock:a,removeBlock:o,createBlock:r,editPage:s,removePage:l,createPage:c,options:d,ping:n.fn.ping},u.on={reload:void 0,pong:void 0,editorConnect:void 0,editorDisconnect:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},i.get().ENABLE_TEMPLATE_EDITOR&&(n.fields.dest=n.DEST_EDITOR,n.on.open=function(e){t.log("WebSocket connection is opened"),u.fn.ping(n.DEST_EDITOR)},n.on.reopen=function(e){t.log("WebSocket connection is reopened"),u.fn.ping(n.DEST_EDITOR)},n.on.close=function(){angular.isDefined(u.on.close)&&u.on.close()},n.on.error=function(){angular.isDefined(u.on.error)&&u.on.error()},n.on.transportFailure=function(){angular.isDefined(u.on.transportFailure)&&u.on.transportFailure()},n.on.message=function(e){var i=e.responseBody;try{var a=atmosphere.util.parseJSON(i);if(a.dest==n.DEST_ALL)switch(a.action){case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect()}if(a.dest==n.DEST_SITE)switch(a.action){case n.ACTION_RELOAD:t.log(n.ACTION_RELOAD),angular.isDefined(u.on.reload)&&u.on.reload();break;case n.ACTION_PING:t.log(n.ACTION_PING),n.pong(n.DEST_EDITOR);break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect();break;case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect()}}catch(o){throw t.error("Error parsing JSON: ",i),o}}),u}]),o.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(i,n,a){function o(){var a,o=angular.element(t[0].getElementById(i.footerElementId));a=1===o.length?o[0].offsetHeight+r(o)+s(o):0;var l=n[0].offsetTop,c=s(n),d=i.additionalPadding||0,u=e.innerHeight-l-c-a-d;n.css("height",u+"px")}function r(e){var t=l(e,"margin-top"),i=l(e,"border-top-width");return t+i}function s(e){var t=l(e,"margin-bottom"),i=l(e,"border-bottom-width");return t+i}function l(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",o),o()}}}]),o.component("itPanelForm",{bindings:{options:"=",dateFormat:"@",updateLabel:"@",update:"&"},template:'<div class="it-ac-panel-form"><form name="$ctrl.form" novalidate><div ng-repeat="option in $ctrl.options"><div class="row"><div class="col-xs-3 col-md-4 col-lg-6"> <label>{{option.title}} :</label></div><div ng-switch on="option.type"><div ng-switch-when="label" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'labelTemplate.html\' "></div></div><div ng-switch-when="input" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'inputTemplate.html\' "></div></div><div ng-switch-when="select" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'selectTemplate.html\' "></div></div><div ng-switch-when="date" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'dateTemplate.html\' "></div></div><div ng-switch-when="checkBox" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'checkBoxTemplate.html\' "></div></div><div ng-switch-when="textArea" class="col-xs-3 col-md-4 col-lg-6"><div ng-include=" \'textAreaTemplate.html\' "></div></div></div></div></div><button type="submit" ng-click="$ctrl.update({message:options})" class="btn btn-primary">{{$ctrl.updateLabel}}</button></form></div><!------------------- Template label -------------------><script type="text/ng-template" id="labelTemplate.html"><p>{{option.value}}</p></script><!------------------- Template input -------------------><script type="text/ng-template" id="inputTemplate.html"><p><input type="text" ng-model="option[\'value\']" name="input" value="{{option.value}}"></p></script><!------------------- Template select -------------------><script type="text/ng-template" id="selectTemplate.html"><p><select name="repeatSelect" id="repeatSelect" ng-model="option.value" ng-options="value.value for value in option.items"/></select></p> </script><!------------------- Template checkbox -------------------><script type="text/ng-template" id="checkBoxTemplate.html"><p><input type="checkbox" ng-model="option[\'value\']" ng-true-value="\'true\'" ng-false-value="\'false\'"><br></p></script><!------------------- Template textArea -------------------><script type="text/ng-template" id="textAreaTemplate.html"><p><textarea ng-model="option[\'value\']" name="textArea"></textarea></p></script><!------------------- Template date -------------------><script type="text/ng-template" id="dateTemplate.html"><p><input type="text" class="form-control" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" ng-model="option[\'value\']" data-autoclose="1" name="date" data-date-format="{{$ctrl.dateFormat}}" bs-datepicker></p></script>',controller:["$scope",function(e){var t=this;void 0==t.dateFormat&&(t.dateFormat="dd/MM/yyyy"),void 0==t.updateLabel&&(t.updateLabel="Update")}]}),o.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),o.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),o.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),o.provider("itConfig",[function(){function e(e){var a={},s=new XMLHttpRequest;return s.onreadystatechange=function(){if(4==s.readyState&&200==s.status)if(t){if(r=JSON.parse(s.responseText),void 0!=n&&null!=n){a=r[n];for(var i in a)"undefined"!=typeof e&&"undefined"!=typeof e[i]&&(a[i]=e[i])}}else r=JSON.parse(s.responseText)},s.open("GET",i,!1),s.send(),o=!0,a}var t=!1,i="app/config/config.json",n=null,a=void 0,o=!1,r={};this.allowOverride=function(e){t=e},this.configFile=function(e){i=e},this.defaultNamespace=function(e){n=e},this.get=function(){return e(a)},this.$get=["$location",function(t){a=t.search();return{get:function(t){return o||e(a),null!=t&&void 0!=t?r[t]:null!=n?r[n]:r}}}]}]),angular.module("itesoft.language",["itesoft.popup","LocalStorageModule"]).provider("itLanguageChangeHandler",function(){var e=this;this.options={storage:"local",displayConfirm:!0,onChangePopup:{title:"Confirm language change",text:"By modifying the language any recent changes may be lost. Continue?",buttonCancelLabel:"NO",buttonOkLabel:"YES"}},this.$get=["$rootScope","$translate","$location","$q","localStorageService","itPopup",function(t,i,n,a,o,r){return{translate:i,getConfig:function(){return e.options},changeLanguage:function(a,s,l){var c={currentLanguage:this.getCurrentLanguage()};if(e.options.displayConfirm){var d=r.confirm({title:e.options.onChangePopup.title,text:e.options.onChangePopup.text,cancelText:e.options.onChangePopup.buttonCancelLabel,okText:e.options.onChangePopup.buttonOkLabel});!function(r){var c=r;d.then(function(c){if("query"===e.options.storage)try{n.search("Locale",a)}catch(d){reject("Error setting query parameter, lang, to locale value: "+a+" Error: "+d.message)}else try{o.set("Locale",a)}catch(d){reject("Error setting local storage parameter, lang, to locale value: "+a+" Error: "+d.message)}s&&(s.currentLanguage=a,s.user&&(s.user.language=i.use())),r={currentLanguage:a},l&&l(r),t.$applyAsync(function(){location.reload()})},function(){i.use(c.currentLanguage)})}(c)}},getCurrentLanguage:function(){return"query"===e.options.storage?n.search().Locale?n.search().Locale.replace(/-/g,"_"):this.getDefaultLocale(this.translate.use()):o.get("Locale")||this.getDefaultLocale(this.translate.use())},getDefaultLocale:function(e){switch(e||(e=i.preferredLanguage()),e){case"en":return"en_GB";case"de":return"de_DE";default:case"fr":return"fr_FR"}},getLanguageCode:function(e){switch(e){case"en_GB":case"en-GB":case"en_US":case"en-US":return"en";case"de_DE":case"de-DE":return"de";default:case"fr_FR":case"fr-FR":case"fr_CA":case"fr-CA":return"fr"}}}}]}),angular.module("itesoft.messaging",["ngWebSocket"]).provider("ItMessaging",[function(){var e=this;e.SERVICE_URL="tstbuydpoc01:3333/itesoft-messaging",this.$get=["$log","$http","$q","$websocket","$rootScope",function(t,i,n,a,o){function r(r){function s(){var e=n.defer();return i({url:"http://"+d.URL+"/rest/topics",method:"GET",headers:{token:d.token}}).then(function(t){e.resolve(t.data)},function(i){t.error(i),e.reject(e)}),e.promise}function l(e,t){for(var i,n=0;n<d.onMessageCallbacks.length;n++){i=d.onMessageCallbacks[n];var a=angular.fromJson(e.data);angular.isArray(a)?angular.forEach(a,function(e){o.$applyAsync(function(){i.fn.apply(this,[e,t])})}):o.$applyAsync(function(){i.fn.apply(this,[a,t])})}}function c(e){for(var t,i=0;i<d.onCloseCallbacks.length;i++)t=d.onCloseCallbacks[i],o.$applyAsync(function(){t.fn.apply(this,e)})}var d=this;d.URL=e.SERVICE_URL,d.onMessageCallbacks=[],d.onCloseCallbacks=[],d.token=r,this.getToken=function(e,a,o){console.warn("This function is only for demo purpose, do NOT use it in production mode, the security of your apiKey will not be granted");var r=n.defer();return i({url:"http://"+this.URL+"/rest/tokens",method:"POST",data:a,headers:{"api-key":e}}).then(function(e){r.resolve(e.data.jwt)},function(e){t.error("error on api endpoint"),r.reject("error on api endpoint")}),r.promise},this.getServiceUrl=function(){return d.URL},this.connect=function(e){return e?(d.token=e,d.dataStream=a("ws://"+d.URL+"/websocket?token="+e),d.dataStream.onMessage(function(e){s().then(function(t){l(e,t)})}),d.dataStream.onClose(function(e){c(e)}),!0):void 0},this.onMessage=function(e){return d.onMessageCallbacks.push({fn:e}),d},this.onClose=function(e){return d.onCloseCallbacks.push({fn:e}),d},this.subscribeToTopic=function(e,a){var o=n.defer();return null!=d.token?i({url:"http://"+d.URL+"/rest/topics/"+e+"/subscribe",method:"POST",data:a,headers:{token:d.token}}).then(function(e){o.resolve(e.data),s()},function(e){t.error(e),o.reject(e)}):(t.error("You cannot register observers to topic without token"),o.reject("no token")),o.promise},this.unsubscribeToTopic=function(e,a){var o=n.defer();return null!=d.token?i({url:"http://"+d.URL+"/rest/topics/"+e+"/unsubscribe",method:"POST",data:a,headers:{token:d.token}}).then(function(e){o.resolve(e.data),s()},function(e){t.error(e),o.reject(e)}):(t.error("You cannot register observers to topic without token"),o.reject("no token")),o.promise},this.sendMessage=function(e){var a=n.defer();return i({url:"http://"+d.URL+"/rest/messages",method:"POST",headers:{token:d.token},data:e}).then(function(e){a.resolve(e.data)},function(e){t.error(e),a.reject(e)}),a.promise}}return function(e){return new r(e)}}]}]),o.provider("itNotifier",[function(){var e=this;e.defaultOptions={dismissOnTimeout:!0,timeout:4e3,dismissButton:!0,animation:"fade",horizontalPosition:"right",verticalPosition:"bottom",compileContent:!0,dismissOnClick:!1,success:{dismissOnClick:!0},info:{dismissOnClick:!0},error:{dismissOnTimeout:!1},warning:{dismissOnTimeout:!1}},this.$get=["ngToast","$rootScope","$log",function(t,i,n){function a(e){return" CODE : "+e.CODE+", TYPE : "+e.TYPE+", MESSAGE : "+e.MESSAGE+", DETAIL : "+e.DETAIL+", DONE : "+e.DONE}var o={};return t.settings=angular.extend(t.settings,e.defaultOptions),o.notifySuccess=function(i,o){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.success,i,i.success);t.success(r),void 0!=o&&n.log("Success popup called : "+a(o))},o.notifyError=function(i,o){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.error,i,i.error);t.danger(r),void 0!=o&&n.error("Error popup called : "+a(o))},o.notifyInfo=function(i,o){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.info,i,i.info);t.info(r),void 0!=o&&n.info("Info popup called : "+a(o))},o.notifyWarning=function(i,o){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.warning,i,i.warning);t.warning(r),void 0!=o&&n.warn("Warning popup called : "+a(o))},o.notifyDismiss=function(e,i){t.dismiss()},o.notify=function(e){n.error("Unknown type for itNotifier: "+e)},i.$on("$locationChangeSuccess",function(){o.notifyDismiss()}),i.$on("itNotifierEvent",function(e,t){if(t)switch(t.type){case"SUCCESS":o.notifySuccess(t.options,t.errorDetails);break;case"ERROR":o.notifyError(t.options,t.errorDetails);break;case"INFO":o.notifyInfo(t.options,t.errorDetails);break;case"WARNING":o.notifyWarning(t.options,t.errorDetails);break;case"DISMISS":o.notifyDismiss(t.options,t.errorDetails);break;default:o.notify(t.type)}else n.error("Bad usage of itNotifier. Check manual for details")}),o}]}]),angular.module("itesoft.popup",["ui.bootstrap.modal"]).factory("itPopup",["$uibModal","$uibModalStack","$rootScope","$q","$compile",function(e,t,i,n,a){function o(e){function t(){return!1}var a={};return a.scope=(e.scope||i).$new(),a.responseDeferred=n.defer(),a.scope.$buttonTapped=function(e,t){var i=(t.onTap||noop)(e);a.responseDeferred.resolve(i)},e=angular.extend({scope:a.scope,template:u,controller:["$scope","$uibModalInstance",function(e,i){function n(){i.close(e.data)}function o(){i.dismiss("cancel")}e.itButtonAction=function(i,r){var s=(r.onTap||t)(i,e),l=s;i.isDefaultPrevented()||a.responseDeferred.resolve(l?n():o())}}],buttons:[]},e||{}),e.scope.options=e,a.options=e,a}function r(i){t.dismissAll();var n=o(i);return e.open(n.options).result}function s(e){return t.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function l(e){return t.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function c(e){return t.dismissAll(),r(e)}function d(e){t.dismissAll();var n=i.$new(!0);n.data={};var a="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(a="<span>"+e.template+"</span>",delete e.template),r(angular.extend({template:p,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var u='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',p='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',f={
alert:s,confirm:l,prompt:d,custom:c};return f}]),o.factory("itStringUtilsService",[function(){function e(e){var n="";return n=t(e),n=i(n)}function t(e){var t="";return t+=angular.isDefined(e)&&e.toLowerCase?e.toLowerCase():e}function i(e){var t=[{"char":"A",base:/[\300-\306]/g},{"char":"a",base:/[\340-\346]/g},{"char":"E",base:/[\310-\313]/g},{"char":"e",base:/[\350-\353]/g},{"char":"I",base:/[\314-\317]/g},{"char":"i",base:/[\354-\357]/g},{"char":"O",base:/[\322-\330]/g},{"char":"o",base:/[\362-\370]/g},{"char":"U",base:/[\331-\334]/g},{"char":"u",base:/[\371-\374]/g},{"char":"N",base:/[\321]/g},{"char":"n",base:/[\361]/g},{"char":"C",base:/[\307]/g},{"char":"c",base:/[\347]/g}],i=e;return t.forEach(function(e){i=i.replace(e.base,e["char"])}),i}return{getLower:t,removeAccent:i,clear:e,cleanDomRef:{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",encode:function(e){if(e){var t,i,n,a,o,r,s,l="",c=0;for(e=this._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),a=t>>2,o=(3&t)<<4|i>>4,r=(15&i)<<2|n>>6,s=63&n,isNaN(i)?r=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return l}},decode:function(e){var t,i,n,a,o,r,s,l="",c=0;if(e.replace)for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");c<e.length;)a=this._keyStr.indexOf(e.charAt(c++)),o=this._keyStr.indexOf(e.charAt(c++)),r=this._keyStr.indexOf(e.charAt(c++)),s=this._keyStr.indexOf(e.charAt(c++)),t=a<<2|o>>4,i=(15&o)<<4|r>>2,n=(3&r)<<6|s,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(n));return l=this._utf8_decode(l)},_utf8_encode:function(e){var t="";if(e.replace){e=e.replace(/rn/g,"n");for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),128>n?(t+=String.fromCharCode(n),i++):n>191&&224>n?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}}}}]),n.factory("IMAGEPage",["$log","MultiPagesPage","PageViewport","MultiPagesConstants",function(e,t,i,n){function a(e,i,n){this.base=t,this.base(e,n),this.img=i}return a.prototype=new t,a.prototype.renderPage=function(e,t){var i=this;if(e.canvasRendered)e.wrapper.append(e.canvas);else{e.wrapper.append(e.canvas);var a=e.canvas[0].getContext("2d");a.transform.apply(a,e.viewport.transform),a.drawImage(i.img,0,0),t&&t(e,n.PAGE_RENDERED)}},a}]).factory("IMAGEViewer",["$log","MultiPagesViewer","MultiPagesViewerAPI","IMAGEPage",function(e,t,i,n){function a(e){this.base=t,this.base(new i(this),e)}return a.prototype=new t,a.prototype.open=function(e,t,i){this.element.empty(),this.pages=[],this.pageMargin=i,this.initialScale=t;var n="string"!=typeof e;n?this.setFile(e):this.setUrl(e)},a.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;t.getAllPages(e,function(e){t.pages=e,t.addPages()})}},a.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result;t.getAllPages(i,function(e){t.pages=e,t.addPages()})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsDataURL(e)}},a.prototype.getAllPages=function(e,t){var i=[],a=this;i.push({});var o=new Image;o.onprogress=angular.bind(this,a.downloadProgress),o.onload=function(){var e=new n(0,o,[0,0,o.width,o.height]);i[0]=e,t(i)},o.src=e},a}]).directive("imageViewer",["$log","IMAGEViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"="},controller:["$scope","$element",function(e,n){var a=function(t){return null===e.options||void 0===e.options?null:e.options[t]},o=new t(n);e.api=o.getAPI(),e.onSrcChanged=function(){o.open(this.src,a("initialScale"),i)},e.onFileChanged=function(){o.open(this.file,a("initialScale"),i)},o.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}]),n.directive("itImageViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.$$api" ng-if="options.showToolbar"></it-toolbar-viewer><image-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}"  api="options.$$api" options="options" ></image-viewer></div>',link:i}}]),e.directive("itProgressbarViewer",[function(){return{scope:{api:"="},restrict:"E",template:'<div class="loader" ><div class="progress-bar"><span class="bar" ng-style=\'{width: api.downloadProgress + "%"}\'></span></div></div>'}}]),e.directive("itToolbarViewer",["$log",function(e){var t=function(e,t,i){e.$watch("api.getZoomLevel()",function(t){e.scale=t}),e.$watch("api.getSelectedPage()",function(t){e.currentPage=t}),e.onZoomLevelChanged=function(){e.api.zoomTo(e.scale)},e.onPageChanged=function(){e.api.goToPage(e.currentPage)}};return{scope:{api:"="},restrict:"E",template:'<div class="toolbar"><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button ng-click="api.zoomOut()">-</button> <select ng-model="scale" ng-change="onZoomLevelChanged()" ng-options="zoom as zoom.label for zoom in api.getZoomLevels()"></select> <button ng-click="api.zoomIn()">+</button> </div><div class="select_page_wrapper" ng-show="api.getNumPages() > 1"><span>Page : </span><button ng-click="api.goToPrevPage()"><</button> <input type="text" ng-model="currentPage" ng-change="onPageChanged()"/> <button ng-click="api.goToNextPage()">></button> <span> of {{api.getNumPages()}}</span> </div><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button ng-click="api.rotatePageRight()"><i class="fa fa-repeat" aria-hidden="true"></i></button><button ng-click="api.rotatePageLeft()"><i class="fa fa-undo" aria-hidden="true"></i></button></div></div>',link:t}}]),e.factory("MultiPagesAddEventWatcher",["$sce",function(e){return function(t){t&&(t.$watch("src",function(e){"string"==typeof e?t.url=e:t.file=e}),t.$watch("options.$$api",function(e){e&&(t.options.getApi=function(){return e},t.options&&t.options.onApiLoaded&&t.options.onApiLoaded(e))}),t.trustSrc=function(t){return e.trustAsResourceUrl(t)})}}]),e.constant("MultiPagesConstants",{PAGE_RENDER_FAILED:-1,PAGE_RENDER_CANCELLED:0,PAGE_RENDERED:1,PAGE_ALREADY_RENDERED:2,ZOOM_LEVELS_LUT:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2,2.2,2.4,2.6,2.8,3,3.3,3.6,3.9,4,4.5,5],ZOOM_FIT_WIDTH:"fit_width",ZOOM_FIT_PAGE:"fit_page",ZOOM_FIT_HEIGHT:"fit_height",ORIENTATION_VERTICAL:"vertical",ORIENTATION_HORIZONTAL:"horizontal"}),e.factory("MultiPagesPage",["$log","MultiPagesConstants","PageViewport",function(e,t,i){function n(e,t){this.pageIndex=e,this.id=e+1,this.container=angular.element("<div></div>"),this.container.attr("id","page_"+e),this.wrapper=angular.element('<div class="page {{api.isPageSelected('+this.id+')}}" ng-click="onPageClicked('+this.id+')"></div>'),this.container.append(this.wrapper),this.canvasRendered=!1,this.rendered=!1,this.rotation=0,this.scale=1,this.view=t}return n.prototype={clear:function(){this.rendered=!1,this.wrapper.empty()},getViewport:function(e,t){return new i(this.view,e,t,0,0,!0)},transform:function(){this.clear(),this.viewport=this.getViewport(this.scale,this.rotation),this.canvasRendered=!1,this.canvas=angular.element("<canvas></canvas>"),this.canvas.attr("width",this.viewport.width),this.canvas.attr("height",this.viewport.height),this.wrapper.css("width",this.viewport.width+"px"),this.wrapper.css("height",this.viewport.height+"px")},resize:function(e){this.scale=e,this.transform()},setOrientation:function(e){switch(this.orientation=e,e){case t.ORIENTATION_HORIZONTAL:this.container.addClass("horizontal"),this.container.removeClass("vertical");break;default:this.container.addClass("vertical"),this.container.removeClass("horizontal")}},rotate:function(e){this.rotation=e,this.transform()},isVisible:function(){var e=this.container[0],i=this.container.parent()[0];switch(this.orientation){case t.ORIENTATION_HORIZONTAL:var n=e.offsetLeft-i.scrollLeft,a=n+e.offsetWidth;return a>=0&&n<=i.offsetWidth;default:var o=e.offsetTop-i.scrollTop,r=o+e.offsetHeight;return r>=0&&o<=i.offsetHeight}},render:function(e){return this.rendered?void(e&&e(this,t.PAGE_ALREADY_RENDERED)):(this.rendered=!0,void this.renderPage(this,function(i,n){n===t.PAGE_RENDERED&&(i.canvasRendered=!0),e&&e(i,n)}))},renderPage:function(e,t){throw"NotImplementedError - renderPage(page, callback)"}},n}]),e.factory("MultiPagesViewer",["$log","$timeout","$compile","MultiPagesViewerAPI","MultiPagesConstants","SizeWatcher","TranslateViewer",function(e,t,i,n,a,o,r){function s(e,t){var i=angular.element("<div></div>");i.css("height","10000px"),e.append(i);var n=i[0].offsetWidth;i.remove();var a=e[0].offsetHeight;return 0===a&&(a=2*t),n-=2*t,a-=2*t+10,{width:n,height:a}}function l(e,t){this.pages=[],this.scaleItem=null,this.fitWidthScale=1,this.fitHeightScale=1,this.fitPageScale=1,this.element=t,this.pageMargin=0,this.orientation=a.ORIENTATION_VERTICAL,this.currentPage=0,this.lastScrollDir=0,this.rotation=0,this.scaleItems={},this.zoomLevels=[],this.api=e,this.onPageRendered=null,this.onDataDownloaded=null,this.onCurrentPageChanged=null}return l.prototype={getAPI:function(){return this.api},addPages:function(){for(var e=this.pages.length,t=0;e>t;++t)this.element.append(this.pages[t].container);this.onPageRendered("loaded",1,e,""),this.setContainerSize(this.initialScale)},updateScaleItem:function(e){var t=this.scaleItems[e.id];return void 0==t?(this.scaleItems[e.id]=e,t=e):t.value=e.value,this.zoomLevels.push(t),t},setContainerSize:function(t){if(this.pages.length>0){var i=s(this.element,this.pageMargin);if(i.width>0&&i.height>0){this.onContainerSizeChanged&&this.onContainerSizeChanged(i),this.containerSize=i;var n=this.scaleItem?this.scaleItem.value:null;this.fitWidthScale=this.calcScale(a.ZOOM_FIT_WIDTH),this.fitHeightScale=this.calcScale(a.ZOOM_FIT_HEIGHT),this.fitPageScale=this.calcScale(a.ZOOM_FIT_PAGE),this.zoomLevels=[];for(var o=a.ZOOM_LEVELS_LUT.length-1,l=0;o>l;++l){var c=null,d=a.ZOOM_LEVELS_LUT[l],u=a.ZOOM_LEVELS_LUT[l+1];d<this.fitWidthScale&&u>this.fitWidthScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_WIDTH,value:this.fitWidthScale,label:r.translate("GLOBAL.VIEWER.FIT_WIDTH_LABEL","Fit width")})),d<this.fitHeightScale&&u>this.fitHeightScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_HEIGHT,value:this.fitHeightScale,label:r.translate("GLOBAL.VIEWER.FIT_HEIGHT_LABEL","Fit height")})),d<this.fitPageScale&&u>this.fitPageScale&&(c=this.updateScaleItem({id:a.ZOOM_FIT_PAGE,value:this.fitPageScale,label:r.translate("GLOBAL.VIEWER.FIT_PAGE_LABEL","Fit page")}));var p=(100*u).toFixed(0)+"%";c=this.updateScaleItem({id:p,value:u,label:p})}if(void 0==this.scaleItem&&t&&(void 0!=this.scaleItems[t]?this.scaleItem=this.scaleItems[t]:e.debug("InitialScale not found : "+t)),this.api.onZoomLevelsChanged&&this.api.onZoomLevelsChanged(this.zoomLevels),null!=this.scaleItem&&this.scaleItem.value===n&&this.pages[0]&&null!=this.pages[0].viewport)return void this.renderAllVisiblePages();this.setScale(this.scaleItem)}}},hasMultiplePages:function(){return this.pages.length>1},setOrientation:function(e){this.orientation=e,this.hasMultiplePages()&&this.setScale(this.scaleItem)},setScale:function(e){void 0!=e&&(this.scaleItem=e);for(var t=e||this.scaleItems["100%"],i=this.pages.length,n=0;i>n;++n){var a=this.pages[n];a.setOrientation(this.orientation),a.resize(t.value)}this.render()},calcScale:function(t){if(t===a.ZOOM_FIT_WIDTH){for(var i=this.pages.length,n=this.pages[0],o=n.getViewport(1,n.rotation).width,r=1;i>r;++r)n=this.pages[r],o=Math.max(o,n.getViewport(1,n.rotation).width);return this.containerSize.width/o}if(t===a.ZOOM_FIT_HEIGHT){for(var i=this.pages.length,n=this.pages[0],s=n.getViewport(1,n.rotation).height,r=1;i>r;++r)n=this.pages[r],s=Math.max(s,n.getViewport(1,n.rotation).height);return this.containerSize.height/s}if(t===a.ZOOM_FIT_PAGE){var n=this.pages[0],l=n.getViewport(1,n.rotation);return this.containerSize.height<this.containerSize.width?this.containerSize.height/l.height:this.containerSize.width/l.width}var c=parseFloat(t);return isNaN(c)?(e.debug("PDF viewer: "+t+" isn't a valid scaleItem value."),1):c},removeDistantPages:function(e,t,i){for(var n=this.pages.length,a=Math.max(e-i,0),o=Math.min(t+i,n-1),r=0;a>r;++r)this.pages[r].clear();for(var r=o+1;n>r;++r)this.pages[r].clear()},renderAllVisiblePages:function(e){void 0!=e&&(this.lastScrollDir=e);for(var t=this,i=this.pages.length,n=-1,o=0,r=!1,s=0;i>s;++s){var l=this.pages[s];if(l.isVisible()){var c=l.container.parent()[0],d=l.container[0];if(t.hasMultiplePages()){if(-1===n)if(this.orientation===a.ORIENTATION_HORIZONTAL){var u=d.offsetLeft-c.scrollLeft,p=d.offsetWidth/2;p+u>=0&&(n=s)}else{var f=d.offsetTop-c.scrollTop,p=d.offsetHeight/2;p+f>=0&&(n=s)}}else n=s;r=!0,o=s,l.render(function(e,i){i===a.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===a.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}else if(r)break}if(-1===n&&(n=o),t.hasMultiplePages()){if(this.clearDistantSelectedPage(n+1,o+1),0!==this.lastScrollDir){var g=(this.lastScrollDir>0?o:n)+this.lastScrollDir;g>=0&&i>g&&this.pages[g].render(function(e,i){i===a.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===a.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}this.removeDistantPages(n,o,1)}this.currentPage=n+1,this.onCurrentPageChanged&&this.onCurrentPageChanged(n+1)},clearDistantSelectedPage:function(e,t){(this.selectedPage<=e||this.selectedPage>t)&&(this.selectedPage=null)},render:function(){0!=this.currentPage&&1!=this.currentPage?this.api.goToPage(this.currentPage):this.renderAllVisiblePages()},rotate:function(e){if(void 0!=e){var t=this.pages[e.pageIndex];if(void 0!=t){var i=t.viewport.rotation+e.rotation;(360===i||-360===i)&&(i=0),t.viewport.rotation=i,t.rotate(i),this.api.onPageRotation&&this.api.onPageRotation(e),this.setContainerSize(this.initialScale),this.thumbnail&&this.thumbnail.rotate(e)}}},rotatePages:function(e){var t=this.pages.length,i=this.rotation-e;(360===i||-360===i)&&(i=0),this.rotation=i;for(var n=0;t>n;++n)this.pages[n].rotate(i);this.setContainerSize(this.initialScale),this.thumbnail&&this.thumbnail.rotatePages(e)},downloadProgress:function(e){var t=0;if("undefined"==typeof e.total)for(;t<e.loaded;)t+=1048576;else t=e.total;this.onDataDownloaded&&this.onDataDownloaded("loading",e.loaded,t,"")},hookScope:function(n){var a=this,r=0,s=new o(a.element[0],200);n.$watchGroup(s.group,function(i){n.sizeWatcherTimeout&&t.cancel(n.sizeWatcherTimeout),n.sizeWatcherTimeout=t(function(){e.debug("SizeChanged"),a.setContainerSize(a.initialScale)},450)}),n.$watch("options.orientation",function(e){a.setOrientation(e)});var l=function(t,o,r,s,l){"render"===t&&1===r?"loaded"===o?i(a.element.contents())(n):"success"===o?e.debug("onProgress("+t+", "+o+", "+r+", "+s+")"):a.api.onError?a.api.onError(t,l):e.debug("Failed to render 1st page!\n\n"+l):"download"===t&&"loading"===o?a.api.downloadProgress=r/s*100:"failed"===o&&(a.api.onError?a.api.onError(t,l):e.debug("Something went really bad!\n\n"+l))};n.onPageClicked=function(e){a.selectedPage=e,a.onPageClicked&&a.onPageClicked(e),a.api.onPageClicked&&a.api.onPageClicked(e)},n.onPageRendered=function(e,t,i,n){l("render",e,t,i,n)},n.onDataDownloaded=function(e,t,i,n){l("download",e,t,i,n)},a.onPageRendered=angular.bind(n,n.onPageRendered),a.onDataDownloaded=angular.bind(n,n.onDataDownloaded),n.$on("$destroy",function(){if(null!=a.onDestroy){try{}catch(t){e.log(t)}a.onDestroy()}a.thumbnail=null,s.cancel(),a.element.empty(),e.debug("viewer destroyed")}),a.element.bind("scroll",function(e){n.scrollTimeout&&t.cancel(n.scrollTimeout),n.scrollTimeout=t(function(){var e=a.element[0].scrollTop,t=e-r;r=e;var i=t>0?1:0>t?-1:0;a.renderAllVisiblePages(i)},350)})}},l}]),e.factory("MultiPagesViewerAPI",["$log","MultiPagesConstants",function(e,t){function i(e){this.viewer=e}return i.prototype={getViewer:function(){return this.viewer},getZoomLevels:function(){return this.viewer.zoomLevels},zoomTo:function(e){void 0!=e&&this.viewer.setScale(e)},getZoomLevel:function(){return this.viewer.scaleItem},zoomIn:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e<this.viewer.zoomLevels.length&&this.zoomTo(this.viewer.zoomLevels[e+1])},zoomOut:function(){var e=this.viewer.zoomLevels.indexOf(this.getZoomLevel());e>0&&this.zoomTo(this.viewer.zoomLevels[e-1])},getCurrentPage:function(){return this.viewer.currentPage},getSelectedPage:function(){return this.viewer.selectedPage||this.viewer.currentPage},isPageSelected:function(e){return this.getSelectedPage()===e?"selected":null},goToPage:function(e){if(!(1>e||e>this.getNumPages())){var i=this.viewer.pages[e-1].container[0],n=this.viewer.element[0];if(this.viewer.orientation===t.ORIENTATION_HORIZONTAL){var a=i.offsetLeft-10;Math.round(n.scrollLeft)===a&&(a-=1),n.scrollLeft=a}else{var o=i.offsetTop-10;Math.round(n.scrollTop)===o&&(o-=1),n.scrollTop=o}}},goToNextPage:function(){this.goToPage(this.getSelectedPage()+1)},goToPrevPage:function(){this.goToPage(this.getSelectedPage()-1)},getNumPages:function(){return this.viewer.pages.length},rotatePagesRight:function(){this.viewer.rotatePages(90)},rotatePagesLeft:function(){this.viewer.rotatePages(-90)},rotatePageRight:function(e){this.rotatePage({pageIndex:e|this.getSelectedPage()-1,rotation:90})},rotatePageLeft:function(e){this.rotatePage({pageIndex:e|this.getSelectedPage()-1,rotation:-90})},rotatePage:function(e){this.viewer.rotate(e),this.onPageRotation&&this.onPageRotation(e)}},i}]),e.factory("PageViewport",[function(){function e(e,t,i,n,a,o){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=n,this.offsetY=a;var r,s,l,c,d=(e[2]+e[0])/2,u=(e[3]+e[1])/2;switch(i%=360,i=0>i?i+360:i){case 180:r=-1,s=0,l=0,c=1;break;case 90:r=0,s=1,l=1,c=0;break;case 270:r=0,s=-1,l=-1,c=0;break;default:r=1,s=0,l=0,c=-1}o&&(l=-l,c=-c);var p,f,g,h;0===r?(p=Math.abs(u-e[1])*t+n,f=Math.abs(d-e[0])*t+a,g=Math.abs(e[3]-e[1])*t,h=Math.abs(e[2]-e[0])*t):(p=Math.abs(d-e[0])*t+n,f=Math.abs(u-e[1])*t+a,g=Math.abs(e[2]-e[0])*t,h=Math.abs(e[3]-e[1])*t),this.transform=[r*t,s*t,l*t,c*t,p-r*t*d-l*t*u,f-s*t*d-c*t*u],this.width=g,this.height=h,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var i="scale"in t?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return Util.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=Util.applyTransform([e[0],e[1]],this.transform),i=Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]},convertToPdfPoint:function(e,t){return Util.applyInverseTransform([e,t],this.transform)}},e}]),e.factory("SizeWatcher",["$interval",function(e){return function(t,i){var n=this;(n.update=function(){n.dimensions=[t.offsetWidth,t.offsetHeight]})(),n.monitor=e(n.update,i),n.group=[function(){return n.dimensions[0]},function(){return n.dimensions[1]}],n.cancel=function(){e.cancel(n.monitor)}}}]),e.factory("TranslateViewer",["$translate",function(e){return{translate:function(t,i){var n=e.instant(t);return n!=t?n:i}}}]),t.factory("CustomStyle",[function(){function e(){}var t=["ms","Moz","Webkit","O"],i={};return e.getProp=function(e,n){if(1===arguments.length&&"string"==typeof i[e])return i[e];n=n||document.documentElement;var a,o,r=n.style;if("string"==typeof r[e])return i[e]=e;o=e.charAt(0).toUpperCase()+e.slice(1);for(var s=0,l=t.length;l>s;s++)if(a=t[s]+o,"string"==typeof r[a])return i[e]=a;return i[e]="undefined"},e.setProp=function(e,t,i){var n=this.getProp(e);"undefined"!==n&&(t.style[n]=i)},e}]),t.directive("itPdfViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){e.thumbnailCollapsed=!1,e.onPassword=function(e){return prompt("The selected PDF is password protected. PDF.js reason: "+e,"")},e.toggleThumbnail=function(){e.thumbnailCollapsed=!e.thumbnailCollapsed},t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div ui-layout="{ flow : \'column\', dividerSize : 0 }" class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar != false"></it-progressbar-viewer><it-toolbar-viewer  api="options.$$api" ng-if="options.showToolbar != false"></it-toolbar-viewer><div ng-if="options.showThumbnail != false" collapsed="thumbnailCollapsed" ui-layout-container size="210px" class="thumbnail-menu"><it-thumbnail-menu-viewer orientation="\'vertical\'" options="options"><div class="ui-splitbar-container-column pull-right"  ng-click="toggleThumbnail()"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-left"></span></div></it-thumbnail-menu-viewer></div><div ui-layout-container><pdf-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.$$api" options="options" password-callback="onPassword(reason)"></pdf-viewer></div><div class="ui-splitbar-container-column pull-left"  ng-click="toggleThumbnail()" ng-if="thumbnailCollapsed"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-right"></span></div></div>',link:i}}]),t.factory("PDFViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.findNext=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID+1;e>=this.viewer.searchResults.length&&(e=0),this.viewer.highlightSearchResult(e)}},i.prototype.findPrev=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID-1;0>e&&(e=this.viewer.searchResults.length-1),this.viewer.highlightSearchResult(e)}},i}]).factory("PDFPage",["$log","MultiPagesPage","MultiPagesConstants","TextLayerBuilder",function(e,t,i,n){function a(e,i){this.base=t,this.base(e.pageIndex),this.pdfPage=e,this.renderTask=null,this.hasTextLayer=i}return a.prototype=new t,a.prototype.clear=function(){null!==this.renderTask&&this.renderTask.cancel(),t.prototype.clear.call(this),this.renderTask=null},a.prototype.getViewport=function(e,t){return this.pdfPage.getViewport(e,t,0,0)},a.prototype.transform=function(){t.prototype.transform.call(this),this.textLayer=angular.element("<div class='text-layer'></div>"),this.textLayer.css("width",this.viewport.width+"px"),this.textLayer.css("height",this.viewport.height+"px")},a.prototype.renderPage=function(e,t){e.canvasRendered?(e.wrapper.append(e.canvas),e.hasTextLayer&&e.wrapper.append(e.textLayer)):(e.wrapper.append(e.canvas),e.renderTask=this.pdfPage.render({canvasContext:e.canvas[0].getContext("2d"),viewport:e.viewport}),e.renderTask.then(function(){e.renderTask=null,t&&t(e,i.PAGE_RENDERED),e.hasTextLayer&&e.pdfPage.getTextContent().then(function(t){var i=new n({textLayerDiv:e.textLayer[0],pageIndex:e.id,viewport:e.viewport});i.setTextContent(t),i.renderLayer(),e.wrapper.append(e.textLayer)})},function(n){e.rendered=!1,e.renderTask=null,"cancelled"===n?t&&t(e,i.PAGE_RENDER_CANCELLED):t&&t(e,i.PAGE_RENDER_FAILED)}))},a}]).factory("PDFViewer",["$log","MultiPagesViewer","PDFViewerAPI","PDFPage",function(e,t,i,n){function a(e){this.base=t,this.base(new i(this),e),this.pdf=null,this.passwordCallback=null}return a.prototype=new t,a.prototype.open=function(e,t,i,n,a){if(this.element.empty(),this.pages=[],void 0!==e&&null!==e&&""!==e){this.pageMargin=a,this.initialScale=t,this.hasTextLayer=i,this.orientation=n;var o="string"!=typeof e;if(void 0!=this.getDocumentTask){var r=this;this.getDocumentTask.destroy().then(function(){o?r.setFile(e):r.setUrl(e)})}else o?this.setFile(e):this.setUrl(e)}},a.prototype.setUrl=function(e){var t=this;this.getDocumentTask=PDFJS.getDocument(e,null,angular.bind(this,this.passwordCallback),angular.bind(this,this.downloadProgress)),this.getDocumentTask.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i,t.addPages()})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},a.prototype.setFile=function(e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result,n=new Uint8Array(i),a=PDFJS.getDocument(n,null,angular.bind(t,t.passwordCallback),angular.bind(t,t.downloadProgress));a.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i,t.addPages()})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)},a.prototype.getAllPages=function(e){var t=[],i={},a=this.pdf.numPages,o=a;if(this.hasTextLayer)for(var r=0;a>r;++r){t.push({});var s=this.pdf.getPage(r+1);s.then(function(a){var r=a.ref.num+" "+a.ref.gen+" R";i[r]=a.pageIndex+1;var s=new n(a,!0);t[a.pageIndex]=s,--o,0===o&&e(t,i)})}else for(var r=0;a>r;++r){t.push({});var s=this.pdf.getPage(r+1);s.then(function(a){t[a.pageIndex]=new n(a,!1),--o,0===o&&e(t,i)})}},a.prototype.onDestroy=function(){this.getDocumentTask&&(this.getDocumentTask.destroy(),this.getDocumentTask=null)},a}]).directive("pdfViewer",["$log","PDFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"=",passwordCallback:"&"},controller:["$scope","$element",function(n,a){var o=function(e){return null===n.options||void 0===n.options?null:n.options[e]};n.getPassword=function(t,i){if(this.passwordCallback){var n=this;this.$apply(function(){var a=n.passwordCallback({reason:i});""!==a&&void 0!==a&&null!==a?t(a):e.log("A password is required to read this document.")})}else e.log("A password is required to read this document.")};var r=new t(a);r.passwordCallback=angular.bind(n,n.getPassword),n.api=r.getAPI();var s=function(){var e=o("renderTextLayer");return typeof e==typeof!0?e:!1};n.onSrcChanged=function(){r.open(n.src,o("initialScale"),s(),o("orientation"),i)},n.onFileChanged=function(){r.open(n.file,o("initialScale"),s(),o("orientation"),i)},r.hookScope(n)}],link:function(e,t,i){i.$observe("src",e.onSrcChanged),e.$watch("file",e.onFileChanged)}}}]),t.factory("TextLayerBuilder",["CustomStyle",function(e){function t(e){return!a.test(e)}function i(e){this.textLayerDiv=e.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=e.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=e.viewport,this.textDivs=[],this.findController=e.findController||null}var n=1e5,a=/\S/;return i.prototype={_finishRendering:function(){this.renderingDone=!0;var e=document.createEvent("CustomEvent");e.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(e)},renderLayer:function(){var t=document.createDocumentFragment(),i=this.textDivs,a=i.length,o=document.createElement("canvas"),r=o.getContext("2d");if(a>n)return void this._finishRendering();for(var s,l,c=0;a>c;c++){var d=i[c];if(void 0===d.dataset.isWhitespace){var u=d.style.fontSize,p=d.style.fontFamily;(u!==s||p!==l)&&(r.font=u+" "+p,s=u,l=p);var f=r.measureText(d.textContent).width;if(f>0){t.appendChild(d);var g;if(void 0!==d.dataset.canvasWidth){var h=d.dataset.canvasWidth/f;g="scaleX("+h+")"}else g="";var m=d.dataset.angle;m&&(g="rotate("+m+"deg) "+g),g&&e.setProp("transform",d,g)}}}this.textLayerDiv.appendChild(t),this._finishRendering(),this.updateMatches()},render:function(e){if(this.divContentDone&&!this.renderingDone)if(this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),e){var t=this;this.renderTimer=setTimeout(function(){t.renderLayer(),t.renderTimer=null},e)}else this.renderLayer()},appendText:function(e,i){var n=i[e.fontName],a=document.createElement("div");if(this.textDivs.push(a),t(e.str))return void(a.dataset.isWhitespace=!0);var o=PDFJS.Util.transform(this.viewport.transform,e.transform),r=Math.atan2(o[1],o[0]);n.vertical&&(r+=Math.PI/2);var s=Math.sqrt(o[2]*o[2]+o[3]*o[3]),l=s;n.ascent?l=n.ascent*l:n.descent&&(l=(1+n.descent)*l);var c,d;0===r?(c=o[4],d=o[5]-l):(c=o[4]+l*Math.sin(r),d=o[5]-l*Math.cos(r)),a.style.left=c+"px",a.style.top=d+"px",a.style.fontSize=s+"px",a.style.fontFamily=n.fontFamily,a.textContent=e.str,PDFJS.pdfBug&&(a.dataset.fontName=e.fontName),0!==r&&(a.dataset.angle=r*(180/Math.PI)),a.textContent.length>1&&(n.vertical?a.dataset.canvasWidth=e.height*this.viewport.scale:a.dataset.canvasWidth=e.width*this.viewport.scale)},setTextContent:function(e){this.textContent=e;for(var t=e.items,i=0,n=t.length;n>i;i++)this.appendText(t[i],e.styles);this.divContentDone=!0},convertMatches:function(e){for(var t=0,i=0,n=this.textContent.items,a=n.length-1,o=null===this.findController?0:this.findController.state.query.length,r=[],s=0,l=e.length;l>s;s++){for(var c=e[s];t!==a&&c>=i+n[t].str.length;)i+=n[t].str.length,t++;t===n.length&&console.error("Could not find a matching mapping");var d={begin:{divIdx:t,offset:c-i}};for(c+=o;t!==a&&c>i+n[t].str.length;)i+=n[t].str.length,t++;d.end={divIdx:t,offset:c-i},r.push(d)}return r},renderMatches:function(e){function t(e,t){var n=e.divIdx;a[n].textContent="",i(n,0,e.offset,t)}function i(e,t,i,o){var r=a[e],s=n[e].str.substring(t,i),l=document.createTextNode(s);if(o){var c=document.createElement("span");return c.className=o,c.appendChild(l),void r.appendChild(c)}r.appendChild(l)}if(0!==e.length){var n=this.textContent.items,a=this.textDivs,o=null,r=this.pageIdx,s=null===this.findController?!1:r===this.findController.selected.pageIdx,l=null===this.findController?-1:this.findController.selected.matchIdx,c=null===this.findController?!1:this.findController.state.highlightAll,d={divIdx:-1,offset:void 0},u=l,p=u+1;if(c)u=0,p=e.length;else if(!s)return;for(var f=u;p>f;f++){var g=e[f],h=g.begin,m=g.end,v=s&&f===l,b=v?" selected":"";if(this.findController&&this.findController.updateMatchPosition(r,f,a,h.divIdx,m.divIdx),o&&h.divIdx===o.divIdx?i(o.divIdx,o.offset,h.offset):(null!==o&&i(o.divIdx,o.offset,d.offset),t(h)),h.divIdx===m.divIdx)i(h.divIdx,h.offset,m.offset,"highlight"+b);else{i(h.divIdx,h.offset,d.offset,"highlight begin"+b);for(var C=h.divIdx+1,w=m.divIdx;w>C;C++)a[C].className="highlight middle"+b;t(m,"highlight end"+b)}o=m}o&&i(o.divIdx,o.offset,d.offset)}},updateMatches:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,i=this.textContent.items,n=-1,a=0,o=e.length;o>a;a++){for(var r=e[a],s=Math.max(n,r.begin.divIdx),l=s,c=r.end.divIdx;c>=l;l++){var d=t[l];d.textContent=i[l].str,d.className=""}n=r.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}},i}]),e.directive("itThumbnailMenuViewer",["$log","TranslateViewer",function(e,t){var i=function(e,i,n){e.model={},e.model.sizes=[{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.SMALL","small"),
value:"small"},{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.MEDIUM","medium"),value:"medium"},{label:t.translate("GLOBAL.VIEWER.SIZE_MENU.BIG","big"),value:"big"}],e.model.currentSize=e.model.sizes[2]};return{scope:{options:"=",orientation:"="},transclude:!0,restrict:"E",template:'<div class="thumbnail-menu-select" ng-if="options.showSizeMenu != false"><select ng-model="model.currentSize" ng-options="size as size.label for size in model.sizes"></select></div><div class="thumbnail-menu-{{orientation}}-{{model.currentSize.value}}" ><it-thumbnail-viewer viewer-api="options.$$api" orientation="orientation" show-num-pages="options.showNumPages"></it-thumbnail-viewer><ng-transclude></ng-transclude></div>',link:i}}]),e.directive("itThumbnailViewer",["$log","ThumbnailViewer","$timeout",function(e,t,i){var n=10;return{restrict:"E",scope:{viewerApi:"=",orientation:"=",showNumPages:"="},controller:["$scope","$element",function(e,i){e.shouldShowNumPages=function(){var e=this.showNumPages;return typeof e==typeof!0?e:!0};var a=new t(i);i.addClass("thumbnail-viewer"),e.api=a.getAPI(),e.onViewerApiChanged=function(){a.open(e.viewerApi,e.orientation,e.shouldShowNumPages(),n)},a.hookScope(e)}],link:function(e,t,n){e.$watchGroup(["viewerApi.getNumPages()","showNumPages"],function(){e.onViewerApiChangedTimeout&&i.cancel(e.onViewerApiChangedTimeout),e.onViewerApiChangedTimeout=i(function(){e.onViewerApiChanged()},300)})}}}]),e.factory("ThumbnailViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.getSelectedPage=function(){return this.viewer.viewer.getAPI().getSelectedPage()},i}]).factory("ThumbnailPage",["$log","$timeout","MultiPagesPage","MultiPagesConstants",function(e,t,i,n){function a(e,t){this.base=i,this.base(e.pageIndex,e.view),t&&(this.pageNum=angular.element("<div class='num-page'>"+this.id+"</div>")),this.page=e}return a.prototype=new i,a.prototype.getViewport=function(e,t){return this.page.getViewport(e,t)},a.prototype.renderPage=function(e,t){this.page.renderPage(e,t),void 0!=this.pageNum&&e.wrapper.append(this.pageNum)},a}]).factory("ThumbnailViewer",["$log","ThumbnailViewerAPI","ThumbnailPage","MultiPagesViewer","MultiPagesConstants",function(e,t,i,n,a){function o(e){this.base=n,this.base(new t(this),e)}return o.prototype=new n,o.prototype.open=function(e,t,i,n){if(this.element.empty(),this.pages=[],null!=e){var o=this;this.viewer=e.getViewer(),this.viewer.thumbnail=this,this.pageMargin=n,this.showNumPages=i,this.orientation=t,this.orientation===a.ORIENTATION_HORIZONTAL?this.initialScale=a.ZOOM_FIT_HEIGHT:this.initialScale=a.ZOOM_FIT_WIDTH,this.getAllPages(function(e){o.pages=e,o.addPages(),o.setContainerSize(o.initialScale)})}},o.prototype.getAllPages=function(e){for(var t=[],n=this.viewer.pages.length,a=n,o=0;n>o;++o){t.push({});var r=new i(this.viewer.pages[o],this.showNumPages);t[o]=r,--a,0===a&&e(t)}},o.prototype.onContainerSizeChanged=function(e){this.showNumPages===!0&&this.orientation===a.ORIENTATION_HORIZONTAL&&(e.height-=20)},o.prototype.onPageClicked=function(e){this.viewer&&(this.viewer.api.goToPage(e),this.viewer.selectedPage=e)},o.prototype.clearDistantSelectedPage=function(e,t){},o.prototype.onDestroy=function(){null!=self.viewer&&(this.viewer.thumbnail=null,self.viewer=null)},o}]),i.directive("itTiffViewer",["$log","MultiPagesAddEventWatcher",function(e,t){var i=function(e,i,n){e.thumbnailCollapsed=!1,e.toggleThumbnail=function(){e.thumbnailCollapsed=!e.thumbnailCollapsed},t(e)};return{scope:{src:"=",options:"="},restrict:"E",template:'<div ui-layout="{ flow : \'column\', dividerSize : 0 }" class="multipage-container"><it-progressbar-viewer api="options.$$api" ng-if="options.showProgressbar != false"></it-progressbar-viewer><it-toolbar-viewer  api="options.$$api" ng-if="options.showToolbar != false"></it-toolbar-viewer><div ng-if="options.showThumbnail != false" collapsed="thumbnailCollapsed" ui-layout-container size="210px" class="thumbnail-menu"><it-thumbnail-menu-viewer orientation="\'vertical\'" options="options"><div class="ui-splitbar-container-column pull-right"  ng-click="toggleThumbnail()"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-left"></span></div></it-thumbnail-menu-viewer></div><div ui-layout-container><tiff-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.$$api" options="options"></tiff-viewer></div><div class="ui-splitbar-container-column pull-left"  ng-click="toggleThumbnail()" ng-if="thumbnailCollapsed"><span class="collapsed-splitbar-button ui-splitbar-icon ui-splitbar-icon-right"></span></div></div>',link:i}}]),i.factory("TIFFPage",["$log","$timeout","MultiPagesPage","MultiPagesConstants",function(e,t,i,n){function a(e,t,n){this.base=i,this.base(e,n),this.getSrc=t}return a.prototype=new i,a.prototype.renderPage=function(e,i){var a=this;if(e.canvasRendered)e.wrapper.append(e.canvas);else{e.wrapper.append(e.canvas);var o=e.canvas[0].getContext("2d");o.transform.apply(o,e.viewport.transform);var r=new Image;r.onload=function(){o.drawImage(r,0,0),i&&i(e,n.PAGE_RENDERED)},t(function(){void 0==a.src&&(a.src=a.getSrc(e.pageIndex)),r.src=a.src},50)}},a}]).factory("TIFFViewer",["$log","MultiPagesViewerAPI","TIFFPage","MultiPagesViewer",function(e,t,i,n){function a(e){this.base=n,this.base(new t(this),e),this.tiff=null}try{Tiff.initialize({TOTAL_MEMORY:167772160})}catch(o){e.debug("Lib tiff throw exception on set TOTAL_MEMORY : "+o)}return a.prototype=new n,a.prototype.open=function(e,t,i,n){this.element.empty(),this.pages=[],this.pageMargin=n,this.initialScale=t,this.orientation=i;var a="string"!=typeof e;a?this.setFile(e):this.setUrl(e)},a.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onprogress=angular.bind(this,t.downloadProgress),i.onload=function(e){t.loadTiff(i.response)},i.send()}},a.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){t.loadTiff(e.target.result)},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},a.prototype.loadTiff=function(e){var t=this;t.onDestroy(),t.tiff=new Tiff({buffer:e}),t.getAllPages(function(e){t.pages=e,t.addPages()})},a.prototype.getAllPages=function(e){function t(e){return r.tiff.setDirectory(e),r.tiff.toDataURL()}for(var n=[],a=this.tiff.countDirectory(),o=a,r=this,s=0;a>s;++s){n.push({}),this.tiff.setDirectory(s);var l=new i(s,t,[0,0,this.tiff.width(),this.tiff.height()]);n[s]=l,--o,0===o&&e(n)}},a.prototype.onDestroy=function(){null!=self.tiff&&(self.tiff.close(),self.tiff=null)},a}]).directive("tiffViewer",["$log","TIFFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",options:"="},controller:["$scope","$element",function(e,n){var a=function(t){return null===e.options||void 0===e.options?null:e.options[t]},o=new t(n);e.api=o.getAPI(),e.onSrcChanged=function(){o.open(this.src,a("initialScale"),a("orientation"),i)},e.onFileChanged=function(){o.open(this.file,a("initialScale"),a("orientation"),i)},o.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}])}();