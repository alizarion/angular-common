/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * Angular-common, v1.0.0
 *Itesoft common Angularjs libs.*/
!function(){var e=angular.module("itesoft",["ngSanitize","ui.bootstrap.tabs","ui.bootstrap.modal","ui.bootstrap.tpls","ngAnimate","matchMedia","ui.grid","ui.grid.pagination","ngRoute","pascalprecht.translate","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.grouping","LocalStorageModule","ngToast","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","ui.codemirror"]);e.directive("itCircularBtn",[function(){return{restrict:"ACE",scope:!1,transclude:!0,template:'<span class="it-circular-button-container "><button class="btn  pull-right" > <div class="it-animated-circular-button"><ng-transclude></ng-transclude></div></button> </span>'}}]),e.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,i,n){t.$watch(function(e){return e.$eval(n.itCompile)},function(n){i.html(n),e(i.contents())(t)})}}])}]),e.directive("itModalFullScreen",["$timeout","$window","$document",function(e,t,i){function n(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),a=parseInt(o["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i}var o='<div class="it-modal-full-screen" ng-class="$isModalOpen? $onOpenCss : \'\'"><div class="it-modal-full-screen-header pull-right"><div  ng-if="$isModalOpen"  class="it-modal-full-screen-button "><button class="btn " ng-click="$closeModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-compress"></i></div></button></div><div  ng-if="!$isModalOpen"  class="it-modal-full-screen-button "> <button class="btn pull-right"  ng-click="$openModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-expand"></i></div></button> </div></div><div  class="it-modal-full-screen-content it-fill"  ng-transclude> </div></div>';return{restrict:"EA",transclude:!0,scope:!1,template:o,link:function(o,a,r,l){var s=isNaN(parseInt(r.itZIndex))?null:parseInt(r.itZIndex);o.$onOpenCss=r.itOpenClass?r.itOpenClass:"it-modal-background";var c=isNaN(parseInt(r.itEscapeKey))?27:parseInt(r.itEscapeKey),d=angular.element(a[0].querySelector(".it-modal-full-screen")),u=angular.element(d[0]);o.$openModal=function(){o.$isModalOpen=!0;var i=document.getElementsByTagName("html"),a=t.getComputedStyle(i[0]),r=parseInt(a.top),l=parseInt(a["margin-top"]),c=parseInt(a["padding-top"]),d=(isNaN(parseInt(r))?0:parseInt(r))+(isNaN(parseInt(l))?0:parseInt(l))+(isNaN(parseInt(c))?0:parseInt(c));u.addClass("it-opened"),u.css("top",d+"px"),null!==s?u.css("z-index",s):u.css("z-index",n()+100),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)},o.$closeModal=function(){o.$isModalOpen=!1,o.$applyAsync(function(){u.removeAttr("style"),u.removeClass("it-opened"),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)})},i.on("keyup",function(e){e&&e.keyCode==c&&o.$closeModal()})}}}]),e.directive("itBusyIndicator",["$timeout","$http",function(e,t){function i(i,o,a){i.$watch(function(){return t.pendingRequests.length>0},function(t){n&&e.cancel(n),t===!0?n=e(function(){i.hasPendingRequests=!0},250):i.hasPendingRequests=!1})}var n;return{link:i,restrict:"AE",transclude:!0,scope:{isBusy:"="},template:'<div class="mask-loading-container" ng-show="hasPendingRequests"></div><div class="main-loading-container" ng-show="hasPendingRequests || isBusy"><i class="fa fa-circle-o-notch fa-spin fa-4x text-primary "></i></div><ng-transclude ng-show="!isBusy" class="it-fill"></ng-transclude>'}}]),e.directive("itLoader",["$http","$rootScope",function(e,t){return{restrict:"EA",scope:!0,template:'<span class="fa-stack"><i class="fa fa-refresh fa-stack-1x" ng-class="{\'fa-spin\':$isLoading}"></i></span>',link:function(t){t.$watch(function(){e.pendingRequests.length>0?t.$applyAsync(function(){t.$isLoading=!0}):t.$applyAsync(function(){t.$isLoading=!1})})}}}]),e.factory("itAmountCleanerService",[function(){var e=["en_US","en_GB","fr_FR","de_DE","id_IT"];return{cleanAmount:function(t,i){var n=0,o=!1;return e.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(o=!0)}),0==o?(console.log("Unable to format amount for local "+i),""):(t=t.replace(/[^0-9,.]/g,""),(JSON.stringify(i)==JSON.stringify(e[2])||JSON.stringify(i)==JSON.stringify(e[4]))&&(t=t.replace(",",".")),JSON.stringify(i)==JSON.stringify(e[0])?t=t.replace(",",""):JSON.stringify(i)==JSON.stringify(e[3])&&(t=t.replace(".",""),t=t.replace(",",".")),n=parseFloat(t),console.log("result1 "+n),void 0==n&&(n=parseFloat(t)),console.log("result2 "+n),n)},formatAmount:function(t,i,n){var o="",a=!1;if(e.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(a=!0)}),0==a)return console.log("Unable to format amount for local "+i),"";if(void 0!=t){var r=t.toString();r=r.replace(/[^0-9,.]/g,""),(JSON.stringify(i)==JSON.stringify(e[2])||JSON.stringify(i)==JSON.stringify(e[4]))&&(r=r.replace(",","."))}return o=angular.isDefined(n)?"TND"===n?new Intl.NumberFormat(i.replace("_","-"),{minimumFractionDigits:3,maximumFractionDigits:3}).format(parseFloat(r)):"YEN"===n?new Intl.NumberFormat(i.replace("_","-"),{minimumFractionDigits:0,maximumFractionDigits:0}).format(parseFloat(r)):new Intl.NumberFormat(i.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(r)):new Intl.NumberFormat(i.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(r))}}}]),e.directive("itLazyGrid",["OPERATOR","NOTIFICATION_TYPE","itQueryFactory","itQueryParamFactory","itAmountCleanerService","localStorageService","$rootScope","$log","$q","$templateCache","$timeout",function(e,t,i,n,o,a,r,l,s,c,d){return{restrict:"AE",scope:{options:"="},template:'<div ui-grid="lazyGrid.fields.gridOptions"  ui-grid-selection ui-grid-pagination ui-grid-auto-resize="true" class="it-fill it-sp-lazy-grid"><div class="it-watermark sp-watermark gridWatermark" ng-show="!lazyGrid.fields.gridOptions.data.length"> {{\'GLOBAL.NO_DATA\' |translate}} </div> </div> <!------------------------------------------------------------------------------------------------------------------------------- FILTER --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="dropDownFilter.html"> <div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"> <it-autocomplete items="colFilter.options.data" selected-option="colFilter.term" input-class="col.headerCellClass" option-container-class="colFilter.class"> </div> </script> <script type="text/ng-template" id="dateRangeFilter.html"> <div class="ui-grid-filter-container"> <span class="{{col.headerCellClass}}"> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[0].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[0].emptyOption | translate}}" ng-model="col.filters[0].term" data-min-date="{{col.filters[0].dateMin}}" data-max-date="{{col.filters[1].term}}" data-autoclose="1" name="date" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[1].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[1].emptyOption | translate}}" ng-model="col.filters[1].term" data-min-date="{{col.filters[0].term}}" data-max-date="{{col.filters[1].dateMax}}" data-autoclose="1" name="date2" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> </span></div> </script> <script type="text/ng-template" id="stringFilter.html"> <div class="ui-grid-filter-container {{col.headerCellClass}}" ng-repeat="colFilter in col.filters"> <input type="text" class="form-control" ng-model="colFilter.term" pattern="{{colFilter.pattern}}" placeholder="{{colFilter.emptyOption | translate}}" maxlength="{{colFilter.maxLength}}"> </div> </script> <!------------------------------------------------------------------------------------------------------------------------------- PAGINATOR --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="paginationTemplate.html"> <div role="contentinfo" class="ui-grid-pager-panel" ui-grid-pager ng-show="grid.options.enablePaginationControls"> <div role="navigation" class="ui-grid-pager-container"> <div role="menubar" class="ui-grid-pager-control"> <button type="button" role="menuitem" class="ui-grid-pager-first it-sp-grid-pager-first" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" ng-click="pageFirstPageClick()" ng-disabled="cantPageBackward()"> <div class="first-triangle"> <div class="first-bar"> </div> </div> </button> <button type="button" role="menuitem" class="ui-grid-pager-previous it-sp-grid-pager-previous" bs-tooltip title="{{ \'HELP.PREVPAGE\' | translate }}" ng-click="pagePreviousPageClick()" ng-disabled="cantPageBackward()"> <div class="first-triangle prev-triangle"></div> </button> <input type="number" class="ui-grid-pager-control-input it-sp-grid-pager-control-input" ng-model="grid.options.paginationCurrentPage" min="1" max="{{ paginationApi.getTotalPages() }}" required/> <span class="ui-grid-pager-max-pages-number it-sp-grid-pager-max-pages-number" ng-show="paginationApi.getTotalPages() > 0"> <abbr> / </abbr> {{ paginationApi.getTotalPages() }} </span> <button type="button" role="menuitem" class="ui-grid-pager-next it-sp-grid-pager-next " bs-tooltip title="{{ \'HELP.NEXTPAGE\' | translate }}" ng-click="pageNextPageClick()" ng-disabled="cantPageForward()"> <div class="last-triangle next-triangle"></div> </button> <button type="button" role="menuitem" class="ui-grid-pager-last it-sp-grid-pager-last" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" ng-click="pageLastPageClick()" ng-disabled="cantPageToLast()"> <div class="last-triangle"> <div class="last-bar"> </div> </div> </button> </div> <div class="ui-grid-pager-row-count-picker it-sp-grid-pager-row-count-picker" ng-if="grid.options.paginationPageSizes.length > 1"> <select ui-grid-one-bind-aria-labelledby-grid="\'items-per-page-label\'" ng-model="grid.options.paginationPageSize" ng-options="o as o for o in grid.options.paginationPageSizes"></select><span ui-grid-one-bind-id-grid="\'items-per-page-label\'" class="ui-grid-pager-row-count-label"> &nbsp; </span> </div> <span ng-if="grid.options.paginationPageSizes.length <= 1" class="ui-grid-pager-row-count-label it-sp-grid-pager-row-count-label"> {{grid.options.paginationPageSize}}&nbsp;{{sizesLabel}} </span> </div> <div class="ui-grid-pager-count-container"><div class="ui-grid-pager-count"> <span class="it-sp-grid-pager-footer-text" ng-show="grid.options.totalItems > 0"> {{\'PAGINATION.INVOICE.FROM\' | translate}} {{showingLow}} <abbr> </abbr> '+"{{'PAGINATION.INVOICE.TO' | translate}} {{showingHigh}} {{'PAGINATION.INVOICE.ON' | translate}} {{grid.options.totalItems}} {{'PAGINATION.INVOICE.TOTAL' | translate}} </span> </div> </div> </div> </script>",controllerAs:"lazyGrid",controller:["$scope",function(t){function r(){l.debug("LazyGrid:Apply External filter"),angular.forEach(k.fields.externalFilter,function(e,t){if(!angular.isUndefined(t)&&!angular.isUndefined(e.value)&&!angular.isUndefined(e.condition)){var i=n.create(t,e.value,e.condition);k.fields.filter.push(i)}})}function s(){l.debug("LazyGrid:Apply filter");var t="",i="",a=e.EQUALS;if(angular.isDefined(k.fields.gridApi.grid))for(var r=0;r<k.fields.gridApi.grid.columns.length;r++){t=k.fields.gridApi.grid.columns[r].field;for(var s=0;s<k.fields.gridApi.grid.columns[r].filters.length;s++)if(i=k.fields.gridApi.grid.columns[r].filters[s].term,void 0!=i&&""!=i){l.debug("LazyGrid:Filter changed, fieds: "+t+", and value: "+i);var c=k.fields.gridApi.grid.columns[r].filters[s].rsqlKey;void 0!=c&&(t=c),void 0!=k.fields.gridApi.grid.columns[r].filters[s].condition&&(a=k.fields.gridApi.grid.columns[r].filters[s].condition),1==k.fields.gridApi.grid.columns[r].filters[s].amount&&(i=o.cleanAmount(i,I));var d=n.create(t,i,a);k.fields.filter.push(d)}}}function u(){l.debug("LazyGrid:Apply default filter"),angular.isDefined(k.fields.gridApi.grid)&&angular.forEach(k.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&angular.isDefined(e.colDef.filters[0].defaultTerm)&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)||(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,l.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function p(){l.debug("LazyGrid:Reset Filter and Apply default filter"),angular.isDefined(k.fields.gridApi.grid)&&angular.forEach(k.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)?angular.forEach(e.colDef.filters,function(e){e.term=""}):(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,l.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function f(){}function g(){}function m(){l.debug("LazyGrid:Filter Changed"),k.fields.filter=[],angular.isDefined(k.fields.promise.refresh)&&d.cancel(k.fields.promise.refresh),k.fields.promise.refresh=d(function(){k.fn.refresh()},1e3)}function h(e,t){if(l.debug("LazyGrid:Sort Changed"),k.fields.filter=[],0==t.length)k.fields.paginationOptions.sort.name=void 0,k.fields.paginationOptions.sort.direction=void 0;else{var i=t[0].name;angular.isDefined(t[0])&&angular.isDefined(t[0].colDef)&&angular.isDefined(t[0].colDef.sorterRsqlKey)&&(i=t[0].colDef.sorterRsqlKey),k.fields.paginationOptions.sort.name=i,k.fields.paginationOptions.sort.direction=t[0].sort.direction,l.debug("sort changed, sort key: "+t[0].name+", and direction: "+t[0].sort.direction)}k.fn.refresh()}function v(e,t){l.debug("LazyGrid:Pagination Changed"),k.fields.filter=[],(k.fields.paginationOptions.pageNumber!=e||k.fields.paginationOptions.pageSize!=t)&&(k.fields.paginationOptions.pageNumber=e,k.fields.paginationOptions.pageSize=t,k.fn.refresh())}function C(){l.debug("LazyGrid:Row Selection Changed")}function b(){l.debug("LazyGrid:Refresh"),r(),s();var e=(k.fields.paginationOptions.pageNumber-1)*k.fields.paginationOptions.pageSize,t=i.create(k.fields.filter,e,k.fields.paginationOptions.pageSize,k.fields.paginationOptions.sort);k.fn.callBack(t)}function E(){l.debug("LazyGrid:Initial load"),s(),k.fields.filter.length<=0&&u(),k.fields.filter=[],k.fn.refresh()}function S(e){return angular.isUndefined(e.key)?void l.error("External filter object must have key"):angular.isUndefined(e.condition)?void l.error("External filter object must have condition"):void(angular.isUndefined(e.value)?k.fields.externalFilter[e.key]={}:k.fields.externalFilter[e.key]=e)}function y(){}var I=a.get("Locale"),k=this;k.options=t.options,k.fields={template:{pagination:c.get("paginationTemplate.html")},filter:[],externalFilter:{},gridApi:{},gridOptions:{},paginationOptions:{},appScope:{},promise:{refresh:{}}},k.on={loaded:f,ready:g,filterChange:m,sortChange:h,paginationChanged:v,rowSelectionChanged:C},k.fn={callBack:k.options.callBack,initialize:y,refresh:b,initialLoad:E,addExternalFilter:S,refreshDefaultFilter:p},k.fields.paginationOptions={pageNumber:1,pageSize:10,sort:{name:void 0,direction:void 0}},k.fields.gridOptions={enableFiltering:!0,enableSorting:!0,enableColumnMenus:!1,useExternalPagination:!0,useExternalSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!0,useExternalFiltering:!0,data:[],columnDefs:[],paginationTemplate:k.fields.template.pagination,onRegisterApi:function(e){e.core.on.filterChanged(k.appScope,k.on.filterChange),e.core.on.sortChanged(k.appScope,k.on.sortChange),e.pagination.on.paginationChanged(k.appScope,k.on.paginationChanged),e.selection.on.rowSelectionChanged(k.appScope,k.on.rowSelectionChanged),k.fields.gridApi=e,l.debug("LazyGrid:UI-grid:onRegisterApi")}},angular.isDefined(k.options.onRegisterApi)&&(k.options.onRegisterApi(k),l.debug("LazyGrid:onRegisterApi"))}]}}]).constant("OPERATOR",{EQUALS:"==",LIKE:"==%",NOT_EQUALS:"!=",LESS_THAN:"=lt=",LESS_EQUALS:"=le=",GREATER_THAN:"=gt=",GREATER_EQUALS:"=ge="}).constant("NOTIFICATION_TYPE",{INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS",DISMISS:"DISMISS"}),e.factory("itPaginatorConfigService",["$q","$log","itNotifier","$filter","MetadataService",function(e,t,i,n,o){function a(){if(r.fields.loaded)t.debug("PaginatorConfigService: loaded"),l.resolve("ok");else{var a=o.getConfig.get({type:"paginatorOptions"}).$promise,s=o.getConfig.get({type:"paginatorDefaultOption"}).$promise;e.all([a,s]).then(function(e){r.fields.defaultOption=e[1].value;var o=e[0].value;angular.isDefined(o)&&null!=o&&angular.isDefined(o.split)?r.fields.options=o.split(","):i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},o),t.debug("PaginatorConfigService: loaded"),r.fields.loaded=!0,l.resolve("ok")},function(e){i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},e.data)})}return l.promise}var r=this,l=e.defer();return r.fields={options:[],defaultOption:"",loaded:!1},r.fn={initialize:a},r}]),e.factory("itQueryParamFactory",[function(){function e(e,t,i){this.key=e,this.value=t,this.operator=i}return{create:function(t,i,n){return new e(t,i,n)}}}]),e.factory("itQueryFactory",["OPERATOR",function(e){function t(t,i,n,o){this.parameters=t,this.start=i,this.size=n,this.sort=o,this.build=function(){var a="";return void 0!=t&&this.parameters.forEach(function(t){angular.isDefined(t.value)&&angular.isDefined(t.key)&&(t.value instanceof Date&&t.operator==e.LESS_EQUALS&&(t.value.setHours(23),t.value.setMinutes(59),t.value.setSeconds(59),t.value.setMilliseconds(999)),a.length>0&&(a+=" and "),t.value instanceof Date&&(t.value=t.value.toISOString()),t.operator==e.LIKE&&(t.value=t.value+"%"),a+=t.key+t.operator+t.value)}),a="query="+a,null!=n&&angular.isDefined(n)&&""!=n&&(a+="&size="+this.size),null!=i&&angular.isDefined(i)&&""!=i&&(a+="&start="+this.start),void 0!=o&&void 0!=this.sort.name&&(a+="&sort=","desc"==this.sort.direction&&(a+="-"),a+=this.sort.name),a}}return{create:function(e,i,n,o){return new t(e,i,n,o)}}}]),e.directive("itDetail",[function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:' <div ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))"   ng-if="currentItemWrapper.currentItem"  class="it-master-detail-slide-left col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" > <div class="it-fill" ng-transclude></div></div><div  ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))" class="col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" ng-if="!currentItemWrapper.currentItem"><div class="it-watermark" >{{$itNoDetail}}</div></div>'}}]),e.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill"> <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),e.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!1,transclude:!0,template:'<div class="fluid-container"><div class="row it-md-header"><div class="col-md-2 it-fill  col-xs-2"><a href="" ng-if="$parent.$parent.$parent.mobile" ng-click="$parent.$parent.$parent.$parent.goToMaster()" class="it-material-design-hamburger__icon pull-left it-fill "> <span  class="menu-animated it-material-design-hamburger__layer " ng-class="{\'it-material-design-hamburger__icon--to-arrow\':$parent.$parent.$parent.$parent.mobile}"> </span> </a></div><div class="col-md-10 col-xs-10 it-fill "><div class="btn-toolbar  it-fill pull-right " ng-transclude></div></div></div></div>'}}),e.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",priority:-1,transclude:!0,scope:{itMasterData:"=",itLang:"=",itCol:"=",itMasterDetailControl:"=",itLockOnChange:"=",itNoDataMsg:"@",itNoDetailMsg:"@"},template:'<div  ng-show="($parent.$parent.activeState == \'master\')" class=" it-master it-master-detail-slide-right col-md-{{itCol ? itCol : 6}} it-fill " ui-i18n="{{itLang}}"><div class="row" ng-transclude></div><div class="row it-master-grid it-fill" ><div class="col-md-12 it-fill"><div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns  ui-grid-move-columns  ui-grid-auto-resize class="it-master-detail-grid it-fill "><div class="it-watermark" ng-show="!gridOptions.data.length" >{{itNoDataMsg}}</div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache","$route","$window",function(e,t,i,n,o,a,r,l){function s(t){var i=this;angular.forEach(e.itMasterData,function(e,n){angular.equals(e,t)&&(i.index=n)}),i.originalItem=t,i.currentItem=angular.copy(t),i.hasChanged=!1,i.isWatched=!1,i.unlockOnEquals=!0}function c(t){e.itMasterDetailControl.disableMultiSelect||(e.gridApi.selection.getSelectedRows().length>1?e.$parent.currentItemWrapper=null:1===e.gridApi.selection.getSelectedRows().length?(d(e.gridApi.selection.getSelectedRows()[0]),u(e.gridApi.selection.getSelectedRows()[0])):0===e.gridApi.selection.getSelectedRows().length&&(e.$parent.currentItemWrapper=null))}function d(t){var n=i.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange?(n.reject("undo or save before change"),n.promise):(e.$parent.currentItemWrapper=new s(t),n.resolve(""),n.promise)}function u(t){e.gridApi.core.scrollTo(t)}function p(){e.$applyAsync(function(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)})}function f(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange&&(o.alert(e.itMasterDetailControl.navAlert),t.preventDefault())}a.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input type="checkbox" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange " tabindex="-1"  ng-checked="row.isSelected"></div>'),a.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="(grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange  )? \'return false\':headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged  && grid.appScope.itLockOnChange" ng-model="grid.selection.selectAll"></div>'),e.$parent.$masterCol=e.itCol,s.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},s.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.$parent.$itNoDetail=e.itNoDetailMsg,e.gridOptions={rowHeight:40,data:e.itMasterData,multiSelect:!e.itMasterDetailControl.disableMultiSelect,enableSelectAll:!e.itMasterDetailControl.disableMultiSelect,enableRowHeaderSelection:!e.itMasterDetailControl.disableMultiSelect,showGridFooter:!0,enableMinHeightCheck:!0,enableColumnResizing:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(e){c(e)}),t.selection.on.rowSelectionChangedBatch(e,function(e){c(e)})},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span ng-show="!grid.appScope.itMasterDetailControl.disableMultiSelect" class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},"undefined"!=typeof e.itMasterDetailControl.columnDefs&&angular.forEach(e.itMasterDetailControl.columnDefs,function(e){e.headerCellTemplate='<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.onRowClick=function(t,i){void 0!=i.entity&&"undefined"!=typeof t.providedHeaderCellTemplate&&d(i.entity).then(function(n){"ui-grid/selectionHeaderCell"!==t.providedHeaderCellTemplate&&(e.gridApi.selection.clearSelectedRows(),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail()),e.gridApi.selection.toggleRowSelection(i.entity),e.$emit("MASTER_ROW_CHANGED",i.entity)},function(t){o.alert(e.itMasterDetailControl.navAlert)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.refreshData=function(){var i=t("itUIGridGlobalFilter")(e.gridOptions.data,e.gridOptions,e.filterText);angular.forEach(e.gridApi.grid.rows,function(t){var n=!1;i.forEach(function(e){angular.equals(t.entity,e)&&(n=!0)}),n?e.gridApi.core.clearRowInvisible(t):e.gridApi.core.setRowInvisible(t)})},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),p())},e.$on("unlockCurrentItem",function(){p()}),e.itMasterDetailControl.scrollToItem=function(e){u(e)},e.itMasterDetailControl.getSelectedItems=function(){return"undefined"!=typeof e.gridApi&&"function"==typeof e.gridApi.selection.getSelectedRows?e.gridApi.selection.getSelectedRows():[]},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){var t=e.gridApi.core.getVisibleRows(e.gridApi.grid),i=[];return angular.forEach(t,function(e){i.push(e.entity)}),i},e.itMasterDetailControl.setCurrentItem=function(t){var o=i.defer();return e.gridApi.selection.clearSelectedRows(),d(t).then(function(){n(function(){var i=e.itMasterData.indexOf(t);i>=0?(e.gridApi.selection.selectRow(t),u(t),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail(),o.resolve()):o.reject()})},function(){o.reject()}),o.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.$on("unlockCurrentItem",function(){n(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){n(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.itAppScope.$navAlert=e.itMasterDetailControl.navAlert;var g=angular.element(l);g.bind("resize",function(){e.gridApi.core.handleWindowResize()}),e.itMasterDetailControl.initState=!0,e.$on("$locationChangeStart",f),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes",buttons:[{text:"OK",type:"btn-info",onTap:function(){return!1}}]}},e.itMasterDetailControl),e.$watch("itLang",function(){e.gridApi.grid.refresh()}),e.$watch("itMasterData",function(){e.gridOptions.data=[],e.itMasterData.forEach(function(t){e.gridOptions.data.push(t)}),"undefined"==typeof e.itMasterData||null===e.itMasterData?e.$parent.currentItemWrapper=null:0===e.itMasterData.length&&(e.$parent.currentItemWrapper=null),e.gridApi.grid.refresh(),null!==e.itMasterDetailControl&&"undefined"!=typeof e.itMasterDetailControl.getCurrentItemWrapper()&&null!=e.itMasterDetailControl.getCurrentItemWrapper()&&e.$applyAsync(function(){u(e.itMasterDetailControl.getCurrentItemWrapper().originalItem)}),e.refreshData()},!0),n(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),l.dispatchEvent(e)},250),e.$watch("$parent.currentItemWrapper.currentItem",function(t,i){null!=e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.unlockOnEquals?e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem):e.$parent.currentItemWrapper.hasChanged=!0)},!0),e.$watch("filterText",function(){e.refreshData()},!0),e.$watch("itNoDetailMsg",function(){e.$parent.$itNoDetail=e.itNoDetailMsg})}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,i,n){function o(e,t){var i,n=t.split("."),o=e;for(i=0;i<n.length;++i){if(void 0==o[n[i]])return void 0;o=o[n[i]]}return o}var a=[];if(void 0===n||""===n)return t;n=n.toLowerCase();for(var r=e.$new(!0),l=0;l<t.length;l++)for(var s=0;s<i.columnDefs.length;s++){var c=t[l],d=i.columnDefs[s].field,u=o(c,d);if(i.columnDefs[s].cellFilter&&(r.value=u,u=r.$eval("value | "+i.columnDefs[s].cellFilter)),"undefined"!=typeof u&&null!=u&&u.toString().toLowerCase().indexOf(n)>-1){a.push(c);break}}return r.$destroy(),a}}]),e.directive("itMasterDetail",["itPopup","$timeout","$window",function(e,t,i){return{restrict:"EA",transclude:!0,scope:!0,template:'<div it-bottom-glue="" class="it-master-detail-container jumbotron "> <div class="it-fill row " ng-transclude></div></div>',controller:["$scope","screenSize",function(n,o){n.activeState="master",n.desktop=o.on("md, lg",function(e){n.desktop=e}),n.mobile=o.on("xs, sm",function(e){n.mobile=e}),n.goToDetail=function(){n.activeState="detail"},n.$watch("mobile",function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper?n.activeState="detail":n.activeState="master"}),n.$watch("$$childHead.currentItemWrapper",function(){!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!==n.$$childHead.currentItemWrapper?!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper.currentItem&&null!==n.$$childHead.currentItemWrapper.currentItem||(n.activeState="master"):n.activeState="master"}),n.goToMaster=function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper&&n.$$childHead.currentItemWrapper.hasChanged&&n.$$childHead.$$childHead.itLockOnChange?e.alert(n.$$childHead.$navAlert):(n.activeState="master",t(function(){i.dispatchEvent(new Event("resize"))},300))}}]}}]),e.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:'<div class="fuild-container">   <div class="row it-fill">   <div class="it-md-header col-xs-12 col-md-12"><div class="btn-toolbar it-fill" ng-transclude></div></div><div class="col-xs-12 col-md-12 pull-right"><div><form><div class="form-group has-feedback it-master-header-search-group  col-xs-12 col-md-{{$parent.itCol < 4 ? 12 :6 }} pull-right" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  class="form-control " type="text" ng-model="$parent.filterText" class="form-control floating-label"  placeholder="{{placeholderText}}"/></div></form></div></div></div></div>',
link:function(e,t,i){e.$watch(function(){return i.itSearchPlaceholder},function(t){e.placeholderText=t})}}}),e.directive("itAutocomplete",function(){return{restrict:"AE",scope:{items:"=",selectedOption:"=",inputClass:"=",optionClass:"=",optionContainerClass:"=",searchMode:"=",placeholder:"="},controllerAs:"itAutocompleteCtrl",controller:["$scope","$rootScope","$translate","$document","$timeout","$log",function(e,t,i,n,o,a){function r(e){a.debug("itAutocomplete: select with  id "+e);var t=!1;b.fields.selectedItem={},angular.isDefined(e)&&(angular.forEach(b.fields.items,function(i){i.id==e&&(d(i),t=!0)}),t||c())}function l(e){a.debug("itAutocomplete: unselect with id "+e),angular.isDefined(e)&&angular.forEach(b.fields.items,function(t){t.id==e&&u(t)})}function s(){a.debug("itAutocomplete: copy option items"),angular.copy(e.items,b.fields.items),c()}function c(){var e=0;angular.forEach(b.fields.items,function(t){angular.isDefined(b.fields.selectedItem)&&(b.fields.selectedItem!=t?u(t):d(t)),t.position=e,e++})}function d(t){if(a.debug("itAutocomplete: select "+t.id),angular.isDefined(b.fields.selectedItem)&&u(b.fields.selectedItem),angular.isDefined(t)){e.focusIndex=t.position,b.fields.selectedItem=t,e.selectedOption=t.id,b.fields.selectedItem["class"]=b.fields.selectedSelectClass;var i=n[0].querySelector("#options_"+t.id);p(i)}}function u(e){e["class"]=b.fields.defaultSelectClass}function p(e){var t=n[0].querySelector("#"+b.fields.optionContainerId);if(angular.isDefined(e)&&null!=e&&angular.isDefined(e.getBoundingClientRect())&&angular.isDefined(t)&&null!=t){var i=e.getBoundingClientRect().top+e.getBoundingClientRect().height+t.scrollTop,o=t.getBoundingClientRect().top+t.getBoundingClientRect().height,a=i-o;t.scrollTop=a}}function f(t){angular.isUndefined(t)?(b.fields.showItems=!1,b.fields.inputSearch=b.fields.selectedItem.value):document.activeElement.parentElement.firstElementChild.classList.contains(b.fields.inputClass)?e.$applyAsync(function(){t.srcElement.focus()}):(b.fields.showItems=!1,b.fields.inputSearch=b.fields.selectedItem.value)}function g(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function m(e){if(angular.isDefined(e)&&-1!=g()){var t=e.srcElement.parentElement.children[1],i=angular.element(e.srcElement.parentElement)[0];if(angular.isDefined(t)&&angular.isDefined(i)&&"fixed"==t.currentStyle.position){var n=i.getBoundingClientRect().top+i.getBoundingClientRect().height;t.style.setProperty("top",n+"px")}}b.fields.showItems=!0}function h(){if(a.debug("itAutocomplete: input search change value"),b.fields.items=[],""==b.fields.inputSearch)s();else{var t=0;angular.forEach(e.items,function(e){"startsWith"==b.fields.searchMode?e.value.toLowerCase().startsWith(b.fields.inputSearch.toLowerCase())&&(b.fields.items.push(e),b.fields.items[t].position=t,t++):-1!=e.value.toLowerCase().search(b.fields.inputSearch.toLowerCase())&&(b.fields.items.push(e),b.fields.items[t].position=t,t++)})}1==b.fields.items.length&&d(b.fields.items[0]),m()}function v(t){var i=t.keyCode;e.keys.forEach(function(e){e.code===i&&e.action()})}function C(){var e=(new Date).getTime(),t="option_container_xxxxxxxxxxxx4yxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}var b=this;b.fields={items:[],inputSearch:"",showItems:!1,optionClass:e.optionClass,optionContainerClass:e.optionContainerClass,inputClass:e.inputClass,defaultSelectClass:"",selectedSelectClass:"",selectedItem:{},searchMode:e.searchMode,placeholder:e.placeholder},angular.isUndefined(b.fields.optionClass)&&(b.fields.optionClass=""),angular.isUndefined(b.fields.optionContainerClass)&&(b.fields.optionContainerClass=""),angular.isUndefined(b.fields.inputClass)&&(b.fields.inputClass="it-autocomplete-input-class"),angular.isUndefined(b.fields.placeholder)&&(b.fields.placeholder=""),b.fields.optionContainerClass=b.fields.optionContainerClass+" it-autocomplete-container",b.fields.defaultSelectClass=b.fields.optionClass+" it-autocomplete-select",b.fields.selectedSelectClass=b.fields.defaultSelectClass+" it-autocomplete-selected",b.fields.optionContainerId=C(),b.fn={select:d,change:h,init:c,fullInit:s,hideItems:f,showItems:m,keyBoardInteration:v},s(),e.focusIndex=-1,r(e.selectedOption),e.$watch("items",function(t,i){a.debug("itAutocomplete: items value changed"),s(),r(e.selectedOption),f()}),e.$watch("selectedOption",function(e,t){a.debug("itAutocomplete: selectedOption value changed"),angular.isDefined(t)&&l(t),(angular.isUndefined(b.fields.selectedItem)||e!=b.fields.selectedItem.id)&&(r(e),f())}),e.$watch("focusIndex",function(t,i){a.debug("itAutocomplete: focusIndex value changed"),t!=i&&(0>t?e.focusIndex=-1:t>=b.fields.items.length&&(e.focusIndex=b.fields.items.length-1),angular.isDefined(b.fields.items)&&d(b.fields.items[e.focusIndex]))}),e.keys=[];const E=13,S=38,y=40;e.keys.push({code:E,action:function(){b.fields.showItems?f():(m(),""==b.fields.inputSearch&&(e.focusIndex=-1))}}),e.keys.push({code:S,action:function(){m(),e.focusIndex--}}),e.keys.push({code:y,action:function(){m(),e.focusIndex++}})}],template:'<div class="col-xs-12 it-autocomplete-div"><input placeholder="{{itAutocompleteCtrl.fields.placeholder}}" ng-keydown="itAutocompleteCtrl.fn.keyBoardInteration($event)" ng-focus="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" type="text" class="form-control" ng-class="inputClass" ng-change="itAutocompleteCtrl.fn.change()" ng-model="itAutocompleteCtrl.fields.inputSearch"> <div  ng-class="itAutocompleteCtrl.fields.optionContainerClass" id="{{itAutocompleteCtrl.fields.optionContainerId}}" ng-show="itAutocompleteCtrl.fields.showItems" ><div class="it-autocomplete-content"  ng-repeat="item in itAutocompleteCtrl.fields.items"><div ng-class="item.class" id="options_{{item.id}}"  ng-mousedown="itAutocompleteCtrl.fn.select(item)">{{item.value | translate}}</div></div></div></div>'}}),e.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="checkbox"></div>'),n.wrap("<label></label>"),n.after('<span class="checkbox-material"><span class="check" style="margin-right:16px;width: '+i.width+";height:"+i.height+';"></span></span>&nbsp;'+(i.itLabel||""))}}}),e.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,i,n){if(n){var o=angular.element(t[0]);if(o.hasClass("floating-label")){o.wrap('<div class="form-control-wrapper"></div>');var a=o.attr("placeholder");a?o.after('<div class="floating-label">'+a+"</div"):(o.after('<div class="floating-label">'+e.itLabel+"</div"),e.$watch("itLabel",function(t){e.$applyAsync(function(){if(o[0].offsetParent){var e=o[0].offsetParent.children;angular.forEach(e,function(e){var i=angular.element(e);i.hasClass("floating-label")&&i.text(t)})}})})),o.after('<span class="material-input"></span>'),o.attr("placeholder","").removeClass("floating-label")}o.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(o[0].offsetParent){var t=o[0].offsetParent.children;angular.forEach(t,function(t){var i=angular.element(t);i.hasClass("text-danger")&&(i.text(e),""!=e&&void 0!=e?(i.removeClass("ng-hide"),i.addClass("ng-show"),i.css("display","block")):(i.removeClass("ng-show"),i.addClass("ng-hide"),i.css("display","none")))})}}),(null===o.val()||"undefined"==o.val()||""===o.val())&&o.addClass("empty"),e.$watch(function(){return n.$modelValue},function(e,t){null===e||void 0==e||""===e?o.addClass("empty"):o.removeClass("empty")}),o.on("change",function(){null===o.val()||"undefined"==o.val()||""===o.val()?o.addClass("empty"):o.removeClass("empty")})}},scope:{itError:"=",itLabel:"@"}}}),e.directive("itSearch",function(){return{restrict:"A",replace:!0,scope:{itSearchControl:"="},link:function(e,t,i){var n=angular.element(t[0]);n.after('<span class="glyphicon glyphicon-search form-control-feedback"/>')},controller:["$scope",function(e){e.itSearchControl.multicolumnsFilter=function(t){var i=new RegExp(e.itSearchControl.filterText,"i"),n=[],o=!1;return e.itSearchControl.columnDefs&&t.forEach(function(t){var a=!1;t.entity?(e.itSearchControl.columnDefs.forEach(function(n){if(!a&&t.entity[n.field]){var o=t.entity[n.field].toString();n.cellFilter&&(e.value=o,o=e.$eval("value | "+n.cellFilter)),"undefined"!=typeof o&&null!=o&&o.match(i)&&(a=!0)}}),a||(t.visible=!1)):(o=!0,e.itSearchControl.columnDefs.forEach(function(e){!a&&t[e.field]&&t[e.field].toString().match(i)&&(a=!0)}),a&&n.push(t))}),o&&(t=n),t}}]}}),e.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="togglebutton"></div>'),void 0==e.itLabel?(n.wrap("<label></label>"),n.after('<span class="toggle"></span>')):(n.wrap("<label></label>"),n.after('<span class="toggle"></span><span>'+(e.itLabel||"")+"</span>"),e.$watch("itLabel",function(e){if(e&&n.context){var t=angular.element(n.context.parentNode);if(t&&i.itLabel){var o=angular.element(t.get(0).firstChild);o.get(0).textContent=e+"  "}}}))},scope:{itLabel:"@"}}}]),e.directive("konami",["$document","$uibModal",function(e,t){return{restrict:"A",template:'<style type="text/css"> @-webkit-keyframes easterEggSpinner { from { -webkit-transform: rotateY(0deg); } to { -webkit-transform: rotateY(-360deg); } } @keyframes easterEggSpinner { from { -moz-transform: rotateY(0deg); -ms-transform: rotateY(0deg); transform: rotateY(0deg); } to { -moz-transform: rotateY(-360deg); -ms-transform: rotateY(-360deg); transform: rotateY(-360deg); } } .easterEgg { -webkit-animation-name: easterEggSpinner; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite; -webkit-animation-duration: 6s; animation-name: easterEggSpinner; animation-timing-function: linear; animation-iteration-count: infinite; animation-duration: 6s; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d; } .easterEgg img { position: absolute; border: 1px solid #ccc; background: rgba(255,255,255,0.8); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); } </style>',link:function(i){var n=[38,38,40,40,37,39,37,39,66,65],o=0,a=function(r){if(r.keyCode===n[o++]){if(o===n.length){e.off("keydown",a);var l=t.open({template:'<div style="max-width: 100%;" class="easterEgg"> <img style="-webkit-transform: rotateY(0deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-72deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-144deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-216deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-288deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> </div>',size:"lg"});i.cancel=function(){l.dismiss("cancel")}}}else o=0};e.on("keydown",a),i.$on("$destroy",function(){e.off("keydown",a)})}}}]),e.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,i){function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return o[e]})}var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(n(t[0].innerHTML))}}}}]),e.directive("itBottomGlue",["$window","$timeout",function(e,t){return function(i,n){function o(){for(var t=n[0],i=angular.element(n)[0],o=0,a=0,r=0,l=0;null!==t&&"undefined"!=typeof t;){var s=e.getComputedStyle(t),c=parseInt(s["margin-bottom"],10),d=parseInt(s["padding-bottom"],10),u=parseInt(s["padding-top"],10),p=parseInt(s["margin-top"],10);l+=isNaN(p)?0:p,o+=isNaN(c)?0:c,a+=isNaN(d)?0:d,r+=isNaN(u)?0:u,t=t.parentElement}var f=e.getComputedStyle(n[0]),g=parseInt(f["padding-bottom"],10),m=i.getBoundingClientRect();n.css("height",e.innerHeight-m.top-o-(a-g)+"px"),n.css("overflow-y","auto")}t(function(){o(),e.addEventListener("resize",function(){o()})},250)}}]),e.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,i){var n=angular.element(t[0].querySelector("ul")),o=angular.element(t[0].querySelector("a"));n.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var a=angular.element(t[0].querySelector("h5")),r=angular.element('<i class="pull-right fa fa-angle-right" ></i>');a.append(r),o.on("click",function(){n.hasClass("it-side-menu-collapse")?(n.removeClass("it-side-menu-collapse"),n.addClass("it-side-menu-expanded"),r.removeClass("fa-angle-right"),r.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),r.addClass("fa-angle-right"),r.removeClass("fa-angle-down"),n.removeClass("it-side-menu-expanded"),n.addClass("it-side-menu-collapse"))})}}}),e.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,i,n){function o(){var t=e.path();t&&angular.forEach(i.find("li"),function(e){var i=e.querySelector("a");i.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(a):angular.element(e).removeClass(a)})}var a=n.itActive||"active";o(),t.$on("$locationChangeSuccess",o)}}}]),e.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div class="it-sidebar-inner"><div class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),e.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!0,template:'<div class="it-menu-content" ng-class="{\'it-side-menu-overlay\':showmenu}"><div class="it-container it-fill" ng-transclude></div></div>'}}),e.controller("$sideMenuCtrl",["$scope","$document","$timeout","$window",function(e,t,i,n){var o=this;o.scope=e,o.scope.showmenu=!1,o.toggleMenu=function(){o.scope.showmenu=o.scope.showmenu?!1:!0,i(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),n.dispatchEvent(e)},300)},o.hideSideMenu=function(){o.scope.showmenu=!1}}]),e.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,i,n,o){var a=angular.element(i[0].querySelector(".it-material-design-hamburger__layer"));angular.element(i[0].querySelector(".it-material-design-hamburger__icon"));t.toggleMenu=o.toggleMenu,"true"===n.itAnimate&&t.$watch("showmenu",function(t,i){t!=i&&(t?(a.removeClass("it-material-design-hamburger__icon--from-arrow"),a.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed")):(a.removeClass("it-material-design-hamburger__icon--to-arrow"),a.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")))},!0),n.itHideButtonMenu&&(t.itHideButtonMenu=t.$eval(n.itHideButtonMenu)),t.$watch(n.itHideButtonMenu,function(e,i){t.itHideButtonMenu=e,e&&o.hideSideMenu()})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itHideButtonMenu"><button  ng-click="toggleMenu()" class="it-material-design-hamburger__icon"><span class="it-menu-animated it-material-design-hamburger__layer"> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),e.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),e.directive("itSidePanel",["$window",function(e){function t(e,t,i){e.itSidePanelElement=t,e.setIconClass(e,i),e.setZIndexes(t,i),e.setColMd(i),e.setHeightMode(i),e.setTopPosition(i)}return{link:t,restrict:"E",transclude:!0,controller:"$sidePanelCtrl",scope:!0,template:'<div class="it-side-panel-container" ng-class="{\'it-side-panel-container-show\': showPanel}"><div class="it-side-panel-button it-vertical-text" ng-class="{\'it-side-panel-button-show\':showPanel,\'it-side-panel-button-right\':!showPanel}" ng-click="toggleSidePanel()"><span class="fa {{itIconClass}}"></span></div><div class="it-side-panel" ng-transclude></div></div>'}}]),e.directive("itSidePanelContent",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-content" ng-transclude></div>'}}),e.controller("$sidePanelCtrl",["$scope","$window","$document","$timeout","$log",function(e,t,i,n,o){var a="it-col",r="it-height-mode",l="it-top-position",s=40,c="z-index",d="window",u="full",p="auto",f=[d,u,p],g=d,m=4,h=12,v=1,C="fa-search",b="none",E=b,S=".it-side-panel-button",y=".it-side-panel-button-right",I=".it-side-panel-container",k=".it-side-panel",A=".it-side-panel-header",T=".it-side-panel-content",$=".it-side-panel-footer",O=this;O.scope=e,O.scope.showPanel=!1,O.scope.itHeightMode=g,O.scope.itSidePanelcolMd=m,O.scope.itSidePanelTopPosition=b,O.scope.sidePanelButtonWidth=s,O.scope.sidePanelContainerWidth=null,O.scope.sidePanelContainerRight=null,O.scope.sidePanelButtonRight=null;var w=angular.element(t);O.scope.getWindowDimensions=function(){return{height:t.innerHeight,width:t.innerWidth}},O.scope.$watch(O.scope.getWindowDimensions,function(e,t){O.scope.windowHeight=e.height,O.scope.windowWidth=e.width;var i=O.scope.getElementFromClass(O.scope.itSidePanelElement,I);if(O.scope.itHeightMode===d){var n=i[0].getBoundingClientRect().top;if(Math.abs(n)<O.scope.windowHeight){var o=O.scope.itSidePanelTopPosition;O.scope.isNoneTopPosition()&&(o=0);var a=O.scope.windowHeight-n-o,r=.1*a,l=O.scope.getElementFromClass(O.scope.itSidePanelElement,A);l.css("height",r+"px");var s=.1*a,c=O.scope.getElementFromClass(O.scope.itSidePanelElement,$);c.css("height",s+"px");var u=O.scope.getElementFromClass(O.scope.itSidePanelElement,T);u.css("height",.8*a+"px")}}if(O.scope.showPanel){var p=O.scope.windowWidth/12*O.scope.itSidePanelcolMd;O.scope.sidePanelContainerWidth=p,i.css("width",p+"px")}else O.scope.modifySidePanelCssProperties()},!0),O.scope.modifySidePanelCssProperties=function(){var e=O.scope.getElementFromClass(O.scope.itSidePanelElement,I),t=O.scope.getElementFromClass(O.scope.itSidePanelElement,y),i=O.scope.windowWidth/12*O.scope.itSidePanelcolMd;O.scope.sidePanelContainerWidth=i,O.scope.sidePanelContainerRight=-O.scope.sidePanelContainerWidth,O.scope.sidePanelButtonRight=O.scope.sidePanelContainerWidth,e.css("width",O.scope.sidePanelContainerWidth+"px"),e.css("right",O.scope.sidePanelContainerRight+"px"),t.css("right",O.scope.sidePanelButtonRight+"px")},w.bind("resize",function(){O.scope.$apply()}),O.scope.toggleSidePanel=function(){O.scope.showPanel=O.scope.showPanel?!1:!0;var e=O.scope.getElementFromClass(O.scope.itSidePanelElement,I),t=O.scope.getElementFromClass(O.scope.itSidePanelElement,S);if(O.scope.showPanel)t.css("right",""),n(function(){O.scope.sidePanelContainerRight=0,e.css("right",O.scope.sidePanelContainerRight+"px")},50);else{var i=e.css("width");O.scope.sidePanelContainerRight=-parseInt(i.slice(0,i.length-2)),O.scope.sidePanelButtonRight=O.scope.sidePanelContainerWidth,e.css("right",O.scope.sidePanelContainerRight+"px"),t.css("right",O.scope.sidePanelButtonRight+"px")}},O.scope.setItSidePanelElement=function(e){O.scope.itSidePanelElement=e},O.scope.setHeightMode=function(e){if(O.scope.itHeightMode=e.itHeightMode,""===O.scope.itHeightMode||"undefined"==typeof O.scope.itHeightMode)O.scope.itHeightMode=g;else if(-1!=f.indexOf(O.scope.itHeightMode)){var t=f.indexOf(O.scope.itHeightMode);O.scope.itHeightMode=f[t]}else O.scope.itHeightMode=g,o.error('"'+r+'" with value "'+O.scope.itHeightMode+'"is unknown. The default value is taken : "'+g+'"');var i=O.scope.getElementFromClass(O.scope.itSidePanelElement,A);i.css("height","10%");var n=O.scope.getElementFromClass(O.scope.itSidePanelElement,$);n.css("height","10%");var a=O.scope.getElementFromClass(O.scope.itSidePanelElement,T);switch(a.css("height","80%"),O.scope.itHeightMode){case u:var l=O.scope.getElementFromClass(O.scope.itSidePanelElement,I),s=l.css("height");if(s>O.scope.windowHeight){l.css("height","100%");var c=O.scope.getElementFromClass(O.scope.itSidePanelElement,k);c.css("height","100%")}break;case p:break;case d:var c=O.scope.getElementFromClass(O.scope.itSidePanelElement,k);c.css("height","100%");var a=O.scope.getElementFromClass(O.scope.itSidePanelElement,T);a.css("overflow","auto");break;default:o.error('Height mode : "'+O.scope.itHeightMode+'" is unknown.')}},O.scope.setIconClass=function(e,t){var i=C;""===t.itIconClass||"undefined"==typeof t.itIconClass?O.scope.itIconClass=i:O.scope.itIconClass=t.itIconClass},O.scope.setColMd=function(e){isNaN(parseInt(e.itCol))?(O.scope.itSidePanelcolMd=m,o.warn('Attribute "'+a+'" of itSidePanel directive is not a number. The default value is taken : "'+O.scope.itSidePanelcolMd+'"')):e.itCol>h?(O.scope.itSidePanelcolMd=h,o.warn('Attribute "'+a+'" of itSidePanel directive exceeds the maximum value ('+h+"). The maximum value is taken.")):e.itCol<v?(O.scope.itSidePanelcolMd=v,o.warn('Attribute "'+a+'" of itSidePanel directive exceeds the minimum value ('+v+"). The minimum value is taken.")):O.scope.itSidePanelcolMd=e.itCol},O.scope.setZIndexes=function(e,t){var i=null;isNaN(parseInt(t.itZIndex))||(i=parseInt(t.itZIndex));var n=O.scope.getElementFromClass(e,I),o=O.scope.getElementFromClass(e,S);if(null!==i)n.css(c,i),o.css(c,i+1);else{var a=O.scope.findHighestZIndex(),r=a+100;n.css(c,r),o.css(c,r+1)}},O.scope.getElementFromClass=function(e,t){var i=angular.element(e[0].querySelector(t)),n=angular.element(i[0]);return n},O.scope.findHighestZIndex=function(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var o=t.getComputedStyle(e[n]),a=parseInt(o["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i},O.scope.setTopPosition=function(e){var t=e.itTopPosition;if(isNaN(parseInt(t)))O.scope.isNoneTopPosition()&&"undefined"!=typeof t||(O.scope.itSidePanelTopPosition=E,o.warn('Attribute "'+l+'" of itSidePanel directive is not a number. The mode taken is "'+E+'"'));else{O.scope.itSidePanelTopPosition=e.itTopPosition;var i=O.scope.getElementFromClass(O.scope.itSidePanelElement,I);i.css("top",O.scope.itSidePanelTopPosition+"px")}},O.scope.isNoneTopPosition=function(){return"none"===O.scope.itSidePanelTopPosition}}]),e.directive("itSidePanelFooter",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-footer" ng-transclude></div>'}}),e.directive("itSidePanelHeader",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-header text-center" ng-transclude></div>'}}),e.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(i,n,o){function a(){var o,a=angular.element(t[0].getElementById(i.footerElementId));o=1===a.length?a[0].offsetHeight+r(a)+l(a):0;var s=n[0].offsetTop,c=l(n),d=i.additionalPadding||0,u=e.innerHeight-s-c-o-d;n.css("height",u+"px")}function r(e){var t=s(e,"margin-top"),i=s(e,"border-top-width");return t+i}function l(e){var t=s(e,"margin-bottom"),i=s(e,"border-bottom-width");return t+i}function s(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",a),a()}}}]),e.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),e.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),e.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),e.factory("BlockService",["$resource","CONFIG",function(e,t){return{custom:e(t.REST_TEMPLATE_API_URL+"/blocks/custom/"+t.CURRENT_PACKAGE+"/:name"),all:e(t.REST_TEMPLATE_API_URL+"/blocks/all/"+t.CURRENT_PACKAGE+"/:name"),original:e(t.REST_TEMPLATE_API_URL+"/blocks/original/:name"),customByOriginal:e(t.REST_TEMPLATE_API_URL+"/original/"+t.CURRENT_PACKAGE+"/:name/custom"),restore:e(t.REST_TEMPLATE_API_URL+"/blocks/restore/"+t.CURRENT_PACKAGE+"/:name"),build:e(t.REST_TEMPLATE_API_URL+"/packages/build"),preview:e(t.REST_TEMPLATE_API_URL+"/packages/preview"),"new":function(e,t,i,n,o,a){return{name:e,position:i,ref:t,content:n,role:o,version:a}}}}]),e.directive("itBlock",[function(){return{restrict:"E",scope:!0,transclude:!0,template:'<ng-transclude  class="{{itBlockController.hilightClass}}" ng-mouseover="itBlockController.over()" ng-mouseleave="itBlockController.leave()" ng-if="!removed || $root.editSite"> </ng-transclude>',controllerAs:"itBlockController",link:function(e,t,i,n,o){o(e,function(t){var i="";angular.forEach(t,function(e){e.outerHTML&&(i+=e.outerHTML)}),e.content=i}),e.ref=i.ref,e.role=i.role,e.position=i.position,e.name=i.name,e.removed=!1,e.element=t,e.version=i.version,angular.isDefined(i.removed)&&(e.removed=i.removed),this.fields={},n.onRegisterApi()},controller:["$scope","$rootScope","$location","$log","$interval","$timeout","$document","itPopup","BlockService","PilotSiteSideService",function(e,t,i,n,o,a,r,l,s,c){var d=this;d.focusable=!1,t.$on("hilightBlock",function(t,i){angular.isDefined(i)&&i.name==d.block.name?d.hilightClass="block-hilight":e.removed?d.hilightClass="block-removed":d.hilightClass=""}),d.onRegisterApi=function(){d.block=s["new"](e.name,e.ref,e.position,e.content,e.role,e.version),d.block.removed=e.removed},d.leave=function(){t.$emit("unSelectBlock",d.block)},d.over=function(){t.$emit("selectBlock",d.block)},t.$watch("editSite",function(){t.editSite&&(a(function(){e.removed&&(d.hilightClass="block-removed")},500),a(function(){angular.isDefined(e.element.find("ng-transclude")[0])&&(e.element.find("ng-transclude")[0].children[0].disabled=!1)},500))})}]}}]),e.directive("itBlockControlPanel",[function(){return{restrict:"EA",scope:!0,template:'<div class="block-control-panel" ng-show="itBlockControlPanelController.CONFIG.ENABLE_TEMPLATE_EDITOR"><div ng-if="itBlockControlPanelController.editorIsOpen"/> <div ng-if="!$root.editSite" class="btn btn-primary" ng-click="$root.editSite=true" >{{\'TEMPLATE.BLOCK.EDIT\' | translate}}</div><div ng-if="$root.editSite"  class="btn btn-primary" ng-click="$root.editSite=false" >{{\'TEMPLATE.BLOCK.READONLY\' | translate}}</div><div class="block-control-panel-action-container"><it-circular-btn ng-click="itBlockControlPanelController.refresh()"><li class="fa fa-refresh"></li></it-circular-btn><it-circular-btn ng-if="$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=false"><li class="fa fa-stop"></li></it-circular-btn><it-circular-btn ng-if="!$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=true"><li class="fa fa-play"></li></it-circular-btn><it-circular-btn><a ng-href="{{itBlockControlPanelController.url}}" target="_blank" ><li class="fa fa-floppy-o"></li></a></div><span class="block-control-panel-help">(Press Ctrl and move your mouse over a block to select it)</span></div><div class=" btn btn-danger offline-editor"  ng-if="!itBlockControlPanelController.editorIsOpen" aria-label="Left Align"><span class="fa fa-exclamation glyphicon-align-left" aria-hidden="true"></span><a  target="_blank" ng-href="{{CONFIG.TEMPLATE_EDITOR_URL}}" >{{\'TEMPLATE.BLOCK.OPEN_EDITOR\' | translate}}</a></div><div class="block-lists"  ng-if="$root.editSite"><div ng-repeat="block in itBlockControlPanelController.blocks | orderBy:\'-name\'" ng-mouseover="itBlockControlPanelController.hilightBlock(block)" class="{{itBlockControlPanelController.getClass(block)}}"><div class="block-lists-name">{{block.name}}</div><div class="block-lists-action"><it-circular-btn ng-click="itBlockControlPanelController.addBlock(block)"><li class="fa fa-plus "></li></it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.editBlock(block)"><li  class="fa fa-pencil"></li></it-circular-btn><it-circular-btn ng-if="block.removed" ng-click="itBlockControlPanelController.restoreBlock(block)"><li  class="fa fa-eye"></li></it-circular-btn><it-circular-btn ng-if="!block.removed" ng-click="itBlockControlPanelController.deleteBlock(block)"><li  class="fa fa-eye-slash block-btn"></li></it-circular-btn></div></div></div></div>',controllerAs:"itBlockControlPanelController",controller:["$scope","$rootScope","$location","$log","$document","$filter","BlockService","PilotSiteSideService","PilotService","CONFIG","itPopup","itNotifier",function(e,t,i,n,o,a,r,l,s,c,d,u){var p=this;p.editorIsOpen=!1,p.CONFIG=c,p.blocks=[],p.url=c.REST_TEMPLATE_API_URL+"/export/"+c.CURRENT_PACKAGE,this.refresh=function(){r.build.get(function(){location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},p.interval=0,l.on.pong=function(t){n.debug("pong"),e.$applyAsync(function(){p.editorIsOpen=!0})},l.on.editorConnect=function(t){n.debug("editorConnect"),e.$applyAsync(function(){p.editorIsOpen=!0})},l.on.editorDisconnect=function(t){n.debug("editorDisconnect"),e.$applyAsync(function(){p.editorIsOpen=!1})},l.on.close=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){p.editorIsOpen=!1})},l.on.error=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){p.editorIsOpen=!1})},l.on.transportFailure=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){p.editorIsOpen=!1})},l.on.reload=this.refresh,this.editJS=function(){n.debug("edit JS"),l.fn.editPage({fileName:"js.blocks.js",fileType:"js",filePackage:c.CURRENT_PACKAGE})},this.editCSS=function(){n.debug("edit CSS"),l.fn.editPage({fileName:"css.blocks.css",fileType:"css",filePackage:c.CURRENT_PACKAGE})},this.addFile=function(){n.debug("add File"),l.fn.createPage()},c.ENABLE_TEMPLATE_EDITOR&&(t.editSite=!0,t.autoRefreshTemplate=!0,o.bind("keydown",function(e){
17!=e.keyCode||p.focusable||(o.find("*").addClass("crosshair"),n.log("keydown"),p.focusable=!0,p.blocks=[],p.hilightedBlock=void 0,p.hilightBlock(void 0))}),o.bind("keyup",function(e){17==e.keyCode&&p.focusable&&(n.log("keyup"),o.find("*").removeClass("crosshair"),p.focusable=!1)}),t.$on("selectBlock",function(e,t){p.focusable&&-1==p.blocks.indexOf(t)&&p.blocks.push(t)}),t.$on("unSelectBlock",function(e,t){p.focusable&&-1!=p.blocks.indexOf(t)&&p.blocks.splice(p.blocks.indexOf(t),1)})),this.editBlock=function(e){if(n.debug("edit block"),angular.isDefined(e.ref)&&""!=e.ref)l.fn.editBlock(e,i.path());else{var t=r["new"]("PS_replace"+e.name,e.name,"replace",e.content,"PS",1);l.fn.createBlock(t,i.path())}},this.addBlock=function(e){if(angular.isDefined(e.name)&&""!=e.name){n.debug("add block");var t=r["new"]("PS_new_"+e.name,e.name,"before","","PS",1);l.fn.createBlock(t,i.path())}},this.restoreBlock=function(e){n.debug("restore block"),r.restore.get({name:e.name},function(){r.build.get(function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(t){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},t.data.body),n.error("Unable to restore block "+JSON.stringify(e))})})},this.deleteBlock=function(e){n.debug("delete block");var i=d.confirm({title:"{{'DELETE_BLOCK_TITLE' | translate}}",text:"{{'DELETE_BLOCK_CONFIRM' | translate}}",buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});i.then(function(i){r.all["delete"]({name:e.name},function(){r.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(){u.notifyError({content:"{{'BLOCK_DELETED_KO' | translate}}"})})},p.hilightBlock=function(e){p.hilightedBlock=e,t.$emit("hilightBlock",e)},p.getClass=function(e){return p.hilightedBlock&&p.hilightedBlock.name==e.name?"block-lists-element-hilight":""}}]}}]),e.factory("PilotService",["$resource","$log","CONFIG",function(e,t,i){function n(e){t.log("ping "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PING,params:[]}))}function o(e){t.log("pong "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PONG,params:[]}))}var a=this;return a.ACTION_EDIT_BLOCK="editBlock",a.ACTION_REMOVE_BLOCK="removeBlock",a.ACTION_CREATE_BLOCK="createBlock",a.ACTION_EDIT_PAGE="editPage",a.ACTION_REMOVE_PAGE="removePage",a.ACTION_CREATE_PAGE="createPage",a.ACTION_PING="ping",a.ACTION_PONG="pong",a.ACTION_DISCONNECT="disconnect",a.ACTION_TIMEOUT="timeout",a.ACTION_CONNECT="connect",a.ACTION_RELOAD="reload",a.DEST_EDITOR="editor",a.DEST_SITE="site",a.DEST_ALL="all",a.fields={socket:{},request:{url:i.REST_EDITOR_API_URL,contentType:"application/json",logLevel:"debug",transport:"websocket",trackMessageLength:!0,reconnectInterval:5e3,enableXDR:!0,timeout:6e4},model:{},dest:""},a.fn={ping:n,pong:o},a.on={message:{},open:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},a.fields.request.onOpen=function(e){a.fields.model.transport=e.transport,a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.open)&&a.on.open()},a.fields.request.onClientTimeout=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_TIMEOUT,params:[]})),setTimeout(function(){a.fields.socket=atmosphere.subscribe(a.fields.request)},a.fields.request.reconnectInterval)},a.fields.request.onReopen=function(e){a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.reopen)&&a.on.reopen()},a.fields.request.onTransportFailure=function(e,t){atmosphere.util.info(e),t.fallbackTransport="long-polling",angular.isDefined(a.on.transportFailure)&&a.on.transportFailure()},a.fields.request.onMessage=function(e){a.on.message(e)},a.fields.request.onClose=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_DISCONNECT,params:[]})),angular.isDefined(a.on.close)&&a.on.close()},a.fields.request.onError=function(e){a.fields.model.logged=!1,angular.isDefined(a.on.error)&&a.on.error()},a.fields.request.onReconnect=function(e,t){a.fields.model.connected=!1},a.fields.socket=atmosphere.subscribe(a.fields.request),a}]),e.factory("PilotSiteSideService",["$resource","$log","CONFIG","PilotService",function(e,t,i,n){function o(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_BLOCK,params:[{block:e,path:t}]}))}function a(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_BLOCK,params:[{block:e,path:t}]}))}function r(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_BLOCK,params:[{block:e,path:t}]}))}function l(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_PAGE,params:[{page:e}]}))}function s(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_PAGE,params:[{page:e}]}))}function c(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_PAGE,params:[{page:e}]}))}var d=this;return d.fields={},d.fn={editBlock:o,removeBlock:a,createBlock:r,editPage:l,removePage:s,createPage:c,ping:n.fn.ping},d.on={reload:void 0,pong:void 0,editorConnect:void 0,editorDisconnect:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},n.fields.dest=n.DEST_EDITOR,n.on.open=function(e){t.log("WebSocket connection is opened"),d.fn.ping(n.DEST_EDITOR)},n.on.reopen=function(e){t.log("WebSocket connection is reopened"),d.fn.ping(n.DEST_EDITOR)},n.on.close=function(){angular.isDefined(d.on.close)&&d.on.close()},n.on.error=function(){angular.isDefined(d.on.error)&&d.on.error()},n.on.transportFailure=function(){angular.isDefined(d.on.transportFailure)&&d.on.transportFailure()},n.on.message=function(e){var i=e.responseBody;try{var o=atmosphere.util.parseJSON(i);if(o.dest==n.DEST_ALL)switch(o.action){case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(d.on.editorConnect)&&d.on.editorConnect();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(d.on.editorDisconnect)&&d.on.editorDisconnect()}if(o.dest==n.DEST_SITE)switch(o.action){case n.ACTION_RELOAD:t.log(n.ACTION_RELOAD),angular.isDefined(d.on.reload)&&d.on.reload();break;case n.ACTION_PING:t.log(n.ACTION_PING),n.pong(n.DEST_EDITOR);break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(d.on.pong)&&d.on.pong();break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(d.on.pong)&&d.on.pong();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(d.on.editorDisconnect)&&d.on.editorDisconnect();break;case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(d.on.editorConnect)&&d.on.editorConnect()}}catch(a){throw t.error("Error parsing JSON: ",i),a}},d}]),e.filter("itUnicode",["$sce",function(e){return function(t){function i(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();n.length<4;)n="0"+n;n="&#x"+n+";",t+=n}return t}return e.trustAsHtml(i(t))}}]),e.provider("itLanguageChangeHandler",function(){var e=this;this.options={storage:"local",displayConfirm:!0,onChangePopup:{title:"Confirm language change",text:"By modifying the language any recent changes may be lost. Continue?"}},this.$get=["$rootScope","$translate","$location","$q","localStorageService","itPopup",function(t,i,n,o,a,r){return{translate:i,getConfig:function(){return e.options},changeLanguage:function(o,l,s){var c={currentLanguage:this.getCurrentLanguage()};if(e.options.displayConfirm){i.use(o);var d=r.confirm({title:e.options.onChangePopup.title,text:e.options.onChangePopup.text,buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});!function(r){var c=r;d.then(function(c){if(i.use(o),"query"===e.options.storage)try{n.search("Locale",o)}catch(d){reject("Error setting query parameter, lang, to locale value: "+o+" Error: "+d.message)}else try{a.set("Locale",o)}catch(d){reject("Error setting local storage parameter, lang, to locale value: "+o+" Error: "+d.message)}l&&(l.currentLanguage=o,l.user&&(l.user.language=i.use())),r={currentLanguage:o},s&&s(r),t.$applyAsync(function(){location.reload()})},function(){i.use(c.currentLanguage)})}(c)}},getCurrentLanguage:function(){return"query"===e.options.storage?n.search().Locale?n.search().Locale.replace(/-/g,"_"):this.getDefaultLocale(this.translate.use()):a.get("Locale")||this.getDefaultLocale(this.translate.use())},getDefaultLocale:function(e){switch(e){case"en":return"en_GB";case"de":return"de_DE";default:case"fr":return"fr_FR"}},getLanguageCode:function(e){switch(e){case"en_GB":case"en-GB":case"en_US":case"en-US":return"en";case"de_DE":case"de-DE":return"de";default:case"fr_FR":case"fr-FR":case"fr_CA":case"fr-CA":return"fr"}}}}]}),e.provider("itNotifier",[function(){var e=this;e.defaultOptions={dismissOnTimeout:!0,timeout:4e3,dismissButton:!0,animation:"fade",horizontalPosition:"right",verticalPosition:"bottom",compileContent:!0,dismissOnClick:!1,success:{dismissOnClick:!0},info:{dismissOnClick:!0},error:{dismissOnTimeout:!1},warning:{dismissOnTimeout:!1}},this.$get=["ngToast","$rootScope","$log",function(t,i,n){function o(e){return" CODE : "+e.CODE+", TYPE : "+e.TYPE+", MESSAGE : "+e.MESSAGE+", DETAIL : "+e.DETAIL+", DONE : "+e.DONE}var a={};return t.settings=angular.extend(t.settings,e.defaultOptions),a.notifySuccess=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.success,i,i.success);t.success(r),void 0!=a&&n.log("Success popup called : "+o(a))},a.notifyError=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.error,i,i.error);t.danger(r),void 0!=a&&n.error("Error popup called : "+o(a))},a.notifyInfo=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.info,i,i.info);t.info(r),void 0!=a&&n.info("Info popup called : "+o(a))},a.notifyWarning=function(i,a){var r=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.warning,i,i.warning);t.warning(r),void 0!=a&&n.warn("Warning popup called : "+o(a))},a.notifyDismiss=function(e,i){t.dismiss()},a.notify=function(e){n.error("Unknown type for itNotifier: "+e)},i.$on("$locationChangeSuccess",function(){a.notifyDismiss()}),i.$on("itNotifierEvent",function(e,t){if(t)switch(t.type){case"SUCCESS":a.notifySuccess(t.options,t.errorDetails);break;case"ERROR":a.notifyError(t.options,t.errorDetails);break;case"INFO":a.notifyInfo(t.options,t.errorDetails);break;case"WARNING":a.notifyWarning(t.options,t.errorDetails);break;case"DISMISS":a.notifyDismiss(t.options,t.errorDetails);break;default:a.notify(t.type)}else n.error("Bad usage of itNotifier. Check manual for details")}),a}]}]),e.factory("itPopup",["$uibModal","$uibModalStack","$rootScope","$q","$compile",function(e,t,i,n,o){function a(e){function t(){return!1}var o={};return o.scope=(e.scope||i).$new(),o.responseDeferred=n.defer(),o.scope.$buttonTapped=function(e,t){var i=(t.onTap||noop)(e);o.responseDeferred.resolve(i)},e=angular.extend({scope:o.scope,template:u,controller:["$scope","$modalInstance",function(e,i){function n(){i.close(e.data)}function a(){i.dismiss("cancel")}e.itButtonAction=function(i,r){var l=(r.onTap||t)(i,e),s=l;i.isDefaultPrevented()||o.responseDeferred.resolve(s?n():a())}}],buttons:[]},e||{}),e.scope.options=e,o.options=e,o}function r(i){t.dismissAll();var n=a(i);return e.open(n.options).result}function l(e){return t.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function s(e){return t.dismissAll(),r(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function c(e){return t.dismissAll(),r(e)}function d(e){t.dismissAll();var n=i.$new(!0);n.data={};var o="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(o="<span>"+e.template+"</span>",delete e.template),r(angular.extend({template:p,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var u='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',p='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',f={alert:l,confirm:s,prompt:d,custom:c};return f}])}();