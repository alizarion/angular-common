/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * Angular-common, v1.0.0
 *Itesoft common Angularjs libs.*/
!function(){var e=angular.module("it-multi-pages-viewer",[]),t=angular.module("it-pdf-viewer",["it-multi-pages-viewer"]),i=angular.module("it-tiff-viewer",["it-multi-pages-viewer"]),n=angular.module("it-image-viewer",["it-multi-pages-viewer"]),r=angular.module("itesoft",["ngSanitize","ui.bootstrap.tabs","ui.bootstrap.modal","ui.bootstrap.tpls","ngAnimate","matchMedia","ui.grid","ui.grid.pagination","ngRoute","pascalprecht.translate","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.grouping","ui.bootstrap.dropdown","LocalStorageModule","ngToast","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","ui.codemirror","it-pdf-viewer","it-image-viewer","it-tiff-viewer"]);r.config(["$compileProvider",function(e){e.directive("itCompile",["$compile",function(e){return function(t,i,n){t.$watch(function(e){return e.$eval(n.itCompile)},function(n){i.html(n),e(i.contents())(t)})}}])}]),r.directive("itCircularBtn",[function(){return{restrict:"ACE",scope:!1,transclude:!0,template:'<span class="it-circular-button-container "><button class="btn  pull-right" > <div class="it-animated-circular-button"><ng-transclude></ng-transclude></div></button> </span>'}}]),r.directive("itModalFullScreen",["$timeout","$window","$document",function(e,t,i){function n(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var r=t.getComputedStyle(e[n]),a=parseInt(r["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i}var r='<div class="it-modal-full-screen" ng-class="$isModalOpen? $onOpenCss : \'\'"><div class="it-modal-full-screen-header pull-right"><div  ng-if="$isModalOpen"  class="it-modal-full-screen-button "><button class="btn " ng-click="$closeModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-compress"></i></div></button></div><div  ng-if="!$isModalOpen"  class="it-modal-full-screen-button "> <button class="btn pull-right"  ng-click="$openModal()"><div class="it-animated-ciruclar-button"><i class="fa fa-expand"></i></div></button> </div></div><div  class="it-modal-full-screen-content it-fill"  ng-transclude> </div></div>';return{restrict:"EA",transclude:!0,scope:!1,template:r,link:function(r,a,o,s){var l=isNaN(parseInt(o.itZIndex))?null:parseInt(o.itZIndex);r.$onOpenCss=o.itOpenClass?o.itOpenClass:"it-modal-background";var c=isNaN(parseInt(o.itEscapeKey))?27:parseInt(o.itEscapeKey),d=angular.element(a[0].querySelector(".it-modal-full-screen")),u=angular.element(d[0]);r.$openModal=function(){r.$isModalOpen=!0;var i=document.getElementsByTagName("html"),a=t.getComputedStyle(i[0]),o=parseInt(a.top),s=parseInt(a["margin-top"]),c=parseInt(a["padding-top"]),d=(isNaN(parseInt(o))?0:parseInt(o))+(isNaN(parseInt(s))?0:parseInt(s))+(isNaN(parseInt(c))?0:parseInt(c));u.addClass("it-opened"),u.css("top",d+"px"),null!==l?u.css("z-index",l):u.css("z-index",n()+100),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)},r.$closeModal=function(){r.$isModalOpen=!1,r.$applyAsync(function(){u.removeAttr("style"),u.removeClass("it-opened"),e(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),t.dispatchEvent(e)},300)})},i.on("keyup",function(e){e&&e.keyCode==c&&r.$closeModal()})}}}]),r.factory("itAmountCleanerService",["$filter",function(e){var t=["en_US","en_GB","fr_FR","de_DE","id_IT"];return{cleanAmount:function(e,i){var n=0,r=!1;return t.forEach(function(e){JSON.stringify(e)==JSON.stringify(i)&&(r=!0)}),0==r?(console.log("Unable to format amount for local "+i),""):(e=e.replace(/[^0-9,.]/g,""),(JSON.stringify(i)==JSON.stringify(t[2])||JSON.stringify(i)==JSON.stringify(t[4]))&&(e=e.replace(",",".")),JSON.stringify(i)==JSON.stringify(t[0])?e=e.replace(",",""):JSON.stringify(i)==JSON.stringify(t[3])&&(e=e.replace(".",""),e=e.replace(",",".")),n=parseFloat(e),console.log("result1 "+n),void 0==n&&(n=parseFloat(e)),console.log("result2 "+n),n)},formatAmount:function(i,n,r){var a="",o=!1;if(t.forEach(function(e){JSON.stringify(e)==JSON.stringify(n)&&(o=!0)}),0==o)return console.log("Unable to format amount for local "+n),"";if(void 0!=i){var s=i.toString();s=s.replace(/[^0-9,.]/g,""),(JSON.stringify(n)==JSON.stringify(t[2])||JSON.stringify(n)==JSON.stringify(t[4]))&&(s=s.replace(",","."))}return angular.isDefined(r)?(r=e("uppercase")(r),a=angular.equals(r,"TND")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:3,maximumFractionDigits:3}).format(parseFloat(s)):angular.equals(r,"JPY")?new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:0,maximumFractionDigits:0}).format(parseFloat(s)):new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s))):a=new Intl.NumberFormat(n.replace("_","-"),{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(s)),a}}}]),r.directive("itLazyGrid",["OPERATOR","NOTIFICATION_TYPE","itQueryFactory","itQueryParamFactory","itAmountCleanerService","localStorageService","$rootScope","$log","$q","$templateCache","$timeout",function(e,t,i,n,r,a,o,s,l,c,d){return{restrict:"AE",scope:{options:"="},template:'<div ui-grid="lazyGrid.fields.gridOptions"  ui-grid-selection ui-grid-pagination ui-grid-auto-resize="true" class="it-fill it-sp-lazy-grid"><div class="it-watermark sp-watermark gridWatermark" ng-show="!lazyGrid.fields.gridOptions.data.length"> {{\'GLOBAL.NO_DATA\' |translate}} </div> </div> <!------------------------------------------------------------------------------------------------------------------------------- FILTER --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="dropDownFilter.html"> <div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"> <it-autocomplete name="autocomplete" items="colFilter.options.data" selected-option="colFilter.term" input-class="col.headerCellClass" option-container-class="colFilter.class"> </div> </script> <script type="text/ng-template" id="dateRangeFilter.html"> <div class="ui-grid-filter-container"> <span class="{{col.headerCellClass}}"> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[0].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[0].emptyOption | translate}}" ng-model="col.filters[0].term" data-min-date="{{col.filters[0].dateMin}}" data-max-date="{{col.filters[1].term}}" data-autoclose="1" name="date" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> <input type="text" class="form-control {{col.headerCellClass}}_{{col.filters[1].emptyOption}}" style="width: 75px;display:inline;margin-left: 1px;margin-right: 1px" placeholder="{{col.filters[1].emptyOption | translate}}" ng-model="col.filters[1].term" data-min-date="{{col.filters[0].term}}" data-max-date="{{col.filters[1].dateMax}}" data-autoclose="1" name="date2" data-date-format="{{\'GLOBAL.DATE.FORMAT\' | translate}}" bs-datepicker> </span></div> </script> <script type="text/ng-template" id="stringFilter.html"> <div class="ui-grid-filter-container {{col.headerCellClass}}" ng-repeat="colFilter in col.filters"> <input type="text" class="form-control" ng-model="colFilter.term" pattern="{{colFilter.pattern}}" placeholder="{{colFilter.emptyOption | translate}}" maxlength="{{colFilter.maxLength}}"> </div> </script> <!------------------------------------------------------------------------------------------------------------------------------- PAGINATOR --------------------------------------------------------------------------------------------------------------------------------> <script type="text/ng-template" id="paginationTemplate.html"> <div role="contentinfo" class="ui-grid-pager-panel" ui-grid-pager ng-show="grid.options.enablePaginationControls"> <div role="navigation" class="ui-grid-pager-container"> <div role="menubar" class="ui-grid-pager-control"> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.FIRSTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-first it-sp-grid-pager-first " ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="first-bar"> </div> </div> <input type="button" title="" ng-click="pageFirstPageClick()" > </input></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.PREVPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-previous it-sp-grid-pager-previous" ng-disabled="cantPageBackward()"><div class="first-triangle"> <div class="prev-triangle"> </div> </div><input type="button" title="" ng-click="pagePreviousPageClick()"/></label><input type="number" class="ui-grid-pager-control-input it-sp-grid-pager-control-input" ng-model="grid.options.paginationCurrentPage" min="1" max="{{ paginationApi.getTotalPages() }}" required/> <span class="ui-grid-pager-max-pages-number it-sp-grid-pager-max-pages-number" ng-show="paginationApi.getTotalPages() > 0"> <abbr> / </abbr> {{ paginationApi.getTotalPages() }} </span> <label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.NEXTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-next it-sp-grid-pager-next" ng-disabled="cantPageForward()"><div class="last-triangle"> <div class="next-triangle"> </div> </div><input type="button" title="" ng-click="pageNextPageClick()"/></label><label data-type="info" data-animation="am-fade-and-scale" bs-tooltip title="{{ \'HELP.LASTPAGE\' | translate }}" class="btn it-lazy-grid-btn-button-navigator ui-grid-pager-last it-sp-grid-pager-last" ng-disabled="cantPageToLast()"><div class="last-triangle"> <div class="last-bar"> </div> </div><input type="button" title="" ng-click="pageLastPageClick()"/></label> </div> <div class="ui-grid-pager-row-count-picker it-sp-grid-pager-row-count-picker" ng-if="grid.options.paginationPageSizes.length > 1"> <select ui-grid-one-bind-aria-labelledby-grid="\'items-per-page-label\'" ng-model="grid.options.paginationPageSize" ng-options="o as o for o in grid.options.paginationPageSizes"></select><span ui-grid-one-bind-id-grid="\'items-per-page-label\'" class="ui-grid-pager-row-count-label"> &nbsp; </span> </div> <span ng-if="grid.options.paginationPageSizes.length <= 1" class="ui-grid-pager-row-count-label it-sp-grid-pager-row-count-label"> {{grid.options.paginationPageSize}}&nbsp;{{sizesLabel}} </span> </div> <div class="ui-grid-pager-count-container"><div class="ui-grid-pager-count"> <span class="it-sp-grid-pager-footer-text" ng-show="grid.options.totalItems > 0"> {{\'PAGINATION.INVOICE.FROM\' | translate}} {{showingLow}} <abbr> </abbr> '+"{{'PAGINATION.INVOICE.TO' | translate}} {{showingHigh}} {{'PAGINATION.INVOICE.ON' | translate}} {{grid.options.totalItems}} {{'PAGINATION.INVOICE.TOTAL' | translate}} </span> </div> </div> </div> </script>",controllerAs:"lazyGrid",controller:["$scope",function(t){function o(){s.debug("LazyGrid:Apply External filter"),angular.forEach(I.fields.externalFilter,function(e,t){if(!angular.isUndefined(t)&&!angular.isUndefined(e.value)&&!angular.isUndefined(e.condition)){var i=n.create(t,e.value,e.condition);I.fields.filter.push(i)}})}function l(){s.debug("LazyGrid:Apply filter");var t="",i="",a=e.EQUALS;if(angular.isDefined(I.fields.gridApi.grid))for(var o=0;o<I.fields.gridApi.grid.columns.length;o++){t=I.fields.gridApi.grid.columns[o].field;for(var l=0;l<I.fields.gridApi.grid.columns[o].filters.length;l++)if(i=I.fields.gridApi.grid.columns[o].filters[l].term,void 0!=i&&""!=i){s.debug("LazyGrid:Filter changed, fieds: "+t+", and value: "+i);var c=I.fields.gridApi.grid.columns[o].filters[l].rsqlKey;void 0!=c&&(t=c),void 0!=I.fields.gridApi.grid.columns[o].filters[l].condition&&(a=I.fields.gridApi.grid.columns[o].filters[l].condition),1==I.fields.gridApi.grid.columns[o].filters[l].amount&&(i=r.cleanAmount(i,S));var d=n.create(t,i,a);I.fields.filter.push(d)}}}function u(){s.debug("LazyGrid:Apply default filter"),angular.isDefined(I.fields.gridApi.grid)&&angular.forEach(I.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&angular.isDefined(e.colDef.filters[0].defaultTerm)&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)||(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function p(){s.debug("LazyGrid:Reset Filter and Apply default filter"),angular.isDefined(I.fields.gridApi.grid)&&angular.forEach(I.fields.gridApi.grid.columns,function(e){angular.isDefined(e)&&angular.isDefined(e.colDef)&&angular.isDefined(e.colDef.filters)&&angular.isDefined(e.colDef.filters[0])&&(angular.isUndefined(e.field)||angular.isUndefined(e.colDef.filters[0].defaultTerm)?angular.forEach(e.colDef.filters,function(e){e.term=""}):(e.colDef.filters[0].term=e.colDef.filters[0].defaultTerm,s.debug("LazyGrid:Apply default filter: "+e.field+"->"+e.colDef.filters[0].term)))})}function f(){}function g(){}function h(){s.debug("LazyGrid:Filter Changed"),I.fields.filter=[],angular.isDefined(I.fields.promise.refresh)&&d.cancel(I.fields.promise.refresh),I.fields.promise.refresh=d(function(){I.fn.refresh()},1e3)}function m(e,t){if(s.debug("LazyGrid:Sort Changed"),I.fields.filter=[],0==t.length)I.fields.paginationOptions.sort.name=void 0,I.fields.paginationOptions.sort.direction=void 0;else{var i=t[0].name;angular.isDefined(t[0])&&angular.isDefined(t[0].colDef)&&angular.isDefined(t[0].colDef.sorterRsqlKey)&&(i=t[0].colDef.sorterRsqlKey),I.fields.paginationOptions.sort.name=i,I.fields.paginationOptions.sort.direction=t[0].sort.direction,s.debug("sort changed, sort key: "+t[0].name+", and direction: "+t[0].sort.direction)}I.fn.refresh()}function v(e,t){s.debug("LazyGrid:Pagination Changed"),I.fields.filter=[],(I.fields.paginationOptions.pageNumber!=e||I.fields.paginationOptions.pageSize!=t)&&(I.fields.paginationOptions.pageNumber=e,I.fields.paginationOptions.pageSize=t,I.fn.refresh())}function C(){s.debug("LazyGrid:Row Selection Changed")}function b(){s.debug("LazyGrid:Refresh"),o(),l();var e=(I.fields.paginationOptions.pageNumber-1)*I.fields.paginationOptions.pageSize,t=i.create(I.fields.filter,e,I.fields.paginationOptions.pageSize,I.fields.paginationOptions.sort);I.fn.callBack(t)}function w(){s.debug("LazyGrid:Initial load"),l(),I.fields.filter.length<=0&&u(),I.fields.filter=[],I.fn.refresh()}function E(e){return angular.isUndefined(e.key)?void s.error("External filter object must have key"):angular.isUndefined(e.condition)?void s.error("External filter object must have condition"):void(angular.isUndefined(e.value)?I.fields.externalFilter[e.key]={}:I.fields.externalFilter[e.key]=e)}function y(){}var S=a.get("Locale"),I=this;I.options=t.options,I.fields={template:{pagination:c.get("paginationTemplate.html")},filter:[],externalFilter:{},gridApi:{},gridOptions:{},paginationOptions:{},appScope:{},promise:{refresh:{}}},I.on={loaded:f,ready:g,filterChange:h,sortChange:m,paginationChanged:v,rowSelectionChanged:C},I.fn={callBack:I.options.callBack,initialize:y,refresh:b,initialLoad:w,addExternalFilter:E,refreshDefaultFilter:p},I.fields.paginationOptions={pageNumber:1,pageSize:10,sort:{name:void 0,direction:void 0}},I.fields.gridOptions={enableFiltering:!0,enableSorting:!0,enableColumnMenus:!1,useExternalPagination:!0,useExternalSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1,modifierKeysToMultiSelect:!1,noUnselect:!0,useExternalFiltering:!0,data:[],columnDefs:[],paginationTemplate:I.fields.template.pagination,onRegisterApi:function(e){e.core.on.filterChanged(I.appScope,I.on.filterChange),e.core.on.sortChanged(I.appScope,I.on.sortChange),e.pagination.on.paginationChanged(I.appScope,I.on.paginationChanged),e.selection.on.rowSelectionChanged(I.appScope,I.on.rowSelectionChanged),I.fields.gridApi=e,s.debug("LazyGrid:UI-grid:onRegisterApi")}},angular.isDefined(I.options.onRegisterApi)&&(I.options.onRegisterApi(I),s.debug("LazyGrid:onRegisterApi"))}]}}]).constant("OPERATOR",{EQUALS:"==",LIKE:"==%",NOT_EQUALS:"!=",LESS_THAN:"=lt=",LESS_EQUALS:"=le=",GREATER_THAN:"=gt=",GREATER_EQUALS:"=ge="}).constant("NOTIFICATION_TYPE",{INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS",DISMISS:"DISMISS"}),r.factory("itPaginatorConfigService",["$q","$log","itNotifier","$filter","MetadataService",function(e,t,i,n,r){function a(){if(o.fields.loaded)t.debug("PaginatorConfigService: loaded"),s.resolve("ok");else{var a=r.getConfig.get({type:"paginatorOptions"}).$promise,l=r.getConfig.get({type:"paginatorDefaultOption"}).$promise;e.all([a,l]).then(function(e){o.fields.defaultOption=e[1].value;var r=e[0].value;angular.isDefined(r)&&null!=r&&angular.isDefined(r.split)?o.fields.options=r.split(","):i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},r),t.debug("PaginatorConfigService: loaded"),o.fields.loaded=!0,s.resolve("ok")},function(e){i.notifyError({content:n("translate")("ERROR.WS.METADATA_ERROR")},e.data)})}return s.promise}var o=this,s=e.defer();return o.fields={options:[],defaultOption:"",loaded:!1},o.fn={initialize:a},o}]),r.factory("itQueryParamFactory",[function(){function e(e,t,i){this.key=e,this.value=t,this.operator=i}return{create:function(t,i,n){return new e(t,i,n)}}}]),r.factory("itQueryFactory",["OPERATOR",function(e){function t(t,i,n,r){this.parameters=t,this.start=i,this.size=n,this.sort=r,this.build=function(){var a="";return void 0!=t&&this.parameters.forEach(function(t){angular.isDefined(t.value)&&angular.isDefined(t.key)&&(t.value instanceof Date&&t.operator==e.LESS_EQUALS&&(t.value.setHours(23),t.value.setMinutes(59),t.value.setSeconds(59),t.value.setMilliseconds(999)),a.length>0&&(a+=" and "),t.value instanceof Date&&(t.value=t.value.toISOString()),t.operator==e.LIKE&&(t.value=t.value+"%"),a+=t.key+t.operator+t.value)}),a="query="+a,null!=n&&angular.isDefined(n)&&""!=n&&(a+="&size="+this.size),null!=i&&angular.isDefined(i)&&""!=i&&(a+="&start="+this.start),void 0!=r&&void 0!=this.sort.name&&(a+="&sort=","desc"==this.sort.direction&&(a+="-"),a+=this.sort.name),a}}return{create:function(e,i,n,r){return new t(e,i,n,r)}}}]),r.directive("itBusyIndicator",["$timeout","$http",function(e,t){function i(i,r,a){i.$watch(function(){return t.pendingRequests.length>0},function(t){n&&e.cancel(n),t===!0?n=e(function(){i.hasPendingRequests=!0},250):i.hasPendingRequests=!1})}var n;return{link:i,restrict:"AE",transclude:!0,scope:{isBusy:"="},template:'<div class="mask-loading-container" ng-show="hasPendingRequests"></div><div class="main-loading-container" ng-show="hasPendingRequests || isBusy"><i class="fa fa-circle-o-notch fa-spin fa-4x text-primary "></i></div><ng-transclude ng-show="!isBusy" class="it-fill"></ng-transclude>'}}]),r.directive("itLoader",["$http","$rootScope",function(e,t){return{restrict:"EA",scope:!0,template:'<span class="fa-stack"><i class="fa fa-refresh fa-stack-1x" ng-class="{\'fa-spin\':$isLoading}"></i></span>',link:function(t){t.$watch(function(){e.pendingRequests.length>0?t.$applyAsync(function(){t.$isLoading=!0}):t.$applyAsync(function(){t.$isLoading=!1})})}}}]),r.directive("itDetail",[function(){return{restrict:"EA",require:"^itMasterDetail",transclude:!0,scope:!1,template:' <div ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))"   ng-if="currentItemWrapper.currentItem"  class="it-master-detail-slide-left col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" > <div class="it-fill" ng-transclude></div></div><div  ng-show="($parent.$parent.desktop || ($parent.$parent.activeState == \'detail\' &&$parent.$parent.mobile))" class="col-md-{{$masterCol ? (12-$masterCol) : 6}} it-fill" ng-if="!currentItemWrapper.currentItem"><div class="it-watermark" >{{$itNoDetail}}</div></div>'}}]),r.directive("itDetailContent",function(){return{restrict:"EA",require:"^itDetail",transclude:!0,scope:!1,template:'<div class="row it-fill"> <div class="col-md-12  it-fill" ng-transclude></div></div>'}}),r.directive("itDetailHeader",function(){return{restrict:"EA",require:"^itDetail",scope:!1,transclude:!0,template:'<div class="fluid-container"><div class="row it-md-header"><div class="col-md-2 it-fill  col-xs-2"><a href="" ng-if="$parent.$parent.$parent.mobile" ng-click="$parent.$parent.$parent.$parent.goToMaster()" class="it-material-design-hamburger__icon pull-left it-fill "> <span  class="menu-animated it-material-design-hamburger__layer " ng-class="{\'it-material-design-hamburger__icon--to-arrow\':$parent.$parent.$parent.$parent.mobile}"> </span> </a></div><div class="col-md-10 col-xs-10 it-fill "><div class="btn-toolbar  it-fill pull-right " ng-transclude></div></div></div></div>'}}),r.directive("itMaster",function(){return{restrict:"EA",require:"^itMasterDetail",priority:-1,transclude:!0,scope:{itMasterData:"=",itLang:"=",itCol:"=",itMasterDetailControl:"=",itLockOnChange:"=",itNoDataMsg:"@",itNoDetailMsg:"@"},template:'<div  ng-show="($parent.$parent.activeState == \'master\')" class=" it-master it-master-detail-slide-right col-md-{{itCol ? itCol : 6}} it-fill " ui-i18n="{{itLang}}"><div class="row" ng-transclude></div><div class="row it-master-grid it-fill" ><div class="col-md-12 it-fill"><div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns  ui-grid-move-columns  ui-grid-auto-resize class="it-master-detail-grid it-fill "><div class="it-watermark" ng-show="!gridOptions.data.length" >{{itNoDataMsg}}</div></div></div></div></div>',controller:["$scope","$filter","$q","$timeout","itPopup","$templateCache","$route","$window",function(e,t,i,n,r,a,o,s){function l(t){var i=this;angular.forEach(e.itMasterData,function(e,n){angular.equals(e,t)&&(i.index=n)}),i.originalItem=t,i.currentItem=angular.copy(t),i.hasChanged=!1,i.isWatched=!1,i.unlockOnEquals=!0}function c(t){e.itMasterDetailControl.disableMultiSelect||(e.gridApi.selection.getSelectedRows().length>1?e.$parent.currentItemWrapper=null:1===e.gridApi.selection.getSelectedRows().length?(d(e.gridApi.selection.getSelectedRows()[0]),u(e.gridApi.selection.getSelectedRows()[0])):0===e.gridApi.selection.getSelectedRows().length&&(e.$parent.currentItemWrapper=null))}function d(t){var n=i.defer();return null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange?(n.reject("undo or save before change"),n.promise):(e.$parent.currentItemWrapper=new l(t),n.resolve(""),n.promise)}function u(t){e.gridApi.core.scrollTo(t)}function p(){e.$applyAsync(function(){null!==e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.hasChanged=!1,e.$parent.currentItemWrapper.isWatched=!1)})}function f(t){null!=e.$parent.currentItemWrapper&&e.$parent.currentItemWrapper.hasChanged&&e.itLockOnChange&&(r.alert(e.itMasterDetailControl.navAlert),t.preventDefault())}a.put("ui-grid/selectionRowHeaderButtons",'<div class="it-master-detail-row-select" ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input type="checkbox" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange " tabindex="-1"  ng-checked="row.isSelected"></div>'),a.put("ui-grid/selectionSelectAllButtons",'<div class="it-master-detail-select-all-header" ng-click="(grid.appScope.$parent.currentItemWrapper.hasChanged && grid.appScope.itLockOnChange  )? \'return false\':headerButtonClick($event)"><input type="checkbox"  ng-change="headerButtonClick($event)" ng-disabled="grid.appScope.$parent.currentItemWrapper.hasChanged  && grid.appScope.itLockOnChange" ng-model="grid.selection.selectAll"></div>'),e.$parent.$masterCol=e.itCol,l.prototype.unlockCurrent=function(){this.hasChanged=!1,this.isWatched=!1},l.prototype.lockCurrent=function(e){this.hasChanged=!0,this.isWatched=!0,this.unlockOnEquals=!e},e.$parent.currentItemWrapper=null,e.$parent.$itNoDetail=e.itNoDetailMsg,e.gridOptions={rowHeight:40,data:e.itMasterData,multiSelect:!e.itMasterDetailControl.disableMultiSelect,enableSelectAll:!e.itMasterDetailControl.disableMultiSelect,enableRowHeaderSelection:!e.itMasterDetailControl.disableMultiSelect,showGridFooter:!0,enableMinHeightCheck:!0,enableColumnResizing:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(e){c(e)}),t.selection.on.rowSelectionChangedBatch(e,function(e){c(e)})},gridFooterTemplate:'<div class="ui-grid-footer-info ui-grid-grid-footer"> <span class="ngLabel badge ">{{"search.totalItems" |t}}  {{grid.appScope.itMasterData.length}}</span> <span ng-show="grid.appScope.filterText.length > 0 && grid.appScope.itMasterData.length != grid.renderContainers.body.visibleRowCache.length" class="ngLabel badge alert-info ">{{"search.showingItems" |t}}  {{grid.renderContainers.body.visibleRowCache.length}}</span> <span ng-show="!grid.appScope.itMasterDetailControl.disableMultiSelect" class="ngLabel badge">{{"search.selectedItems" | t}} {{grid.appScope.gridApi.selection.getSelectedRows().length}}</span></div>',rowTemplate:'<div ng-click="grid.appScope.onRowClick(col,row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>'},"undefined"!=typeof e.itMasterDetailControl.columnDefs&&angular.forEach(e.itMasterDetailControl.columnDefs,function(e){e.headerCellTemplate='<div ng-class="{ \'sortable\': sortable }"> <!-- <div class="ui-grid-vertical-bar">&nbsp;</div> --> <div class="ui-grid-cell-contents" col-index="renderIndex" title="TOOLTIP"> <span>{{ col.displayName CUSTOM_FILTERS }}</span> <span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }"> &nbsp; </span> </div> <div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}"> <i class="fa fa-align-justify"></i> </div> <div ui-grid-filter></div> </div>'},!0),e.gridOptions.columnDefs=e.itMasterDetailControl.columnDefs,e.onRowClick=function(t,i){void 0!=i.entity&&"undefined"!=typeof t.providedHeaderCellTemplate&&d(i.entity).then(function(n){"ui-grid/selectionHeaderCell"!==t.providedHeaderCellTemplate&&(e.gridApi.selection.clearSelectedRows(),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail()),e.gridApi.selection.toggleRowSelection(i.entity),e.$emit("MASTER_ROW_CHANGED",i.entity)},function(t){r.alert(e.itMasterDetailControl.navAlert)})},e.itMasterDetailControl.selectItem=function(t){e.onRowClick(null,{entity:t})},e.refreshData=function(){var i=t("itUIGridGlobalFilter")(e.gridOptions.data,e.gridOptions,e.filterText);angular.forEach(e.gridApi.grid.rows,function(t){var n=!1;i.forEach(function(e){angular.equals(t.entity,e)&&(n=!0)}),n?e.gridApi.core.clearRowInvisible(t):e.gridApi.core.setRowInvisible(t)})},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),p())},e.$on("unlockCurrentItem",function(){p()}),e.itMasterDetailControl.scrollToItem=function(e){u(e)},e.itMasterDetailControl.getSelectedItems=function(){return"undefined"!=typeof e.gridApi&&"function"==typeof e.gridApi.selection.getSelectedRows?e.gridApi.selection.getSelectedRows():[]},e.itMasterDetailControl.getCurrentItem=function(){return e.$parent.currentItemWrapper.currentItem},e.itMasterDetailControl.getCurrentItemWrapper=function(){return e.$parent.currentItemWrapper},e.itMasterDetailControl.getFilteredItems=function(){var t=e.gridApi.core.getVisibleRows(e.gridApi.grid),i=[];return angular.forEach(t,function(e){i.push(e.entity)}),i},e.itMasterDetailControl.setCurrentItem=function(t){var r=i.defer();return e.gridApi.selection.clearSelectedRows(),d(t).then(function(){n(function(){var i=e.itMasterData.indexOf(t);i>=0?(e.gridApi.selection.selectRow(t),u(t),e.$parent.$parent.mobile&&e.$parent.$parent.goToDetail(),r.resolve()):r.reject()})},function(){r.reject()}),r.promise},e.itMasterDetailControl.undoChangeCurrentItem=function(){null!=e.$parent.currentItemWrapper&&(d(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.currentItem=angular.copy(e.$parent.currentItemWrapper.originalItem),e.$parent.currentItemWrapper.unlockCurrent())},e.itMasterDetailControl.fillHeight=function(){},e.$on("unlockCurrentItem",function(){n(function(){e.$parent.currentItemWrapper.unlockCurrent()})}),e.$on("lockCurrentItem",function(t){n(function(){e.$parent.currentItemWrapper.lockCurrent(t)})}),e.itAppScope=e.$parent,e.itAppScope.$navAlert=e.itMasterDetailControl.navAlert;var g=angular.element(s);g.bind("resize",function(){e.gridApi.core.handleWindowResize()}),e.itMasterDetailControl.initState=!0,e.$on("$locationChangeStart",f),e.itMasterDetailControl=angular.extend({navAlert:{text:"Please save or revert your pending change",title:"Unsaved changes",buttons:[{text:"OK",type:"btn-info",onTap:function(){return!1}}]}},e.itMasterDetailControl),e.$watch("itLang",function(){e.gridApi.grid.refresh()}),e.$watch("itMasterData",function(){e.gridOptions.data=[],e.itMasterData.forEach(function(t){e.gridOptions.data.push(t)}),"undefined"==typeof e.itMasterData||null===e.itMasterData?e.$parent.currentItemWrapper=null:0===e.itMasterData.length&&(e.$parent.currentItemWrapper=null),e.gridApi.grid.refresh(),null!==e.itMasterDetailControl&&"undefined"!=typeof e.itMasterDetailControl.getCurrentItemWrapper()&&null!=e.itMasterDetailControl.getCurrentItemWrapper()&&e.$applyAsync(function(){u(e.itMasterDetailControl.getCurrentItemWrapper().originalItem)}),e.refreshData()},!0),n(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),s.dispatchEvent(e)},250),e.$watch("$parent.currentItemWrapper.currentItem",function(t,i){null!=e.$parent.currentItemWrapper&&(e.$parent.currentItemWrapper.isWatched||(e.$parent.currentItemWrapper.isWatched=!0),e.$parent.currentItemWrapper.unlockOnEquals?e.$parent.currentItemWrapper.hasChanged=!angular.equals(t,e.$parent.currentItemWrapper.originalItem):e.$parent.currentItemWrapper.hasChanged=!0)},!0),e.$watch("filterText",function(){e.refreshData()},!0),e.$watch("itNoDetailMsg",function(){e.$parent.$itNoDetail=e.itNoDetailMsg})}]}}).filter("itUIGridGlobalFilter",["$rootScope",function(e){return function(t,i,n){function r(e,t){var i,n=t.split("."),r=e;for(i=0;i<n.length;++i){if(void 0==r[n[i]])return void 0;r=r[n[i]]}return r}var a=[];if(void 0===n||""===n)return t;n=n.toLowerCase();for(var o=e.$new(!0),s=0;s<t.length;s++)for(var l=0;l<i.columnDefs.length;l++){var c=t[s],d=i.columnDefs[l].field,u=r(c,d);if(i.columnDefs[l].cellFilter&&(o.value=u,u=o.$eval("value | "+i.columnDefs[l].cellFilter)),"undefined"!=typeof u&&null!=u&&u.toString().toLowerCase().indexOf(n)>-1){a.push(c);break}}return o.$destroy(),a}}]),r.directive("itMasterDetail",["itPopup","$timeout","$window",function(e,t,i){return{restrict:"EA",transclude:!0,scope:!0,template:'<div it-bottom-glue="" class="it-master-detail-container jumbotron "> <div class="it-fill row " ng-transclude></div></div>',controller:["$scope","screenSize",function(n,r){n.activeState="master",n.desktop=r.on("md, lg",function(e){n.desktop=e}),n.mobile=r.on("xs, sm",function(e){n.mobile=e}),n.goToDetail=function(){n.activeState="detail"},n.$watch("mobile",function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper?n.activeState="detail":n.activeState="master"}),n.$watch("$$childHead.currentItemWrapper",function(){
!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!==n.$$childHead.currentItemWrapper?!n.mobile||"undefined"!=typeof n.$$childHead.currentItemWrapper.currentItem&&null!==n.$$childHead.currentItemWrapper.currentItem||(n.activeState="master"):n.activeState="master"}),n.goToMaster=function(){n.mobile&&"undefined"!=typeof n.$$childHead.currentItemWrapper&&null!=n.$$childHead.currentItemWrapper&&n.$$childHead.currentItemWrapper.hasChanged&&n.$$childHead.$$childHead.itLockOnChange?e.alert(n.$$childHead.$navAlert):(n.activeState="master",t(function(){i.dispatchEvent(new Event("resize"))},300))}}]}}]),r.directive("itMasterHeader",function(){return{restrict:"EA",require:"^itMaster",scope:!1,transclude:!0,template:'<div class="fuild-container">   <div class="row it-fill">   <div class="it-md-header col-xs-12 col-md-12"><div class="btn-toolbar it-fill" ng-transclude></div></div><div class="col-xs-12 col-md-12 pull-right"><div><form><div class="form-group has-feedback it-master-header-search-group  col-xs-12 col-md-{{$parent.itCol < 4 ? 12 :6 }} pull-right" ><span class="glyphicon glyphicon-search form-control-feedback"></span><input  class="form-control " type="text" ng-model="$parent.filterText" class="form-control floating-label"  placeholder="{{placeholderText}}"/></div></form></div></div></div></div>',link:function(e,t,i){e.$watch(function(){return i.itSearchPlaceholder},function(t){e.placeholderText=t})}}}),r.directive("itAutocomplete",function(){return{restrict:"AE",scope:{items:"=",itemsGetter:"&?",selectedOption:"=",inputClass:"=",optionClass:"=",optionContainerClass:"=",converter:"=",searchMode:"=",placeholder:"=",options:"=",onChange:"&",eventSelect:"=",eventRefresh:"=",name:"="},controllerAs:"itAutocompleteCtrl",controller:["$scope","$rootScope","$translate","$document","$timeout","$log",function(e,t,i,n,r,a){function o(){I.fields.debug&&a.debug(e.name+" itAutocomplete: focusIndex value changed  -> "+e.focusIndex),e.focusIndex<0?e.focusIndex=-1:e.focusIndex>=I.fields.items.length&&(e.focusIndex=I.fields.items.length-1),angular.isDefined(I.fields.items)&&I.fields.items[e.focusIndex]!=I.selectedItem&&d(I.fields.items[e.focusIndex])}function s(t){t=E(t);var i=!1;I.fields.selectedItem={},angular.isDefined(t)&&(I.fields.debug&&a.debug(e.name+" itAutocomplete: select with  id "+t),angular.forEach(I.fields.items,function(e){E(e)==t&&(u(e),i=!0)}),i||c())}function l(){angular.isDefined(e.items)?I.fields.items=angular.copy(e.items):I.fields.items=angular.copy(e.itemsGetter({param:I.fields.event.refresh.value})),I.fields.initialItems=angular.copy(I.fields.items),I.fields.debug&&a.debug(e.name+" itAutocomplete: copy option items "+I.fields.initialItems)}function c(){I.fields.debug&&a.debug(e.name+" itAutocomplete: init select ");var t=0;angular.forEach(I.fields.items,function(e){angular.isDefined(I.fields.selectedItem)&&I.fields.selectedItem==e&&d(e),t++})}function d(i){angular.isDefined(i)?(u(i),I.fields.debug&&a.debug(e.name+" itAutocomplete: select "+JSON.stringify(i)),I.fields.converter?e.selectedOption=y(i):e.selectedOption=E(i)):(I.fields.debug&&a.debug(e.name+" itAutocomplete: select empty"),e.selectedOption=void 0),I.fields.event.select&&(I.fields.debug&&a.debug(e.name+" itAutocomplete: emit select event "+e.selectedOption),t.$emit(I.fields.event.select,e.selectedOption))}function u(t){if(angular.isDefined(t)){I.fields.debug&&a.debug(e.name+" itAutocomplete: applySelection "+JSON.stringify(t));var i=S(t);e.focusIndex!=i&&(e.focusIndex=i,o()),I.fields.inputSearch=w(t),I.fields.selectedItem=y(t);var r=n[0].querySelector("#options_"+I.cleanDomRef.encode(E(I.fields.selectedItem)+""));p(r,t)}else I.fields.selectedItem=void 0,e.focusIndex=-1,o()}function p(t,i){var r=n[0].querySelector("#"+I.fields.optionContainerId);I.fields.debug&&a.debug(e.name+" itAutocomplete: scrollTo #"+I.fields.optionContainerId+" to: "+t),angular.isDefined(r)&&null!=r&&(r.scrollTop=20*(S(i)+1)-r.getBoundingClientRect().height)}function f(t){a.debug(e.name+" itAutocomplete: hide "+I.fields.selectedItem),angular.isUndefined(t)?(I.fields.showItems=!1,angular.isDefined(I.fields.selectedItem)&&(I.fields.inputSearch=w(I.fields.selectedItem))):document.activeElement.parentElement.firstElementChild.classList.contains(I.fields.inputClass)?e.$applyAsync(function(){t.srcElement.focus()}):(I.fields.showItems=!1,angular.isDefined(I.fields.selectedItem)&&(I.fields.inputSearch=w(I.fields.selectedItem)))}function g(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function h(e){if(angular.isDefined(e)&&-1!=g()){var t=e.srcElement.parentElement.children[1],i=angular.element(e.srcElement.parentElement)[0];if(angular.isDefined(t)&&angular.isDefined(i)&&"fixed"==t.currentStyle.position){var n=i.getBoundingClientRect().top+i.getBoundingClientRect().height;t.style.setProperty("top",n+"px")}}I.fields.showItems=!0}function m(t){if(a.debug(e.name+" itAutocomplete: input search change value "+t+"->"+I.fields.inputSearch),I.fields.items=[],""==I.fields.inputSearch)d(void 0),l(),c();else{var i=0;angular.forEach(I.fields.initialItems,function(t){"startsWith"==I.fields.searchMode?b(w(t)).startsWith(b(I.fields.inputSearch))&&(I.fields.items.push(t),i++):"custom"==I.fields.searchMode?angular.isUndefined(I.fn.searchPredicate)?a.error(e.name+" When using searchMode = custom, you need to add a searchPredicate function by adding  self.fn.searchPredicate = function (inputValue,item) "):I.fn.searchPredicate(I.fields.inputSearch,t)&&(I.fields.items.push(t),i++):-1!=b(w(t)).search(b(I.fields.inputSearch))&&(I.fields.items.push(t),i++)}),1==I.fields.items.length&&d(I.fields.items[0])}h()}function v(t){var i=t.keyCode;e.keys.forEach(function(e){e.code===i&&e.action()})}function C(){var e=(new Date).getTime(),t="option_container_xxxxxxxxxxxx4yxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});return t}function b(e){var t="";return t+=angular.isDefined(e)&&e.toLowerCase?e.toLowerCase():e}function w(e){var t="";return t=angular.isDefined(I.fields.converter)&&I.fields.converter.getLabelFromObject?I.fields.converter.getLabelFromObject(e):e.value}function E(e){var t="";if(angular.isDefined(I.fields.converter)&&I.fields.converter.getIdFromObject)t=I.fields.converter.getIdFromObject(e);else{if(!e||!angular.isDefined(e)||"object"!=typeof e)return e;t=e.id}return t}function y(e){var t={};return t=angular.isDefined(I.fields.converter)&&I.fields.converter.getObject?I.fields.converter.getObject(e):e}function S(e){return I.fields.items.indexOf(e)}var I=this;I.options=e.options,I.fields={items:[],inputSearch:"",showItems:!1,optionClass:e.optionClass,optionContainerClass:e.optionContainerClass,inputClass:e.inputClass,defaultSelectClass:"",selectedSelectClass:"",selectedItem:{},searchMode:e.searchMode,placeholder:e.placeholder,debug:!1,converter:e.converter,event:{refresh:{name:e.eventRefresh,value:void 0},select:e.eventSelect}},angular.isUndefined(I.fields.optionClass)&&(I.fields.optionClass=""),angular.isUndefined(I.fields.optionContainerClass)&&(I.fields.optionContainerClass=""),angular.isUndefined(I.fields.inputClass)&&(I.fields.inputClass="it-autocomplete-input-class"),angular.isUndefined(I.fields.placeholder)&&(I.fields.placeholder=""),I.fields.optionContainerClass=I.fields.optionContainerClass+" it-autocomplete-container",I.fields.defaultSelectClass=I.fields.optionClass+" it-autocomplete-select",I.fields.selectedSelectClass=I.fields.defaultSelectClass+" it-autocomplete-selected",I.fields.optionContainerId=C(),I.cleanDomRef={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",encode:function(e){if(e){var t,i,n,r,a,o,s,l="",c=0;for(e=I.cleanDomRef._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),r=t>>2,a=(3&t)<<4|i>>4,o=(15&i)<<2|n>>6,s=63&n,isNaN(i)?o=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(s);return l}},decode:function(e){var t,i,n,r,a,o,s,l="",c=0;if(e.replace)for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)r=this._keyStr.indexOf(e.charAt(c++)),a=this._keyStr.indexOf(e.charAt(c++)),o=this._keyStr.indexOf(e.charAt(c++)),s=this._keyStr.indexOf(e.charAt(c++)),t=r<<2|a>>4,i=(15&a)<<4|o>>2,n=(3&o)<<6|s,l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(n));return l=cleanDomRef._utf8_decode(l)},_utf8_encode:function(e){var t="";if(e.replace){e=e.replace(/rn/g,"n");for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),128>n?(t+=String.fromCharCode(n),i++):n>191&&224>n?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},angular.isUndefined(e.name)&&(e.name=I.fields.optionContainerId),I.fn={select:d,change:m,init:c,fullInit:l,hideItems:f,showItems:h,getIdFromObject:E,getLabelFromObject:w,keyBoardInteration:v},I.on={},angular.isDefined(e.items)&&angular.isDefined(e.itemsGetter)&&a.error(e.name+" Autocomplete must use items or items-getter, you are not allowed to use both"),angular.isUndefined(e.items)&&angular.isUndefined(e.itemsGetter)&&a.error(e.name+" Autocomplete must use items or items-getter, you need to add one parameter"),angular.isDefined(I.options)&&angular.isDefined(I.options.onRegisterApi)&&I.options.onRegisterApi(I),l(),c(),e.focusIndex=-1,o(),s(e.selectedOption),I.fields.event.refresh.name?t.$on(I.fields.event.refresh.name,function(t,i){I.fields.debug&&a.debug(e.name+" itAutocomplete: refresh event emit, calling refresh items "),I.fields.event.refresh.value=i,l(),f(),c()}):(I.fields.debug&&a.debug(e.name+" itAutocomplete: refresh event is not defined, add watch to items"),e.$watch("items",function(t,i){t!=I.fields.item&&(I.fields.debug&&a.debug(e.name+" itAutocomplete: items value changed "+t+" "+i),l(),c(),s(e.selectedOption),f())})),e.$watch("selectedOption",function(t,i){e.onChange&&e.onChange(),I.fields.debug&&a.debug(e.name+" itAutocomplete: selectedOption value changed "+i+" -> "+t),(angular.isUndefined(I.fields.selectedItem)||t!=E(I.fields.selectedItem))&&s(t)}),e.keys=[];const T=13,P=38,A=40;e.keys.push({code:T,action:function(){I.fields.showItems?f():(h(),""==I.fields.inputSearch&&(e.focusIndex=-1,o()))}}),e.keys.push({code:P,action:function(){h(),e.focusIndex--,o()}}),e.keys.push({code:A,action:function(){h(),e.focusIndex++,o()}})}],template:'<div class="col-xs-12 it-autocomplete-div"><input placeholder="{{itAutocompleteCtrl.fields.placeholder}}" ng-keydown="itAutocompleteCtrl.fn.keyBoardInteration($event)" ng-focus="itAutocompleteCtrl.fn.showItems($event)" ng-blur="itAutocompleteCtrl.fn.hideItems($event)" type="text" class="form-control" ng-class="inputClass" ng-change="itAutocompleteCtrl.fn.change($event)" ng-model="itAutocompleteCtrl.fields.inputSearch">    <div  ng-class="itAutocompleteCtrl.fields.optionContainerClass" id="{{itAutocompleteCtrl.fields.optionContainerId}}" ng-show="itAutocompleteCtrl.fields.showItems" >       <div class="it-autocomplete-content"  ng-repeat="item in itAutocompleteCtrl.fields.items">           <div class=" {{item == itAutocompleteCtrl.fields.selectedItem?itAutocompleteCtrl.fields.selectedSelectClass: itAutocompleteCtrl.fields.defaultSelectClass}}"               id="{{\'options_\'+itAutocompleteCtrl.cleanDomRef.encode(itAutocompleteCtrl.fn.getIdFromObject(item))}}"                 ng-mousedown="itAutocompleteCtrl.fn.select(item)">               {{itAutocompleteCtrl.fn.getLabelFromObject(item)}}           </div>       </div>   </div></div>'}}),r.directive("itCheckbox",function(){return{restrict:"A",transclude:!0,replace:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="checkbox"></div>'),n.wrap("<label></label>"),n.after('<span class="checkbox-material"><span class="check" style="margin-right:16px;width: '+i.width+";height:"+i.height+';"></span></span>&nbsp;'+(i.itLabel||""))}}}),r.directive("itInput",function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(e,t,i,n){if(n){var r=angular.element(t[0]);if(r.hasClass("floating-label")){r.wrap('<div class="form-control-wrapper"></div>');var a=r.attr("placeholder");a?r.after('<div class="floating-label">'+a+"</div"):(r.after('<div class="floating-label">'+e.itLabel+"</div"),e.$watch("itLabel",function(t){e.$applyAsync(function(){if(r[0].offsetParent){var e=r[0].offsetParent.children;angular.forEach(e,function(e){var i=angular.element(e);i.hasClass("floating-label")&&i.text(t)})}})})),r.after('<span class="material-input"></span>'),r.attr("placeholder","").removeClass("floating-label")}r.after('<small class="text-danger" style="display:none;"></small>'),e.$watch("itError",function(e){if(r[0].offsetParent){var t=r[0].offsetParent.children;angular.forEach(t,function(t){var i=angular.element(t);i.hasClass("text-danger")&&(i.text(e),""!=e&&void 0!=e?(i.removeClass("ng-hide"),i.addClass("ng-show"),i.css("display","block")):(i.removeClass("ng-show"),i.addClass("ng-hide"),i.css("display","none")))})}}),(null===r.val()||"undefined"==r.val()||""===r.val())&&r.addClass("empty"),e.$watch(function(){return n.$modelValue},function(e,t){null===e||void 0==e||""===e?r.addClass("empty"):r.removeClass("empty")}),r.on("change",function(){null===r.val()||"undefined"==r.val()||""===r.val()?r.addClass("empty"):r.removeClass("empty")})}},scope:{itError:"=",itLabel:"@"}}}),r.directive("itSearch",function(){return{restrict:"A",replace:!0,scope:{itSearchControl:"="},link:function(e,t,i){var n=angular.element(t[0]);n.after('<span class="glyphicon glyphicon-search form-control-feedback"/>')},controller:["$scope",function(e){e.itSearchControl.multicolumnsFilter=function(t){var i=new RegExp(e.itSearchControl.filterText,"i"),n=[],r=!1;return e.itSearchControl.columnDefs&&t.forEach(function(t){var a=!1;t.entity?(e.itSearchControl.columnDefs.forEach(function(n){if(!a&&t.entity[n.field]){var r=t.entity[n.field].toString();n.cellFilter&&(e.value=r,r=e.$eval("value | "+n.cellFilter)),"undefined"!=typeof r&&null!=r&&r.match(i)&&(a=!0)}}),a||(t.visible=!1)):(r=!0,e.itSearchControl.columnDefs.forEach(function(e){!a&&t[e.field]&&t[e.field].toString().match(i)&&(a=!0)}),a&&n.push(t))}),r&&(t=n),t}}]}}),r.directive("itToggle",["$compile",function(e){return{restrict:"A",transclude:!0,link:function(e,t,i){var n=angular.element(t[0]);n.wrap('<div class="togglebutton"></div>'),void 0==e.itLabel?(n.wrap("<label></label>"),n.after('<span class="toggle"></span>')):(n.wrap("<label></label>"),n.after('<span class="toggle"></span><span>'+(e.itLabel||"")+"</span>"),e.$watch("itLabel",function(e){if(e&&n.context){var t=angular.element(n.context.parentNode);if(t&&i.itLabel){var r=angular.element(t.get(0).firstChild);r.get(0).textContent=e+"  "}}}))},scope:{itLabel:"@"}}}]),r.directive("itInclude",["$timeout","$compile",function(e,t){var i=function(i,n,r){var a;i.$watch(r.itInclude,function(r){e(function(){a&&a.$destroy(),a=i.$new(),n.html(r||""),t(n.contents())(a)},50)})};return{restrict:"AE",link:i}}]),r.directive("itMediaViewer",["itScriptService",function(e){var t=function(e,t){if(void 0!=e){var i=e.split(t);return i[i.length-1]}return e},i=function(i,n,r){var a=function(t,n){var r=(i.options?i.options.libPath:null)||"js/dist/assets/lib";switch(t){case"pdf":i.pdfSrc=n,e.LoadScripts([r+"/pdf.js"]).then(function(){PDFJS.workerSrc=r+"/pdf.worker.js",i.template='<it-pdf-viewer src="pdfSrc" options="options"></it-pdf-viewer>'});break;case"png":case"jpeg":case"jpg":i.imageSrc=n,i.template='<it-image-viewer src="imageSrc" options="options"></it-image-viewer>';break;case"tif":case"tiff":i.tiffSrc=n,e.LoadScripts([r+"/tiff.min.js"]).then(function(){i.template='<it-tiff-viewer src="tiffSrc" options="options"></it-tiff-viewer>'});break;default:i.template="No template found for extension : "+t}},o=function(e){e&&("string"==typeof e?(i.ext=t(e,".").toLowerCase(),a(i.ext,e)):r.type?a(r.type,e):void 0!=e.name?(i.ext=t(e.name,".").toLowerCase(),a(i.ext,e)):i.template="must specify type when using stream")};i.$watch("src",o),i.$watch("file",o)};return{scope:{src:"=",file:"=",type:"@",options:"="},restrict:"E",template:'<div it-include="template"></div>',link:i}}]),r.factory("itScriptService",["$log","$window","$q",function(e,t,i){var n={},r={},a=i.defer(),o=i.defer(),s=function(e){if(e){if(void 0!=n[e])return n[e];var t=i.defer(),r=document.createElement("script");return n[e]=t.promise,r.src=e,r.type="text/javascript",r.onload=function(){t.resolve(r)},document.head.appendChild(r),t.promise}return a.resolve(),a.promise},l=function(e){if("string"==typeof e)return s(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(s(e))}),i.all(t)}return o.resolve(),o.promise},c=function(e){if(e){if(void 0!=r[e])return r[e];var t=i.defer(),n=document.createElement("link");return r[e]=t.promise,n.href=e,n.rel="stylesheet",n.type="text/css",n.onload=function(){t.resolve(n)},document.head.appendChild(n),t.promise}return a.resolve(),a.promise},d=function(e){if("string"==typeof e)return c(e);if(typeof e==typeof[]){var t=[];return angular.forEach(e,function(e){t.push(c(e))}),i.all(t)}return o.resolve(),o.promise},u=function(e,t){return i.all([l(e),d(t)])};return{LoadScripts:u}}]),r.directive("konami",["$document","$uibModal",function(e,t){return{restrict:"A",template:'<style type="text/css"> @-webkit-keyframes easterEggSpinner { from { -webkit-transform: rotateY(0deg); } to { -webkit-transform: rotateY(-360deg); } } @keyframes easterEggSpinner { from { -moz-transform: rotateY(0deg); -ms-transform: rotateY(0deg); transform: rotateY(0deg); } to { -moz-transform: rotateY(-360deg); -ms-transform: rotateY(-360deg); transform: rotateY(-360deg); } } .easterEgg { -webkit-animation-name: easterEggSpinner; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite; -webkit-animation-duration: 6s; animation-name: easterEggSpinner; animation-timing-function: linear; animation-iteration-count: infinite; animation-duration: 6s; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -ms-transform-style: preserve-3d; transform-style: preserve-3d; } .easterEgg img { position: absolute; border: 1px solid #ccc; background: rgba(255,255,255,0.8); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); } </style>',link:function(i){var n=[38,38,40,40,37,39,37,39,66,65],r=0,a=function(o){if(o.keyCode===n[r++]){if(r===n.length){e.off("keydown",a);var s=t.open({template:'<div style="max-width: 100%;" class="easterEgg"> <img style="-webkit-transform: rotateY(0deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-72deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-144deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-216deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> <img style="-webkit-transform: rotateY(-288deg) translateX(180px); padding: 0 0 0 0px;" src="http://media1.woopic.com/493/f/470x264/q/85/fd/p/newsweb-finance-article%7Cc8c%7C177%7Cbe13e9df471d6c4469b3e3ac93/itesoft-la-sf2i-monte-a-9-9-des-parts%7Cl_itesoftlogo.png" width="100%" height="160" alt=""> </div>',size:"lg"});i.cancel=function(){s.dismiss("cancel")}}}else r=0};e.on("keydown",a),i.$on("$destroy",function(){e.off("keydown",a)})}}}]),r.directive("itPrettyprint",["$rootScope","$sanitize",function(e,t){return{restrict:"EA",terminal:!0,compile:function(e,t){return t["class"]?t["class"]&&-1==t["class"].split(" ").indexOf("prettyprint")&&t.$set("class",t["class"]+" prettyprint"):t.$set("class","prettyprint"),function(e,t,i){function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return r[e]})}var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t[0].innerHTML=prettyPrintOne(n(t[0].innerHTML))}}}}]),r.directive("itBottomGlue",["$window","$timeout",function(e,t){return function(i,n){function r(){for(var t=n[0],i=angular.element(n)[0],r=0,a=0,o=0,s=0;null!==t&&"undefined"!=typeof t;){var l=e.getComputedStyle(t),c=parseInt(l["margin-bottom"],10),d=parseInt(l["padding-bottom"],10),u=parseInt(l["padding-top"],10),p=parseInt(l["margin-top"],10);s+=isNaN(p)?0:p,r+=isNaN(c)?0:c,a+=isNaN(d)?0:d,o+=isNaN(u)?0:u,t=t.parentElement}var f=e.getComputedStyle(n[0]),g=parseInt(f["padding-bottom"],10),h=i.getBoundingClientRect();n.css("height",e.innerHeight-h.top-r-(a-g)+"px"),n.css("overflow-y","auto")}t(function(){r(),e.addEventListener("resize",function(){r()})},250)}}]),r.directive("itCollapsedItem",function(){return{restrict:"A",link:function(e,t,i){var n=angular.element(t[0].querySelector("ul")),r=angular.element(t[0].querySelector("a"));n.addClass("it-side-menu-collapse"),t.addClass("it-sub-menu");var a=angular.element(t[0].querySelector("h5")),o=angular.element('<i class="pull-right fa fa-angle-right" ></i>');a.append(o),r.on("click",function(){n.hasClass("it-side-menu-collapse")?(n.removeClass("it-side-menu-collapse"),n.addClass("it-side-menu-expanded"),o.removeClass("fa-angle-right"),o.addClass("fa-angle-down"),t.addClass("toggled")):(t.removeClass("toggled"),o.addClass("fa-angle-right"),o.removeClass("fa-angle-down"),n.removeClass("it-side-menu-expanded"),n.addClass("it-side-menu-collapse"))})}}}),r.directive("itNavActive",["$location",function(e){return{restrict:"A",scope:!1,link:function(t,i,n){function r(){var t=e.path();t&&angular.forEach(i.find("li"),function(e){var i=e.querySelector("a");i.href.match("#"+t+"(?=\\?|$)")?angular.element(e).addClass(a):angular.element(e).removeClass(a)})}var a=n.itActive||"active";r(),t.$on("$locationChangeSuccess",r)}}}]),r.directive("itSideMenu",function(){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e,t,i){e.$itSideMenuWidth=i.itWidth?i.itWidth:260,e.$watch(function(){e.$itSideMenuWidth=i.itWidth?i.itWidth:260});var n=angular.element(document.querySelector("it-side-menu-header"));n[0]||(e.$noMenuHeader=!0)},template:'<div style="{{$noMenuHeader ? \'top:0px;padding-bottom:0px;left:0px;\':\'\'}}width:{{$itSideMenuWidth}}px;" class="it-side-menu it-side-menu-left it-side-menu-hide it-menu-animated" ng-class="{\'it-side-menu-hide\':!showmenu,\'it-side-menu-slide\':showmenu}"><div style="width:{{($itSideMenuWidth * 1 ) + (50 * 1)}}px;"  class="it-sidebar-inner"><div style="width:{{$itSideMenuWidth}}px;" class="nav navbar navbar-inverse"><nav class="" ng-transclude ></nav></div></div></div>'}}),r.directive("itSideMenuContent",function(){return{restrict:"ECA",require:"^itSideMenus",transclude:!0,scope:!1,link:function(e){var t=angular.element(document.querySelector("it-side-menu-header"));t[0]||(e.showmenu=!0)},template:'<div class="it-menu-content"  style="padding-left : {{showmenu ? $itSideMenuWidth : 0}}px"><div class="it-container it-fill" ng-transclude></div></div>'}}),r.controller("$sideMenuCtrl",["$scope","$document","$timeout","$window",function(e,t,i,n){var r=this;r.scope=e,r.scope.showmenu=!1,r.toggleMenu=function(){r.scope.showmenu=r.scope.showmenu?!1:!0,i(function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),n.dispatchEvent(e)},300)},r.hideSideMenu=function(){r.scope.showmenu=!1}}]),r.directive("itSideMenuHeader",["$rootScope",function(e){return{restrict:"E",require:"^itSideMenus",transclude:!0,scope:!0,link:function(t,i,n,r){var a=angular.element(i[0].querySelector(".it-material-design-hamburger__layer")),o=(angular.element(i[0].querySelector(".it-material-design-hamburger__icon")),angular.element(document.querySelector("it-side-menu-content")));o&&o.css("padding-top","60px"),t.toggleMenu=r.toggleMenu,"true"===n.itAnimate&&t.$watch("showmenu",function(t,i){t!=i&&(t?(a.removeClass("it-material-design-hamburger__icon--from-arrow"),a.addClass("it-material-design-hamburger__icon--to-arrow"),e.$broadcast("it-sidemenu-state","closed")):(a.removeClass("it-material-design-hamburger__icon--to-arrow"),a.addClass("it-material-design-hamburger__icon--from-arrow"),e.$broadcast("it-sidemenu-state","opened")))},!0),n.itHideButtonMenu&&(t.itHideButtonMenu=t.$eval(n.itHideButtonMenu)),t.$watch(n.itHideButtonMenu,function(e,i){t.itHideButtonMenu=e,e&&r.hideSideMenu()})},template:'<nav id="header" class="it-side-menu-header nav navbar navbar-fixed-top navbar-inverse"><section class="it-material-design-hamburger" ng-hide="itHideButtonMenu"><button  ng-click="toggleMenu()" class="it-material-design-hamburger__icon"><span class="it-menu-animated it-material-design-hamburger__layer"> </span></button> </section><div class="container-fluid" ng-transclude></div></nav>'}}]),r.directive("itSideMenus",function(){return{restrict:"ECA",transclude:!0,controller:"$sideMenuCtrl",template:'<div class="it-side-menu-group" ng-transclude></div>'}}),r.directive("itSidePanel",["$window",function(e){function t(e,t,i){e.itSidePanelElement=t,e.setIconClass(e,i),e.setZIndexes(t,i),e.setColMd(i),e.setHeightMode(i),e.setTopPosition(i)}return{link:t,restrict:"E",transclude:!0,controller:"$sidePanelCtrl",scope:!0,template:'<div class="it-side-panel-container" ng-class="{\'it-side-panel-container-show\': showPanel}"><div class="it-side-panel-button it-vertical-text" ng-class="{\'it-side-panel-button-show\':showPanel,\'it-side-panel-button-right\':!showPanel}" ng-click="toggleSidePanel()"><span class="fa {{itIconClass}}"></span></div><div class="it-side-panel" ng-transclude></div></div>'}}]),r.directive("itSidePanelContent",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-content" ng-transclude></div>'}}),r.controller("$sidePanelCtrl",["$scope","$window","$document","$timeout","$log",function(e,t,i,n,r){var a="it-col",o="it-height-mode",s="it-top-position",l=40,c="z-index",d="window",u="full",p="auto",f=[d,u,p],g=d,h=4,m=12,v=1,C="fa-search",b="none",w=b,E=".it-side-panel-button",y=".it-side-panel-button-right",S=".it-side-panel-container",I=".it-side-panel",T=".it-side-panel-header",P=".it-side-panel-content",A=".it-side-panel-footer",D=this;D.scope=e,D.scope.showPanel=!1,D.scope.itHeightMode=g,D.scope.itSidePanelcolMd=h,D.scope.itSidePanelTopPosition=b,D.scope.sidePanelButtonWidth=l,D.scope.sidePanelContainerWidth=null,D.scope.sidePanelContainerRight=null,D.scope.sidePanelButtonRight=null;var k=angular.element(t);D.scope.getWindowDimensions=function(){return{height:t.innerHeight,width:t.innerWidth}},D.scope.$watch(D.scope.getWindowDimensions,function(e,t){D.scope.windowHeight=e.height,D.scope.windowWidth=e.width;var i=D.scope.getElementFromClass(D.scope.itSidePanelElement,S);if(D.scope.itHeightMode===d){var n=i[0].getBoundingClientRect().top;if(Math.abs(n)<D.scope.windowHeight){var r=D.scope.itSidePanelTopPosition;D.scope.isNoneTopPosition()&&(r=0);var a=D.scope.windowHeight-n-r,o=.1*a,s=D.scope.getElementFromClass(D.scope.itSidePanelElement,T);s.css("height",o+"px");var l=.1*a,c=D.scope.getElementFromClass(D.scope.itSidePanelElement,A);c.css("height",l+"px");var u=D.scope.getElementFromClass(D.scope.itSidePanelElement,P);u.css("height",.8*a+"px")}}if(D.scope.showPanel){var p=D.scope.windowWidth/12*D.scope.itSidePanelcolMd;D.scope.sidePanelContainerWidth=p,i.css("width",p+"px")}else D.scope.modifySidePanelCssProperties()},!0),D.scope.modifySidePanelCssProperties=function(){var e=D.scope.getElementFromClass(D.scope.itSidePanelElement,S),t=D.scope.getElementFromClass(D.scope.itSidePanelElement,y),i=D.scope.windowWidth/12*D.scope.itSidePanelcolMd;D.scope.sidePanelContainerWidth=i,D.scope.sidePanelContainerRight=-D.scope.sidePanelContainerWidth,D.scope.sidePanelButtonRight=D.scope.sidePanelContainerWidth,e.css("width",D.scope.sidePanelContainerWidth+"px"),e.css("right",D.scope.sidePanelContainerRight+"px"),t.css("right",D.scope.sidePanelButtonRight+"px")},k.bind("resize",function(){D.scope.$apply()}),D.scope.toggleSidePanel=function(){D.scope.showPanel=D.scope.showPanel?!1:!0;var e=D.scope.getElementFromClass(D.scope.itSidePanelElement,S),t=D.scope.getElementFromClass(D.scope.itSidePanelElement,E);if(D.scope.showPanel)t.css("right",""),n(function(){D.scope.sidePanelContainerRight=0,e.css("right",D.scope.sidePanelContainerRight+"px")},50);else{var i=e.css("width");D.scope.sidePanelContainerRight=-parseInt(i.slice(0,i.length-2)),D.scope.sidePanelButtonRight=D.scope.sidePanelContainerWidth,e.css("right",D.scope.sidePanelContainerRight+"px"),t.css("right",D.scope.sidePanelButtonRight+"px")}},D.scope.setItSidePanelElement=function(e){D.scope.itSidePanelElement=e},D.scope.setHeightMode=function(e){if(D.scope.itHeightMode=e.itHeightMode,""===D.scope.itHeightMode||"undefined"==typeof D.scope.itHeightMode)D.scope.itHeightMode=g;else if(-1!=f.indexOf(D.scope.itHeightMode)){var t=f.indexOf(D.scope.itHeightMode);D.scope.itHeightMode=f[t]}else D.scope.itHeightMode=g,r.error('"'+o+'" with value "'+D.scope.itHeightMode+'"is unknown. The default value is taken : "'+g+'"');var i=D.scope.getElementFromClass(D.scope.itSidePanelElement,T);i.css("height","10%");var n=D.scope.getElementFromClass(D.scope.itSidePanelElement,A);n.css("height","10%");var a=D.scope.getElementFromClass(D.scope.itSidePanelElement,P);switch(a.css("height","80%"),D.scope.itHeightMode){case u:var s=D.scope.getElementFromClass(D.scope.itSidePanelElement,S),l=s.css("height");if(l>D.scope.windowHeight){s.css("height","100%");var c=D.scope.getElementFromClass(D.scope.itSidePanelElement,I);c.css("height","100%")}break;case p:break;case d:var c=D.scope.getElementFromClass(D.scope.itSidePanelElement,I);c.css("height","100%");var a=D.scope.getElementFromClass(D.scope.itSidePanelElement,P);a.css("overflow","auto");break;default:r.error('Height mode : "'+D.scope.itHeightMode+'" is unknown.')}},D.scope.setIconClass=function(e,t){var i=C;""===t.itIconClass||"undefined"==typeof t.itIconClass?D.scope.itIconClass=i:D.scope.itIconClass=t.itIconClass},D.scope.setColMd=function(e){isNaN(parseInt(e.itCol))?(D.scope.itSidePanelcolMd=h,r.warn('Attribute "'+a+'" of itSidePanel directive is not a number. The default value is taken : "'+D.scope.itSidePanelcolMd+'"')):e.itCol>m?(D.scope.itSidePanelcolMd=m,r.warn('Attribute "'+a+'" of itSidePanel directive exceeds the maximum value ('+m+"). The maximum value is taken.")):e.itCol<v?(D.scope.itSidePanelcolMd=v,r.warn('Attribute "'+a+'" of itSidePanel directive exceeds the minimum value ('+v+"). The minimum value is taken.")):D.scope.itSidePanelcolMd=e.itCol},D.scope.setZIndexes=function(e,t){var i=null;isNaN(parseInt(t.itZIndex))||(i=parseInt(t.itZIndex));var n=D.scope.getElementFromClass(e,S),r=D.scope.getElementFromClass(e,E);
if(null!==i)n.css(c,i),r.css(c,i+1);else{var a=D.scope.findHighestZIndex(),o=a+100;n.css(c,o),r.css(c,o+1)}},D.scope.getElementFromClass=function(e,t){var i=angular.element(e[0].querySelector(t)),n=angular.element(i[0]);return n},D.scope.findHighestZIndex=function(){for(var e=document.getElementsByTagName("*"),i=0,n=0;n<e.length-1;n++){var r=t.getComputedStyle(e[n]),a=parseInt(r["z-index"]);(isNaN(a)?0:a)>i&&(i=a)}return i},D.scope.setTopPosition=function(e){var t=e.itTopPosition;if(isNaN(parseInt(t)))D.scope.isNoneTopPosition()&&"undefined"!=typeof t||(D.scope.itSidePanelTopPosition=w,r.warn('Attribute "'+s+'" of itSidePanel directive is not a number. The mode taken is "'+w+'"'));else{D.scope.itSidePanelTopPosition=e.itTopPosition;var i=D.scope.getElementFromClass(D.scope.itSidePanelElement,S);i.css("top",D.scope.itSidePanelTopPosition+"px")}},D.scope.isNoneTopPosition=function(){return"none"===D.scope.itSidePanelTopPosition}}]),r.directive("itSidePanelFooter",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-footer" ng-transclude></div>'}}),r.directive("itSidePanelHeader",function(){function e(e){}return{scope:!1,link:e,restrict:"E",transclude:!0,require:"^itSidePanel",template:'<div class="it-side-panel-header text-center" ng-transclude></div>'}}),r.factory("BlockService",["$resource","CONFIG",function(e,t){return{custom:e(t.REST_TEMPLATE_API_URL+"/blocks/custom/"+t.CURRENT_PACKAGE+"/:name"),all:e(t.REST_TEMPLATE_API_URL+"/blocks/all/"+t.CURRENT_PACKAGE+"/:name"),original:e(t.REST_TEMPLATE_API_URL+"/blocks/original/:name"),customByOriginal:e(t.REST_TEMPLATE_API_URL+"/original/"+t.CURRENT_PACKAGE+"/:name/custom"),restore:e(t.REST_TEMPLATE_API_URL+"/blocks/restore/"+t.CURRENT_PACKAGE+"/:name"),build:e(t.REST_TEMPLATE_API_URL+"/packages/build"),preview:e(t.REST_TEMPLATE_API_URL+"/packages/preview"),"new":function(e,t,i,n,r,a){return{name:e,position:i,ref:t,content:n,role:r,version:a}}}}]),r.directive("itBlock",[function(){return{restrict:"E",scope:!0,transclude:!0,template:'<ng-transclude  class="{{itBlockController.hilightClass}}" ng-mouseover="itBlockController.over()" ng-mouseleave="itBlockController.leave()" ng-if="!removed || $root.editSite"> </ng-transclude>',controllerAs:"itBlockController",link:function(e,t,i,n,r){r(e,function(t){var i="";angular.forEach(t,function(e){e.outerHTML&&(i+=e.outerHTML)}),e.content=i}),e.ref=i.ref,e.role=i.role,e.position=i.position,e.name=i.name,e.removed=!1,e.element=t,e.version=i.version,angular.isDefined(i.removed)&&"true"==i.removed&&(e.removed=i.removed),this.fields={},n.onRegisterApi()},controller:["$scope","$rootScope","$location","$log","$interval","$timeout","$document","itPopup","BlockService","PilotSiteSideService",function(e,t,i,n,r,a,o,s,l,c){var d=this;d.focusable=!1,t.$on("hilightBlock",function(t,i){angular.isDefined(i)&&i.name==d.block.name?d.hilightClass="block-hilight":e.removed?d.hilightClass="block-removed":d.hilightClass=""}),d.onRegisterApi=function(){d.block=l["new"](e.name,e.ref,e.position,e.content,e.role,e.version),d.block.removed=e.removed},d.leave=function(){t.$emit("unSelectBlock",d.block)},d.over=function(){t.$emit("selectBlock",d.block)},t.$watch("editSite",function(){t.editSite&&(a(function(){e.removed&&(d.hilightClass="block-removed")},500),a(function(){angular.isDefined(e.element.find("ng-transclude")[0])&&(e.element.find("ng-transclude")[0].children[0].disabled=!1)},500))})}]}}]),r.directive("itBlockControlPanel",[function(){return{restrict:"EA",scope:!0,template:'<div class="block-control-panel col-xs-12" ng-if="itBlockControlPanelController.CONFIG.ENABLE_TEMPLATE_EDITOR"><div ng-if="itBlockControlPanelController.editorIsOpen" class="col-xs-12"/> <div class="block-control-panel-action-container col-xs-12"><it-circular-btn ng-if="!$root.editSite" ng-click="$root.editSite=true" ><i class="fa fa-pencil"></i></it-circular-btn><it-circular-btn ng-if="$root.editSite" ng-click="$root.editSite=false" ><i class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.refresh()"><i class="fa fa-refresh"></i></it-circular-btn><it-circular-btn ng-if="$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=false"><i class="fa fa-stop"></i></it-circular-btn><it-circular-btn ng-if="!$root.autoRefreshTemplate" ng-click="$root.autoRefreshTemplate=true"><i class="fa fa-play"></i></it-circular-btn><it-circular-btn><a ng-href="{{itBlockControlPanelController.url}}" target="_blank" ><i class="fa fa-floppy-o"></i></a></it-circular-btn><span ng-if="!itBlockControlPanelController.focusable" class="col-xs-8 block-control-panel-help">(Press Ctrl and move your mouse over a block)</span><span ng-if="itBlockControlPanelController.focusable" class="col-xs-8 block-control-panel-help">(Release Ctrl over an element to select it)</span></div><div class=" btn btn-danger offline-editor"  ng-if="!itBlockControlPanelController.editorIsOpen" aria-label="Left Align"><span class="fa fa-exclamation" aria-hidden="true"></span><a  target="_blank" ng-href="{{CONFIG.TEMPLATE_EDITOR_URL}}" >{{\'GLOBAL.TEMPLATE.BLOCK.OPEN_EDITOR\' | translate}}</a></div><div class="block-lists"  ng-if="$root.editSite"><div ng-repeat="block in itBlockControlPanelController.blocks | orderBy:\'-name\'" ng-mouseover="itBlockControlPanelController.hilightBlock(block)" class="{{itBlockControlPanelController.getClass(block)}}"><div class="block-lists-name">{{block.name}}</div><div class="block-lists-action"><it-circular-btn ng-click="itBlockControlPanelController.addBlock(block)"><i class="fa fa-plus "></i></it-circular-btn><it-circular-btn ng-click="itBlockControlPanelController.editBlock(block)"><i  class="fa fa-pencil"></i></it-circular-btn><it-circular-btn ng-if="block.removed" ng-click="itBlockControlPanelController.restoreBlock(block)"><i  class="fa fa-eye"></i></it-circular-btn><it-circular-btn ng-if="!block.removed" ng-click="itBlockControlPanelController.deleteBlock(block)"><i  class="fa fa-eye-slash block-btn"></i></it-circular-btn></div></div></div></div>',controllerAs:"itBlockControlPanelController",controller:["$scope","$rootScope","$location","$log","$document","$filter","BlockService","PilotSiteSideService","PilotService","CONFIG","itPopup","itNotifier",function(e,t,i,n,r,a,o,s,l,c,d,u){function p(){s.fn.options({currentPackage:c.CURRENT_PACKAGE})}var f=this;c.ENABLE_TEMPLATE_EDITOR&&(f.editorIsOpen=!1,f.CONFIG=c,f.blocks=[],f.url=c.REST_TEMPLATE_API_URL+"/export/"+c.CURRENT_PACKAGE,this.refresh=function(){o.build.get(function(){location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},f.interval=0,p(),s.on.pong=function(t){n.debug("pong"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorConnect=function(t){n.debug("editorConnect"),e.$applyAsync(function(){f.editorIsOpen=!0,p()})},s.on.editorDisconnect=function(t){n.debug("editorDisconnect"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.close=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.error=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.transportFailure=function(){n.error("websocket api is deconnected, please restart APIs to enable connection"),e.$applyAsync(function(){f.editorIsOpen=!1})},s.on.reload=this.refresh,f.editJS=function(){n.debug("edit JS"),s.fn.editPage({fileName:"js.blocks.js",fileType:"js",filePackage:c.CURRENT_PACKAGE})},f.editCSS=function(){n.debug("edit CSS"),s.fn.editPage({fileName:"css.blocks.css",fileType:"css",filePackage:c.CURRENT_PACKAGE})},f.addFile=function(){n.debug("add File"),s.fn.createPage()},t.editSite=!0,t.autoRefreshTemplate=!0,r.bind("keydown",function(e){17!=e.keyCode||f.focusable||(r.find("*").addClass("crosshair"),n.log("keydown"),f.focusable=!0,f.blocks=[],f.hilightedBlock=void 0,f.hilightBlock(void 0))}),r.bind("keyup",function(e){17==e.keyCode&&f.focusable&&(n.log("keyup"),r.find("*").removeClass("crosshair"),f.focusable=!1)}),t.$on("selectBlock",function(e,t){f.focusable&&-1==f.blocks.indexOf(t)&&f.blocks.push(t)}),t.$on("unSelectBlock",function(e,t){f.focusable&&-1!=f.blocks.indexOf(t)&&f.blocks.splice(f.blocks.indexOf(t),1)})),f.editBlock=function(e){if(n.debug("edit block"),angular.isDefined(e.ref)&&""!=e.ref)s.fn.editBlock(e,i.path());else{var t=o["new"](c.CURRENT_PACKAGE+"_replace"+e.name+"_"+a("date")(new Date,"yyyyMMddHHmmss"),e.name,"replace",e.content,c.CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.addBlock=function(e){if(angular.isDefined(e.name)&&""!=e.name){n.debug("add block");var t=o["new"](c.CURRENT_PACKAGE+"_new_"+e.name+"_"+a("date")(new Date,"yyyyMMddHHmmss"),e.name,"before","",c.CURRENT_ROLE,1);s.fn.createBlock(t,i.path())}},f.restoreBlock=function(e){n.debug("restore block"),o.restore.get({name:e.name},function(){o.build.get(function(){o.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(t){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},t.data.body),n.error("Unable to restore block "+JSON.stringify(e))})})},f.deleteBlock=function(e){n.debug("delete block");var i=d.confirm({title:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.TITLE' | translate}}",text:"{{'GLOBAL.TEMPLATE.BLOCK.DELETE.CONFIRM' | translate}}",buttons:[{text:"Cancel",type:"",onTap:function(){return!1}},{text:"ok",type:"",onTap:function(){return!0}}]});i.then(function(){o.all["delete"]({name:e.name},function(){o.build.get(function(){t.autoRefreshTemplate&&location.reload()},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(e){u.notifyError({content:a("translate")("GLOBAL.TEMPLATE.WS.ERROR"),dismissOnTimeout:!1},e.data.body)})},function(){u.notifyError({content:"{{'GLOBAL.TEMPLACE.WS.BLOCK_DELETED_KO' | translate}}"})})},f.hilightBlock=function(e){f.hilightedBlock=e,t.$emit("hilightBlock",e)},f.getClass=function(e){return f.hilightedBlock&&f.hilightedBlock.name==e.name?"block-lists-element-hilight":""}}]}}]),r.factory("PilotService",["$resource","$log","CONFIG",function(e,t,i){function n(e){t.log("ping "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PING,params:[]}))}function r(e){t.log("pong "+e),a.fields.socket.push(atmosphere.util.stringifyJSON({dest:e,action:a.ACTION_PONG,params:[]}))}var a=this;return a.ACTION_EDIT_BLOCK="editBlock",a.ACTION_REMOVE_BLOCK="removeBlock",a.ACTION_CREATE_BLOCK="createBlock",a.ACTION_EDIT_PAGE="editPage",a.ACTION_REMOVE_PAGE="removePage",a.ACTION_CREATE_PAGE="createPage",a.ACTION_PING="ping",a.ACTION_PONG="pong",a.ACTION_DISCONNECT="disconnect",a.ACTION_TIMEOUT="timeout",a.ACTION_CONNECT="connect",a.ACTION_RELOAD="reload",a.ACTION_OPTIONS="options",a.DEST_EDITOR="editor",a.DEST_SITE="site",a.DEST_ALL="all",a.fields={socket:{},request:{url:i.REST_EDITOR_API_URL,contentType:"application/json",logLevel:"debug",transport:"websocket",trackMessageLength:!0,reconnectInterval:5e3,enableXDR:!0,timeout:6e4},model:{},dest:""},a.fn={ping:n,pong:r},a.on={message:{},open:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},a.fields.request.onOpen=function(e){a.fields.model.transport=e.transport,a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.open)&&a.on.open()},a.fields.request.onClientTimeout=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_TIMEOUT,params:[]})),setTimeout(function(){a.fields.socket=atmosphere.subscribe(a.fields.request)},a.fields.request.reconnectInterval)},a.fields.request.onReopen=function(e){a.fields.model.connected=!0,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_CONNECT,params:[]})),angular.isDefined(a.on.reopen)&&a.on.reopen()},a.fields.request.onTransportFailure=function(e,t){atmosphere.util.info(e),t.fallbackTransport="long-polling",angular.isDefined(a.on.transportFailure)&&a.on.transportFailure()},a.fields.request.onMessage=function(e){a.on.message(e)},a.fields.request.onClose=function(e){a.fields.model.connected=!1,a.fields.socket.push(atmosphere.util.stringifyJSON({dest:a.fields.dest,action:a.ACTION_DISCONNECT,params:[]})),angular.isDefined(a.on.close)&&a.on.close()},a.fields.request.onError=function(e){a.fields.model.logged=!1,angular.isDefined(a.on.error)&&a.on.error()},a.fields.request.onReconnect=function(e,t){a.fields.model.connected=!1},i.ENABLE_TEMPLATE_EDITOR&&(a.fields.socket=atmosphere.subscribe(a.fields.request)),a}]),r.factory("PilotSiteSideService",["$resource","$log","CONFIG","PilotService",function(e,t,i,n){function r(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_BLOCK,params:[{block:e,path:t}]}))}function a(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_BLOCK,params:[{block:e,path:t}]}))}function o(e,t){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_BLOCK,params:[{block:e,path:t}]}))}function s(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_EDIT_PAGE,params:[{page:e}]}))}function l(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_REMOVE_PAGE,params:[{page:e}]}))}function c(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_CREATE_PAGE,params:[{page:e}]}))}function d(e){n.fields.socket.push(atmosphere.util.stringifyJSON({dest:n.DEST_EDITOR,action:n.ACTION_OPTIONS,params:[{options:e}]}))}var u=this;return u.fields={},u.fn={editBlock:r,removeBlock:a,createBlock:o,editPage:s,removePage:l,createPage:c,options:d,ping:n.fn.ping},u.on={reload:void 0,pong:void 0,editorConnect:void 0,editorDisconnect:void 0,close:void 0,reopen:void 0,transportFailure:void 0,error:void 0},i.ENABLE_TEMPLATE_EDITOR&&(n.fields.dest=n.DEST_EDITOR,n.on.open=function(e){t.log("WebSocket connection is opened"),u.fn.ping(n.DEST_EDITOR)},n.on.reopen=function(e){t.log("WebSocket connection is reopened"),u.fn.ping(n.DEST_EDITOR)},n.on.close=function(){angular.isDefined(u.on.close)&&u.on.close()},n.on.error=function(){angular.isDefined(u.on.error)&&u.on.error()},n.on.transportFailure=function(){angular.isDefined(u.on.transportFailure)&&u.on.transportFailure()},n.on.message=function(e){var i=e.responseBody;try{var r=atmosphere.util.parseJSON(i);if(r.dest==n.DEST_ALL)switch(r.action){case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect()}if(r.dest==n.DEST_SITE)switch(r.action){case n.ACTION_RELOAD:t.log(n.ACTION_RELOAD),angular.isDefined(u.on.reload)&&u.on.reload();break;case n.ACTION_PING:t.log(n.ACTION_PING),n.pong(n.DEST_EDITOR);break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_PONG:t.log(n.ACTION_PONG),angular.isDefined(u.on.pong)&&u.on.pong();break;case n.ACTION_DISCONNECT:t.log(n.ACTION_DISCONNECT),angular.isDefined(u.on.editorDisconnect)&&u.on.editorDisconnect();break;case n.ACTION_CONNECT:t.log(n.ACTION_CONNECT),angular.isDefined(u.on.editorConnect)&&u.on.editorConnect()}}catch(a){throw t.error("Error parsing JSON: ",i),a}}),u}]),r.directive("itFillHeight",["$window","$document",function(e,t){return{restrict:"A",scope:{footerElementId:"@",additionalPadding:"@"},link:function(i,n,r){function a(){var r,a=angular.element(t[0].getElementById(i.footerElementId));r=1===a.length?a[0].offsetHeight+o(a)+s(a):0;var l=n[0].offsetTop,c=s(n),d=i.additionalPadding||0,u=e.innerHeight-l-c-r-d;n.css("height",u+"px")}function o(e){var t=l(e,"margin-top"),i=l(e,"border-top-width");return t+i}function s(e){var t=l(e,"margin-bottom"),i=l(e,"border-bottom-width");return t+i}function l(e,t){return parseInt(e.css(t),10)||0}angular.element(e).on("resize",a),a()}}}]),r.directive("itViewMasterHeader",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-md-6"><div class="btn-toolbar" ng-transclude></div></div><div class="col-md-6 pull-right"><div><form><div class="form-group has-feedback"><span class="glyphicon glyphicon-search form-control-feedback"></span><input it-input class="form-control" type="text" placeholder="Rechercher"/></div></form></div></div></div>'}}),r.directive("itViewPanel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="jumbotron" ng-transclude></div>'}}),r.directive("itViewTitle",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="row"><div class="col-xs-12"><h3 ng-transclude></h3><hr></div></div>'}}),r.filter("itUnicode",["$sce",function(e){return function(t){function i(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();n.length<4;)n="0"+n;n="&#x"+n+";",t+=n}return t}return e.trustAsHtml(i(t))}}]),r.provider("itLanguageChangeHandler",function(){var e=this;this.options={storage:"local",displayConfirm:!0,onChangePopup:{title:"Confirm language change",text:"By modifying the language any recent changes may be lost. Continue?",buttonCancelLabel:"NO",buttonOkLabel:"YES"}},this.$get=["$rootScope","$translate","$location","$q","localStorageService","itPopup",function(t,i,n,r,a,o){return{translate:i,getConfig:function(){return e.options},changeLanguage:function(r,s,l){var c={currentLanguage:this.getCurrentLanguage()};if(e.options.displayConfirm){i.use(r);var d=o.confirm({title:e.options.onChangePopup.title,text:e.options.onChangePopup.text,cancelText:e.options.onChangePopup.buttonCancelLabel,okText:e.options.onChangePopup.buttonOkLabel});!function(o){var c=o;d.then(function(c){if(i.use(r),"query"===e.options.storage)try{n.search("Locale",r)}catch(d){reject("Error setting query parameter, lang, to locale value: "+r+" Error: "+d.message)}else try{a.set("Locale",r)}catch(d){reject("Error setting local storage parameter, lang, to locale value: "+r+" Error: "+d.message)}s&&(s.currentLanguage=r,s.user&&(s.user.language=i.use())),o={currentLanguage:r},l&&l(o),t.$applyAsync(function(){location.reload()})},function(){i.use(c.currentLanguage)})}(c)}},getCurrentLanguage:function(){return"query"===e.options.storage?n.search().Locale?n.search().Locale.replace(/-/g,"_"):this.getDefaultLocale(this.translate.use()):a.get("Locale")||this.getDefaultLocale(this.translate.use())},getDefaultLocale:function(e){switch(e||(e=i.preferredLanguage()),e){case"en":return"en_GB";case"de":return"de_DE";default:case"fr":return"fr_FR"}},getLanguageCode:function(e){switch(e){case"en_GB":case"en-GB":case"en_US":case"en-US":return"en";case"de_DE":case"de-DE":return"de";default:case"fr_FR":case"fr-FR":case"fr_CA":case"fr-CA":return"fr"}}}}]}),r.provider("itNotifier",[function(){var e=this;e.defaultOptions={dismissOnTimeout:!0,timeout:4e3,dismissButton:!0,animation:"fade",horizontalPosition:"right",verticalPosition:"bottom",compileContent:!0,dismissOnClick:!1,success:{dismissOnClick:!0},info:{dismissOnClick:!0},error:{dismissOnTimeout:!1},warning:{dismissOnTimeout:!1}},this.$get=["ngToast","$rootScope","$log",function(t,i,n){function r(e){return" CODE : "+e.CODE+", TYPE : "+e.TYPE+", MESSAGE : "+e.MESSAGE+", DETAIL : "+e.DETAIL+", DONE : "+e.DONE}var a={};return t.settings=angular.extend(t.settings,e.defaultOptions),a.notifySuccess=function(i,a){var o=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.success,i,i.success);t.success(o),void 0!=a&&n.log("Success popup called : "+r(a))},a.notifyError=function(i,a){var o=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.error,i,i.error);t.danger(o),void 0!=a&&n.error("Error popup called : "+r(a))},a.notifyInfo=function(i,a){var o=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.info,i,i.info);t.info(o),void 0!=a&&n.info("Info popup called : "+r(a))},a.notifyWarning=function(i,a){var o=angular.extend(t.settings,e.defaultOptions,e.defaultOptions.warning,i,i.warning);t.warning(o),void 0!=a&&n.warn("Warning popup called : "+r(a))},a.notifyDismiss=function(e,i){t.dismiss()},a.notify=function(e){n.error("Unknown type for itNotifier: "+e)},i.$on("$locationChangeSuccess",function(){a.notifyDismiss()}),i.$on("itNotifierEvent",function(e,t){if(t)switch(t.type){case"SUCCESS":a.notifySuccess(t.options,t.errorDetails);break;case"ERROR":a.notifyError(t.options,t.errorDetails);break;case"INFO":a.notifyInfo(t.options,t.errorDetails);break;case"WARNING":a.notifyWarning(t.options,t.errorDetails);break;case"DISMISS":a.notifyDismiss(t.options,t.errorDetails);break;default:a.notify(t.type)}else n.error("Bad usage of itNotifier. Check manual for details")}),a}]}]),r.factory("itPopup",["$uibModal","$uibModalStack","$rootScope","$q","$compile",function(e,t,i,n,r){function a(e){function t(){return!1}var r={};return r.scope=(e.scope||i).$new(),r.responseDeferred=n.defer(),r.scope.$buttonTapped=function(e,t){var i=(t.onTap||noop)(e);r.responseDeferred.resolve(i)},e=angular.extend({scope:r.scope,template:u,controller:["$scope","$uibModalInstance",function(e,i){function n(){i.close(e.data)}function a(){i.dismiss("cancel")}e.itButtonAction=function(i,o){var s=(o.onTap||t)(i,e),l=s;i.isDefaultPrevented()||r.responseDeferred.resolve(l?n():a())}}],buttons:[]},e||{}),e.scope.options=e,r.options=e,r}function o(i){t.dismissAll();var n=a(i);return e.open(n.options).result}function s(e){return t.dismissAll(),o(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}}]},e||{}))}function l(e){return t.dismissAll(),o(angular.extend({buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){return!1}}]},e||{}))}function c(e){return t.dismissAll(),o(e)}function d(e){t.dismissAll();var n=i.$new(!0);n.data={};var r="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(r="<span>"+e.template+"</span>",delete e.template),o(angular.extend({template:p,inputLabel:e.inputLabel||"",buttons:[{text:e.okText||"OK",type:e.okType||"btn-info",onTap:function(){return!0}},{text:e.cancelText||"Cancel",type:e.cancelType||"",onTap:function(){}}]},e||{}))}var u='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div><div class="modal-body"><p it-compile="options.text"></p></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',p='<div class="modal-header it-view-header"><h3 it-compile="options.title"></h3></div></div><div class="modal-body"><p it-compile="options.text"></p>   <div class="form-group"><div class="form-control-wrapper"><input type="{{options.inputType}}" class="form-control" ng-model="data.response"  placeholder="{{options.inputPlaceholder}}"></div></div></div><div class="modal-footer"><button ng-repeat="button in options.buttons" class="btn btn-raised {{button.type}}" ng-click="itButtonAction($event,button)" it-compile="button.text"></button></div>',f={alert:s,confirm:l,prompt:d,custom:c};return f}]),e.directive("itProgressbarViewer",[function(){return{scope:{api:"="},restrict:"E",template:'<div class="loader" ><div class="progress-bar"><span class="bar" ng-style=\'{width: api.downloadProgress + "%"}\'></span></div></div>'}}]),e.directive("itToolbarViewer",[function(){var e=function(e,t,i){e.$watch("api.getZoomLevel()",function(t){e.scale=t}),e.$watch("api.getCurrentPage()",function(t){e.currentPage=t}),e.onZoomLevelChanged=function(){e.api.zoomTo(e.scale)},e.onPageChanged=function(){e.api.goToPage(e.currentPage)}};return{scope:{api:"="},restrict:"E",template:'<div class="toolbar"><div class="zoom_wrapper" ng-show="api.getNumPages() > 0"><button ng-click="api.zoomOut()">-</button> <select ng-model="scale" ng-change="onZoomLevelChanged()" ng-options="zoom as zoom.label for zoom in api.zoomLevels"></select> <button ng-click="api.zoomIn()">+</button> </div><div class="select_page_wrapper" ng-show="api.getNumPages() > 1"><span>Page : </span><button ng-click="api.goToPrevPage()"><</button> <input type="text" ng-model="currentPage" ng-change="onPageChanged()"/> <button ng-click="api.goToNextPage()">></button> <span> of {{api.getNumPages()}}</span></div></div>',link:e}}]),e.constant("MultiPagesConstants",{PAGE_RENDER_FAILED:-1,PAGE_RENDER_CANCELLED:0,PAGE_RENDERED:1,PAGE_ALREADY_RENDERED:2,ZOOM_LEVELS_LUT:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2,2.2,2.4,2.6,2.8,3,3.3,3.6,3.9,4,4.5,5],ZOOM_FIT_WIDTH:"fit_width",ZOOM_FIT_PAGE:"fit_page",ZOOM_FIT_HEIGHT:"fit_height"}),e.factory("MultiPagesPage",["PageViewport",function(e){function t(e,t){this.id=e+1,this.container=angular.element("<div class='page'></div>"),this.container.attr("id","page_"+e),this.canvasRendered=!1,this.rendered=!1,this.view=t}return t.prototype={clear:function(){this.rendered=!1,this.container.empty()},getViewport:function(t){return new e(this.view,t,0,0,0)},resize:function(e){this.viewport=this.getViewport(e),this.canvasRendered=!1,this.canvas=angular.element("<canvas></canvas>"),this.canvas.attr("width",this.viewport.width),this.canvas.attr("height",this.viewport.height),this.container.css("width",this.viewport.width+"px"),this.container.css("height",this.viewport.height+"px")},isVisible:function(){var e=this.container[0],t=this.container.parent()[0],i=e.offsetTop-t.scrollTop,n=i+e.offsetHeight;return n>=0&&i<=t.offsetHeight},render:function(e){throw"NotImplementedError - render"}},t}]),e.factory("MultiPagesViewer",["$log","$timeout","MultiPagesViewerAPI","MultiPagesConstants","SizeWatcher",function(e,t,i,n,r){function a(e,t){var i=angular.element("<div></div>");i.css("height","10000px"),e.append(i);var n=i[0].offsetWidth;i.remove();var r=e[0].offsetHeight;return 0===r&&(r=2*t),n-=2*t,r-=2*t,{width:n,height:r}}function o(e,t){this.pages=[],this.scaleItem=null,this.fitWidthScale=1,this.fitHeightScale=1,this.fitPageScale=1,this.element=t,this.pageMargin=0,this.currentPage=0,this.lastScrollDir=0,this.api=e,this.onPageRendered=null,this.onDataDownloaded=null,this.onCurrentPageChanged=null}return o.prototype={getAPI:function(){return this.api},setContainerSize:function(e){if(this.pages.length>0){this.containerSize=a(this.element,this.pageMargin),this.fitWidthScale=this.calcScale(n.ZOOM_FIT_WIDTH),this.fitHeightScale=this.calcScale(n.ZOOM_FIT_HEIGHT),this.fitPageScale=this.calcScale(n.ZOOM_FIT_PAGE),this.api.zoomLevels=[];for(var t=.1;;){var i=this.api.getNextZoomInScale(t);if(i.value===t)break;100===i.value&&(this.defaultScale=i),void 0==this.scaleItem&&i.id===e&&(this.scaleItem=i),this.api.zoomLevels.push(i),t=i.value}this.setScale(this.scaleItem)}},setScale:function(e){void 0!=e&&(this.scaleItem=e);for(var t=e||this.defaultScale||this.api.zoomLevels[0],i=this.pages.length,n=0;i>n;++n)this.pages[n].clear(),this.pages[n].resize(t.value);0!=this.currentPage&&1!=this.currentPage?this.api.goToPage(this.currentPage):this.renderAllVisiblePages()},calcScale:function(t){if(t===n.ZOOM_FIT_WIDTH){for(var i=this.pages.length,r=this.pages[0].getViewport(1).width,a=1;i>a;++a)r=Math.max(r,this.pages[a].getViewport(1).width);return this.containerSize.width/r}if(t===n.ZOOM_FIT_HEIGHT){for(var i=this.pages.length,o=this.pages[0].getViewport(1).height,a=1;i>a;++a)o=Math.max(o,this.pages[a].getViewport(1).height);return this.containerSize.height/o}if(t===n.ZOOM_FIT_PAGE){var s=this.pages[0].getViewport(1);return this.containerSize.height<this.containerSize.width?this.containerSize.height/s.height:this.containerSize.width/s.width}var l=parseFloat(t);return isNaN(l)?(e.debug("PDF viewer: "+t+" isn't a valid scaleItem value."),1):l},removeDistantPages:function(e,t){for(var i=this.pages.length,n=Math.max(e-t,0),r=Math.min(e+t,i-1),a=0;n>a;++a)this.pages[a].clear();for(var a=r+1;i>a;++a)this.pages[a].clear()},renderAllVisiblePages:function(e){void 0!=e&&(this.lastScrollDir=e);for(var t=this,i=this.pages.length,r=0,a=!1,o=0;i>o;++o){var s=this.pages[o];if(s.isVisible()){var l=s.container.parent()[0],c=s.container[0].offsetTop-l.scrollTop;c<=l.offsetHeight/2&&(r=o),a=!0,s.render(function(e,i){i===n.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===n.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}else if(a)break}if(0!==this.lastScrollDir){var d=r+this.lastScrollDir;d>=0&&i>d&&this.pages[d].render(function(e,i){i===n.PAGE_RENDERED?t.onPageRendered("success",e.id,t.pages.length,""):i===n.PAGE_RENDER_FAILED&&t.onPageRendered("failed",e.id,t.pages.length,"Failed to render page.")})}this.removeDistantPages(r,2),this.currentPage=r+1,this.onCurrentPageChanged&&this.onCurrentPageChanged(r+1)},hookScope:function(i,n){var a=this,o=0,s=new r(a.element[0],200);i.$watchGroup(s.group,function(e){a.setContainerSize(n)});var l=function(t,i,n,r,o){"render"===t&&1===n?"success"===i?e.debug("onProgress("+t+", "+i+", "+n+", "+r+")"):e.debug("Failed to render 1st page!\n\n"+o):"download"===t&&"loading"===i?a.api.downloadProgress=n/r*100:"failed"===i&&e.debug("Something went really bad!\n\n"+o)};i.onPageRendered=function(e,t,i,n){l("render",e,t,i,n)},i.onDataDownloaded=function(e,t,i,n){l("download",e,t,i,n)},a.onPageRendered=angular.bind(i,i.onPageRendered),a.onDataDownloaded=angular.bind(i,i.onDataDownloaded),i.$on("$destroy",function(){if(null!=a.onDestroy){try{}catch(t){e.log(t)}a.onDestroy()}s.cancel(),a.element.empty(),e.debug("viewer destroyed")}),a.element.bind("scroll",function(e){i.scrollTimeout&&t.cancel(i.scrollTimeout),i.scrollTimeout=t(function(){var e=a.element[0].scrollTop,t=e-o;o=e;var i=t>0?1:0>t?-1:0;a.renderAllVisiblePages(i)},350)})},downloadProgress:function(e){var t=0;if("undefined"==typeof e.total)for(;t<e.loaded;)t+=1048576;else t=e.total;this.onDataDownloaded&&this.onDataDownloaded("loading",e.loaded,t,"")}},o}]),e.factory("MultiPagesViewerAPI",["$log","MultiPagesConstants",function(e,t){function i(e){this.viewer=e,this.scaleItems={},this.zoomLevels=[]}return i.prototype={getNextZoomInScale:function(e){for(var i=e,n=t.ZOOM_LEVELS_LUT.length,r=null,a=0;n>a;++a)if(t.ZOOM_LEVELS_LUT[a]>e){i=t.ZOOM_LEVELS_LUT[a];break}if(e<this.viewer.fitWidthScale&&i>this.viewer.fitWidthScale)r={id:t.ZOOM_FIT_WIDTH,value:this.viewer.fitWidthScale,label:"Fit width"};else if(e<this.viewer.fitHeightScale&&i>this.viewer.fitHeightScale)r={id:t.ZOOM_FIT_HEIGHT,value:this.viewer.fitHeightScale,label:"Fit height"};else if(e<this.viewer.fitPageScale&&i>this.viewer.fitPageScale)r={id:t.ZOOM_FIT_PAGE,value:this.viewer.fitPageScale,label:"Fit page"};else{var o=(100*i).toFixed(0)+"%";r={id:o,value:i,label:o}}var s=this.scaleItems[r.id];return void 0==s?(this.scaleItems[r.id]=r,s=r):s.value=r.value,s},getNextZoomOutScale:function(e){for(var i=e,n=t.ZOOM_LEVELS_LUT.length,r=null,a=n-1;a>=0;--a)if(t.ZOOM_LEVELS_LUT[a]<e){i=t.ZOOM_LEVELS_LUT[a];break}r=e>this.viewer.fitWidthScale&&i<this.viewer.fitWidthScale?{id:t.ZOOM_FIT_WIDTH,value:this.viewer.fitWidthScale,label:"Fit width"}:e<this.viewer.fitHeightScale&&i>this.viewer.fitHeightScale?{id:t.ZOOM_FIT_HEIGHT,value:this.viewer.fitHeightScale,label:"Fit height"}:e>this.viewer.fitPageScale&&i<this.viewer.fitPageScale?{id:t.ZOOM_FIT_PAGE,value:this.viewer.fitPageScale,label:"Fit page"}:{id:i,value:i,label:(100*i).toFixed(0)+"%"};var o=this.scaleItems[r.id];return void 0==o?(this.scaleItems[r.id]=r,o=r):o.value=r.value,o},zoomTo:function(e){void 0!=e&&this.viewer.setScale(e)},getZoomLevel:function(){return this.viewer.scaleItem;
},zoomIn:function(){var e=this.getNextZoomInScale(this.getZoomLevel().value);this.zoomTo(e)},zoomOut:function(){var e=this.getNextZoomOutScale(this.getZoomLevel().value);this.zoomTo(e)},getCurrentPage:function(){return this.viewer.currentPage},goToPage:function(e){1>e||e>this.getNumPages()||(this.viewer.element[0].scrollTop=this.viewer.pages[e-1].container[0].offsetTop)},goToNextPage:function(){this.goToPage(this.viewer.currentPage+1)},goToPrevPage:function(){this.goToPage(this.viewer.currentPage-1)},getNumPages:function(){return this.viewer.pages.length}},i}]),e.factory("PageViewport",[function(){function e(e,t,i,n,r,a){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=n,this.offsetY=r;var o,s,l,c,d=(e[2]+e[0])/2,u=(e[3]+e[1])/2;switch(i%=360,i=0>i?i+360:i){case 180:o=-1,s=0,l=0,c=1;break;case 90:o=0,s=1,l=1,c=0;break;case 270:o=0,s=-1,l=-1,c=0;break;default:o=1,s=0,l=0,c=-1}a&&(l=-l,c=-c);var p,f,g,h;0===o?(p=Math.abs(u-e[1])*t+n,f=Math.abs(d-e[0])*t+r,g=Math.abs(e[3]-e[1])*t,h=Math.abs(e[2]-e[0])*t):(p=Math.abs(d-e[0])*t+n,f=Math.abs(u-e[1])*t+r,g=Math.abs(e[2]-e[0])*t,h=Math.abs(e[3]-e[1])*t),this.transform=[o*t,s*t,l*t,c*t,p-o*t*d-l*t*u,f-s*t*d-c*t*u],this.width=g,this.height=h,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var i="scale"in t?t.scale:this.scale,n="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return Util.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=Util.applyTransform([e[0],e[1]],this.transform),i=Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]},convertToPdfPoint:function(e,t){return Util.applyInverseTransform([e,t],this.transform)}},e}]),e.factory("SizeWatcher",["$interval",function(e){return function(t,i){var n=this;(n.update=function(){n.dimensions=[t.offsetWidth,t.offsetHeight]})(),n.monitor=e(n.update,i),n.group=[function(){return n.dimensions[0]},function(){return n.dimensions[1]}],n.cancel=function(){e.cancel(n.monitor)}}}]),n.factory("IMAGEPage",["$log","MultiPagesPage","PageViewport","MultiPagesConstants",function(e,t,i,n){function r(e,i,n){this.base=t,this.base(e,n),this.img=i}return r.prototype=new t,r.prototype.render=function(e){var t=this;if(this.rendered)return void(e&&e(this,n.PAGE_ALREADY_RENDERED));if(this.rendered=!0,this.canvasRendered)t.container.append(t.canvas);else{t.container.append(t.canvas);var i=t.canvas[0].getContext("2d");i.drawImage(this.img,0,0,t.viewport.width,t.viewport.height),e&&e(t,n.PAGE_RENDERED)}},r}]).factory("IMAGEViewer",["$log","MultiPagesViewer","MultiPagesViewerAPI","IMAGEPage",function(e,t,i,n){function r(e){this.base=t,this.base(new i(this),e)}return r.prototype=new t,r.prototype.open=function(e,t,i){this.element.empty(),this.pages=[],this.pageMargin=i,this.initialScale=t;var n="string"!=typeof e;n?this.setFile(e):this.setUrl(e)},r.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;t.getAllPages(e,function(e){t.pages=e,t.setContainerSize(t.initialScale)})}},r.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result;t.getAllPages(i,function(e){t.pages=e,t.setContainerSize(t.initialScale)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsDataURL(e)}},r.prototype.getAllPages=function(e,t){var i=[],r=this;i.push({});var a=new Image;a.onprogress=angular.bind(this,r.downloadProgress),a.onload=function(){var e=new n(0,a,[0,0,a.width,a.height]);i[0]=e,r.element.append(e.container),t(i)},a.src=e},r}]).directive("imageViewer",["$log","IMAGEViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",api:"=",initialScale:"@"},controller:["$scope","$element",function(e,n){var r=new t(n);e.api=r.getAPI(),e.onSrcChanged=function(){r.open(this.src,this.initialScale,i)},e.onFileChanged=function(){r.open(this.file,this.initialScale,i)},r.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}]),n.directive("itImageViewer",["$sce",function(e){var t=function(t,i,n){t.trustSrc=function(t){return e.trustAsResourceUrl(t)}};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><image-viewer class="multipage-viewer" src="{{trustSrc(src)}}" api="options.api" initial-scale="{{options.initialScale}}" ></image-viewer>',link:t}}]),t.factory("CustomStyle",[function(){function e(){}var t=["ms","Moz","Webkit","O"],i={};return e.getProp=function(e,n){if(1===arguments.length&&"string"==typeof i[e])return i[e];n=n||document.documentElement;var r,a,o=n.style;if("string"==typeof o[e])return i[e]=e;a=e.charAt(0).toUpperCase()+e.slice(1);for(var s=0,l=t.length;l>s;s++)if(r=t[s]+a,"string"==typeof o[r])return i[e]=r;return i[e]="undefined"},e.setProp=function(e,t,i){var n=this.getProp(e);"undefined"!==n&&(t.style[n]=i)},e}]),t.directive("itPdfViewer",["$sce",function(e){var t=function(t,i,n){t.onPassword=function(e){return prompt("The selected PDF is password protected. PDF.js reason: "+e,"")},t.$watch("src",function(e){"string"==typeof e?t.url=e:t.file=e}),t.trustSrc=function(t){return e.trustAsResourceUrl(t)}};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><pdf-viewer class="multipage-viewer" file="file" src="{{trustSrc(url)}}" api="options.api" initial-scale="{{options.initialScale}}" render-text-layer="{{options.renderTextLayer}}" password-callback="onPassword(reason)"></pdf-viewer>',link:t}}]),t.factory("PDFViewerAPI",["$log","MultiPagesViewerAPI",function(e,t){function i(e){this.base=t,this.base(e)}return i.prototype=new t,i.prototype.findNext=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID+1;e>=this.viewer.searchResults.length&&(e=0),this.viewer.highlightSearchResult(e)}},i.prototype.findPrev=function(){if(-1!==this.viewer.searchHighlightResultID){var e=this.viewer.searchHighlightResultID-1;0>e&&(e=this.viewer.searchResults.length-1),this.viewer.highlightSearchResult(e)}},i}]).factory("PDFPage",["$log","MultiPagesPage","MultiPagesConstants","TextLayerBuilder",function(e,t,i,n){function r(e,i){this.base=t,this.base(e.pageIndex),this.pdfPage=e,this.textContent=i,this.renderTask=null}return r.prototype=new t,r.prototype.clear=function(){null!==this.renderTask&&this.renderTask.cancel(),t.prototype.clear.call(this),this.renderTask=null},r.prototype.getViewport=function(e){return this.pdfPage.getViewport(e)},r.prototype.resize=function(e){t.prototype.resize.call(this,e),this.textLayer=angular.element("<div class='text-layer'></div>"),this.textLayer.css("width",this.viewport.width+"px"),this.textLayer.css("height",this.viewport.height+"px")},r.prototype.render=function(t){var r=this;return this.rendered?void(null===this.renderTask?t&&t(this,i.PAGE_ALREADY_RENDERED):this.renderTask.then(function(){t&&t(r,i.PAGE_ALREADY_RENDERED)},function(t){e.debug("stopped "+t)})):(this.rendered=!0,void(this.canvasRendered?(r.container.append(r.canvas),r.container.append(r.textLayer)):(this.renderTask=this.pdfPage.render({canvasContext:this.canvas[0].getContext("2d"),viewport:this.viewport}),r.container.append(r.canvas),this.renderTask.then(function(){if(r.rendered=!0,r.renderTask=null,r.canvasRendered=!0,r.textContent){var e=new n({textLayerDiv:r.textLayer[0],pageIndex:r.id,viewport:r.viewport});e.setTextContent(r.textContent),e.renderLayer(),r.container.append(r.textLayer)}t&&t(r,i.PAGE_RENDERED)},function(e){r.rendered=!1,r.renderTask=null,"cancelled"===e?t&&t(r,i.PAGE_RENDER_CANCELLED):t&&t(r,i.PAGE_RENDER_FAILED)}))))},r}]).factory("PDFViewer",["$log","MultiPagesViewer","PDFViewerAPI","PDFPage",function(e,t,i,n){function r(e){this.base=t,this.base(new i(this),e),this.pdf=null,this.passwordCallback=null}return r.prototype=new t,r.prototype.open=function(e,t,i,n){this.element.empty(),this.pages=[],this.pageMargin=n,this.initialScale=t,this.hasTextLayer=i;var r="string"!=typeof e;if(void 0!=this.getDocumentTask){var a=this;this.getDocumentTask.destroy().then(function(){r?a.setFile(e):a.setUrl(e)})}else r?this.setFile(e):this.setUrl(e)},r.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this;this.getDocumentTask=PDFJS.getDocument(e,null,angular.bind(this,this.passwordCallback),angular.bind(this,this.downloadProgress)),this.getDocumentTask.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i;for(var n=0;n<e.length;++n)t.element.append(e[n].container);t.setContainerSize(t.initialScale)})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})}},r.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){var i=e.target.result,n=new Uint8Array(i),r=PDFJS.getDocument(n,null,angular.bind(t,t.passwordCallback),angular.bind(t,t.downloadProgress));r.then(function(e){t.pdf=e,t.getAllPages(function(e,i){t.pages=e,t.pagesRefMap=i;for(var n=0;n<e.length;++n)t.element.append(e[n].container);t.setContainerSize(t.initialScale)})},function(e){t.onDataDownloaded("failed",0,0,"PDF.js: "+e)})},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},r.prototype.getAllPages=function(e){var t=[],i={},r=this.pdf.numPages,a=r;if(this.hasTextLayer)for(var o=0;r>o;++o){t.push({});var s=this.pdf.getPage(o+1);s.then(function(r){var o=r.ref.num+" "+r.ref.gen+" R";i[o]=r.pageIndex+1;var s=new n(r,null);t[r.pageIndex]=s,--a,0===a&&e(t,i),r.getTextContent().then(function(e){s.textContent=e})})}else for(var o=0;r>o;++o){t.push({});var s=this.pdf.getPage(o+1);s.then(function(r){t[r.pageIndex]=new n(r,null),--a,0===a&&e(t,i)})}},r.prototype.onDestroy=function(){this.getDocumentTask&&(this.getDocumentTask.destroy(),this.getDocumentTask=null)},r}]).directive("pdfViewer",["$log","PDFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",initialScale:"@",renderTextLayer:"@",passwordCallback:"&"},controller:["$scope","$element",function(n,r){n.getPassword=function(t,i){if(this.passwordCallback){var n=this;this.$apply(function(){var r=n.passwordCallback({reason:i});""!==r&&void 0!==r&&null!==r?t(r):e.log("A password is required to read this document.")})}else e.log("A password is required to read this document.")};var a=new t(r);a.passwordCallback=angular.bind(n,n.getPassword),n.api=a.getAPI(),n.shouldRenderTextLayer=function(){return""===this.renderTextLayer||void 0===this.renderTextLayer||null===this.renderTextLayer||"false"===this.renderTextLayer.toLowerCase()?!1:!0},n.onSrcChanged=function(){a.open(this.src,this.initialScale,this.shouldRenderTextLayer(),i)},n.onFileChanged=function(){a.open(this.file,this.initialScale,this.shouldRenderTextLayer(),i)},a.hookScope(n)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}]),t.factory("TextLayerBuilder",["CustomStyle",function(e){function t(e){return!r.test(e)}function i(e){this.textLayerDiv=e.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=e.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=e.viewport,this.textDivs=[],this.findController=e.findController||null}var n=1e5,r=/\S/;return i.prototype={_finishRendering:function(){this.renderingDone=!0;var e=document.createEvent("CustomEvent");e.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(e)},renderLayer:function(){var t=document.createDocumentFragment(),i=this.textDivs,r=i.length,a=document.createElement("canvas"),o=a.getContext("2d");if(r>n)return void this._finishRendering();for(var s,l,c=0;r>c;c++){var d=i[c];if(void 0===d.dataset.isWhitespace){var u=d.style.fontSize,p=d.style.fontFamily;(u!==s||p!==l)&&(o.font=u+" "+p,s=u,l=p);var f=o.measureText(d.textContent).width;if(f>0){t.appendChild(d);var g;if(void 0!==d.dataset.canvasWidth){var h=d.dataset.canvasWidth/f;g="scaleX("+h+")"}else g="";var m=d.dataset.angle;m&&(g="rotate("+m+"deg) "+g),g&&e.setProp("transform",d,g)}}}this.textLayerDiv.appendChild(t),this._finishRendering(),this.updateMatches()},render:function(e){if(this.divContentDone&&!this.renderingDone)if(this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),e){var t=this;this.renderTimer=setTimeout(function(){t.renderLayer(),t.renderTimer=null},e)}else this.renderLayer()},appendText:function(e,i){var n=i[e.fontName],r=document.createElement("div");if(this.textDivs.push(r),t(e.str))return void(r.dataset.isWhitespace=!0);var a=PDFJS.Util.transform(this.viewport.transform,e.transform),o=Math.atan2(a[1],a[0]);n.vertical&&(o+=Math.PI/2);var s=Math.sqrt(a[2]*a[2]+a[3]*a[3]),l=s;n.ascent?l=n.ascent*l:n.descent&&(l=(1+n.descent)*l);var c,d;0===o?(c=a[4],d=a[5]-l):(c=a[4]+l*Math.sin(o),d=a[5]-l*Math.cos(o)),r.style.left=c+"px",r.style.top=d+"px",r.style.fontSize=s+"px",r.style.fontFamily=n.fontFamily,r.textContent=e.str,PDFJS.pdfBug&&(r.dataset.fontName=e.fontName),0!==o&&(r.dataset.angle=o*(180/Math.PI)),r.textContent.length>1&&(n.vertical?r.dataset.canvasWidth=e.height*this.viewport.scale:r.dataset.canvasWidth=e.width*this.viewport.scale)},setTextContent:function(e){this.textContent=e;for(var t=e.items,i=0,n=t.length;n>i;i++)this.appendText(t[i],e.styles);this.divContentDone=!0},convertMatches:function(e){for(var t=0,i=0,n=this.textContent.items,r=n.length-1,a=null===this.findController?0:this.findController.state.query.length,o=[],s=0,l=e.length;l>s;s++){for(var c=e[s];t!==r&&c>=i+n[t].str.length;)i+=n[t].str.length,t++;t===n.length&&console.error("Could not find a matching mapping");var d={begin:{divIdx:t,offset:c-i}};for(c+=a;t!==r&&c>i+n[t].str.length;)i+=n[t].str.length,t++;d.end={divIdx:t,offset:c-i},o.push(d)}return o},renderMatches:function(e){function t(e,t){var n=e.divIdx;r[n].textContent="",i(n,0,e.offset,t)}function i(e,t,i,a){var o=r[e],s=n[e].str.substring(t,i),l=document.createTextNode(s);if(a){var c=document.createElement("span");return c.className=a,c.appendChild(l),void o.appendChild(c)}o.appendChild(l)}if(0!==e.length){var n=this.textContent.items,r=this.textDivs,a=null,o=this.pageIdx,s=null===this.findController?!1:o===this.findController.selected.pageIdx,l=null===this.findController?-1:this.findController.selected.matchIdx,c=null===this.findController?!1:this.findController.state.highlightAll,d={divIdx:-1,offset:void 0},u=l,p=u+1;if(c)u=0,p=e.length;else if(!s)return;for(var f=u;p>f;f++){var g=e[f],h=g.begin,m=g.end,v=s&&f===l,C=v?" selected":"";if(this.findController&&this.findController.updateMatchPosition(o,f,r,h.divIdx,m.divIdx),a&&h.divIdx===a.divIdx?i(a.divIdx,a.offset,h.offset):(null!==a&&i(a.divIdx,a.offset,d.offset),t(h)),h.divIdx===m.divIdx)i(h.divIdx,h.offset,m.offset,"highlight"+C);else{i(h.divIdx,h.offset,d.offset,"highlight begin"+C);for(var b=h.divIdx+1,w=m.divIdx;w>b;b++)r[b].className="highlight middle"+C;t(m,"highlight end"+C)}a=m}a&&i(a.divIdx,a.offset,d.offset)}},updateMatches:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,i=this.textContent.items,n=-1,r=0,a=e.length;a>r;r++){for(var o=e[r],s=Math.max(n,o.begin.divIdx),l=s,c=o.end.divIdx;c>=l;l++){var d=t[l];d.textContent=i[l].str,d.className=""}n=o.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}},i}]),i.directive("itTiffViewer",["$sce",function(e){var t=function(t,i,n){t.trustSrc=function(t){return e.trustAsResourceUrl(t)}};return{scope:{src:"=",options:"="},restrict:"E",template:'<it-progressbar-viewer api="options.api" ng-if="options.showProgressbar"></it-progressbar-viewer><it-toolbar-viewer api="options.api" ng-if="options.showToolbar"></it-toolbar-viewer><tiff-viewer class="multipage-viewer" src="{{trustSrc(src)}}" api="options.api" initial-scale="{{options.initialScale}}" ></tiff-viewer>',link:t}}]),i.factory("TIFFPage",["$log","MultiPagesPage","MultiPagesConstants",function(e,t,i){function n(e,i,n){this.base=t,this.base(e,n),this.src=i}return n.prototype=new t,n.prototype.render=function(e){var t=this;if(this.rendered)return void(e&&e(this,i.PAGE_ALREADY_RENDERED));if(this.rendered=!0,this.canvasRendered)t.container.append(t.canvas);else{t.container.append(t.canvas);var n=t.canvas[0].getContext("2d"),r=new Image;r.onload=function(){n.drawImage(r,0,0,t.viewport.width,t.viewport.height),e&&e(t,i.PAGE_RENDERED)},r.src=this.src}},n}]).factory("TIFFViewer",["$log","MultiPagesViewerAPI","TIFFPage","MultiPagesViewer",function(e,t,i,n){function r(e){this.base=n,this.base(new t(this),e),this.tiff=null}return Tiff.initialize({TOTAL_MEMORY:167772160}),r.prototype=new n,r.prototype.open=function(e,t,i){this.element.empty(),this.pages=[],this.pageMargin=i,this.initialScale=t;var n="string"!=typeof e;n?this.setFile(e):this.setUrl(e)},r.prototype.setUrl=function(e){if(void 0!==e&&null!==e&&""!==e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onprogress=angular.bind(this,t.downloadProgress),i.onload=function(e){t.loadTiff(i.response)},i.send()}},r.prototype.setFile=function(e){if(void 0!==e&&null!==e){var t=this,i=new FileReader;i.onload=function(e){t.loadTiff(e.target.result)},i.onprogress=function(e){t.downloadProgress(e)},i.onloadend=function(e){var i=e.target.error;if(null!==i){var n="File API error: ";switch(e.code){case i.ENCODING_ERR:n+="Encoding error.";break;case i.NOT_FOUND_ERR:n+="File not found.";break;case i.NOT_READABLE_ERR:n+="File could not be read.";break;case i.SECURITY_ERR:n+="Security issue with file.";break;default:n+="Unknown error."}t.onDataDownloaded("failed",0,0,n)}},i.readAsArrayBuffer(e)}},r.prototype.loadTiff=function(e){var t=this;t.onDestroy(),t.tiff=new Tiff({buffer:e}),t.getAllPages(function(e){t.pages=e,t.setContainerSize(t.initialScale)})},r.prototype.getAllPages=function(e){function t(e){return o.tiff.setDirectory(e),o.tiff.toDataURL()}for(var n=[],r=this.tiff.countDirectory(),a=r,o=this,s=0;r>s;++s){n.push({}),this.tiff.setDirectory(s);var l=new i(s,t,[0,0,this.tiff.width(),this.tiff.height()]);n[s]=l,this.element.append(l.container),--a,0===a&&e(n)}},r.prototype.onDestroy=function(){null!=self.tiff&&(self.tiff.close(),self.tiff=null)},r}]).directive("tiffViewer",["$log","TIFFViewer",function(e,t){var i=10;return{restrict:"E",scope:{src:"@",file:"=",api:"=",initialScale:"@"},controller:["$scope","$element",function(e,n){var r=new t(n);e.api=r.getAPI(),e.onSrcChanged=function(){r.open(this.src,this.initialScale,i)},e.onFileChanged=function(){r.open(this.file,this.initialScale,i)},r.hookScope(e)}],link:function(e,t,i){i.$observe("src",function(t){e.onSrcChanged()}),e.$watch("file",function(t){e.onFileChanged()})}}}])}();