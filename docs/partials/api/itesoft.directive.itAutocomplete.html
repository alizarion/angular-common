<h1><code ng:non-bindable="">itAutocomplete</code>
<div><span class="hint">directive in module <code ng:non-bindable="">itesoft</code>
<code ng:non-bindable=""><a target="_blank" href="https://github.com/alizarion/angular-common/releases/tag/v1.1"> since v1.1</a></code>
</span>
</div>
</h1>
<div><h2 id="description">Description</h2>
<div class="description"><div class="itesoft-directive-page itesoft-directive-itautocomplete-page"><p>The ItAutocomplete widgets provides suggestions while you type into the field</p>
<pre><code class="lang-html">  &lt;it-autocomplete items=&quot;[{id=1,value=&#39;premiere option&#39;}]&quot; selected-option=&quot;selectedId&quot; search-mode=&quot;&#39;contains&#39;&quot;  /&gt;
</code></pre>
<p><h3 id="description_event">Event</h3>
 <table class="table">
 <tr>
     <th>
         Param
     </th>
     <th>
         Description
     </th>
 </tr>
 <tr>
     <td>
         event-select
     </td>
     <td>
         Name of event to emit when value is selected
     </td>
 </tr>
 <tr>
     <td>
         event-refresh
     </td>
     <td>
         Name of event to emit to force autocomplete to refresh items
     </td>
 </tr>
 </table></p>
<p><h3 id="description_options">Options</h3>
 <table class="table">
 <tr>
     <th>
         Param
     </th>
     <th>
         Description
     </th>
 </tr>
 <tr>
     <td>
          items-getter
     </td>
     <td>
         Getter that return list of items to show in autocomplete
     </td>
 </tr>
 <tr>
     <td>
          items
     </td>
     <td>
         List of items to show in autocomplete
     </td>
 </tr>
 <tr>
     <td>
         options
     </td>
     <td>
         Reference to autocomplete object :</p>
<pre><code>     $scope.options = {
         // call when lazyGrid is instantiate
         onRegisterApi: function (autocomplete) {
             $scope.autocomplete = autocomplete;
              // Call when user click
             $scope.autocomplete.fn.searchPredicate= function(inputValue,itemToTest){
                 return (itemToTest.id.indexOf(inputValue) !== -1 || itemToTest.value.indexOf(inputValue) !== -1);
             }
         }
     }
 &lt;/td&gt;
</code></pre><p> </tr>
 <tr>
     <td>
          converter
     </td>
     <td>
         Converter to transform object to id or label
          implements:
          {
          getIdFromObject,
          getLabelFromObject,
          getObject
          }
     </td>
 </tr>
 <tr>
     <td>
         selected-option
     </td>
     <td>
         Reference to the selected item id
     </td>
 </tr>
 </table></p>
<p><h3 id="description_skinning">Skinning</h3>
Following is the list of structural style classes:</p>
<table class="table">
 <tr>
     <th>
         Class
     </th>
     <th>
         Applies
     </th>
 </tr>
 <tr>
     <td>
         it-autocomplete-select
     </td>
     <td>
         Default option class
     </td>
 </tr>
 <tr>
     <td>
         it-autocomplete-selected
     </td>
     <td>
         Selected option class
     </td>
 </tr>
 <tr>
     <td>
         it-autocomplete-container
     </td>
     <td>
         Option container div
     </td>
 </tr>
 <tr>
     <td>
         it-autocomplete-div
     </td>
     <td>
        parent  div
     </td>
 </tr>
 <tr>
     <td>
         search-mode
     </td>
     <td>
        allow to specify a searchMode (startsWith,custom) see below. Default filter is contains
     </td>
 </tr>


 </table>
</div></div>
<h2 id="usage">Usage</h2>
<div class="usage">as element:<pre class="prettyprint linenums">&lt;it-autocomplete&gt;
&lt;/it-autocomplete&gt;</pre>
as attribute<pre class="prettyprint linenums">&lt;ANY it-autocomplete&gt;
   ...
&lt;/ANY&gt;</pre>
as class<pre class="prettyprint linenums">&lt;ANY class="it-autocomplete"&gt;
   ...
&lt;/ANY&gt;</pre>
</div>
<h2 id="example">Example</h2>
<div class="example"><div class="itesoft-directive-page itesoft-directive-itautocomplete-page"><h4 id="example_source">Source</h4>
<div source-edit="itesoft-showcase" source-edit-deps="angular.js Module.js controller.js" source-edit-html="index.html-4" source-edit-css="" source-edit-js="Module.js controller.js" source-edit-json="" source-edit-unit="" source-edit-scenario=""></div>
<div class="tabbable"><div class="tab-pane" title="index.html">
<pre class="prettyprint linenums" ng-set-text="index.html-4" ng-html-wrap-loaded="itesoft-showcase angular.js Module.js controller.js"></pre>
<script type="text/ng-template" id="index.html-4">
<style>
.width300{width:300px};
</style>
<div ng-controller="HomeCtrl">

<h3 id="example_usage-inside-grid">Usage inside grid:</h3>
<div id="grid1" ui-grid="gridOptions" class="grid"></div>
<h3 id="example_standalone-usage">Standalone usage:</h3>
Selected Id:<input type="text" ng-model="selectedOption"/>

<div class="row">
<div  class="col-xs-3"> StartsWith:</div>
<div  class="col-xs-9">
<it-autocomplete items="firstNameOptions" selected-option="selectedOption" search-mode="'startsWith'"></it-autocomplete>
</div>
</div>
<div class="row">
</div>

<h3 id="example_custom-search-method">Custom search method</h3>
<div class="row">
<div class="col-xs-12">
<span class="text" >
You can use a custom filter method by adding search-mode="'custom'" parameter
</span>
</div>
</div>
<div class="row">
<div class="col-xs-3">Custom predicate:</div>

<div  class="col-xs-3">
<it-autocomplete  items="firstNameOptions" name="'customPredicate'"  search-mode="'custom'" selected-option="firstRate"  options="options" ></it-autocomplete>
</div>
<div class="row">
<div class="col-xs-3">Starts with:</div>
<div  class="col-xs-3">
<it-autocomplete  items="firstNameOptions" name="'customPredicate'"  search-mode="'startsWith'" selected-option="firstRate"  options="options" ></it-autocomplete>
</div>
</div>
<h3 id="example_linked-autocomplete">Linked autocomplete</h3>
<div class="row">
    <div class="col-xs-12">
    <span class="text" >
    You can link autocomplete together by adding event-select and event-refresh params
    </span>
    </div>
</div>

<div class="row">
    <div  class="col-xs-3">
    Taux
    </div>
    <div  class="col-xs-3">
    Code
    </div>
</div>
<div class="row">
    <div  class="col-xs-3">
    <it-autocomplete  items-getter="getRate(code)" name="'firstRate'" selected-option="rate"  event-select="'firstEvent'" selected-option="firstRate" event-refresh="'secondEvent'" options="options" ></it-autocomplete>
    </div>

    <div  class="col-xs-3">
    <it-autocomplete   items-getter="getCode(rate)"  name="'firstCode'" selected-option="code"    event-select="'secondEvent'" selected-option="firstCode" event-refresh="'firstEvent'" options="options" ></it-autocomplete>
    </div>
</div>

<div class="row">
    <div  class="col-xs-3">
    {{rate}}
    </div>
    <div  class="col-xs-3">
    {{code}}
    </div>
</div>
<div class="row">
   <div class="col-xs-12">
       <h3 id="example_autocomplete-map-with-object">Autocomplete map with object</h3>
   </div>
</div>
<div class="row">
   <div class="col-xs-12">
       <span class="text" >
       You can map object directly inside autocomplete
       </span>
    </div>
</div>
<div class="row">
    <div  class="col-xs-3">
    Taux
    </div>
    <div  class="col-xs-3">
    Code
    </div>
</div>
<div class="row">
    <div  class="col-xs-3">
    <it-autocomplete  items="availablesTax" name="'objectAutoComplete'" converter="taxConverter"  selected-option="selectedtax" ></it-autocomplete>
    </div>
    <div  class="col-xs-3">
    {{selectedtax}}
   </div>
</div>
</div>
</script>
</div>
<div class="tab-pane" title="Module.js">
<pre class="prettyprint linenums" ng-set-text="Module.js"></pre>
<script type="text/ng-template" id="Module.js">
angular.module('itesoft-showcase',['ngMessages','itesoft']);
</script>
</div>
<div class="tab-pane" title="controller.js">
<pre class="prettyprint linenums" ng-set-text="controller.js"></pre>
<script type="text/ng-template" id="controller.js">
angular.module('itesoft-showcase').controller('HomeCtrl',
['$scope','$log','$timeout',function($scope,$log,$timeout) {
           $scope.myData = [];
           $scope.availablesTax = [];
           // sample values
           $scope.myDataInit = [ { "firstName": "Cox", "lastName": "Carney", "company": "Enormo", "employed": true }, { "firstName": "Lorraine", "lastName": "Wise", "company": "Comveyer", "employed": false }, { "firstName": "Nancy", "lastName": "Waters", "company": "Fuelton", "employed": false }];
           $scope.firstNameOptions = [{id:"Cox",value:"Cox"},{id:"Lorraine",value:"Lorraine"},{id:"Enormo",value:"Enormo"},{id:"Enormo1",value:"Enormo1"},{id:"Enormo2",value:"Enormo2"},{id:"Enormo3",value:"Enormo3"},{id:"Enormo4",value:"Enormo4"},{id:"Enormo5",value:"Enormo5"},{id:"Enormo6",value:"Enormo6"},{id:"Enormo7",value:"Enormo7"},{id:"Enormo8",value:"Enormo8"},{id:"Enormo9",value:"Enormo9"},{id:"Enormo10",value:"Enormo10"},{id:"Enormo11",value:"Enormo12"}];
           $scope.lastNameOptions = [{id:"Carney",value:"Carney"},{id:"Wise",value:"Wise"},{id:"Waters",value:"Waters"}];
           $scope.customOptions = [
           {id:20,value:"FR_20"},{id:19.6,value:"FR_19.6"},{id:7,value:"FR_7"},{id:"10",value:"FR_10"},{id:"19",value:"DE_19"},{id:"7",value:"DE_7"},{id:"0",value:"NO"},
           {id:"22",value:"FR_22"},{id:"23",value:"FR_23"},{id:"24",value:"FR_24"},{id:"25",value:"FR_25"},{id:"26",value:"DE_26"},{id:"27",value:"DE_27"},{id:"28",value:"28"}
           ];

           $scope.rate = "";
           $scope.code = "";


           $scope.tvas = [{rate:"19.6",code:"TVA_FR_OLD"},{rate:"20",code:"TVA_FR"}];


           $timeout(function(){
               $scope.availablesTax =[
               {"id":1,"companyId":1,"code":"D5.5","name":"TVA 5,5% Biens & Services Débit","rate":5.5,"content":{"JURIDICTION":"FR/FR","ACCOUNT":"445200","END_DATE":1522627200000,"START_DATE":1522627200000,"OFFSET_TAX":"","OFFSET_ACCOUNT":""}},
               {"id":2,"companyId":1,"code":"D20","name":"TVA 20% Biens & Services Débit","rate":20,"content":{"JURIDICTION":"FR/FR","ACCOUNT":"445100","END_DATE":1522627200000,"START_DATE":1522627200000,"OFFSET_TAX":"","OFFSET_ACCOUNT":""}}
               ];

               $scope.selectedtax =  {"id":1,"companyId":1,"code":"D5.5","name":"TVA 5,5% Biens & Services Débit","rate":5.5,"content":{"JURIDICTION":"FR/FR","ACCOUNT":"445200","END_DATE":1522627200000,"START_DATE":1522627200000,"OFFSET_TAX":"","OFFSET_ACCOUNT":""}}          ;
           },1000);
;
           angular.copy($scope.myDataInit,$scope.myData);


           $scope.options = {
               // call when lazyGrid is instantiate
               onRegisterApi: function (autocomplete) {
                   $scope.autocomplete = autocomplete;
                    // Call when user click
                   $scope.autocomplete.fn.searchPredicate= function(inputValue,itemToTest){
                       return (itemToTest.id.indexOf(inputValue) !== -1 || itemToTest.value.indexOf(inputValue) !== -1);
                   }
               }
           }

           $scope.taxConverter={
               getObject : function(item){
                   var resultItem = item;
                   resultItem.content = undefined;
                   return resultItem;
               },
               getIdFromObject: function(object){
                   if(angular.isDefined(object)){
                       return object.id;
                   }else{
                       $log.error("unable to get id of null object");
                   }
               },
               getLabelFromObject: function(object){
                   if(angular.isDefined(object)){
                       return object.code;
                   }else{
                       return "";
                   }
               }
           }

           $scope.firstRate ="";
           $scope.firstCode ="";
           $scope.secondRate ="";
           $scope.secondCode ="";

           $scope.getRate = function(code){
               var result = [];
                   $log.debug("getRate with code: "+code);
                   angular.forEach($scope.tvas, function(tva){
                       if( angular.isUndefined(code) || code == '' || tva.code==code){
                       result.push({id:tva.rate,value:tva.rate})
                       }
                   })
                 return result;
           };


           $scope.getCode = function(tax){
                var result = [];
               if(angular.isDefined(tax)){
                   $log.debug("getCode with rate: "+tax);
                   angular.forEach($scope.tvas, function(tva){
                       if( angular.isUndefined(tax) || tax == '' ||  tva.rate==tax){
                       result.push({id:tva.code,value:tva.code})
                       }
                   })
               }else{
                   angular.forEach($scope.tvas, function(tva){
                       result.push({id:tva.rate,value:tva.rate})
                   })
               }
               return result;
           };


           $scope.gridOptions = {
               data:$scope.myData,
               useExternalFiltering: true,
               enableFiltering: true,
               onRegisterApi: function(gridApi){

                 $scope.gridApi = gridApi;
                 //quick an dirty example of filter that use it-autocomplete
                 $scope.gridApi.core.on.filterChanged($scope, function(){
                     $scope.myData = [];
                           var filterUse = false;
                     angular.forEach($scope.myDataInit,function(item){
                           var added = false;
                           var key = '';
                           var value = '';
                           for (var i = 0; i < $scope.gridApi.grid.columns.length; i++) {
                           if(!added){
                                   key = $scope.gridApi.grid.columns[i].field;
                                   for (var j = 0; j < $scope.gridApi.grid.columns[i].filters.length; j++) {
                                           value = $scope.gridApi.grid.columns[i].filters[j].term;
                                           if (value != undefined && value != '' && item[key] == value) {
                                               $scope.myData.push(item);
                                               added = true;
                                               filterUse = true;
                                           }
                                           if (value == undefined) {
                                               $scope.myData.push(item);
                                               added = true;
                                               filterUse = true;
                                           }
                                        }
                                   }
                                   }
                           if(! filterUse){
                            //angular.copy($scope.myDataInit,$scope.myData);
                           }
                           $scope.gridOptions.data = $scope.myData;
                           $scope.gridOptions.totalItems = $scope.myData.length;
                     })
                   });
               },
               columnDefs:[{
                   name: 'firstName',
                   cellClass: 'firstName',
                   filterHeaderTemplate: '<div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><it-autocomplete placeholder="\'filter\'" items="grid.appScope.firstNameOptions" selected-option="colFilter.term" input-class="\'firstNameFilter\'" option-container-class="\'width300\'" ></it-autocomplete></div>',
                   filter:[{
                     term: 1
                     }]
                   },
                   {
                   name: 'lastName',
                   cellClass: 'lastName',
                   filterHeaderTemplate: '<div class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><it-autocomplete items="grid.appScope.lastNameOptions" selected-option="colFilter.term" input-class="\'lastNameFilter\'" option-container-class="\'width300\'"></it-autocomplete></div>',
                   filter:[{
                     term: 1 }]
                   }
               ]
           };
           $scope.selectedOption = "Lorraine";
    }
]);
</script>
</div>
</div><h4 id="example_autocomplete-map-with-object_demo">Demo</h4>
<div class="well doc-example-live animate-container" ng-embed-app="itesoft-showcase" ng-set-html="index.html-4" ng-eval-javascript="Module.js controller.js"></div>
</div></div>
</div>
